var bo=Object.defineProperty,wo=Object.defineProperties;var Co=Object.getOwnPropertyDescriptors;var ri=Object.getOwnPropertySymbols;var In=Object.prototype.hasOwnProperty,$n=Object.prototype.propertyIsEnumerable;var Bn=Math.pow,Pi=(c,t,f)=>t in c?bo(c,t,{enumerable:!0,configurable:!0,writable:!0,value:f}):c[t]=f,yt=(c,t)=>{for(var f in t||(t={}))In.call(t,f)&&Pi(c,f,t[f]);if(ri)for(var f of ri(t))$n.call(t,f)&&Pi(c,f,t[f]);return c},Ot=(c,t)=>wo(c,Co(t));var Rn=(c,t)=>{var f={};for(var p in c)In.call(c,p)&&t.indexOf(p)<0&&(f[p]=c[p]);if(c!=null&&ri)for(var p of ri(c))t.indexOf(p)<0&&$n.call(c,p)&&(f[p]=c[p]);return f};var J=(c,t,f)=>(Pi(c,typeof t!="symbol"?t+"":t,f),f);var ie=(c,t,f)=>new Promise((p,m)=>{var y=r=>{try{u(f.next(r))}catch(a){m(a)}},w=r=>{try{u(f.throw(r))}catch(a){m(a)}},u=r=>r.done?p(r.value):Promise.resolve(r.value).then(y,w);u((f=f.apply(c,t)).next())});import{c as xi,k as Nr,a as gn,g as Wr,s as xo,b as So,d as To,e as Oo,f as Xr,S as zn,h as ko,i as pn,j as vn,n as yi,l as Yr,m as Ao,o as Eo,p as Mo,q as Po,r as Do,t as jo,u as Lo,v as Fo,w as Io,x as $o,y as Di,z as Gr,A as Bo,B as Ro,C as zo,D as Rt,E as _e,F as Jt,G as Ho,H as it,I as Z,J as at,K as M,L as $,M as dt,N as ct,O as Ct,P as qr,Q as Ht,R as D,T as vt,U as me,V as de,W as Vo,X as Uo,Y as No,Z as Wo,_ as mn,$ as Qe,a0 as Xo,a1 as Pe,a2 as Ft,a3 as I,a4 as ke,a5 as Si,a6 as kt,a7 as It,a8 as Ut,a9 as bt,aa as ae,ab as le,ac as wt,ad as Yo,ae as ti,af as Go,ag as qo,ah as ei,ai as Qt,aj as qt,ak as Xe,al as Ko,am as Ve,an as Jo,ao as Hn,ap as Vn,aq as si,ar as Un,as as Xi,at as Nn,au as Zo}from"./index.9ba2f0f9.js";import{_ as Bt}from"./_plugin-vue_export-helper.c27b6911.js";import{a as Ti,g as Qo}from"./index.db9bc9a4.js";import{r as ji}from"./___vite-browser-external_commonjs-proxy.6a231247.js";function ta(){}function ea(c,t){for(var f=-1,p=c==null?0:c.length;++f<p&&t(c[f],f,c)!==!1;);return c}function ia(c,t,f,p){for(var m=c.length,y=f+(p?1:-1);p?y--:++y<m;)if(t(c[y],y,c))return y;return-1}function na(c){return c!==c}function ra(c,t,f){for(var p=f-1,m=c.length;++p<m;)if(c[p]===t)return p;return-1}function sa(c,t,f){return t===t?ra(c,t,f):ia(c,na,f)}function oa(c,t){var f=c==null?0:c.length;return!!f&&sa(c,t,0)>-1}function aa(c,t){return c&&xi(t,Nr(t),c)}function la(c,t){return c&&xi(t,gn(t),c)}function ca(c,t){return xi(c,Wr(c),t)}var ha=Object.getOwnPropertySymbols,ua=ha?function(c){for(var t=[];c;)So(t,Wr(c)),c=To(c);return t}:xo;const Kr=ua;function fa(c,t){return xi(c,Kr(c),t)}function da(c){return Oo(c,gn,Kr)}var ga=Object.prototype,pa=ga.hasOwnProperty;function va(c){var t=c.length,f=new c.constructor(t);return t&&typeof c[0]=="string"&&pa.call(c,"index")&&(f.index=c.index,f.input=c.input),f}function ma(c,t){var f=t?Xr(c.buffer):c.buffer;return new c.constructor(f,c.byteOffset,c.byteLength)}var _a=/\w*$/;function ya(c){var t=new c.constructor(c.source,_a.exec(c));return t.lastIndex=c.lastIndex,t}var Wn=zn?zn.prototype:void 0,Xn=Wn?Wn.valueOf:void 0;function ba(c){return Xn?Object(Xn.call(c)):{}}var wa="[object Boolean]",Ca="[object Date]",xa="[object Map]",Sa="[object Number]",Ta="[object RegExp]",Oa="[object Set]",ka="[object String]",Aa="[object Symbol]",Ea="[object ArrayBuffer]",Ma="[object DataView]",Pa="[object Float32Array]",Da="[object Float64Array]",ja="[object Int8Array]",La="[object Int16Array]",Fa="[object Int32Array]",Ia="[object Uint8Array]",$a="[object Uint8ClampedArray]",Ba="[object Uint16Array]",Ra="[object Uint32Array]";function za(c,t,f){var p=c.constructor;switch(t){case Ea:return Xr(c);case wa:case Ca:return new p(+c);case Ma:return ma(c,f);case Pa:case Da:case ja:case La:case Fa:case Ia:case $a:case Ba:case Ra:return ko(c,f);case xa:return new p;case Sa:case ka:return new p(c);case Ta:return ya(c);case Oa:return new p;case Aa:return ba(c)}}var Ha="[object Map]";function Va(c){return pn(c)&&vn(c)==Ha}var Yn=yi&&yi.isMap,Ua=Yn?Yr(Yn):Va;const Na=Ua;var Wa="[object Set]";function Xa(c){return pn(c)&&vn(c)==Wa}var Gn=yi&&yi.isSet,Ya=Gn?Yr(Gn):Xa;const Ga=Ya;var qa=1,Ka=2,Ja=4,Jr="[object Arguments]",Za="[object Array]",Qa="[object Boolean]",tl="[object Date]",el="[object Error]",Zr="[object Function]",il="[object GeneratorFunction]",nl="[object Map]",rl="[object Number]",Qr="[object Object]",sl="[object RegExp]",ol="[object Set]",al="[object String]",ll="[object Symbol]",cl="[object WeakMap]",hl="[object ArrayBuffer]",ul="[object DataView]",fl="[object Float32Array]",dl="[object Float64Array]",gl="[object Int8Array]",pl="[object Int16Array]",vl="[object Int32Array]",ml="[object Uint8Array]",_l="[object Uint8ClampedArray]",yl="[object Uint16Array]",bl="[object Uint32Array]",At={};At[Jr]=At[Za]=At[hl]=At[ul]=At[Qa]=At[tl]=At[fl]=At[dl]=At[gl]=At[pl]=At[vl]=At[nl]=At[rl]=At[Qr]=At[sl]=At[ol]=At[al]=At[ll]=At[ml]=At[_l]=At[yl]=At[bl]=!0;At[el]=At[Zr]=At[cl]=!1;function fi(c,t,f,p,m,y){var w,u=t&qa,r=t&Ka,a=t&Ja;if(f&&(w=m?f(c,p,m,y):f(c)),w!==void 0)return w;if(!Ao(c))return c;var l=Eo(c);if(l){if(w=va(c),!u)return Mo(c,w)}else{var i=vn(c),s=i==Zr||i==il;if(Po(c))return Do(c,u);if(i==Qr||i==Jr||s&&!m){if(w=r||s?{}:jo(c),!u)return r?fa(c,la(w,c)):ca(c,aa(w,c))}else{if(!At[i])return m?c:{};w=za(c,i,u)}}y||(y=new Lo);var e=y.get(c);if(e)return e;y.set(c,w),Ga(c)?c.forEach(function(n){w.add(fi(n,t,f,n,c,y))}):Na(c)&&c.forEach(function(n,d){w.set(d,fi(n,t,f,d,c,y))});var o=a?r?da:Fo:r?gn:Nr,h=l?void 0:o(c);return ea(h||c,function(n,d){h&&(d=n,n=c[d]),Io(w,d,fi(n,t,f,d,c,y))}),w}var wl=1,Cl=4;function bi(c){return fi(c,wl|Cl)}function xl(c,t,f){for(var p=-1,m=c==null?0:c.length;++p<m;)if(f(t,c[p]))return!0;return!1}var Sl="[object Number]";function Yt(c){return typeof c=="number"||pn(c)&&$o(c)==Sl}function Tl(c){return c===void 0}var Ol=1/0,kl=Di&&1/Gr(new Di([,-0]))[1]==Ol?function(c){return new Di(c)}:ta;const Al=kl;var El=200;function Ml(c,t,f){var p=-1,m=oa,y=c.length,w=!0,u=[],r=u;if(f)w=!1,m=xl;else if(y>=El){var a=t?null:Al(c);if(a)return Gr(a);w=!1,m=Ro,r=new Bo}else r=t?[]:u;t:for(;++p<y;){var l=c[p],i=t?t(l):l;if(l=f||l!==0?l:0,w&&i===i){for(var s=r.length;s--;)if(r[s]===i)continue t;t&&r.push(i),u.push(l)}else m(r,i,f)||(r!==u&&r.push(i),u.push(l))}return u}function Pl(c,t){return c&&c.length?Ml(c,zo(t)):[]}var re=(c=>(c.EMPTY="",c.ONE="one",c.MULTI="multiple",c))(re||{}),Zt=(c=>(c.ONE="selectOne",c.MULTI="selectMultiple",c.CANCEL="selectCancel",c))(Zt||{});function Pt(){const c=Rt({mSelectMode:re.EMPTY,mSelectOneType:"",mSelectId:"",mSelectIds:[],mSelectActive:[]}),t=_e("fabric"),f=_e("canvasEditor"),p=_e("event"),m=u=>{c.mSelectMode=re.ONE,u[0]&&(c.mSelectId=u[0].id,c.mSelectOneType=u[0].type,c.mSelectIds=u.map(r=>r.id))},y=u=>{c.mSelectMode=re.MULTI,c.mSelectId="",c.mSelectIds=u.map(r=>r.id)},w=()=>{c.mSelectId="",c.mSelectIds=[],c.mSelectMode=re.EMPTY,c.mSelectOneType=""};return Jt(()=>{p.on(Zt.ONE,m),p.on(Zt.MULTI,y),p.on(Zt.CANCEL,w)}),Ho(()=>{p.off(Zt.ONE,m),p.off(Zt.MULTI,y),p.off(Zt.CANCEL,w)}),{fabric:t,canvasEditor:f,mixinState:c}}const Dl={style:{display:"inline-block"}},jl=Ct({name:"ImportJson"}),Ll=Object.assign(jl,{setup(c){const{canvasEditor:t}=Pt(),f=()=>{t.insert()};return(p,m)=>{const y=it("Button");return Z(),at("div",Dl,[M(y,{onClick:f,type:"text",size:"small"},{default:$(()=>[dt(ct(p.$t("import_files")),1)]),_:1})])}}});var ts={exports:{}};(function(c){(function(){function t(h,n){document.addEventListener?h.addEventListener("scroll",n,!1):h.attachEvent("scroll",n)}function f(h){document.body?h():document.addEventListener?document.addEventListener("DOMContentLoaded",function n(){document.removeEventListener("DOMContentLoaded",n),h()}):document.attachEvent("onreadystatechange",function n(){(document.readyState=="interactive"||document.readyState=="complete")&&(document.detachEvent("onreadystatechange",n),h())})}function p(h){this.g=document.createElement("div"),this.g.setAttribute("aria-hidden","true"),this.g.appendChild(document.createTextNode(h)),this.h=document.createElement("span"),this.i=document.createElement("span"),this.m=document.createElement("span"),this.j=document.createElement("span"),this.l=-1,this.h.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.i.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.j.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.m.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.h.appendChild(this.m),this.i.appendChild(this.j),this.g.appendChild(this.h),this.g.appendChild(this.i)}function m(h,n){h.g.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;white-space:nowrap;font-synthesis:none;font:"+n+";"}function y(h){var n=h.g.offsetWidth,d=n+100;return h.j.style.width=d+"px",h.i.scrollLeft=d,h.h.scrollLeft=h.h.scrollWidth+100,h.l!==n?(h.l=n,!0):!1}function w(h,n){function d(){var v=g;y(v)&&v.g.parentNode!==null&&n(v.l)}var g=h;t(h.h,d),t(h.i,d),y(h)}function u(h,n,d){n=n||{},d=d||window,this.family=h,this.style=n.style||"normal",this.weight=n.weight||"normal",this.stretch=n.stretch||"normal",this.context=d}var r=null,a=null,l=null,i=null;function s(h){return a===null&&(e(h)&&/Apple/.test(window.navigator.vendor)?(h=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))(?:\.([0-9]+))/.exec(window.navigator.userAgent),a=!!h&&603>parseInt(h[1],10)):a=!1),a}function e(h){return i===null&&(i=!!h.document.fonts),i}function o(h,n){var d=h.style,g=h.weight;if(l===null){var v=document.createElement("div");try{v.style.font="condensed 100px sans-serif"}catch(_){}l=v.style.font!==""}return[d,g,l?h.stretch:"","100px",n].join(" ")}u.prototype.load=function(h,n){var d=this,g=h||"BESbswy",v=0,_=n||3e3,b=new Date().getTime();return new Promise(function(C,S){if(e(d.context)&&!s(d.context)){var E=new Promise(function(V,W){function L(){new Date().getTime()-b>=_?W(Error(""+_+"ms timeout exceeded")):d.context.document.fonts.load(o(d,'"'+d.family+'"'),g).then(function(A){1<=A.length?V():setTimeout(L,25)},W)}L()}),z=new Promise(function(V,W){v=setTimeout(function(){W(Error(""+_+"ms timeout exceeded"))},_)});Promise.race([z,E]).then(function(){clearTimeout(v),C(d)},S)}else f(function(){function V(){var P;(P=B!=-1&&st!=-1||B!=-1&&ht!=-1||st!=-1&&ht!=-1)&&((P=B!=st&&B!=ht&&st!=ht)||(r===null&&(P=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),r=!!P&&(536>parseInt(P[1],10)||parseInt(P[1],10)===536&&11>=parseInt(P[2],10))),P=r&&(B==ft&&st==ft&&ht==ft||B==O&&st==O&&ht==O||B==F&&st==F&&ht==F)),P=!P),P&&(j.parentNode!==null&&j.parentNode.removeChild(j),clearTimeout(v),C(d))}function W(){if(new Date().getTime()-b>=_)j.parentNode!==null&&j.parentNode.removeChild(j),S(Error(""+_+"ms timeout exceeded"));else{var P=d.context.document.hidden;(P===!0||P===void 0)&&(B=L.g.offsetWidth,st=A.g.offsetWidth,ht=X.g.offsetWidth,V()),v=setTimeout(W,50)}}var L=new p(g),A=new p(g),X=new p(g),B=-1,st=-1,ht=-1,ft=-1,O=-1,F=-1,j=document.createElement("div");j.dir="ltr",m(L,o(d,"sans-serif")),m(A,o(d,"serif")),m(X,o(d,"monospace")),j.appendChild(L.g),j.appendChild(A.g),j.appendChild(X.g),d.context.document.body.appendChild(j),ft=L.g.offsetWidth,O=A.g.offsetWidth,F=X.g.offsetWidth,W(),w(L,function(P){B=P,V()}),m(L,o(d,'"'+d.family+'",sans-serif')),w(A,function(P){st=P,V()}),m(A,o(d,'"'+d.family+'",serif')),w(X,function(P){ht=P,V()}),m(X,o(d,'"'+d.family+'",monospace'))})})},c.exports=u})()})(ts);var Fl=ts.exports;const es=qr(Fl);function _n(c){return Vo()?(Uo(c),!0):!1}function Il(){const c=new Set,t=m=>{c.delete(m)};return{on:m=>{c.add(m);const y=()=>t(m);return _n(y),{off:y}},off:t,trigger:(...m)=>Promise.all(Array.from(c).map(y=>y(...m)))}}function Te(c){return typeof c=="function"?c():D(c)}const ii=typeof window!="undefined"&&typeof document!="undefined";typeof WorkerGlobalScope!="undefined"&&globalThis instanceof WorkerGlobalScope;const $l=Object.prototype.toString,Bl=c=>$l.call(c)==="[object Object]",Rl=()=>+Date.now(),is=()=>{},zl=(c,t)=>Object.prototype.hasOwnProperty.call(c,t);function Hl(c,t){function f(...p){return new Promise((m,y)=>{Promise.resolve(c(()=>t.apply(this,p),{fn:t,thisArg:this,args:p})).then(m).catch(y)})}return f}const ns=c=>c();function Vl(c=ns){const t=vt(!0);function f(){t.value=!1}function p(){t.value=!0}const m=(...y)=>{t.value&&c(...y)};return{isActive:me(t),pause:f,resume:p,eventFilter:m}}function Ul(c){let t;function f(){return t||(t=c()),t}return f.reset=()=>ie(this,null,function*(){const p=t;t=void 0,p&&(yield p)}),f}function Nl(c){return c||Qe()}function Wl(...c){if(c.length!==1)return No(...c);const t=c[0];return typeof t=="function"?me(Wo(()=>({get:t,set:is}))):vt(t)}function Xl(c,t=!0,f){Nl()?Jt(c,f):t?c():mn(c)}const Yl=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,Gl=/[YMDHhms]o|\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a{1,2}|A{1,2}|m{1,2}|s{1,2}|Z{1,2}|SSS/g;function ql(c,t,f,p){let m=c<12?"AM":"PM";return p&&(m=m.split("").reduce((y,w)=>y+=`${w}.`,"")),f?m.toLowerCase():m}function xe(c){const t=["th","st","nd","rd"],f=c%100;return c+(t[(f-20)%10]||t[f]||t[0])}function Kl(c,t,f={}){var p;const m=c.getFullYear(),y=c.getMonth(),w=c.getDate(),u=c.getHours(),r=c.getMinutes(),a=c.getSeconds(),l=c.getMilliseconds(),i=c.getDay(),s=(p=f.customMeridiem)!=null?p:ql,e={Yo:()=>xe(m),YY:()=>String(m).slice(-2),YYYY:()=>m,M:()=>y+1,Mo:()=>xe(y+1),MM:()=>`${y+1}`.padStart(2,"0"),MMM:()=>c.toLocaleDateString(f.locales,{month:"short"}),MMMM:()=>c.toLocaleDateString(f.locales,{month:"long"}),D:()=>String(w),Do:()=>xe(w),DD:()=>`${w}`.padStart(2,"0"),H:()=>String(u),Ho:()=>xe(u),HH:()=>`${u}`.padStart(2,"0"),h:()=>`${u%12||12}`.padStart(1,"0"),ho:()=>xe(u%12||12),hh:()=>`${u%12||12}`.padStart(2,"0"),m:()=>String(r),mo:()=>xe(r),mm:()=>`${r}`.padStart(2,"0"),s:()=>String(a),so:()=>xe(a),ss:()=>`${a}`.padStart(2,"0"),SSS:()=>`${l}`.padStart(3,"0"),d:()=>i,dd:()=>c.toLocaleDateString(f.locales,{weekday:"narrow"}),ddd:()=>c.toLocaleDateString(f.locales,{weekday:"short"}),dddd:()=>c.toLocaleDateString(f.locales,{weekday:"long"}),A:()=>s(u,r),AA:()=>s(u,r,!1,!0),a:()=>s(u,r,!0),aa:()=>s(u,r,!0,!0)};return t.replace(Gl,(o,h)=>{var n,d;return(d=h!=null?h:(n=e[o])==null?void 0:n.call(e))!=null?d:o})}function Jl(c){if(c===null)return new Date(Number.NaN);if(c===void 0)return new Date;if(c instanceof Date)return new Date(c);if(typeof c=="string"&&!/Z$/i.test(c)){const t=c.match(Yl);if(t){const f=t[2]-1||0,p=(t[7]||"0").substring(0,3);return new Date(t[1],f,t[3]||1,t[4]||0,t[5]||0,t[6]||0,p)}}return new Date(c)}function Zl(c,t="HH:mm:ss",f={}){return Ht(()=>Kl(Jl(Te(c)),Te(t),f))}function Ql(c,t,f={}){const{immediate:p=!0}=f,m=vt(!1);let y=null;function w(){y&&(clearTimeout(y),y=null)}function u(){m.value=!1,w()}function r(...a){w(),m.value=!0,y=setTimeout(()=>{m.value=!1,y=null,c(...a)},Te(t))}return p&&(m.value=!0,ii&&r()),_n(u),{isPending:me(m),start:r,stop:u}}function tc(c,t,f={}){const a=f,{eventFilter:p=ns}=a,m=Rn(a,["eventFilter"]),y=Hl(p,t);let w,u,r;if(m.flush==="sync"){const l=vt(!1);u=()=>{},w=i=>{l.value=!0,i(),l.value=!1},r=de(c,(...i)=>{l.value||y(...i)},m)}else{const l=[],i=vt(0),s=vt(0);u=()=>{i.value=s.value},l.push(de(c,()=>{s.value++},Ot(yt({},m),{flush:"sync"}))),w=e=>{const o=s.value;e(),i.value+=s.value-o},l.push(de(c,(...e)=>{const o=i.value>0&&i.value===s.value;i.value=0,s.value=0,!o&&y(...e)},m)),r=()=>{l.forEach(e=>e())}}return{stop:r,ignoreUpdates:w,ignorePrevAsyncUpdates:u}}function ec(c){var t;const f=Te(c);return(t=f==null?void 0:f.$el)!=null?t:f}const ic=ii?window:void 0,nc=ii?window.document:void 0,rs=ii?window.navigator:void 0;function Ue(...c){let t,f,p,m;if(typeof c[0]=="string"||Array.isArray(c[0])?([f,p,m]=c,t=ic):[t,f,p,m]=c,!t)return is;Array.isArray(f)||(f=[f]),Array.isArray(p)||(p=[p]);const y=[],w=()=>{y.forEach(l=>l()),y.length=0},u=(l,i,s,e)=>(l.addEventListener(i,s,e),()=>l.removeEventListener(i,s,e)),r=de(()=>[ec(t),Te(m)],([l,i])=>{if(w(),!l)return;const s=Bl(i)?yt({},i):i;y.push(...f.flatMap(e=>p.map(o=>u(l,e,o,s))))},{immediate:!0,flush:"post"}),a=()=>{r(),w()};return _n(a),a}function rc(){const c=vt(!1),t=Qe();return t&&Jt(()=>{c.value=!0},t),c}function ss(c){const t=rc();return Ht(()=>(t.value,!!c()))}const Re={array:c=>JSON.stringify(c),object:c=>JSON.stringify(c),set:c=>JSON.stringify(Array.from(c)),map:c=>JSON.stringify(Object.fromEntries(c)),null:()=>""};function sc(c){return c?c instanceof Map?Re.map:c instanceof Set?Re.set:Array.isArray(c)?Re.array:Re.object:Re.null}function oc(c,t){const f=vt(""),p=vt();function m(){if(ii)return p.value=new Promise((y,w)=>{try{const u=Te(c);if(u==null)y("");else if(typeof u=="string")y(Li(new Blob([u],{type:"text/plain"})));else if(u instanceof Blob)y(Li(u));else if(u instanceof ArrayBuffer)y(window.btoa(String.fromCharCode(...new Uint8Array(u))));else if(u instanceof HTMLCanvasElement)y(u.toDataURL(t==null?void 0:t.type,t==null?void 0:t.quality));else if(u instanceof HTMLImageElement){const r=u.cloneNode(!1);r.crossOrigin="Anonymous",ac(r).then(()=>{const a=document.createElement("canvas"),l=a.getContext("2d");a.width=r.width,a.height=r.height,l.drawImage(r,0,0,a.width,a.height),y(a.toDataURL(t==null?void 0:t.type,t==null?void 0:t.quality))}).catch(w)}else if(typeof u=="object"){const a=((t==null?void 0:t.serializer)||sc(u))(u);return y(Li(new Blob([a],{type:"application/json"})))}else w(new Error("target is unsupported types"))}catch(u){w(u)}}),p.value.then(y=>f.value=y),p.value}return Pe(c)||typeof c=="function"?de(c,m,{immediate:!0}):m(),{base64:f,promise:p,execute:m}}function ac(c){return new Promise((t,f)=>{c.complete?t():(c.onload=()=>{t()},c.onerror=f)})}function Li(c){return new Promise((t,f)=>{const p=new FileReader;p.onload=m=>{t(m.target.result)},p.onerror=f,p.readAsDataURL(c)})}function qn(c,t={}){const{controls:f=!1,navigator:p=rs}=t,m=ss(()=>p&&"permissions"in p);let y;const w=typeof c=="string"?{name:c}:c,u=vt(),r=()=>{y&&(u.value=y.state)},a=Ul(()=>ie(this,null,function*(){if(m.value){if(!y)try{y=yield p.permissions.query(w),Ue(y,"change",r),r()}catch(l){u.value="prompt"}return y}}));return a(),f?{state:u,isSupported:m,query:a}:u}function lc(c={}){const{navigator:t=rs,read:f=!1,source:p,copiedDuring:m=1500,legacy:y=!1}=c,w=ss(()=>t&&"clipboard"in t),u=qn("clipboard-read"),r=qn("clipboard-write"),a=Ht(()=>w.value||y),l=vt(""),i=vt(!1),s=Ql(()=>i.value=!1,m);function e(){w.value&&d(u.value)?t.clipboard.readText().then(g=>{l.value=g}):l.value=n()}a.value&&f&&Ue(["copy","cut"],e);function o(){return ie(this,arguments,function*(g=Te(p)){a.value&&g!=null&&(w.value&&d(r.value)?yield t.clipboard.writeText(g):h(g),l.value=g,i.value=!0,s.start())})}function h(g){const v=document.createElement("textarea");v.value=g!=null?g:"",v.style.position="absolute",v.style.opacity="0",document.body.appendChild(v),v.select(),document.execCommand("copy"),v.remove()}function n(){var g,v,_;return(_=(v=(g=document==null?void 0:document.getSelection)==null?void 0:g.call(document))==null?void 0:v.toString())!=null?_:""}function d(g){return g==="granted"||g==="prompt"}return{isSupported:a,text:l,copied:i,copy:o}}function os(c){return JSON.parse(JSON.stringify(c))}function as(c){return c}function cc(c,t){return c.value=t}function hc(c){return c?typeof c=="function"?c:os:as}function uc(c){return c?typeof c=="function"?c:os:as}function fc(c,t={}){const{clone:f=!1,dump:p=hc(f),parse:m=uc(f),setSource:y=cc}=t;function w(){return Xo({snapshot:p(c.value),timestamp:Rl()})}const u=vt(w()),r=vt([]),a=vt([]),l=v=>{y(c,m(v.snapshot)),u.value=v},i=()=>{r.value.unshift(u.value),u.value=w(),t.capacity&&r.value.length>t.capacity&&r.value.splice(t.capacity,Number.POSITIVE_INFINITY),a.value.length&&a.value.splice(0,a.value.length)},s=()=>{r.value.splice(0,r.value.length),a.value.splice(0,a.value.length)},e=()=>{const v=r.value.shift();v&&(a.value.unshift(u.value),l(v))},o=()=>{const v=a.value.shift();v&&(r.value.unshift(u.value),l(v))},h=()=>{l(u.value)},n=Ht(()=>[u.value,...r.value]),d=Ht(()=>r.value.length>0),g=Ht(()=>a.value.length>0);return{source:c,undoStack:r,redoStack:a,last:u,history:n,canUndo:d,canRedo:g,clear:s,commit:i,reset:h,undo:e,redo:o}}function dc(c,t={}){const{deep:f=!1,flush:p="pre",eventFilter:m}=t,{eventFilter:y,pause:w,resume:u,isActive:r}=Vl(m),{ignoreUpdates:a,ignorePrevAsyncUpdates:l,stop:i}=tc(c,n,{deep:f,flush:p,eventFilter:y});function s(_,b){l(),a(()=>{_.value=b})}const e=fc(c,Ot(yt({},t),{clone:t.clone||f,setSource:s})),{clear:o,commit:h}=e;function n(){l(),h()}function d(_){u(),_&&n()}function g(_){let b=!1;const C=()=>b=!0;a(()=>{_(C)}),b||n()}function v(){i(),o()}return Ot(yt({},e),{isTracking:r,pause:w,resume:d,commit:n,batch:g,dispose:v})}const gc={multiple:!0,accept:"*",reset:!1,directory:!1};function pc(c={}){const{document:t=nc}=c,f=vt(null),{on:p,trigger:m}=Il();let y;t&&(y=t.createElement("input"),y.type="file",y.onchange=r=>{const a=r.target;f.value=a.files,m(f.value)});const w=()=>{f.value=null,y&&(y.value="",m(null))},u=r=>{if(!y)return;const a=yt(yt(yt({},gc),c),r);y.multiple=a.multiple,y.accept=a.accept,y.webkitdirectory=a.directory,zl(a,"capture")&&(y.capture=a.capture),a.reset&&w(),y.click()};return{files:me(f),open:u,reset:w,onChange:p}}function vc(c,t={}){const f=Wl(c),{threshold:p=50,onSwipe:m,onSwipeEnd:y,onSwipeStart:w,disableTextSelect:u=!1}=t,r=Rt({x:0,y:0}),a=(S,E)=>{r.x=S,r.y=E},l=Rt({x:0,y:0}),i=(S,E)=>{l.x=S,l.y=E},s=Ht(()=>r.x-l.x),e=Ht(()=>r.y-l.y),{max:o,abs:h}=Math,n=Ht(()=>o(h(s.value),h(e.value))>=p),d=vt(!1),g=vt(!1),v=Ht(()=>n.value?h(s.value)>h(e.value)?s.value>0?"left":"right":e.value>0?"up":"down":"none"),_=S=>{var E,z,V;const W=S.buttons===0,L=S.buttons===1;return(V=(z=(E=t.pointerTypes)==null?void 0:E.includes(S.pointerType))!=null?z:W||L)!=null?V:!0},b=[Ue(c,"pointerdown",S=>{if(!_(S))return;g.value=!0;const E=S.target;E==null||E.setPointerCapture(S.pointerId);const{clientX:z,clientY:V}=S;a(z,V),i(z,V),w==null||w(S)}),Ue(c,"pointermove",S=>{if(!_(S)||!g.value)return;const{clientX:E,clientY:z}=S;i(E,z),!d.value&&n.value&&(d.value=!0),d.value&&(m==null||m(S))}),Ue(c,"pointerup",S=>{_(S)&&(d.value&&(y==null||y(S,v.value)),g.value=!1,d.value=!1)})];Xl(()=>{var S,E,z,V,W,L,A,X;(E=(S=f.value)==null?void 0:S.style)==null||E.setProperty("touch-action","none"),u&&((V=(z=f.value)==null?void 0:z.style)==null||V.setProperty("-webkit-user-select","none"),(L=(W=f.value)==null?void 0:W.style)==null||L.setProperty("-ms-user-select","none"),(X=(A=f.value)==null?void 0:A.style)==null||X.setProperty("user-select","none"))});const C=()=>b.forEach(S=>S());return{isSwiping:me(d),direction:me(v),posStart:me(r),posEnd:me(l),distanceX:s,distanceY:e,stop:C}}function Yi(c){return oc(c).promise.value}function mc(c){const t=["arial","Microsoft YaHei"],p=JSON.parse(c).objects.filter(m=>m.type.includes("text")&&!t.includes(m.fontFamily)).map(m=>m.fontFamily).map(m=>new es(m).load(null,15e4));return Promise.all(p)}function wi(c){return new Promise(t=>{const{onChange:f,open:p}=pc(c);f(m=>{t(m)}),p()})}function _c(c){return new Promise(t=>{const f=document.createElement("img");f.src=c,document.body.appendChild(f),f.onload=()=>{t(f)}})}const yc=(c,t)=>ie(void 0,null,function*(){try{yield lc(yt({source:c},t)).copy(),Ft.Message.success("复制成功")}catch(f){throw Ft.Message.error("复制失败"),f}});var oi,bc=new Uint8Array(16);function wc(){if(!oi&&(oi=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!oi))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return oi(bc)}const Cc=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function xc(c){return typeof c=="string"&&Cc.test(c)}var Nt=[];for(var Fi=0;Fi<256;++Fi)Nt.push((Fi+256).toString(16).substr(1));function Sc(c){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,f=(Nt[c[t+0]]+Nt[c[t+1]]+Nt[c[t+2]]+Nt[c[t+3]]+"-"+Nt[c[t+4]]+Nt[c[t+5]]+"-"+Nt[c[t+6]]+Nt[c[t+7]]+"-"+Nt[c[t+8]]+Nt[c[t+9]]+"-"+Nt[c[t+10]]+Nt[c[t+11]]+Nt[c[t+12]]+Nt[c[t+13]]+Nt[c[t+14]]+Nt[c[t+15]]).toLowerCase();if(!xc(f))throw TypeError("Stringified UUID is invalid");return f}function Lt(c,t,f){c=c||{};var p=c.random||(c.rng||wc)();if(p[6]=p[6]&15|64,p[8]=p[8]&63|128,t){f=f||0;for(var m=0;m<16;++m)t[f+m]=p[m];return t}return Sc(p)}const Tc={style:{display:"inline-block"}},Oc={href:"javascript:void(0)"},kc=Ct({name:"ImportFile"}),Ac=Object.assign(kc,{setup(c){const{fabric:t,canvasEditor:f}=Pt(),p=Rt({showModal:!1,svgStr:""}),m={insertImg:function(){wi({accept:"image/*",multiple:!0}).then(r=>{Array.from(r).forEach(a=>{Yi(a).then(l=>{w(l)})})})},insertSvg:function(){wi({accept:".svg",multiple:!0}).then(r=>{Array.from(r).forEach(a=>{Yi(a).then(l=>{u(l)})})})},insertSvgStrModal:function(){p.svgStr="",p.showModal=!0},insertSvgStr:function(){t.loadSVGFromString(p.svgStr,(r,a)=>{const l=t.util.groupSVGElements(r,Ot(yt({},a),{name:"defaultSVG",id:Lt()}));f.canvas.add(l).centerObject(l).renderAll()})}},y=r=>{const a=m[r];a&&typeof a=="function"&&a()};function w(r){if(!r)throw new Error("file is undefined");const a=document.createElement("img");a.src=r,document.body.appendChild(a),a.onload=()=>{const l=new t.Image(a,{id:Lt(),name:"图片1",left:100,top:100});f.canvas.add(l),f.canvas.setActiveObject(l),f.canvas.renderAll(),a.remove()}}function u(r){if(!r)throw new Error("file is undefined");t.loadSVGFromURL(r,(a,l)=>{const i=t.util.groupSVGElements(a,Ot(yt({},l),{name:"defaultSVG",id:Lt()}));f.canvas.add(i).centerObject(i).renderAll()})}return(r,a)=>{const l=it("Icon"),i=it("DropdownItem"),s=it("DropdownMenu"),e=it("Dropdown"),o=it("Input"),h=it("Modal");return Z(),at("div",Tc,[M(e,{"transfer-class-name":"fix",onOnClick:y},{list:$(()=>[M(s,null,{default:$(()=>[M(i,{name:"insertImg"},{default:$(()=>[dt(ct(r.$t("insertFile.insert_picture")),1)]),_:1}),M(i,{name:"insertSvg"},{default:$(()=>[dt(ct(r.$t("insertFile.insert_SVG")),1)]),_:1}),M(i,{name:"insertSvgStrModal"},{default:$(()=>[dt(ct(r.$t("insertFile.insert_SVGStr")),1)]),_:1})]),_:1})]),default:$(()=>[I("a",Oc,[dt(ct(r.$t("insertFile.insert"))+" ",1),M(l,{type:"ios-arrow-down"})])]),_:1}),M(h,{modelValue:D(p).showModal,"onUpdate:modelValue":a[1]||(a[1]=n=>D(p).showModal=n),title:r.$t("insertFile.modal_tittle"),onOnOk:a[2]||(a[2]=n=>y("insertSvgStr")),onOnCancel:a[3]||(a[3]=n=>r.showModal=!1)},{default:$(()=>[M(o,{modelValue:D(p).svgStr,"onUpdate:modelValue":a[0]||(a[0]=n=>D(p).svgStr=n),"show-word-limit":"",type:"textarea",placeholder:r.$t("insertFile.insert_SVGStr_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["modelValue","title"])])}}}),Ec=Bt(Ac,[["__scopeId","data-v-61f41c8a"]]);const Mc={style:{display:"inline-block"}},Pc=["alt","onClick"],Dc={__name:"fontTmpl",setup(c){const t="https://nihaojob.github.io/vue-fabric-editor-static/",{fabric:f,canvasEditor:p}=Pt(),{t:m}=ke(),y=[{label:"字体",tempUrl:`${t}font-tmpl/1.json`,src:`${t}font-tmpl/1.png`},{label:"字体",tempUrl:`${t}font-tmpl/2.json`,src:`${t}font-tmpl/2.png`},{label:"字体",tempUrl:`${t}font-tmpl/3.json`,src:`${t}font-tmpl/3.png`},{label:"字体",tempUrl:`${t}font-tmpl/4.json`,src:`${t}font-tmpl/4.png`},{label:"字体",tempUrl:`${t}font-tmpl/5.json`,src:`${t}font-tmpl/5.png`}],w=r=>{Ft.Spin.show({render:l=>l("div",m("alert.loading_fonts"))});const a=JSON.parse(r);a.id=Lt(),new f.Textbox.fromObject(a,l=>{p.canvas.add(l),l.center(),p.canvas.setActiveObject(l),Ft.Spin.hide()})},u=r=>{Ft.Spin.show({render:l=>l("div",m("alert.loading_data"))}),Ti.get(r).then(l=>{w(JSON.stringify(l.data))})};return(r,a)=>{const l=it("Divider"),i=it("Tooltip"),s=Si("lazy");return Z(),at("div",Mc,[M(l,{plain:"",orientation:"left"},{default:$(()=>[dt(ct(r.$t("title_template")),1)]),_:1}),(Z(),at(kt,null,It(y,(e,o)=>M(i,{content:e.label,key:`${o}-bai1-button`,placement:"top"},{default:$(()=>[Ut(I("img",{class:"tmpl-img",alt:e.label,onClick:h=>u(e.tempUrl)},null,8,Pc),[[s,e.src]])]),_:2},1032,["content"])),64))])}}},jc=Bt(Dc,[["__scopeId","data-v-f1f0f304"]]);const be=c=>(ae("data-v-13b5a329"),c=c(),le(),c),Lc={key:0,class:"box attr-item"},Fc=be(()=>I("svg",{t:"1650442284704",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2345",width:"14",height:"14"},[I("path",{d:"M80 24h64v976H80zM198 227h448v190H198zM198 607h746v190H198z","p-id":"2346"})],-1)),Ic=be(()=>I("svg",{t:"1650442754876",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1514",width:"14",height:"14"},[I("path",{d:"M477.312 576V448H266.688a32 32 0 0 1-32-32v-192a32 32 0 0 1 32-32h210.624V34.688a34.688 34.688 0 0 1 69.376 0V192h210.624a32 32 0 0 1 32 32v192a32 32 0 0 1-32 32H546.688v128H896a32 32 0 0 1 32 32v192a32 32 0 0 1-32 32H546.688v157.312a34.688 34.688 0 1 1-69.376 0V832H128a32 32 0 0 1-32-32v-192A32 32 0 0 1 128 576h349.312z",fill:"#666666","p-id":"1515"})],-1)),$c=be(()=>I("svg",{t:"1650442299564",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2543",width:"14",height:"14"},[I("path",{d:"M944 1000h-64V24h64zM826 417H378V227h448zM826 797H80V607h746z","p-id":"2544"})],-1)),Bc=be(()=>I("svg",{t:"1650442692910",class:"icon",viewBox:"0 0 1170 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1118",width:"14",height:"14"},[I("path",{d:"M1170.285714 36.571429a36.571429 36.571429 0 0 1-36.571428 36.571428H36.571429a36.571429 36.571429 0 0 1 0-73.142857h1097.142857a36.571429 36.571429 0 0 1 36.571428 36.571429z m-219.428571 146.285714v512a36.571429 36.571429 0 0 1-36.571429 36.571428h-219.428571a36.571429 36.571429 0 0 1-36.571429-36.571428v-512a36.571429 36.571429 0 0 1 36.571429-36.571429h219.428571a36.571429 36.571429 0 0 1 36.571429 36.571429z m-438.857143 0v804.571428a36.571429 36.571429 0 0 1-36.571429 36.571429h-219.428571a36.571429 36.571429 0 0 1-36.571429-36.571429v-804.571428a36.571429 36.571429 0 0 1 36.571429-36.571429h219.428571a36.571429 36.571429 0 0 1 36.571429 36.571429z",fill:"#666666","p-id":"1119"})],-1)),Rc=be(()=>I("svg",{t:"1650442732396",class:"icon",viewBox:"0 0 1243 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1316",width:"14",height:"14"},[I("path",{d:"M548.571429 472.356571h146.285714V231.643429a36.571429 36.571429 0 0 1 36.571428-36.571429h219.428572a36.571429 36.571429 0 0 1 36.571428 36.571429v240.713142h179.785143a39.643429 39.643429 0 0 1 0 79.286858H987.428571v240.713142a36.571429 36.571429 0 0 1-36.571428 36.571429h-219.428572a36.571429 36.571429 0 0 1-36.571428-36.571429V551.643429h-146.285714V950.857143a36.571429 36.571429 0 0 1-36.571429 36.571428H292.571429a36.571429 36.571429 0 0 1-36.571429-36.571428V551.643429H76.214857a39.643429 39.643429 0 1 1 0-79.286858H256V73.142857A36.571429 36.571429 0 0 1 292.571429 36.571429h219.428571a36.571429 36.571429 0 0 1 36.571429 36.571428v399.213714z",fill:"#666666","p-id":"1317"})],-1)),zc=be(()=>I("svg",{t:"1650442674784",class:"icon",viewBox:"0 0 1170 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"920",width:"14",height:"14"},[I("path",{d:"M1170.285714 987.428571a36.571429 36.571429 0 0 0-36.571428-36.571428H36.571429a36.571429 36.571429 0 0 0 0 73.142857h1097.142857a36.571429 36.571429 0 0 0 36.571428-36.571429z m-219.428571-146.285714v-512a36.571429 36.571429 0 0 0-36.571429-36.571428h-219.428571a36.571429 36.571429 0 0 0-36.571429 36.571428v512a36.571429 36.571429 0 0 0 36.571429 36.571429h219.428571a36.571429 36.571429 0 0 0 36.571429-36.571429z m-438.857143 0V36.571429a36.571429 36.571429 0 0 0-36.571429-36.571429h-219.428571a36.571429 36.571429 0 0 0-36.571429 36.571429v804.571428a36.571429 36.571429 0 0 0 36.571429 36.571429h219.428571a36.571429 36.571429 0 0 0 36.571429-36.571429z",fill:"#666666","p-id":"921"})],-1)),Hc=be(()=>I("svg",{t:"1650442800956",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1910",width:"14",height:"14"},[I("path",{d:"M96 0a32 32 0 0 1 32 32v960a32 32 0 0 1-64 0V32A32 32 0 0 1 96 0z m832 0a32 32 0 0 1 32 32v960a32 32 0 0 1-64 0V32a32 32 0 0 1 32-32zM384 800v-576a32 32 0 0 1 32-32h192a32 32 0 0 1 32 32v576a32 32 0 0 1-32 32h-192a32 32 0 0 1-32-32z",fill:"#515151","p-id":"1911"})],-1)),Vc=be(()=>I("svg",{t:"1650442784286",class:"icon",viewBox:"0 0 1170 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1712",width:"14",height:"14"},[I("path",{d:"M1170.285714 36.571429a36.571429 36.571429 0 0 1-36.571428 36.571428H36.571429a36.571429 36.571429 0 0 1 0-73.142857h1097.142857a36.571429 36.571429 0 0 1 36.571428 36.571429z m0 950.857142a36.571429 36.571429 0 0 1-36.571428 36.571429H36.571429a36.571429 36.571429 0 0 1 0-73.142857h1097.142857a36.571429 36.571429 0 0 1 36.571428 36.571428zM256 365.714286h658.285714a36.571429 36.571429 0 0 1 36.571429 36.571428v219.428572a36.571429 36.571429 0 0 1-36.571429 36.571428h-658.285714a36.571429 36.571429 0 0 1-36.571429-36.571428v-219.428572a36.571429 36.571429 0 0 1 36.571429-36.571428z",fill:"#515151","p-id":"1713"})],-1)),Uc=Ct({name:"Align"}),Nc=Object.assign(Uc,{setup(c){const{mixinState:t,canvasEditor:f}=Pt(),p=Ht(()=>t.mSelectMode!=="multiple"),m=()=>{f.left()},y=()=>{f.right()},w=()=>{f.xcenter()},u=()=>{f.ycenter()},r=()=>{f.top()},a=()=>{f.bottom()},l=()=>{f.xequation()},i=()=>{f.yequation()};return(s,e)=>{const o=it("Button"),h=it("Tooltip");return D(t).mSelectMode==="multiple"?(Z(),at("div",Lc,[M(h,{content:s.$t("group_align.left")},{default:$(()=>[M(o,{disabled:D(p),onClick:m,size:"small",type:"text"},{default:$(()=>[Fc]),_:1},8,["disabled"])]),_:1},8,["content"]),M(h,{content:s.$t("group_align.centerX")},{default:$(()=>[M(o,{disabled:D(p),onClick:w,size:"small",type:"text"},{default:$(()=>[Ic]),_:1},8,["disabled"])]),_:1},8,["content"]),M(h,{content:s.$t("group_align.right")},{default:$(()=>[M(o,{disabled:D(p),onClick:y,size:"small",type:"text"},{default:$(()=>[$c]),_:1},8,["disabled"])]),_:1},8,["content"]),M(h,{content:s.$t("group_align.top")},{default:$(()=>[M(o,{disabled:D(p),onClick:r,size:"small",type:"text"},{default:$(()=>[Bc]),_:1},8,["disabled"])]),_:1},8,["content"]),M(h,{content:s.$t("group_align.centerY")},{default:$(()=>[M(o,{disabled:D(p),onClick:u,size:"small",type:"text"},{default:$(()=>[Rc]),_:1},8,["disabled"])]),_:1},8,["content"]),M(h,{content:s.$t("group_align.bottom")},{default:$(()=>[M(o,{disabled:D(p),onClick:a,size:"small",type:"text"},{default:$(()=>[zc]),_:1},8,["disabled"])]),_:1},8,["content"]),M(h,{content:s.$t("group_align.averageX")},{default:$(()=>[M(o,{disabled:D(p),onClick:l,size:"small",type:"text"},{default:$(()=>[Hc]),_:1},8,["disabled"])]),_:1},8,["content"]),M(h,{content:s.$t("group_align.averageY")},{default:$(()=>[M(o,{disabled:D(p),onClick:i,size:"small",type:"text"},{default:$(()=>[Vc]),_:1},8,["disabled"])]),_:1},8,["content"])])):bt("",!0)}}}),Wc=Bt(Nc,[["__scopeId","data-v-13b5a329"]]);const yn=c=>(ae("data-v-d44512ce"),c=c(),le(),c),Xc={key:0,class:"box attr-item"},Yc=yn(()=>I("svg",{t:"1650442559691",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3787",width:"14",height:"14"},[I("path",{d:"M885 607H544V417h192V227H544V24h-64v203H288v190h192v190H139v190h341v203h64V797h341z","p-id":"3788"})],-1)),Gc=yn(()=>I("svg",{t:"1650852784867",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2351",width:"14",height:"14"},[I("path",{d:"M544 480V64h-64v416H64v64h416v416h64V544h416v-64z",fill:"#727272","p-id":"2352"}),I("path",{d:"M123.7 241.1h119.5v64H123.7zM302.9 241.1h119.5v64H302.9zM601.6 241.1h119.5v64H601.6zM780.8 241.1h119.5v64H780.8zM123.7 718.9h119.5v64H123.7zM302.9 718.9h119.5v64H302.9zM601.6 718.9h119.5v64H601.6zM780.8 718.9h119.5v64H780.8z",fill:"#B2B2B2","p-id":"2353"})],-1)),qc=yn(()=>I("svg",{t:"1650442510967",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3412",width:"14",height:"14"},[I("path",{d:"M859.9 474H164.1c-4.5 0-8.1 3.6-8.1 8v60c0 4.4 3.6 8 8.1 8h695.8c4.5 0 8.1-3.6 8.1-8v-60c0-4.4-3.6-8-8.1-8z m-353.6-74.7c2.9 3.7 8.5 3.7 11.3 0l100.8-127.5c3.7-4.7 0.4-11.7-5.7-11.7H550V104c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v156h-62.8c-6 0-9.4 7-5.7 11.7l100.8 127.6z m11.4 225.4c-2.9-3.7-8.5-3.7-11.3 0L405.6 752.3c-3.7 4.7-0.4 11.7 5.7 11.7H474v156c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V764h62.8c6 0 9.4-7 5.7-11.7L517.7 624.7z","p-id":"3413"})],-1)),Kc=Ct({name:"CenterAlign"}),Jc=Object.assign(Kc,{setup(c){const{mixinState:t,canvasEditor:f}=Pt(),p=m=>{f.position(m)};return(m,y)=>{const w=it("Button"),u=it("Tooltip");return D(t).mSelectMode?(Z(),at("div",Xc,[M(u,{content:m.$t("center_align.centerX")},{default:$(()=>[M(w,{disabled:!D(t).mSelectMode,onClick:y[0]||(y[0]=r=>p("centerH")),type:"text"},{default:$(()=>[Yc]),_:1},8,["disabled"])]),_:1},8,["content"]),M(u,{content:m.$t("center_align.center")},{default:$(()=>[M(w,{disabled:!D(t).mSelectMode,onClick:y[1]||(y[1]=r=>p("center")),type:"text"},{default:$(()=>[Gc]),_:1},8,["disabled"])]),_:1},8,["content"]),M(u,{content:m.$t("center_align.centerY")},{default:$(()=>[M(w,{disabled:!D(t).mSelectMode,onClick:y[2]||(y[2]=r=>p("centerV")),type:"text"},{default:$(()=>[qc]),_:1},8,["disabled"])]),_:1},8,["content"])])):bt("",!0)}}}),Zc=Bt(Jc,[["__scopeId","data-v-d44512ce"]]);const ls=c=>(ae("data-v-9f941328"),c=c(),le(),c),Qc={key:0,class:"box attr-item"},th=ls(()=>I("svg",{t:"1650443094178",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1549",width:"14",height:"14"},[I("path",{d:"M252.76928 299.904l146.2784 0 0 472.42752-146.2784 0 0-472.42752Z","p-id":"1550"}),I("path",{d:"M477.48096 85.34528l70.87104 0 0 885.80608-70.87104 0 0-885.80608Z","p-id":"1551"}),I("path",{d:"M629.80096 284.8l31.0016 0 0 502.88128-31.0016 0L629.80096 284.8zM776.42752 284.8l31.0016 0 0 502.88128-31.0016 0L776.42752 284.8zM657.09056 315.8016l0-31.0016 123.04896 0 0 31.0016L657.09056 315.8016zM657.27488 787.64544l0-31.0016 123.04896 0 0 31.0016L657.27488 787.64544z","p-id":"1552"})],-1)),eh=ls(()=>I("svg",{t:"1650443104385",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1749",width:"14",height:"14"},[I("path",{d:"M286.01856 250.91584l472.4224 0 0 146.2784-472.4224 0 0-146.2784Z","p-id":"1750"}),I("path",{d:"M87.19872 475.62752l885.80096 0 0 70.87104-885.80096 0 0-70.87104Z","p-id":"1751"}),I("path",{d:"M773.55008 627.94752l0 31.0016L270.6688 658.94912l0-31.0016L773.55008 627.94752zM773.55008 774.5792l0 31.0016L270.6688 805.5808l0-31.0016L773.55008 774.5792zM742.54848 655.24224l31.0016 0 0 123.04896-31.0016 0L742.54848 655.24224zM270.70464 655.42144l31.0016 0 0 123.04896-31.0016 0L270.70464 655.42144z","p-id":"1752"})],-1)),ih=Ct({name:"Flip"}),nh=Object.assign(ih,{setup(c){const{mixinState:t,canvasEditor:f}=Pt(),p=()=>t.mSelectMode!=="one",m=y=>{const w=f.canvas.getActiveObject();w.set(`flip${y}`,!w[`flip${y}`]).setCoords(),f.canvas.requestRenderAll()};return(y,w)=>{const u=it("Button"),r=it("Tooltip");return D(t).mSelectMode==="one"?(Z(),at("div",Qc,[M(r,{content:y.$t("flip.x")},{default:$(()=>[M(u,{disabled:p(),onClick:w[0]||(w[0]=a=>m("X")),type:"text"},{default:$(()=>[th]),_:1},8,["disabled"])]),_:1},8,["content"]),M(r,{content:y.$t("flip.y")},{default:$(()=>[M(u,{disabled:p(),onClick:w[1]||(w[1]=a=>m("Y")),type:"text"},{default:$(()=>[eh]),_:1},8,["disabled"])]),_:1},8,["content"])])):bt("",!0)}}}),rh=Bt(nh,[["__scopeId","data-v-9f941328"]]),sh=Ct({__name:"previewCurrent",setup(c){const t=_e("canvasEditor"),f=()=>{t.preview().then(p=>{Ft.ImagePreview.show({previewList:[p]})})};return(p,m)=>{const y=it("Button");return Z(),wt(y,{type:"text",onClick:f},{default:$(()=>[dt(ct(p.$t("preview")),1)]),_:1})}}}),oh={__name:"backHome",setup(c){const t=Yo(),f=()=>{t.push("/home").then(()=>{location.reload()})};return(p,m)=>{const y=it("Button");return Z(),wt(y,{type:"text",onClick:f},{default:$(()=>[dt("返回主页")]),_:1})}}};const ah={class:"save-box"},lh=Ct({name:"save-bar"}),ch=Object.assign(lh,{setup(c){const{t}=ke(),{canvasEditor:f}=Pt(),p={clipboard(){f.clipboard()},saveJson(){f.saveJson()},saveSvg(){f.saveSvg()},saveImg(){f.saveImg()}},m=ti(function(u){p[u]&&typeof p[u]=="function"&&p[u]()},300),y=()=>{f.clear()},w=()=>{Ft.Modal.confirm({title:t("tip"),content:`<p>${t("clearTip")}</p>`,okText:t("ok"),cancelText:t("cancel"),onOk:()=>y()})};return(u,r)=>{const a=it("Button"),l=it("Icon"),i=it("DropdownItem"),s=it("DropdownMenu"),e=it("Dropdown");return Z(),at("div",ah,[M(a,{style:{"margin-left":"10px"},type:"text",onClick:w},{default:$(()=>[dt(ct(u.$t("empty")),1)]),_:1}),M(e,{style:{"margin-left":"10px"},onOnClick:D(m)},{list:$(()=>[M(s,null,{default:$(()=>[M(i,{name:"clipboard"},{default:$(()=>[dt(ct(u.$t("copy_to_clipboard")),1)]),_:1}),M(i,{name:"saveImg"},{default:$(()=>[dt(ct(u.$t("save_as_picture")),1)]),_:1}),M(i,{name:"saveSvg"},{default:$(()=>[dt(ct(u.$t("save_as_svg")),1)]),_:1}),M(i,{name:"saveJson",divided:""},{default:$(()=>[dt(ct(u.$t("save_as_json")),1)]),_:1})]),_:1})]),default:$(()=>[M(a,{type:"primary"},{default:$(()=>[dt(ct(u.$t("keep"))+" ",1),M(l,{type:"ios-arrow-down"})]),_:1})]),_:1},8,["onOnClick"])])}}}),hh=Bt(ch,[["__scopeId","data-v-8a3adb70"]]),uh=Ct({name:"saveBar"}),fh=Object.assign(uh,{setup(c){const{locale:t}=ke(),f={zh:"中文",en:"En"};let p=Rt(Object.keys(f).map(w=>({langType:w,langName:f[w]})));const m=Ht(()=>f[t.value]),y=w=>{t.value=w,Go(qo,w)};return(w,u)=>{const r=it("Icon"),a=it("Button"),l=it("DropdownItem"),i=it("DropdownMenu"),s=it("Dropdown");return Z(),wt(s,{onOnClick:y},{list:$(()=>[M(i,null,{default:$(()=>[(Z(!0),at(kt,null,It(D(p),e=>(Z(),wt(l,{key:e.langType,name:e.langType},{default:$(()=>[dt(ct(e.langName),1)]),_:2},1032,["name"]))),128))]),_:1})]),default:$(()=>[M(a,{type:"text"},{default:$(()=>[dt(ct(D(m))+" ",1),M(r,{type:"ios-arrow-down"})]),_:1})]),_:1})}}}),dh=Ct({name:"Clone"}),gh=Object.assign(dh,{setup(c){const{mixinState:t,canvasEditor:f}=Pt(),p=ti(function(){f.clone()},300);return(m,y)=>{const w=it("Button"),u=it("Tooltip");return D(t).mSelectMode==="one"?(Z(),wt(u,{key:0,content:m.$t("quick.copy")},{default:$(()=>[M(w,{onClick:D(p),icon:"ios-copy",type:"text"},null,8,["onClick"])]),_:1},8,["content"])):bt("",!0)}}});const cs=c=>(ae("data-v-ae299503"),c=c(),le(),c),ph={key:0,class:"attr-item box"},vh=cs(()=>I("svg",{t:"1650848913991",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"17131",width:"14",height:"14"},[I("path",{d:"M341.333333 341.333333 341.333333 512 554.666667 512 554.666667 341.333333 341.333333 341.333333M42.666667 42.666667 213.333333 42.666667 213.333333 85.333333 810.666667 85.333333 810.666667 42.666667 981.333333 42.666667 981.333333 213.333333 938.666667 213.333333 938.666667 810.666667 981.333333 810.666667 981.333333 981.333333 810.666667 981.333333 810.666667 938.666667 213.333333 938.666667 213.333333 981.333333 42.666667 981.333333 42.666667 810.666667 85.333333 810.666667 85.333333 213.333333 42.666667 213.333333 42.666667 42.666667M213.333333 810.666667 213.333333 853.333333 810.666667 853.333333 810.666667 810.666667 853.333333 810.666667 853.333333 213.333333 810.666667 213.333333 810.666667 170.666667 213.333333 170.666667 213.333333 213.333333 170.666667 213.333333 170.666667 810.666667 213.333333 810.666667M256 256 640 256 640 426.666667 768 426.666667 768 768 341.333333 768 341.333333 597.333333 256 597.333333 256 256M640 597.333333 426.666667 597.333333 426.666667 682.666667 682.666667 682.666667 682.666667 512 640 512 640 597.333333Z","p-id":"17132"})],-1)),mh=cs(()=>I("svg",{t:"1650848938557",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"17281",width:"14",height:"14"},[I("path",{d:"M85.333333 85.333333 256 85.333333 256 128 554.666667 128 554.666667 85.333333 725.333333 85.333333 725.333333 256 682.666667 256 682.666667 384 768 384 768 341.333333 938.666667 341.333333 938.666667 512 896 512 896 768 938.666667 768 938.666667 938.666667 768 938.666667 768 896 512 896 512 938.666667 341.333333 938.666667 341.333333 768 384 768 384 682.666667 256 682.666667 256 725.333333 85.333333 725.333333 85.333333 554.666667 128 554.666667 128 256 85.333333 256 85.333333 85.333333M768 512 768 469.333333 682.666667 469.333333 682.666667 554.666667 725.333333 554.666667 725.333333 725.333333 554.666667 725.333333 554.666667 682.666667 469.333333 682.666667 469.333333 768 512 768 512 810.666667 768 810.666667 768 768 810.666667 768 810.666667 512 768 512M554.666667 256 554.666667 213.333333 256 213.333333 256 256 213.333333 256 213.333333 554.666667 256 554.666667 256 597.333333 384 597.333333 384 512 341.333333 512 341.333333 341.333333 512 341.333333 512 384 597.333333 384 597.333333 256 554.666667 256M512 512 469.333333 512 469.333333 597.333333 554.666667 597.333333 554.666667 554.666667 597.333333 554.666667 597.333333 469.333333 512 469.333333 512 512Z","p-id":"17282"})],-1)),_h=Ct({name:"Group"}),yh=Object.assign(_h,{setup(c){const{mixinState:t,canvasEditor:f}=Pt();let p=Ht(()=>t.mSelectMode==="one"&&t.mSelectOneType==="group"),m=Ht(()=>t.mSelectMode==="multiple");const y=()=>{f.unGroup()},w=()=>{f.group()};return(u,r)=>{const a=it("Button");return D(m)||D(p)?(Z(),at("div",ph,[D(m)?(Z(),wt(a,{key:0,disabled:!D(m),onClick:w,type:"text"},{default:$(()=>[vh,dt(" 组合 ")]),_:1},8,["disabled"])):bt("",!0),D(p)?(Z(),wt(a,{key:1,disabled:!D(p),onClick:y,type:"text"},{default:$(()=>[mh,dt(" 拆分组合 ")]),_:1},8,["disabled"])):bt("",!0)])):bt("",!0)}}}),bh=Bt(yh,[["__scopeId","data-v-ae299503"]]);const hs=c=>(ae("data-v-7281401e"),c=c(),le(),c),wh={class:"box"},Ch=hs(()=>I("svg",{t:"1650853919128",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1271",width:"14",height:"14"},[I("path",{d:"M970.837333 919.850667l-205.696-205.653334A382.421333 382.421333 0 0 0 853.333333 469.333333a384 384 0 0 0-384-384 384 384 0 0 0-384 384 384 384 0 0 0 384 384 382.421333 382.421333 0 0 0 244.906667-88.192l205.653333 205.653334a36.053333 36.053333 0 0 0 50.986667 0 36.266667 36.266667 0 0 0-0.042667-50.944z m-380.117333-162.986667c-38.4 16.256-79.189333 24.448-121.386667 24.448a311.296 311.296 0 0 1-220.586666-91.392A311.296 311.296 0 0 1 157.312 469.333333 311.296 311.296 0 0 1 248.746667 248.746667 311.296 311.296 0 0 1 469.333333 157.354667a311.296 311.296 0 0 1 220.586667 91.392A311.296 311.296 0 0 1 781.354667 469.333333a311.296 311.296 0 0 1-91.392 220.586667 310.186667 310.186667 0 0 1-99.242667 66.901333z",fill:"#595959","p-id":"1272"}),I("path",{d:"M652.672 431.829333h-147.84V292.010667a35.968 35.968 0 1 0-71.978667 0v139.818666H292.010667a35.968 35.968 0 1 0 0 72.021334h140.8v140.8a35.968 35.968 0 1 0 72.021333 0v-140.8h147.84a35.968 35.968 0 1 0 0-72.021334z",fill:"#595959","p-id":"1273"})],-1)),xh=hs(()=>I("svg",{t:"1650853934351",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1470",width:"14",height:"14"},[I("path",{d:"M970.837333 919.850667l-205.696-205.653334A382.421333 382.421333 0 0 0 853.333333 469.333333a384 384 0 0 0-384-384 384 384 0 0 0-384 384 384 384 0 0 0 384 384 382.421333 382.421333 0 0 0 244.906667-88.192l205.653333 205.653334a36.053333 36.053333 0 0 0 50.986667 0 36.266667 36.266667 0 0 0-0.042667-50.944z m-380.117333-162.986667c-38.4 16.256-79.189333 24.448-121.386667 24.448a311.296 311.296 0 0 1-220.586666-91.392A311.296 311.296 0 0 1 157.312 469.333333 311.296 311.296 0 0 1 248.746667 248.746667 311.296 311.296 0 0 1 469.333333 157.354667a311.296 311.296 0 0 1 220.586667 91.392A311.296 311.296 0 0 1 781.354667 469.333333a311.296 311.296 0 0 1-91.392 220.586667 310.186667 310.186667 0 0 1-99.242667 66.901333z",fill:"#595959","p-id":"1471"}),I("path",{d:"M652.672 431.829333H292.010667a35.968 35.968 0 1 0 0 72.021334h360.661333a35.968 35.968 0 1 0 0-72.021334z",fill:"#595959","p-id":"1472"})],-1)),Sh=Ct({name:"Zoom"}),Th=Object.assign(Sh,{setup(c){const{canvasEditor:t}=Pt(),f=()=>{t.one()},p=()=>{t.big()},m=()=>{t.small()},y=()=>{t.auto()};return(w,u)=>{const r=it("Button"),a=it("ButtonGroup");return Z(),at("div",wh,[M(a,null,{default:$(()=>[M(r,{onClick:p},{default:$(()=>[Ch]),_:1}),M(r,{onClick:m},{default:$(()=>[xh]),_:1}),M(r,{onClick:f,icon:"ios-expand"}),M(r,{onClick:y,icon:"md-contract"})]),_:1})])}}}),Oh=Bt(Th,[["__scopeId","data-v-7281401e"]]);const kh=c=>(ae("data-v-1591cc47"),c=c(),le(),c),Ah={class:"box"},Eh=kh(()=>I("span",null,"Drag",-1)),Mh=Ct({name:"Drag"}),Ph=Object.assign(Mh,{setup(c){const t=vt(!1),{canvasEditor:f}=Pt(),p=m=>{m?f.startDring():f.endDring()};return Jt(()=>{f.on("startDring",()=>t.value=!0),f.on("endDring",()=>t.value=!1)}),ei(()=>{f.off("startDring"),f.off("endDring")}),(m,y)=>{const w=it("Switch");return Z(),at("div",Ah,[M(w,{size:"large",modelValue:D(t),"onUpdate:modelValue":y[0]||(y[0]=u=>Pe(t)?t.value=u:null),onOnChange:p},{open:$(()=>[Eh]),_:1},8,["modelValue"])])}}}),Dh=Bt(Ph,[["__scopeId","data-v-1591cc47"]]);const jh=Ct({name:"Lock"}),Lh=Object.assign(jh,{setup(c){const t=_e("event"),{mixinState:f,canvasEditor:p}=Pt(),m=["lockMovementX","lockMovementY","lockRotation","lockScalingX","lockScalingY"],y=vt(!1),w=()=>{f.mSelectActive.hasControls=!1,m.forEach(l=>{f.mSelectActive[l]=!0}),f.mSelectActive.selectable=!1,y.value=!0,p.canvas.renderAll()},u=()=>{f.mSelectActive.hasControls=!0,m.forEach(l=>{f.mSelectActive[l]=!1}),f.mSelectActive.selectable=!0,y.value=!1,p.canvas.renderAll()},r=l=>{l?w():u()},a=l=>{y.value=!l[0].hasControls,f.mSelectActive=l[0]};return Jt(()=>{t.on("selectOne",a)}),ei(()=>{t.off("selectOne",a)}),(l,i)=>{const s=it("Button"),e=it("Tooltip");return D(f).mSelectMode==="one"?(Z(),wt(e,{key:0,content:l.$t("quick.lock")},{default:$(()=>[D(y)?(Z(),wt(s,{key:0,onClick:i[0]||(i[0]=o=>r(!1)),icon:"md-lock",type:"text"})):(Z(),wt(s,{key:1,onClick:i[1]||(i[1]=o=>r(!0)),icon:"md-unlock",type:"text"}))]),_:1},8,["content"])):bt("",!0)}}}),Fh=Bt(Lh,[["__scopeId","data-v-ce89c6d5"]]),Ih=Ct({name:"Del"}),$h=Object.assign(Ih,{setup(c){const{mixinState:t,canvasEditor:f}=Pt(),p=ti(function(){f.del()},300);return(m,y)=>{const w=it("Button"),u=it("Tooltip");return D(t).mSelectMode?(Z(),wt(u,{key:0,content:m.$t("quick.del")},{default:$(()=>[M(w,{onClick:D(p),icon:"ios-trash",type:"text"},null,8,["onClick"])]),_:1},8,["content"])):bt("",!0)}}}),Bh={class:"setting-item"},Rh={class:"mr-10px"},zh={class:"setting-item"},Hh={class:"mr-10px"},Vh={class:"setting-item"},Uh={class:"mr-10px"},Nh={class:"setting-item"},Wh={class:"mr-10px"},Xh=Ct({name:"WaterMark"}),Yh=Ct(Ot(yt({},Xh),{setup(c){const{canvasEditor:t}=Pt(),f=Rt({text:"",size:24,isRotate:0,font:"serif",color:"#ccc",position:"lt"}),p=vt(!1),m=()=>{f.text="",f.size=24,f.font="serif",f.color="#ccc",f.position="lt",f.isRotate=0},y=(a,l)=>{const i=document.createElement("canvas");return i.width=a,i.height=l,i.style.position="fixed",i.style.opacity="0",i.style.zIndex="-1",i},w={lt:(a,l,i)=>{let s=y(a,l);const e=s.width||a;let o=s.getContext("2d");o.fillStyle=f.color,o.font=`${f.size}px ${f.font}`,o.fillText(f.text,10,f.size+10,e-20),i&&i(s.toDataURL()),s=null,o=null},rt:(a,l,i)=>{let s=y(a,l),e=s.getContext("2d");const o=s.width||a;e.fillStyle=f.color,e.font=`${f.size}px ${f.font}`,e.fillText(f.text,o-e.measureText(f.text).width-20,f.size+10,o-20),i&&i(s.toDataURL()),s=null,e=null},lb:(a,l,i)=>{let s=y(a,l),e=s.getContext("2d");const o=s.width||a,h=s.height||l;e.fillStyle=f.color,e.font=`${f.size}px ${f.font}`,e.fillText(f.text,10,h-f.size,o-20),i&&i(s.toDataURL()),s=null,e=null},rb:(a,l,i)=>{let s=y(a,l),e=s.getContext("2d");const o=s.width||a;e.fillStyle=f.color,e.font=`${f.size}px ${f.font}`,e.fillText(f.text,o-e.measureText(f.text).width-20,l-f.size,a-20),i&&i(s.toDataURL()),s=null,e=null},full:(a,l,i)=>{let s=y(a,l),e=s.getContext("2d");const o=e.measureText(f.text).width+40;let h=y(f.isRotate===0?o:o*2,f.isRotate===0?f.size+20:o+20);document.body.appendChild(h);let n=h.getContext("2d");n.textAlign="left",n.textBaseline="top",n.font=`${f.size}px ${f.font}`,n.fillStyle=`${f.color}`,f.isRotate===0?n.fillText(f.text,10,10):(n.translate(0,o-10),n.rotate(-30*Math.PI/180),n.fillText(f.text,0,0)),e.fillStyle=e.createPattern(h,"repeat"),e.fillRect(0,0,a,l),i&&i(s.toDataURL()),s=null,h=null,e=null,n=null}},u=()=>{if(!f.text)return Ft.Message.warning("水印名字不能为空");const a=t.canvas.getObjects().find(o=>o.id==="workspace"),{width:l,height:i,left:s,top:e}=a;w[f.position](l,i,o=>{t.canvas.overlayImage=null,t.canvas.setOverlayImage(o,t.canvas.renderAll.bind(t.canvas),{left:s||0,top:e||0,originX:"left",originY:"top"})}),m()},r=ti(function(){p.value=!0},250);return(a,l)=>{const i=it("Button"),s=it("Input"),e=it("Slider"),o=it("Radio"),h=it("RadioGroup"),n=it("Modal");return Z(),at(kt,null,[M(i,{type:"text",onClick:D(r)},{default:$(()=>[dt(ct(a.$t("waterMark.text")),1)]),_:1},8,["onClick"]),M(n,{modelValue:D(p),"onUpdate:modelValue":l[4]||(l[4]=d=>Pe(p)?p.value=d:null),title:a.$t("waterMark.modalTitle"),onOnOk:u,onOnCancel:m},{default:$(()=>[I("div",Bh,[I("span",Rh,ct(a.$t("waterMark.setting.name")),1),M(s,{class:"w-320",modelValue:D(f).text,"onUpdate:modelValue":l[0]||(l[0]=d=>D(f).text=d),maxlength:"15","show-word-limit":"",placeholder:a.$t("placeholder")},null,8,["modelValue","placeholder"])]),I("div",zh,[I("span",Hh,ct(a.$t("waterMark.setting.size")),1),M(e,{class:"w-320",modelValue:D(f).size,"onUpdate:modelValue":l[1]||(l[1]=d=>D(f).size=d),min:18,max:48},null,8,["modelValue"])]),I("div",Vh,[I("span",Uh,ct(a.$t("waterMark.setting.position.label")),1),M(h,{modelValue:D(f).position,"onUpdate:modelValue":l[2]||(l[2]=d=>D(f).position=d)},{default:$(()=>[M(o,{label:"lt"},{default:$(()=>[dt(ct(a.$t("waterMark.setting.position.lt")),1)]),_:1}),M(o,{label:"rt"},{default:$(()=>[dt(ct(a.$t("waterMark.setting.position.rt")),1)]),_:1}),M(o,{label:"lb"},{default:$(()=>[dt(ct(a.$t("waterMark.setting.position.lb")),1)]),_:1}),M(o,{label:"rb"},{default:$(()=>[dt(ct(a.$t("waterMark.setting.position.rb")),1)]),_:1}),M(o,{label:"full"},{default:$(()=>[dt(ct(a.$t("waterMark.setting.position.full")),1)]),_:1})]),_:1},8,["modelValue"])]),Ut(I("div",Nh,[I("span",Wh,ct(a.$t("waterMark.setting.angle")),1),I("div",null,[M(h,{modelValue:D(f).isRotate,"onUpdate:modelValue":l[3]||(l[3]=d=>D(f).isRotate=d)},{default:$(()=>[M(o,{label:0},{default:$(()=>[dt("横向")]),_:1}),M(o,{label:1},{default:$(()=>[dt("倾斜")]),_:1})]),_:1},8,["modelValue"])])],512),[[Qt,D(f).position==="full"]])]),_:1},8,["modelValue","title"])],64)}}}));const Gh=Bt(Yh,[["__scopeId","data-v-f0cdd18d"]]),qh={class:"search-box"},Kh=["alt","onClick"],Jh=Ct({name:"ImportTmpl"}),Zh=Ct(Ot(yt({},Jh),{setup(c){const{t}=ke(),{canvasEditor:f}=Pt(),p={value:"",label:"全部"},m=Rt({search:"",placeholder:"",jsonFile:null,materialType:[""],materialTypelist:[],materialist:[]});f.getMaterialType("template").then(i=>{m.materialTypelist=[...i],m.materialist=i});const y=()=>{console.log(m.jsonFile),f.insertSvgFile(m.jsonFile)},w=i=>{Ft.Modal.confirm({title:t("tip"),content:`<p>${t("replaceTip")}</p>`,okText:t("ok"),cancelText:t("cancel"),onOk:()=>u(i)})},u=i=>{Ft.Spin.show({render:e=>e("div",t("alert.loading_data"))}),Ti.get(i).then(e=>{m.jsonFile=JSON.stringify(e.data),Ft.Spin.hide(),y()})},r=(i,s)=>{const{label:e,value:o}=s[0];m.placeholder=e,m.search="",a(o)},a=i=>{if(!i)m.materialist=bi(m.materialTypelist);else{const s=m.materialTypelist.filter(e=>e.value===i)||[];m.materialist=s}if(m.search){const s=bi(m.materialist);m.materialist=s.map(e=>(e.list&&(e.list=e.list.filter(o=>o.label.includes(m.search))),e))}},l=()=>{const[i]=m.materialType;a(i)};return(i,s)=>{const e=it("Button"),o=it("Cascader"),h=it("Input"),n=it("Divider"),d=it("Tooltip"),g=Si("lazy");return Z(),at("div",null,[I("div",qh,[M(o,{data:[p,...D(m).materialTypelist],modelValue:D(m).materialType,"onUpdate:modelValue":s[0]||(s[0]=v=>D(m).materialType=v),onOnChange:r},{default:$(()=>[M(e,{icon:"ios-menu"})]),_:1},8,["data","modelValue"]),M(h,{class:"input",placeholder:D(m).placeholder,modelValue:D(m).search,"onUpdate:modelValue":s[1]||(s[1]=v=>D(m).search=v),search:"",onOnChange:l},null,8,["placeholder","modelValue"])]),(Z(!0),at(kt,null,It(D(m).materialist,v=>(Z(),at("div",{key:v.value},[M(n,{plain:"",orientation:"left"},{default:$(()=>[dt(ct(v.label),1)]),_:2},1024),(Z(!0),at(kt,null,It(v.list,(_,b)=>(Z(),wt(d,{content:_.label,key:`${b}-bai1-button`,placement:"top"},{default:$(()=>[Ut(I("img",{class:"tmpl-img",alt:_.label,onClick:C=>w(_.tempUrl)},null,8,Kh),[[g,_.src]])]),_:2},1032,["content"]))),128))]))),128))])}}}));const Qh=Bt(Zh,[["__scopeId","data-v-813679a1"]]);var K={};(function(c){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var t=t||{version:"5.3.0"};if(c.fabric=t,typeof document!="undefined"&&typeof window!="undefined")document instanceof(typeof HTMLDocument!="undefined"?HTMLDocument:Document)?t.document=document:t.document=document.implementation.createHTMLDocument(""),t.window=window;else{var f=ji,p=new f.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;t.document=p.document,t.jsdomImplForWrapper=ji.implForWrapper,t.nodeCanvas=ji.Canvas,t.window=p,DOMParser=t.window.DOMParser}t.isTouchSupported="ontouchstart"in t.window||"ontouchstart"in t.document||t.window&&t.window.navigator&&t.window.navigator.maxTouchPoints>0,t.isLikelyNode=typeof Buffer!="undefined"&&typeof window=="undefined",t.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],t.DPI=96,t.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",t.commaWsp="(?:\\s+,?\\s*|,\\s*)",t.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,t.reNonWord=/[ \n\.,;!\?\-]/,t.fontPaths={},t.iMatrix=[1,0,0,1,0,0],t.svgNS="http://www.w3.org/2000/svg",t.perfLimitSizeTotal=2097152,t.maxCacheSideLimit=4096,t.minCacheSideLimit=256,t.charWidthsCache={},t.textureSize=2048,t.disableStyleCopyPaste=!1,t.enableGLFiltering=!0,t.devicePixelRatio=t.window.devicePixelRatio||t.window.webkitDevicePixelRatio||t.window.mozDevicePixelRatio||1,t.browserShadowBlurConstant=1,t.arcToSegmentsCache={},t.boundsOfCurveCache={},t.cachesBoundsOfCurve=!0,t.forceGLPutImageData=!1,t.initFilterBackend=function(){if(t.enableGLFiltering&&t.isWebglSupported&&t.isWebglSupported(t.textureSize))return console.log("max texture size: "+t.maxTextureSize),new t.WebglFilterBackend({tileSize:t.textureSize});if(t.Canvas2dFilterBackend)return new t.Canvas2dFilterBackend},typeof document!="undefined"&&typeof window!="undefined"&&(window.fabric=t),function(){function u(e,o){if(this.__eventListeners[e]){var h=this.__eventListeners[e];o?h[h.indexOf(o)]=!1:t.util.array.fill(h,!1)}}function r(e,o){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var h in e)this.on(h,e[h]);else this.__eventListeners[e]||(this.__eventListeners[e]=[]),this.__eventListeners[e].push(o);return this}function a(e,o){var h=function(){o.apply(this,arguments),this.off(e,h)}.bind(this);this.on(e,h)}function l(e,o){if(arguments.length===1)for(var h in e)a.call(this,h,e[h]);else a.call(this,e,o);return this}function i(e,o){if(!this.__eventListeners)return this;if(arguments.length===0)for(e in this.__eventListeners)u.call(this,e);else if(arguments.length===1&&typeof arguments[0]=="object")for(var h in e)u.call(this,h,e[h]);else u.call(this,e,o);return this}function s(e,o){if(!this.__eventListeners)return this;var h=this.__eventListeners[e];if(!h)return this;for(var n=0,d=h.length;n<d;n++)h[n]&&h[n].call(this,o||{});return this.__eventListeners[e]=h.filter(function(g){return g!==!1}),this}t.Observable={fire:s,on:r,once:l,off:i}}(),t.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var u=0,r=arguments.length;u<r;u++)this._onObjectAdded(arguments[u]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(u,r,a){var l=this._objects;return a?l[r]=u:l.splice(r,0,u),this._onObjectAdded&&this._onObjectAdded(u),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var u=this._objects,r,a=!1,l=0,i=arguments.length;l<i;l++)r=u.indexOf(arguments[l]),r!==-1&&(a=!0,u.splice(r,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[l]));return this.renderOnAddRemove&&a&&this.requestRenderAll(),this},forEachObject:function(u,r){for(var a=this.getObjects(),l=0,i=a.length;l<i;l++)u.call(r,a[l],l,a);return this},getObjects:function(u){return typeof u=="undefined"?this._objects.concat():this._objects.filter(function(r){return r.type===u})},item:function(u){return this._objects[u]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(u,r){return this._objects.indexOf(u)>-1?!0:r?this._objects.some(function(a){return typeof a.contains=="function"&&a.contains(u,!0)}):!1},complexity:function(){return this._objects.reduce(function(u,r){return u+=r.complexity?r.complexity():0,u},0)}},t.CommonMethods={_setOptions:function(u){for(var r in u)this.set(r,u[r])},_initGradient:function(u,r){u&&u.colorStops&&!(u instanceof t.Gradient)&&this.set(r,new t.Gradient(u))},_initPattern:function(u,r,a){u&&u.source&&!(u instanceof t.Pattern)?this.set(r,new t.Pattern(u,a)):a&&a()},_setObject:function(u){for(var r in u)this._set(r,u[r])},set:function(u,r){return typeof u=="object"?this._setObject(u):this._set(u,r),this},_set:function(u,r){this[u]=r},toggle:function(u){var r=this.get(u);return typeof r=="boolean"&&this.set(u,!r),this},get:function(u){return this[u]}},function(u){var r=Math.sqrt,a=Math.atan2,l=Math.pow,i=Math.PI/180,s=Math.PI/2;t.util={cos:function(e){if(e===0)return 1;e<0&&(e=-e);var o=e/s;switch(o){case 1:case 3:return 0;case 2:return-1}return Math.cos(e)},sin:function(e){if(e===0)return 0;var o=e/s,h=1;switch(e<0&&(h=-1),o){case 1:return h;case 2:return 0;case 3:return-h}return Math.sin(e)},removeFromArray:function(e,o){var h=e.indexOf(o);return h!==-1&&e.splice(h,1),e},getRandomInt:function(e,o){return Math.floor(Math.random()*(o-e+1))+e},degreesToRadians:function(e){return e*i},radiansToDegrees:function(e){return e/i},rotatePoint:function(e,o,h){var n=new t.Point(e.x-o.x,e.y-o.y),d=t.util.rotateVector(n,h);return new t.Point(d.x,d.y).addEquals(o)},rotateVector:function(e,o){var h=t.util.sin(o),n=t.util.cos(o),d=e.x*n-e.y*h,g=e.x*h+e.y*n;return{x:d,y:g}},createVector:function(e,o){return new t.Point(o.x-e.x,o.y-e.y)},calcAngleBetweenVectors:function(e,o){return Math.acos((e.x*o.x+e.y*o.y)/(Math.hypot(e.x,e.y)*Math.hypot(o.x,o.y)))},getHatVector:function(e){return new t.Point(e.x,e.y).multiply(1/Math.hypot(e.x,e.y))},getBisector:function(e,o,h){var n=t.util.createVector(e,o),d=t.util.createVector(e,h),g=t.util.calcAngleBetweenVectors(n,d),v=t.util.calcAngleBetweenVectors(t.util.rotateVector(n,g),d),_=g*(v===0?1:-1)/2;return{vector:t.util.getHatVector(t.util.rotateVector(n,_)),angle:g}},projectStrokeOnPoints:function(e,o,h){var n=[],d=o.strokeWidth/2,g=o.strokeUniform?new t.Point(1/o.scaleX,1/o.scaleY):new t.Point(1,1),v=function(_){var b=d/Math.hypot(_.x,_.y);return new t.Point(_.x*b*g.x,_.y*b*g.y)};return e.length<=1||e.forEach(function(_,b){var C=new t.Point(_.x,_.y),S,E;b===0?(E=e[b+1],S=h?v(t.util.createVector(E,C)).addEquals(C):e[e.length-1]):b===e.length-1?(S=e[b-1],E=h?v(t.util.createVector(S,C)).addEquals(C):e[0]):(S=e[b-1],E=e[b+1]);var z=t.util.getBisector(C,S,E),V=z.vector,W=z.angle,L,A;if(o.strokeLineJoin==="miter"&&(L=-d/Math.sin(W/2),A=new t.Point(V.x*L*g.x,V.y*L*g.y),Math.hypot(A.x,A.y)/d<=o.strokeMiterLimit)){n.push(C.add(A)),n.push(C.subtract(A));return}L=-d*Math.SQRT2,A=new t.Point(V.x*L*g.x,V.y*L*g.y),n.push(C.add(A)),n.push(C.subtract(A))}),n},transformPoint:function(e,o,h){return h?new t.Point(o[0]*e.x+o[2]*e.y,o[1]*e.x+o[3]*e.y):new t.Point(o[0]*e.x+o[2]*e.y+o[4],o[1]*e.x+o[3]*e.y+o[5])},makeBoundingBoxFromPoints:function(e,o){if(o)for(var h=0;h<e.length;h++)e[h]=t.util.transformPoint(e[h],o);var n=[e[0].x,e[1].x,e[2].x,e[3].x],d=t.util.array.min(n),g=t.util.array.max(n),v=g-d,_=[e[0].y,e[1].y,e[2].y,e[3].y],b=t.util.array.min(_),C=t.util.array.max(_),S=C-b;return{left:d,top:b,width:v,height:S}},invertTransform:function(e){var o=1/(e[0]*e[3]-e[1]*e[2]),h=[o*e[3],-o*e[1],-o*e[2],o*e[0]],n=t.util.transformPoint({x:e[4],y:e[5]},h,!0);return h[4]=-n.x,h[5]=-n.y,h},toFixed:function(e,o){return parseFloat(Number(e).toFixed(o))},parseUnit:function(e,o){var h=/\D{0,2}$/.exec(e),n=parseFloat(e);switch(o||(o=t.Text.DEFAULT_SVG_FONT_SIZE),h[0]){case"mm":return n*t.DPI/25.4;case"cm":return n*t.DPI/2.54;case"in":return n*t.DPI;case"pt":return n*t.DPI/72;case"pc":return n*t.DPI/72*12;case"em":return n*o;default:return n}},falseFunction:function(){return!1},getKlass:function(e,o){return e=t.util.string.camelize(e.charAt(0).toUpperCase()+e.slice(1)),t.util.resolveNamespace(o)[e]},getSvgAttributes:function(e){var o=["instantiated_by_use","style","id","class"];switch(e){case"linearGradient":o=o.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":o=o.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":o=o.concat(["offset","stop-color","stop-opacity"]);break}return o},resolveNamespace:function(e){if(!e)return t;var o=e.split("."),h=o.length,n,d=u||t.window;for(n=0;n<h;++n)d=d[o[n]];return d},loadImage:function(e,o,h,n){if(!e){o&&o.call(h,e);return}var d=t.util.createImage(),g=function(){o&&o.call(h,d,!1),d=d.onload=d.onerror=null};d.onload=g,d.onerror=function(){t.log("Error loading "+d.src),o&&o.call(h,null,!0),d=d.onload=d.onerror=null},e.indexOf("data")!==0&&n!==void 0&&n!==null&&(d.crossOrigin=n),e.substring(0,14)==="data:image/svg"&&(d.onload=null,t.util.loadImageInDom(d,g)),d.src=e},loadImageInDom:function(e,o){var h=t.document.createElement("div");h.style.width=h.style.height="1px",h.style.left=h.style.top="-100%",h.style.position="absolute",h.appendChild(e),t.document.querySelector("body").appendChild(h),e.onload=function(){o(),h.parentNode.removeChild(h),h=null}},enlivenObjects:function(e,o,h,n){e=e||[];var d=[],g=0,v=e.length;function _(){++g===v&&o&&o(d.filter(function(b){return b}))}if(!v){o&&o(d);return}e.forEach(function(b,C){if(!b||!b.type){_();return}var S=t.util.getKlass(b.type,h);S.fromObject(b,function(E,z){z||(d[C]=E),n&&n(b,E,z),_()})})},enlivenObjectEnlivables:function(e,o,h){var n=t.Object.ENLIVEN_PROPS.filter(function(d){return!!e[d]});t.util.enlivenObjects(n.map(function(d){return e[d]}),function(d){var g={};n.forEach(function(v,_){g[v]=d[_],o&&(o[v]=d[_])}),h&&h(g)})},enlivenPatterns:function(e,o){e=e||[];function h(){++d===g&&o&&o(n)}var n=[],d=0,g=e.length;if(!g){o&&o(n);return}e.forEach(function(v,_){v&&v.source?new t.Pattern(v,function(b){n[_]=b,h()}):(n[_]=v,h())})},groupSVGElements:function(e,o,h){var n;return e&&e.length===1?(typeof h!="undefined"&&(e[0].sourcePath=h),e[0]):(o&&(o.width&&o.height?o.centerPoint={x:o.width/2,y:o.height/2}:(delete o.width,delete o.height)),n=new t.Group(e,o),typeof h!="undefined"&&(n.sourcePath=h),n)},populateWithProperties:function(e,o,h){if(h&&Array.isArray(h))for(var n=0,d=h.length;n<d;n++)h[n]in e&&(o[h[n]]=e[h[n]])},createCanvasElement:function(){return t.document.createElement("canvas")},copyCanvasElement:function(e){var o=t.util.createCanvasElement();return o.width=e.width,o.height=e.height,o.getContext("2d").drawImage(e,0,0),o},toDataURL:function(e,o,h){return e.toDataURL("image/"+o,h)},createImage:function(){return t.document.createElement("img")},multiplyTransformMatrices:function(e,o,h){return[e[0]*o[0]+e[2]*o[1],e[1]*o[0]+e[3]*o[1],e[0]*o[2]+e[2]*o[3],e[1]*o[2]+e[3]*o[3],h?0:e[0]*o[4]+e[2]*o[5]+e[4],h?0:e[1]*o[4]+e[3]*o[5]+e[5]]},qrDecompose:function(e){var o=a(e[1],e[0]),h=l(e[0],2)+l(e[1],2),n=r(h),d=(e[0]*e[3]-e[2]*e[1])/n,g=a(e[0]*e[2]+e[1]*e[3],h);return{angle:o/i,scaleX:n,scaleY:d,skewX:g/i,skewY:0,translateX:e[4],translateY:e[5]}},calcRotateMatrix:function(e){if(!e.angle)return t.iMatrix.concat();var o=t.util.degreesToRadians(e.angle),h=t.util.cos(o),n=t.util.sin(o);return[h,n,-n,h,0,0]},calcDimensionsMatrix:function(e){var o=typeof e.scaleX=="undefined"?1:e.scaleX,h=typeof e.scaleY=="undefined"?1:e.scaleY,n=[e.flipX?-o:o,0,0,e.flipY?-h:h,0,0],d=t.util.multiplyTransformMatrices,g=t.util.degreesToRadians;return e.skewX&&(n=d(n,[1,0,Math.tan(g(e.skewX)),1],!0)),e.skewY&&(n=d(n,[1,Math.tan(g(e.skewY)),0,1],!0)),n},composeMatrix:function(e){var o=[1,0,0,1,e.translateX||0,e.translateY||0],h=t.util.multiplyTransformMatrices;return e.angle&&(o=h(o,t.util.calcRotateMatrix(e))),(e.scaleX!==1||e.scaleY!==1||e.skewX||e.skewY||e.flipX||e.flipY)&&(o=h(o,t.util.calcDimensionsMatrix(e))),o},resetObjectTransform:function(e){e.scaleX=1,e.scaleY=1,e.skewX=0,e.skewY=0,e.flipX=!1,e.flipY=!1,e.rotate(0)},saveObjectTransform:function(e){return{scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,angle:e.angle,left:e.left,flipX:e.flipX,flipY:e.flipY,top:e.top}},isTransparent:function(e,o,h,n){n>0&&(o>n?o-=n:o=0,h>n?h-=n:h=0);var d=!0,g,v,_=e.getImageData(o,h,n*2||1,n*2||1),b=_.data.length;for(g=3;g<b&&(v=_.data[g],d=v<=0,d!==!1);g+=4);return _=null,d},parsePreserveAspectRatioAttribute:function(e){var o="meet",h="Mid",n="Mid",d=e.split(" "),g;return d&&d.length&&(o=d.pop(),o!=="meet"&&o!=="slice"?(g=o,o="meet"):d.length&&(g=d.pop())),h=g!=="none"?g.slice(1,4):"none",n=g!=="none"?g.slice(5,8):"none",{meetOrSlice:o,alignX:h,alignY:n}},clearFabricFontCache:function(e){e=(e||"").toLowerCase(),e?t.charWidthsCache[e]&&delete t.charWidthsCache[e]:t.charWidthsCache={}},limitDimsByArea:function(e,o){var h=Math.sqrt(o*e),n=Math.floor(o/h);return{x:Math.floor(h),y:n}},capValue:function(e,o,h){return Math.max(e,Math.min(o,h))},findScaleToFit:function(e,o){return Math.min(o.width/e.width,o.height/e.height)},findScaleToCover:function(e,o){return Math.max(o.width/e.width,o.height/e.height)},matrixToSVG:function(e){return"matrix("+e.map(function(o){return t.util.toFixed(o,t.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(e,o){var h=t.util.invertTransform(o),n=t.util.multiplyTransformMatrices(h,e.calcOwnMatrix());t.util.applyTransformToObject(e,n)},addTransformToObject:function(e,o){t.util.applyTransformToObject(e,t.util.multiplyTransformMatrices(o,e.calcOwnMatrix()))},applyTransformToObject:function(e,o){var h=t.util.qrDecompose(o),n=new t.Point(h.translateX,h.translateY);e.flipX=!1,e.flipY=!1,e.set("scaleX",h.scaleX),e.set("scaleY",h.scaleY),e.skewX=h.skewX,e.skewY=h.skewY,e.angle=h.angle,e.setPositionByOrigin(n,"center","center")},sizeAfterTransform:function(e,o,h){var n=e/2,d=o/2,g=[{x:-n,y:-d},{x:n,y:-d},{x:-n,y:d},{x:n,y:d}],v=t.util.calcDimensionsMatrix(h),_=t.util.makeBoundingBoxFromPoints(g,v);return{x:_.width,y:_.height}},mergeClipPaths:function(e,o){var h=e,n=o;h.inverted&&!n.inverted&&(h=o,n=e),t.util.applyTransformToObject(n,t.util.multiplyTransformMatrices(t.util.invertTransform(h.calcTransformMatrix()),n.calcTransformMatrix()));var d=h.inverted&&n.inverted;return d&&(h.inverted=n.inverted=!1),new t.Group([h],{clipPath:n,inverted:d})},hasStyleChanged:function(e,o,h){return h=h||!1,e.fill!==o.fill||e.stroke!==o.stroke||e.strokeWidth!==o.strokeWidth||e.fontSize!==o.fontSize||e.fontFamily!==o.fontFamily||e.fontWeight!==o.fontWeight||e.fontStyle!==o.fontStyle||e.textBackgroundColor!==o.textBackgroundColor||e.deltaY!==o.deltaY||h&&(e.overline!==o.overline||e.underline!==o.underline||e.linethrough!==o.linethrough)},stylesToArray:function(h,o){for(var h=t.util.object.clone(h,!0),n=o.split(`
`),d=-1,g={},v=[],_=0;_<n.length;_++){if(!h[_]){d+=n[_].length;continue}for(var b=0;b<n[_].length;b++){d++;var C=h[_][b];if(C&&Object.keys(C).length>0){var S=t.util.hasStyleChanged(g,C,!0);S?v.push({start:d,end:d+1,style:C}):v[v.length-1].end++}g=C||{}}}return v},stylesFromArray:function(e,o){if(!Array.isArray(e))return e;for(var h=o.split(`
`),n=-1,d=0,g={},v=0;v<h.length;v++)for(var _=0;_<h[v].length;_++)n++,e[d]&&e[d].start<=n&&n<e[d].end&&(g[v]=g[v]||{},g[v][_]=Object.assign({},e[d].style),n===e[d].end-1&&d++);return g}}}(c),function(){var u=Array.prototype.join,r={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},a={m:"l",M:"L"};function l(O,F,j,P,U,T,x,k,R,q,N){var nt=t.util.cos(O),ot=t.util.sin(O),lt=t.util.cos(F),Y=t.util.sin(F),H=j*U*lt-P*T*Y+x,tt=P*U*lt+j*T*Y+k,et=q+R*(-j*U*ot-P*T*nt),G=N+R*(-P*U*ot+j*T*nt),rt=H+R*(j*U*Y+P*T*lt),ut=tt+R*(P*U*Y-j*T*lt);return["C",et,G,rt,ut,H,tt]}function i(O,F,j,P,U,T,x){var k=Math.PI,R=x*k/180,q=t.util.sin(R),N=t.util.cos(R),nt=0,ot=0;j=Math.abs(j),P=Math.abs(P);var lt=-N*O*.5-q*F*.5,Y=-N*F*.5+q*O*.5,H=j*j,tt=P*P,et=Y*Y,G=lt*lt,rt=H*tt-H*et-tt*G,ut=0;if(rt<0){var mt=Math.sqrt(1-rt/(H*tt));j*=mt,P*=mt}else ut=(U===T?-1:1)*Math.sqrt(rt/(H*et+tt*G));var gt=ut*j*Y/P,Q=-ut*P*lt/j,pt=N*gt-q*Q+O*.5,_t=q*gt+N*Q+F*.5,xt=s(1,0,(lt-gt)/j,(Y-Q)/P),jt=s((lt-gt)/j,(Y-Q)/P,(-lt-gt)/j,(-Y-Q)/P);T===0&&jt>0?jt-=2*k:T===1&&jt<0&&(jt+=2*k);for(var St=Math.ceil(Math.abs(jt/k*2)),Kt=[],zt=jt/St,Ce=8/3*Math.sin(zt/4)*Math.sin(zt/4)/Math.sin(zt/2),Be=xt+zt,ee=0;ee<St;ee++)Kt[ee]=l(xt,Be,N,q,j,P,pt,_t,Ce,nt,ot),nt=Kt[ee][5],ot=Kt[ee][6],xt=Be,Be+=zt;return Kt}function s(O,F,j,P){var U=Math.atan2(F,O),T=Math.atan2(P,j);return T>=U?T-U:2*Math.PI-(U-T)}function e(O,F,j,P,U,T,x,k){var R;if(t.cachesBoundsOfCurve&&(R=u.call(arguments),t.boundsOfCurveCache[R]))return t.boundsOfCurveCache[R];var q=Math.sqrt,N=Math.min,nt=Math.max,ot=Math.abs,lt=[],Y=[[],[]],H,tt,et,G,rt,ut,mt,gt;tt=6*O-12*j+6*U,H=-3*O+9*j-9*U+3*x,et=3*j-3*O;for(var Q=0;Q<2;++Q){if(Q>0&&(tt=6*F-12*P+6*T,H=-3*F+9*P-9*T+3*k,et=3*P-3*F),ot(H)<1e-12){if(ot(tt)<1e-12)continue;G=-et/tt,0<G&&G<1&&lt.push(G);continue}mt=tt*tt-4*et*H,!(mt<0)&&(gt=q(mt),rt=(-tt+gt)/(2*H),0<rt&&rt<1&&lt.push(rt),ut=(-tt-gt)/(2*H),0<ut&&ut<1&&lt.push(ut))}for(var pt,_t,xt=lt.length,jt=xt,St;xt--;)G=lt[xt],St=1-G,pt=St*St*St*O+3*St*St*G*j+3*St*G*G*U+G*G*G*x,Y[0][xt]=pt,_t=St*St*St*F+3*St*St*G*P+3*St*G*G*T+G*G*G*k,Y[1][xt]=_t;Y[0][jt]=O,Y[1][jt]=F,Y[0][jt+1]=x,Y[1][jt+1]=k;var Kt=[{x:N.apply(null,Y[0]),y:N.apply(null,Y[1])},{x:nt.apply(null,Y[0]),y:nt.apply(null,Y[1])}];return t.cachesBoundsOfCurve&&(t.boundsOfCurveCache[R]=Kt),Kt}function o(O,F,j){for(var P=j[1],U=j[2],T=j[3],x=j[4],k=j[5],R=j[6],q=j[7],N=i(R-O,q-F,P,U,x,k,T),nt=0,ot=N.length;nt<ot;nt++)N[nt][1]+=O,N[nt][2]+=F,N[nt][3]+=O,N[nt][4]+=F,N[nt][5]+=O,N[nt][6]+=F;return N}function h(O){var F=0,j=0,P=O.length,U=0,T=0,x,k,R,q=[],N,nt,ot;for(k=0;k<P;++k){switch(R=!1,x=O[k].slice(0),x[0]){case"l":x[0]="L",x[1]+=F,x[2]+=j;case"L":F=x[1],j=x[2];break;case"h":x[1]+=F;case"H":x[0]="L",x[2]=j,F=x[1];break;case"v":x[1]+=j;case"V":x[0]="L",j=x[1],x[1]=F,x[2]=j;break;case"m":x[0]="M",x[1]+=F,x[2]+=j;case"M":F=x[1],j=x[2],U=x[1],T=x[2];break;case"c":x[0]="C",x[1]+=F,x[2]+=j,x[3]+=F,x[4]+=j,x[5]+=F,x[6]+=j;case"C":nt=x[3],ot=x[4],F=x[5],j=x[6];break;case"s":x[0]="S",x[1]+=F,x[2]+=j,x[3]+=F,x[4]+=j;case"S":N==="C"?(nt=2*F-nt,ot=2*j-ot):(nt=F,ot=j),F=x[3],j=x[4],x[0]="C",x[5]=x[3],x[6]=x[4],x[3]=x[1],x[4]=x[2],x[1]=nt,x[2]=ot,nt=x[3],ot=x[4];break;case"q":x[0]="Q",x[1]+=F,x[2]+=j,x[3]+=F,x[4]+=j;case"Q":nt=x[1],ot=x[2],F=x[3],j=x[4];break;case"t":x[0]="T",x[1]+=F,x[2]+=j;case"T":N==="Q"?(nt=2*F-nt,ot=2*j-ot):(nt=F,ot=j),x[0]="Q",F=x[1],j=x[2],x[1]=nt,x[2]=ot,x[3]=F,x[4]=j;break;case"a":x[0]="A",x[6]+=F,x[7]+=j;case"A":R=!0,q=q.concat(o(F,j,x)),F=x[6],j=x[7];break;case"z":case"Z":F=U,j=T;break}R||q.push(x),N=x[0]}return q}function n(O,F,j,P){return Math.sqrt((j-O)*(j-O)+(P-F)*(P-F))}function d(O){return O*O*O}function g(O){return 3*O*O*(1-O)}function v(O){return 3*O*(1-O)*(1-O)}function _(O){return(1-O)*(1-O)*(1-O)}function b(O,F,j,P,U,T,x,k){return function(R){var q=d(R),N=g(R),nt=v(R),ot=_(R);return{x:x*q+U*N+j*nt+O*ot,y:k*q+T*N+P*nt+F*ot}}}function C(O,F,j,P,U,T,x,k){return function(R){var q=1-R,N=3*q*q*(j-O)+6*q*R*(U-j)+3*R*R*(x-U),nt=3*q*q*(P-F)+6*q*R*(T-P)+3*R*R*(k-T);return Math.atan2(nt,N)}}function S(O){return O*O}function E(O){return 2*O*(1-O)}function z(O){return(1-O)*(1-O)}function V(O,F,j,P,U,T){return function(x){var k=S(x),R=E(x),q=z(x);return{x:U*k+j*R+O*q,y:T*k+P*R+F*q}}}function W(O,F,j,P,U,T){return function(x){var k=1-x,R=2*k*(j-O)+2*x*(U-j),q=2*k*(P-F)+2*x*(T-P);return Math.atan2(q,R)}}function L(O,F,j){var P={x:F,y:j},U,T=0,x;for(x=1;x<=100;x+=1)U=O(x/100),T+=n(P.x,P.y,U.x,U.y),P=U;return T}function A(O,F){for(var j=0,P=0,U=O.iterator,T={x:O.x,y:O.y},x,k,R=.01,q=O.angleFinder,N;P<F&&R>1e-4;)x=U(j),N=j,k=n(T.x,T.y,x.x,x.y),k+P>F?(j-=R,R/=2):(T=x,j+=R,P+=k);return x.angle=q(N),x}function X(O){for(var F=0,j=O.length,P,U=0,T=0,x=0,k=0,R=[],q,N,nt,ot=0;ot<j;ot++){switch(P=O[ot],N={x:U,y:T,command:P[0]},P[0]){case"M":N.length=0,x=U=P[1],k=T=P[2];break;case"L":N.length=n(U,T,P[1],P[2]),U=P[1],T=P[2];break;case"C":q=b(U,T,P[1],P[2],P[3],P[4],P[5],P[6]),nt=C(U,T,P[1],P[2],P[3],P[4],P[5],P[6]),N.iterator=q,N.angleFinder=nt,N.length=L(q,U,T),U=P[5],T=P[6];break;case"Q":q=V(U,T,P[1],P[2],P[3],P[4]),nt=W(U,T,P[1],P[2],P[3],P[4]),N.iterator=q,N.angleFinder=nt,N.length=L(q,U,T),U=P[3],T=P[4];break;case"Z":case"z":N.destX=x,N.destY=k,N.length=n(U,T,x,k),U=x,T=k;break}F+=N.length,R.push(N)}return R.push({length:F,x:U,y:T}),R}function B(O,F,j){j||(j=X(O));for(var P=0;F-j[P].length>0&&P<j.length-2;)F-=j[P].length,P++;var U=j[P],T=F/U.length,x=U.command,k=O[P],R;switch(x){case"M":return{x:U.x,y:U.y,angle:0};case"Z":case"z":return R=new t.Point(U.x,U.y).lerp(new t.Point(U.destX,U.destY),T),R.angle=Math.atan2(U.destY-U.y,U.destX-U.x),R;case"L":return R=new t.Point(U.x,U.y).lerp(new t.Point(k[1],k[2]),T),R.angle=Math.atan2(k[2]-U.y,k[1]-U.x),R;case"C":return A(U,F);case"Q":return A(U,F)}}function st(O){var F=[],j=[],P,U,T=t.rePathCommand,x="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",k="("+x+")"+t.commaWsp,R="([01])"+t.commaWsp+"?",q=k+"?"+k+"?"+k+R+R+k+"?("+x+")",N=new RegExp(q,"g"),nt,ot,lt;if(!O||!O.match)return F;lt=O.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var Y=0,H,tt=lt.length;Y<tt;Y++){P=lt[Y],ot=P.slice(1).trim(),j.length=0;var et=P.charAt(0);if(H=[et],et.toLowerCase()==="a")for(var G;G=N.exec(ot);)for(var rt=1;rt<G.length;rt++)j.push(G[rt]);else for(;nt=T.exec(ot);)j.push(nt[0]);for(var rt=0,ut=j.length;rt<ut;rt++)U=parseFloat(j[rt]),isNaN(U)||H.push(U);var mt=r[et.toLowerCase()],gt=a[et]||et;if(H.length-1>mt)for(var Q=1,pt=H.length;Q<pt;Q+=mt)F.push([et].concat(H.slice(Q,Q+mt))),et=gt;else F.push(H)}return F}function ht(O,F){var j=[],P,U=new t.Point(O[0].x,O[0].y),T=new t.Point(O[1].x,O[1].y),x=O.length,k=1,R=0,q=x>2;for(F=F||0,q&&(k=O[2].x<T.x?-1:O[2].x===T.x?0:1,R=O[2].y<T.y?-1:O[2].y===T.y?0:1),j.push(["M",U.x-k*F,U.y-R*F]),P=1;P<x;P++){if(!U.eq(T)){var N=U.midPointFrom(T);j.push(["Q",U.x,U.y,N.x,N.y])}U=O[P],P+1<O.length&&(T=O[P+1])}return q&&(k=U.x>O[P-2].x?1:U.x===O[P-2].x?0:-1,R=U.y>O[P-2].y?1:U.y===O[P-2].y?0:-1),j.push(["L",U.x+k*F,U.y+R*F]),j}function ft(O,F,j){return j&&(F=t.util.multiplyTransformMatrices(F,[1,0,0,1,-j.x,-j.y])),O.map(function(P){for(var U=P.slice(0),T={},x=1;x<P.length-1;x+=2)T.x=P[x],T.y=P[x+1],T=t.util.transformPoint(T,F),U[x]=T.x,U[x+1]=T.y;return U})}t.util.joinPath=function(O){return O.map(function(F){return F.join(" ")}).join(" ")},t.util.parsePath=st,t.util.makePathSimpler=h,t.util.getSmoothPathFromPoints=ht,t.util.getPathSegmentsInfo=X,t.util.getBoundsOfCurve=e,t.util.getPointOnPath=B,t.util.transformPath=ft}(),function(){var u=Array.prototype.slice;function r(e,o){for(var h=u.call(arguments,2),n=[],d=0,g=e.length;d<g;d++)n[d]=h.length?e[d][o].apply(e[d],h):e[d][o].call(e[d]);return n}function a(e,o){return s(e,o,function(h,n){return h>=n})}function l(e,o){return s(e,o,function(h,n){return h<n})}function i(e,o){for(var h=e.length;h--;)e[h]=o;return e}function s(e,o,h){if(!(!e||e.length===0)){var n=e.length-1,d=o?e[n][o]:e[n];if(o)for(;n--;)h(e[n][o],d)&&(d=e[n][o]);else for(;n--;)h(e[n],d)&&(d=e[n]);return d}}t.util.array={fill:i,invoke:r,min:l,max:a}}(),function(){function u(a,l,i){if(i)if(!t.isLikelyNode&&l instanceof Element)a=l;else if(l instanceof Array){a=[];for(var s=0,e=l.length;s<e;s++)a[s]=u({},l[s],i)}else if(l&&typeof l=="object")for(var o in l)o==="canvas"||o==="group"?a[o]=null:l.hasOwnProperty(o)&&(a[o]=u({},l[o],i));else a=l;else for(var o in l)a[o]=l[o];return a}function r(a,l){return u({},a,l)}t.util.object={extend:u,clone:r},t.util.object.extend(t.util,t.Observable)}(),function(){function u(s){return s.replace(/-+(.)?/g,function(e,o){return o?o.toUpperCase():""})}function r(s,e){return s.charAt(0).toUpperCase()+(e?s.slice(1):s.slice(1).toLowerCase())}function a(s){return s.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function l(s){var e=0,o,h=[];for(e=0,o;e<s.length;e++)(o=i(s,e))!==!1&&h.push(o);return h}function i(s,e){var o=s.charCodeAt(e);if(isNaN(o))return"";if(o<55296||o>57343)return s.charAt(e);if(55296<=o&&o<=56319){if(s.length<=e+1)throw"High surrogate without following low surrogate";var h=s.charCodeAt(e+1);if(56320>h||h>57343)throw"High surrogate without following low surrogate";return s.charAt(e)+s.charAt(e+1)}if(e===0)throw"Low surrogate without preceding high surrogate";var n=s.charCodeAt(e-1);if(55296>n||n>56319)throw"Low surrogate without preceding high surrogate";return!1}t.util.string={camelize:u,capitalize:r,escapeXml:a,graphemeSplit:l}}(),function(){var u=Array.prototype.slice,r=function(){},a=function(){for(var o in{toString:1})if(o==="toString")return!1;return!0}(),l=function(o,h,n){for(var d in h)d in o.prototype&&typeof o.prototype[d]=="function"&&(h[d]+"").indexOf("callSuper")>-1?o.prototype[d]=function(g){return function(){var v=this.constructor.superclass;this.constructor.superclass=n;var _=h[g].apply(this,arguments);if(this.constructor.superclass=v,g!=="initialize")return _}}(d):o.prototype[d]=h[d],a&&(h.toString!==Object.prototype.toString&&(o.prototype.toString=h.toString),h.valueOf!==Object.prototype.valueOf&&(o.prototype.valueOf=h.valueOf))};function i(){}function s(o){for(var h=null,n=this;n.constructor.superclass;){var d=n.constructor.superclass.prototype[o];if(n[o]!==d){h=d;break}n=n.constructor.superclass.prototype}return h?arguments.length>1?h.apply(this,u.call(arguments,1)):h.call(this):console.log("tried to callSuper "+o+", method not found in prototype chain",this)}function e(){var o=null,h=u.call(arguments,0);typeof h[0]=="function"&&(o=h.shift());function n(){this.initialize.apply(this,arguments)}n.superclass=o,n.subclasses=[],o&&(i.prototype=o.prototype,n.prototype=new i,o.subclasses.push(n));for(var d=0,g=h.length;d<g;d++)l(n,h[d],o);return n.prototype.initialize||(n.prototype.initialize=r),n.prototype.constructor=n,n.prototype.callSuper=s,n}t.util.createClass=e}(),function(){var u=!!t.document.createElement("div").attachEvent,r=["touchstart","touchmove","touchend"];t.util.addListener=function(l,i,s,e){l&&l.addEventListener(i,s,u?!1:e)},t.util.removeListener=function(l,i,s,e){l&&l.removeEventListener(i,s,u?!1:e)};function a(l){var i=l.changedTouches;return i&&i[0]?i[0]:l}t.util.getPointer=function(l){var i=l.target,s=t.util.getScrollLeftTop(i),e=a(l);return{x:e.clientX+s.left,y:e.clientY+s.top}},t.util.isTouchEvent=function(l){return r.indexOf(l.type)>-1||l.pointerType==="touch"}}(),function(){function u(e,o){var h=e.style;if(!h)return e;if(typeof o=="string")return e.style.cssText+=";"+o,o.indexOf("opacity")>-1?s(e,o.match(/opacity:\s*(\d?\.?\d*)/)[1]):e;for(var n in o)if(n==="opacity")s(e,o[n]);else{var d=n==="float"||n==="cssFloat"?typeof h.styleFloat=="undefined"?"cssFloat":"styleFloat":n;h.setProperty(d,o[n])}return e}var r=t.document.createElement("div"),a=typeof r.style.opacity=="string",l=typeof r.style.filter=="string",i=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,s=function(e){return e};a?s=function(e,o){return e.style.opacity=o,e}:l&&(s=function(e,o){var h=e.style;return e.currentStyle&&!e.currentStyle.hasLayout&&(h.zoom=1),i.test(h.filter)?(o=o>=.9999?"":"alpha(opacity="+o*100+")",h.filter=h.filter.replace(i,o)):h.filter+=" alpha(opacity="+o*100+")",e}),t.util.setStyle=u}(),function(){var u=Array.prototype.slice;function r(_){return typeof _=="string"?t.document.getElementById(_):_}var a,l=function(_){return u.call(_,0)};try{a=l(t.document.childNodes)instanceof Array}catch(_){}a||(l=function(_){for(var b=new Array(_.length),C=_.length;C--;)b[C]=_[C];return b});function i(_,b){var C=t.document.createElement(_);for(var S in b)S==="class"?C.className=b[S]:S==="for"?C.htmlFor=b[S]:C.setAttribute(S,b[S]);return C}function s(_,b){_&&(" "+_.className+" ").indexOf(" "+b+" ")===-1&&(_.className+=(_.className?" ":"")+b)}function e(_,b,C){return typeof b=="string"&&(b=i(b,C)),_.parentNode&&_.parentNode.replaceChild(b,_),b.appendChild(_),b}function o(_){for(var b=0,C=0,S=t.document.documentElement,E=t.document.body||{scrollLeft:0,scrollTop:0};_&&(_.parentNode||_.host)&&(_=_.parentNode||_.host,_===t.document?(b=E.scrollLeft||S.scrollLeft||0,C=E.scrollTop||S.scrollTop||0):(b+=_.scrollLeft||0,C+=_.scrollTop||0),!(_.nodeType===1&&_.style.position==="fixed")););return{left:b,top:C}}function h(_){var b,C=_&&_.ownerDocument,S={left:0,top:0},E={left:0,top:0},z,V={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!C)return E;for(var W in V)E[V[W]]+=parseInt(n(_,W),10)||0;return b=C.documentElement,typeof _.getBoundingClientRect!="undefined"&&(S=_.getBoundingClientRect()),z=o(_),{left:S.left+z.left-(b.clientLeft||0)+E.left,top:S.top+z.top-(b.clientTop||0)+E.top}}var n;t.document.defaultView&&t.document.defaultView.getComputedStyle?n=function(_,b){var C=t.document.defaultView.getComputedStyle(_,null);return C?C[b]:void 0}:n=function(_,b){var C=_.style[b];return!C&&_.currentStyle&&(C=_.currentStyle[b]),C},function(){var _=t.document.documentElement.style,b="userSelect"in _?"userSelect":"MozUserSelect"in _?"MozUserSelect":"WebkitUserSelect"in _?"WebkitUserSelect":"KhtmlUserSelect"in _?"KhtmlUserSelect":"";function C(E){return typeof E.onselectstart!="undefined"&&(E.onselectstart=t.util.falseFunction),b?E.style[b]="none":typeof E.unselectable=="string"&&(E.unselectable="on"),E}function S(E){return typeof E.onselectstart!="undefined"&&(E.onselectstart=null),b?E.style[b]="":typeof E.unselectable=="string"&&(E.unselectable=""),E}t.util.makeElementUnselectable=C,t.util.makeElementSelectable=S}();function d(_){var b=t.jsdomImplForWrapper(_);return b._canvas||b._image}function g(_){if(t.isLikelyNode){var b=t.jsdomImplForWrapper(_);b&&(b._image=null,b._canvas=null,b._currentSrc=null,b._attributes=null,b._classList=null)}}function v(_,b){_.imageSmoothingEnabled=_.imageSmoothingEnabled||_.webkitImageSmoothingEnabled||_.mozImageSmoothingEnabled||_.msImageSmoothingEnabled||_.oImageSmoothingEnabled,_.imageSmoothingEnabled=b}t.util.setImageSmoothing=v,t.util.getById=r,t.util.toArray=l,t.util.addClass=s,t.util.makeElement=i,t.util.wrapElement=e,t.util.getScrollLeftTop=o,t.util.getElementOffset=h,t.util.getNodeCanvas=d,t.util.cleanUpJsdomNode=g}(),function(){function u(l,i){return l+(/\?/.test(l)?"&":"?")+i}function r(){}function a(l,i){i||(i={});var s=i.method?i.method.toUpperCase():"GET",e=i.onComplete||function(){},o=new t.window.XMLHttpRequest,h=i.body||i.parameters;return o.onreadystatechange=function(){o.readyState===4&&(e(o),o.onreadystatechange=r)},s==="GET"&&(h=null,typeof i.parameters=="string"&&(l=u(l,i.parameters))),o.open(s,l,!0),(s==="POST"||s==="PUT")&&o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(h),o}t.util.request=a}(),t.log=console.log,t.warn=console.warn,function(){var u=t.util.object.extend,r=t.util.object.clone,a=[];t.util.object.extend(a,{cancelAll:function(){var d=this.splice(0);return d.forEach(function(g){g.cancel()}),d},cancelByCanvas:function(d){if(!d)return[];var g=this.filter(function(v){return typeof v.target=="object"&&v.target.canvas===d});return g.forEach(function(v){v.cancel()}),g},cancelByTarget:function(d){var g=this.findAnimationsByTarget(d);return g.forEach(function(v){v.cancel()}),g},findAnimationIndex:function(d){return this.indexOf(this.findAnimation(d))},findAnimation:function(d){return this.find(function(g){return g.cancel===d})},findAnimationsByTarget:function(d){return d?this.filter(function(g){return g.target===d}):[]}});function l(){return!1}function i(d,g,v,_){return-v*Math.cos(d/_*(Math.PI/2))+v+g}function s(d){d||(d={});var g=!1,v,_=function(){var b=t.runningAnimations.indexOf(v);return b>-1&&t.runningAnimations.splice(b,1)[0]};return v=u(r(d),{cancel:function(){return g=!0,_()},currentValue:"startValue"in d?d.startValue:0,completionRate:0,durationRate:0}),t.runningAnimations.push(v),h(function(b){var C=b||+new Date,S=d.duration||500,E=C+S,z,V=d.onChange||l,W=d.abort||l,L=d.onComplete||l,A=d.easing||i,X="startValue"in d?d.startValue.length>0:!1,B="startValue"in d?d.startValue:0,st="endValue"in d?d.endValue:100,ht=d.byValue||(X?B.map(function(ft,O){return st[O]-B[O]}):st-B);d.onStart&&d.onStart(),function ft(O){z=O||+new Date;var F=z>E?S:z-C,j=F/S,P=X?B.map(function(T,x){return A(F,B[x],ht[x],S)}):A(F,B,ht,S),U=Math.abs(X?(P[0]-B[0])/ht[0]:(P-B)/ht);if(v.currentValue=X?P.slice():P,v.completionRate=U,v.durationRate=j,!g){if(W(P,U,j)){_();return}if(z>E){v.currentValue=X?st.slice():st,v.completionRate=1,v.durationRate=1,V(X?st.slice():st,1,1),L(st,1,1),_();return}else V(P,U,j),h(ft)}}(C)}),v.cancel}var e=t.window.requestAnimationFrame||t.window.webkitRequestAnimationFrame||t.window.mozRequestAnimationFrame||t.window.oRequestAnimationFrame||t.window.msRequestAnimationFrame||function(d){return t.window.setTimeout(d,1e3/60)},o=t.window.cancelAnimationFrame||t.window.clearTimeout;function h(){return e.apply(t.window,arguments)}function n(){return o.apply(t.window,arguments)}t.util.animate=s,t.util.requestAnimFrame=h,t.util.cancelAnimFrame=n,t.runningAnimations=a}(),function(){function u(a,l,i){var s="rgba("+parseInt(a[0]+i*(l[0]-a[0]),10)+","+parseInt(a[1]+i*(l[1]-a[1]),10)+","+parseInt(a[2]+i*(l[2]-a[2]),10);return s+=","+(a&&l?parseFloat(a[3]+i*(l[3]-a[3])):1),s+=")",s}function r(a,l,i,s){var e=new t.Color(a).getSource(),o=new t.Color(l).getSource(),h=s.onComplete,n=s.onChange;return s=s||{},t.util.animate(t.util.object.extend(s,{duration:i||500,startValue:e,endValue:o,byValue:o,easing:function(d,g,v,_){var b=s.colorEasing?s.colorEasing(d,_):1-Math.cos(d/_*(Math.PI/2));return u(g,v,b)},onComplete:function(d,g,v){if(h)return h(u(o,o,0),g,v)},onChange:function(d,g,v){if(n){if(Array.isArray(d))return n(u(d,d,0),g,v);n(d,g,v)}}}))}t.util.animateColor=r}(),function(){function u(O,F,j,P){return O<Math.abs(F)?(O=F,P=j/4):F===0&&O===0?P=j/(2*Math.PI)*Math.asin(1):P=j/(2*Math.PI)*Math.asin(F/O),{a:O,c:F,p:j,s:P}}function r(O,F,j){return O.a*Math.pow(2,10*(F-=1))*Math.sin((F*j-O.s)*(2*Math.PI)/O.p)}function a(O,F,j,P){return j*((O=O/P-1)*O*O+1)+F}function l(O,F,j,P){return O/=P/2,O<1?j/2*O*O*O+F:j/2*((O-=2)*O*O+2)+F}function i(O,F,j,P){return j*(O/=P)*O*O*O+F}function s(O,F,j,P){return-j*((O=O/P-1)*O*O*O-1)+F}function e(O,F,j,P){return O/=P/2,O<1?j/2*O*O*O*O+F:-j/2*((O-=2)*O*O*O-2)+F}function o(O,F,j,P){return j*(O/=P)*O*O*O*O+F}function h(O,F,j,P){return j*((O=O/P-1)*O*O*O*O+1)+F}function n(O,F,j,P){return O/=P/2,O<1?j/2*O*O*O*O*O+F:j/2*((O-=2)*O*O*O*O+2)+F}function d(O,F,j,P){return-j*Math.cos(O/P*(Math.PI/2))+j+F}function g(O,F,j,P){return j*Math.sin(O/P*(Math.PI/2))+F}function v(O,F,j,P){return-j/2*(Math.cos(Math.PI*O/P)-1)+F}function _(O,F,j,P){return O===0?F:j*Math.pow(2,10*(O/P-1))+F}function b(O,F,j,P){return O===P?F+j:j*(-Math.pow(2,-10*O/P)+1)+F}function C(O,F,j,P){return O===0?F:O===P?F+j:(O/=P/2,O<1?j/2*Math.pow(2,10*(O-1))+F:j/2*(-Math.pow(2,-10*--O)+2)+F)}function S(O,F,j,P){return-j*(Math.sqrt(1-(O/=P)*O)-1)+F}function E(O,F,j,P){return j*Math.sqrt(1-(O=O/P-1)*O)+F}function z(O,F,j,P){return O/=P/2,O<1?-j/2*(Math.sqrt(1-O*O)-1)+F:j/2*(Math.sqrt(1-(O-=2)*O)+1)+F}function V(O,F,j,P){var U=1.70158,T=0,x=j;if(O===0)return F;if(O/=P,O===1)return F+j;T||(T=P*.3);var k=u(x,j,T,U);return-r(k,O,P)+F}function W(O,F,j,P){var U=1.70158,T=0,x=j;if(O===0)return F;if(O/=P,O===1)return F+j;T||(T=P*.3);var k=u(x,j,T,U);return k.a*Math.pow(2,-10*O)*Math.sin((O*P-k.s)*(2*Math.PI)/k.p)+k.c+F}function L(O,F,j,P){var U=1.70158,T=0,x=j;if(O===0)return F;if(O/=P/2,O===2)return F+j;T||(T=P*(.3*1.5));var k=u(x,j,T,U);return O<1?-.5*r(k,O,P)+F:k.a*Math.pow(2,-10*(O-=1))*Math.sin((O*P-k.s)*(2*Math.PI)/k.p)*.5+k.c+F}function A(O,F,j,P,U){return U===void 0&&(U=1.70158),j*(O/=P)*O*((U+1)*O-U)+F}function X(O,F,j,P,U){return U===void 0&&(U=1.70158),j*((O=O/P-1)*O*((U+1)*O+U)+1)+F}function B(O,F,j,P,U){return U===void 0&&(U=1.70158),O/=P/2,O<1?j/2*(O*O*(((U*=1.525)+1)*O-U))+F:j/2*((O-=2)*O*(((U*=1.525)+1)*O+U)+2)+F}function st(O,F,j,P){return j-ht(P-O,0,j,P)+F}function ht(O,F,j,P){return(O/=P)<1/2.75?j*(7.5625*O*O)+F:O<2/2.75?j*(7.5625*(O-=1.5/2.75)*O+.75)+F:O<2.5/2.75?j*(7.5625*(O-=2.25/2.75)*O+.9375)+F:j*(7.5625*(O-=2.625/2.75)*O+.984375)+F}function ft(O,F,j,P){return O<P/2?st(O*2,0,j,P)*.5+F:ht(O*2-P,0,j,P)*.5+j*.5+F}t.util.ease={easeInQuad:function(O,F,j,P){return j*(O/=P)*O+F},easeOutQuad:function(O,F,j,P){return-j*(O/=P)*(O-2)+F},easeInOutQuad:function(O,F,j,P){return O/=P/2,O<1?j/2*O*O+F:-j/2*(--O*(O-2)-1)+F},easeInCubic:function(O,F,j,P){return j*(O/=P)*O*O+F},easeOutCubic:a,easeInOutCubic:l,easeInQuart:i,easeOutQuart:s,easeInOutQuart:e,easeInQuint:o,easeOutQuint:h,easeInOutQuint:n,easeInSine:d,easeOutSine:g,easeInOutSine:v,easeInExpo:_,easeOutExpo:b,easeInOutExpo:C,easeInCirc:S,easeOutCirc:E,easeInOutCirc:z,easeInElastic:V,easeOutElastic:W,easeInOutElastic:L,easeInBack:A,easeOutBack:X,easeInOutBack:B,easeInBounce:st,easeOutBounce:ht,easeInOutBounce:ft}}(),function(u){var r=u.fabric||(u.fabric={}),a=r.util.object.extend,l=r.util.object.clone,i=r.util.toFixed,s=r.util.parseUnit,e=r.util.multiplyTransformMatrices,o=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],h=["symbol","image","marker","pattern","view","svg"],n=["pattern","defs","symbol","metadata","clipPath","mask","desc"],d=["symbol","g","a","svg","clipPath","defs"],g={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},v={stroke:"strokeOpacity",fill:"fillOpacity"},_="font-size",b="clip-path";r.svgValidTagNamesRegEx=E(o),r.svgViewBoxElementsRegEx=E(h),r.svgInvalidAncestorsRegEx=E(n),r.svgValidParentsRegEx=E(d),r.cssRules={},r.gradientDefs={},r.clipPaths={};function C(T){return T in g?g[T]:T}function S(T,x,k,R){var q=Array.isArray(x),N;if((T==="fill"||T==="stroke")&&x==="none")x="";else{if(T==="strokeUniform")return x==="non-scaling-stroke";if(T==="strokeDashArray")x==="none"?x=null:x=x.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(T==="transformMatrix")k&&k.transformMatrix?x=e(k.transformMatrix,r.parseTransformAttribute(x)):x=r.parseTransformAttribute(x);else if(T==="visible")x=x!=="none"&&x!=="hidden",k&&k.visible===!1&&(x=!1);else if(T==="opacity")x=parseFloat(x),k&&typeof k.opacity!="undefined"&&(x*=k.opacity);else if(T==="textAnchor")x=x==="start"?"left":x==="end"?"right":"center";else if(T==="charSpacing")N=s(x,R)/R*1e3;else if(T==="paintFirst"){var nt=x.indexOf("fill"),ot=x.indexOf("stroke"),x="fill";(nt>-1&&ot>-1&&ot<nt||nt===-1&&ot>-1)&&(x="stroke")}else{if(T==="href"||T==="xlink:href"||T==="font")return x;if(T==="imageSmoothing")return x==="optimizeQuality";N=q?x.map(s):s(x,R)}}return!q&&isNaN(N)?x:N}function E(T){return new RegExp("^("+T.join("|")+")\\b","i")}function z(T){for(var x in v)if(!(typeof T[v[x]]=="undefined"||T[x]==="")){if(typeof T[x]=="undefined"){if(!r.Object.prototype[x])continue;T[x]=r.Object.prototype[x]}if(T[x].indexOf("url(")!==0){var k=new r.Color(T[x]);T[x]=k.setAlpha(i(k.getAlpha()*T[v[x]],2)).toRgba()}}return T}function V(T,x){var k,R=[],q,N,nt;for(N=0,nt=x.length;N<nt;N++)k=x[N],q=T.getElementsByTagName(k),R=R.concat(Array.prototype.slice.call(q));return R}r.parseTransformAttribute=function(){function T(Q,pt){var _t=r.util.cos(pt[0]),xt=r.util.sin(pt[0]),jt=0,St=0;pt.length===3&&(jt=pt[1],St=pt[2]),Q[0]=_t,Q[1]=xt,Q[2]=-xt,Q[3]=_t,Q[4]=jt-(_t*jt-xt*St),Q[5]=St-(xt*jt+_t*St)}function x(Q,pt){var _t=pt[0],xt=pt.length===2?pt[1]:pt[0];Q[0]=_t,Q[3]=xt}function k(Q,pt,_t){Q[_t]=Math.tan(r.util.degreesToRadians(pt[0]))}function R(Q,pt){Q[4]=pt[0],pt.length===2&&(Q[5]=pt[1])}var q=r.iMatrix,N=r.reNum,nt=r.commaWsp,ot="(?:(skewX)\\s*\\(\\s*("+N+")\\s*\\))",lt="(?:(skewY)\\s*\\(\\s*("+N+")\\s*\\))",Y="(?:(rotate)\\s*\\(\\s*("+N+")(?:"+nt+"("+N+")"+nt+"("+N+"))?\\s*\\))",H="(?:(scale)\\s*\\(\\s*("+N+")(?:"+nt+"("+N+"))?\\s*\\))",tt="(?:(translate)\\s*\\(\\s*("+N+")(?:"+nt+"("+N+"))?\\s*\\))",et="(?:(matrix)\\s*\\(\\s*("+N+")"+nt+"("+N+")"+nt+"("+N+")"+nt+"("+N+")"+nt+"("+N+")"+nt+"("+N+")\\s*\\))",G="(?:"+et+"|"+tt+"|"+H+"|"+Y+"|"+ot+"|"+lt+")",rt="(?:"+G+"(?:"+nt+"*"+G+")*)",ut="^\\s*(?:"+rt+"?)\\s*$",mt=new RegExp(ut),gt=new RegExp(G,"g");return function(Q){var pt=q.concat(),_t=[];if(!Q||Q&&!mt.test(Q))return pt;Q.replace(gt,function(jt){var St=new RegExp(G).exec(jt).filter(function(Ce){return!!Ce}),Kt=St[1],zt=St.slice(2).map(parseFloat);switch(Kt){case"translate":R(pt,zt);break;case"rotate":zt[0]=r.util.degreesToRadians(zt[0]),T(pt,zt);break;case"scale":x(pt,zt);break;case"skewX":k(pt,zt,2);break;case"skewY":k(pt,zt,1);break;case"matrix":pt=zt;break}_t.push(pt.concat()),pt=q.concat()});for(var xt=_t[0];_t.length>1;)_t.shift(),xt=r.util.multiplyTransformMatrices(xt,_t[0]);return xt}}();function W(T,x){var k,R;T.replace(/;\s*$/,"").split(";").forEach(function(q){var N=q.split(":");k=N[0].trim().toLowerCase(),R=N[1].trim(),x[k]=R})}function L(T,x){var k,R;for(var q in T)typeof T[q]!="undefined"&&(k=q.toLowerCase(),R=T[q],x[k]=R)}function A(T,x){var k={};for(var R in r.cssRules[x])if(X(T,R.split(" ")))for(var q in r.cssRules[x][R])k[q]=r.cssRules[x][R][q];return k}function X(T,x){var k,R=!0;return k=st(T,x.pop()),k&&x.length&&(R=B(T,x)),k&&R&&x.length===0}function B(T,x){for(var k,R=!0;T.parentNode&&T.parentNode.nodeType===1&&x.length;)R&&(k=x.pop()),T=T.parentNode,R=st(T,k);return x.length===0}function st(T,x){var k=T.nodeName,R=T.getAttribute("class"),q=T.getAttribute("id"),N,nt;if(N=new RegExp("^"+k,"i"),x=x.replace(N,""),q&&x.length&&(N=new RegExp("#"+q+"(?![a-zA-Z\\-]+)","i"),x=x.replace(N,"")),R&&x.length)for(R=R.split(" "),nt=R.length;nt--;)N=new RegExp("\\."+R[nt]+"(?![a-zA-Z\\-]+)","i"),x=x.replace(N,"");return x.length===0}function ht(T,x){var k;if(T.getElementById&&(k=T.getElementById(x)),k)return k;var R,q,N,nt=T.getElementsByTagName("*");for(q=0,N=nt.length;q<N;q++)if(R=nt[q],x===R.getAttribute("id"))return R}function ft(T){for(var x=V(T,["use","svg:use"]),k=0;x.length&&k<x.length;){var R=x[k],q=R.getAttribute("xlink:href")||R.getAttribute("href");if(q===null)return;var N=q.slice(1),nt=R.getAttribute("x")||0,ot=R.getAttribute("y")||0,lt=ht(T,N).cloneNode(!0),Y=(lt.getAttribute("transform")||"")+" translate("+nt+", "+ot+")",H,tt=x.length,et,G,rt,ut,mt=r.svgNS;if(F(lt),/^svg$/i.test(lt.nodeName)){var gt=lt.ownerDocument.createElementNS(mt,"g");for(G=0,rt=lt.attributes,ut=rt.length;G<ut;G++)et=rt.item(G),gt.setAttributeNS(mt,et.nodeName,et.nodeValue);for(;lt.firstChild;)gt.appendChild(lt.firstChild);lt=gt}for(G=0,rt=R.attributes,ut=rt.length;G<ut;G++)et=rt.item(G),!(et.nodeName==="x"||et.nodeName==="y"||et.nodeName==="xlink:href"||et.nodeName==="href")&&(et.nodeName==="transform"?Y=et.nodeValue+" "+Y:lt.setAttribute(et.nodeName,et.nodeValue));lt.setAttribute("transform",Y),lt.setAttribute("instantiated_by_use","1"),lt.removeAttribute("id"),H=R.parentNode,H.replaceChild(lt,R),x.length===tt&&k++}}var O=new RegExp("^\\s*("+r.reNum+"+)\\s*,?\\s*("+r.reNum+"+)\\s*,?\\s*("+r.reNum+"+)\\s*,?\\s*("+r.reNum+"+)\\s*$");function F(T){if(!r.svgViewBoxElementsRegEx.test(T.nodeName))return{};var x=T.getAttribute("viewBox"),k=1,R=1,q=0,N=0,nt,ot,lt,Y,H=T.getAttribute("width"),tt=T.getAttribute("height"),et=T.getAttribute("x")||0,G=T.getAttribute("y")||0,rt=T.getAttribute("preserveAspectRatio")||"",ut=!x||!(x=x.match(O)),mt=!H||!tt||H==="100%"||tt==="100%",gt=ut&&mt,Q={},pt="",_t=0,xt=0;if(Q.width=0,Q.height=0,Q.toBeParsed=gt,ut&&(et||G)&&T.parentNode&&T.parentNode.nodeName!=="#document"&&(pt=" translate("+s(et)+" "+s(G)+") ",lt=(T.getAttribute("transform")||"")+pt,T.setAttribute("transform",lt),T.removeAttribute("x"),T.removeAttribute("y")),gt)return Q;if(ut)return Q.width=s(H),Q.height=s(tt),Q;if(q=-parseFloat(x[1]),N=-parseFloat(x[2]),nt=parseFloat(x[3]),ot=parseFloat(x[4]),Q.minX=q,Q.minY=N,Q.viewBoxWidth=nt,Q.viewBoxHeight=ot,mt?(Q.width=nt,Q.height=ot):(Q.width=s(H),Q.height=s(tt),k=Q.width/nt,R=Q.height/ot),rt=r.util.parsePreserveAspectRatioAttribute(rt),rt.alignX!=="none"&&(rt.meetOrSlice==="meet"&&(R=k=k>R?R:k),rt.meetOrSlice==="slice"&&(R=k=k>R?k:R),_t=Q.width-nt*k,xt=Q.height-ot*k,rt.alignX==="Mid"&&(_t/=2),rt.alignY==="Mid"&&(xt/=2),rt.alignX==="Min"&&(_t=0),rt.alignY==="Min"&&(xt=0)),k===1&&R===1&&q===0&&N===0&&et===0&&G===0)return Q;if((et||G)&&T.parentNode.nodeName!=="#document"&&(pt=" translate("+s(et)+" "+s(G)+") "),lt=pt+" matrix("+k+" 0 0 "+R+" "+(q*k+_t)+" "+(N*R+xt)+") ",T.nodeName==="svg"){for(Y=T.ownerDocument.createElementNS(r.svgNS,"g");T.firstChild;)Y.appendChild(T.firstChild);T.appendChild(Y)}else Y=T,Y.removeAttribute("x"),Y.removeAttribute("y"),lt=Y.getAttribute("transform")+lt;return Y.setAttribute("transform",lt),Q}function j(T,x){for(;T&&(T=T.parentNode);)if(T.nodeName&&x.test(T.nodeName.replace("svg:",""))&&!T.getAttribute("instantiated_by_use"))return!0;return!1}r.parseSVGDocument=function(T,x,k,R){if(T){ft(T);var q=r.Object.__uid++,N,nt,ot=F(T),lt=r.util.toArray(T.getElementsByTagName("*"));if(ot.crossOrigin=R&&R.crossOrigin,ot.svgUid=q,lt.length===0&&r.isLikelyNode){lt=T.selectNodes('//*[name(.)!="svg"]');var Y=[];for(N=0,nt=lt.length;N<nt;N++)Y[N]=lt[N];lt=Y}var H=lt.filter(function(et){return F(et),r.svgValidTagNamesRegEx.test(et.nodeName.replace("svg:",""))&&!j(et,r.svgInvalidAncestorsRegEx)});if(!H||H&&!H.length){x&&x([],{});return}var tt={};lt.filter(function(et){return et.nodeName.replace("svg:","")==="clipPath"}).forEach(function(et){var G=et.getAttribute("id");tt[G]=r.util.toArray(et.getElementsByTagName("*")).filter(function(rt){return r.svgValidTagNamesRegEx.test(rt.nodeName.replace("svg:",""))})}),r.gradientDefs[q]=r.getGradientDefs(T),r.cssRules[q]=r.getCSSRules(T),r.clipPaths[q]=tt,r.parseElements(H,function(et,G){x&&(x(et,ot,G,lt),delete r.gradientDefs[q],delete r.cssRules[q],delete r.clipPaths[q])},l(ot),k,R)}};function P(T,x){var k=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],R="xlink:href",q=x.getAttribute(R).slice(1),N=ht(T,q);if(N&&N.getAttribute(R)&&P(T,N),k.forEach(function(ot){N&&!x.hasAttribute(ot)&&N.hasAttribute(ot)&&x.setAttribute(ot,N.getAttribute(ot))}),!x.children.length)for(var nt=N.cloneNode(!0);nt.firstChild;)x.appendChild(nt.firstChild);x.removeAttribute(R)}var U=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+r.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+r.reNum+"))?\\s+(.*)");a(r,{parseFontDeclaration:function(T,x){var k=T.match(U);if(k){var R=k[1],q=k[3],N=k[4],nt=k[5],ot=k[6];R&&(x.fontStyle=R),q&&(x.fontWeight=isNaN(parseFloat(q))?q:parseFloat(q)),N&&(x.fontSize=s(N)),ot&&(x.fontFamily=ot),nt&&(x.lineHeight=nt==="normal"?1:nt)}},getGradientDefs:function(T){var x=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],k=V(T,x),R,q=0,N={};for(q=k.length;q--;)R=k[q],R.getAttribute("xlink:href")&&P(T,R),N[R.getAttribute("id")]=R;return N},parseAttributes:function(T,x,k){if(T){var R,q={},N,nt;typeof k=="undefined"&&(k=T.getAttribute("svgUid")),T.parentNode&&r.svgValidParentsRegEx.test(T.parentNode.nodeName)&&(q=r.parseAttributes(T.parentNode,x,k));var ot=x.reduce(function(rt,ut){return R=T.getAttribute(ut),R&&(rt[ut]=R),rt},{}),lt=a(A(T,k),r.parseStyleAttribute(T));ot=a(ot,lt),lt[b]&&T.setAttribute(b,lt[b]),N=nt=q.fontSize||r.Text.DEFAULT_SVG_FONT_SIZE,ot[_]&&(ot[_]=N=s(ot[_],nt));var Y,H,tt={};for(var et in ot)Y=C(et),H=S(Y,ot[et],q,N),tt[Y]=H;tt&&tt.font&&r.parseFontDeclaration(tt.font,tt);var G=a(q,tt);return r.svgValidParentsRegEx.test(T.nodeName)?G:z(G)}},parseElements:function(T,x,k,R,q){new r.ElementsParser(T,x,k,R,q).parse()},parseStyleAttribute:function(T){var x={},k=T.getAttribute("style");return k&&(typeof k=="string"?W(k,x):L(k,x)),x},parsePointsAttribute:function(T){if(!T)return null;T=T.replace(/,/g," ").trim(),T=T.split(/\s+/);var x=[],k,R;for(k=0,R=T.length;k<R;k+=2)x.push({x:parseFloat(T[k]),y:parseFloat(T[k+1])});return x},getCSSRules:function(T){var x=T.getElementsByTagName("style"),k,R,q={},N;for(k=0,R=x.length;k<R;k++){var nt=x[k].textContent;nt=nt.replace(/\/\*[\s\S]*?\*\//g,""),nt.trim()!==""&&(N=nt.split("}"),N=N.filter(function(ot){return ot.trim()}),N.forEach(function(ot){var lt=ot.split("{"),Y={},H=lt[1].trim(),tt=H.split(";").filter(function(ut){return ut.trim()});for(k=0,R=tt.length;k<R;k++){var et=tt[k].split(":"),G=et[0].trim(),rt=et[1].trim();Y[G]=rt}ot=lt[0].trim(),ot.split(",").forEach(function(ut){ut=ut.replace(/^svg/i,"").trim(),ut!==""&&(q[ut]?r.util.object.extend(q[ut],Y):q[ut]=r.util.object.clone(Y))})}))}return q},loadSVGFromURL:function(T,x,k,R){T=T.replace(/^\n\s*/,"").trim(),new r.util.request(T,{method:"get",onComplete:q});function q(N){var nt=N.responseXML;if(!nt||!nt.documentElement)return x&&x(null),!1;r.parseSVGDocument(nt.documentElement,function(ot,lt,Y,H){x&&x(ot,lt,Y,H)},k,R)}},loadSVGFromString:function(T,x,k,R){var q=new r.window.DOMParser,N=q.parseFromString(T.trim(),"text/xml");r.parseSVGDocument(N.documentElement,function(nt,ot,lt,Y){x(nt,ot,lt,Y)},k,R)}})}(c),t.ElementsParser=function(u,r,a,l,i,s){this.elements=u,this.callback=r,this.options=a,this.reviver=l,this.svgUid=a&&a.svgUid||0,this.parsingOptions=i,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=s},function(u){u.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},u.createObjects=function(){var r=this;this.elements.forEach(function(a,l){a.setAttribute("svgUid",r.svgUid),r.createObject(a,l)})},u.findTag=function(r){return t[t.util.string.capitalize(r.tagName.replace("svg:",""))]},u.createObject=function(r,a){var l=this.findTag(r);if(l&&l.fromElement)try{l.fromElement(r,this.createCallback(a,r),this.options)}catch(i){t.log(i)}else this.checkIfDone()},u.createCallback=function(r,a){var l=this;return function(i){var s;l.resolveGradient(i,a,"fill"),l.resolveGradient(i,a,"stroke"),i instanceof t.Image&&i._originalElement&&(s=i.parsePreserveAspectRatioAttribute(a)),i._removeTransformMatrix(s),l.resolveClipPath(i,a),l.reviver&&l.reviver(a,i),l.instances[r]=i,l.checkIfDone()}},u.extractPropertyDefinition=function(r,a,l){var i=r[a],s=this.regexUrl;if(s.test(i)){s.lastIndex=0;var e=s.exec(i)[1];return s.lastIndex=0,t[l][this.svgUid][e]}},u.resolveGradient=function(r,a,l){var i=this.extractPropertyDefinition(r,l,"gradientDefs");if(i){var s=a.getAttribute(l+"-opacity"),e=t.Gradient.fromElement(i,r,s,this.options);r.set(l,e)}},u.createClipPathCallback=function(r,a){return function(l){l._removeTransformMatrix(),l.fillRule=l.clipRule,a.push(l)}},u.resolveClipPath=function(r,a){var l=this.extractPropertyDefinition(r,"clipPath","clipPaths"),i,s,e,o,h,n;if(l){o=[],e=t.util.invertTransform(r.calcTransformMatrix());for(var d=l[0].parentNode,g=a;g.parentNode&&g.getAttribute("clip-path")!==r.clipPath;)g=g.parentNode;g.parentNode.appendChild(d);for(var v=0;v<l.length;v++)i=l[v],s=this.findTag(i),s.fromElement(i,this.createClipPathCallback(r,o),this.options);o.length===1?l=o[0]:l=new t.Group(o),h=t.util.multiplyTransformMatrices(e,l.calcTransformMatrix()),l.clipPath&&this.resolveClipPath(l,g);var n=t.util.qrDecompose(h);l.flipX=!1,l.flipY=!1,l.set("scaleX",n.scaleX),l.set("scaleY",n.scaleY),l.angle=n.angle,l.skewX=n.skewX,l.skewY=0,l.setPositionByOrigin({x:n.translateX,y:n.translateY},"center","center"),r.clipPath=l}else delete r.clipPath},u.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(r){return r!=null}),this.callback(this.instances,this.elements))}}(t.ElementsParser.prototype),function(u){var r=u.fabric||(u.fabric={});if(r.Point){r.warn("fabric.Point is already defined");return}r.Point=a;function a(l,i){this.x=l,this.y=i}a.prototype={type:"point",constructor:a,add:function(l){return new a(this.x+l.x,this.y+l.y)},addEquals:function(l){return this.x+=l.x,this.y+=l.y,this},scalarAdd:function(l){return new a(this.x+l,this.y+l)},scalarAddEquals:function(l){return this.x+=l,this.y+=l,this},subtract:function(l){return new a(this.x-l.x,this.y-l.y)},subtractEquals:function(l){return this.x-=l.x,this.y-=l.y,this},scalarSubtract:function(l){return new a(this.x-l,this.y-l)},scalarSubtractEquals:function(l){return this.x-=l,this.y-=l,this},multiply:function(l){return new a(this.x*l,this.y*l)},multiplyEquals:function(l){return this.x*=l,this.y*=l,this},divide:function(l){return new a(this.x/l,this.y/l)},divideEquals:function(l){return this.x/=l,this.y/=l,this},eq:function(l){return this.x===l.x&&this.y===l.y},lt:function(l){return this.x<l.x&&this.y<l.y},lte:function(l){return this.x<=l.x&&this.y<=l.y},gt:function(l){return this.x>l.x&&this.y>l.y},gte:function(l){return this.x>=l.x&&this.y>=l.y},lerp:function(l,i){return typeof i=="undefined"&&(i=.5),i=Math.max(Math.min(1,i),0),new a(this.x+(l.x-this.x)*i,this.y+(l.y-this.y)*i)},distanceFrom:function(l){var i=this.x-l.x,s=this.y-l.y;return Math.sqrt(i*i+s*s)},midPointFrom:function(l){return this.lerp(l)},min:function(l){return new a(Math.min(this.x,l.x),Math.min(this.y,l.y))},max:function(l){return new a(Math.max(this.x,l.x),Math.max(this.y,l.y))},toString:function(){return this.x+","+this.y},setXY:function(l,i){return this.x=l,this.y=i,this},setX:function(l){return this.x=l,this},setY:function(l){return this.y=l,this},setFromPoint:function(l){return this.x=l.x,this.y=l.y,this},swap:function(l){var i=this.x,s=this.y;this.x=l.x,this.y=l.y,l.x=i,l.y=s},clone:function(){return new a(this.x,this.y)}}}(c),function(u){var r=u.fabric||(u.fabric={});if(r.Intersection){r.warn("fabric.Intersection is already defined");return}function a(l){this.status=l,this.points=[]}r.Intersection=a,r.Intersection.prototype={constructor:a,appendPoint:function(l){return this.points.push(l),this},appendPoints:function(l){return this.points=this.points.concat(l),this}},r.Intersection.intersectLineLine=function(l,i,s,e){var o,h=(e.x-s.x)*(l.y-s.y)-(e.y-s.y)*(l.x-s.x),n=(i.x-l.x)*(l.y-s.y)-(i.y-l.y)*(l.x-s.x),d=(e.y-s.y)*(i.x-l.x)-(e.x-s.x)*(i.y-l.y);if(d!==0){var g=h/d,v=n/d;0<=g&&g<=1&&0<=v&&v<=1?(o=new a("Intersection"),o.appendPoint(new r.Point(l.x+g*(i.x-l.x),l.y+g*(i.y-l.y)))):o=new a}else h===0||n===0?o=new a("Coincident"):o=new a("Parallel");return o},r.Intersection.intersectLinePolygon=function(l,i,s){var e=new a,o=s.length,h,n,d,g;for(g=0;g<o;g++)h=s[g],n=s[(g+1)%o],d=a.intersectLineLine(l,i,h,n),e.appendPoints(d.points);return e.points.length>0&&(e.status="Intersection"),e},r.Intersection.intersectPolygonPolygon=function(l,i){var s=new a,e=l.length,o;for(o=0;o<e;o++){var h=l[o],n=l[(o+1)%e],d=a.intersectLinePolygon(h,n,i);s.appendPoints(d.points)}return s.points.length>0&&(s.status="Intersection"),s},r.Intersection.intersectPolygonRectangle=function(l,i,s){var e=i.min(s),o=i.max(s),h=new r.Point(o.x,e.y),n=new r.Point(e.x,o.y),d=a.intersectLinePolygon(e,h,l),g=a.intersectLinePolygon(h,o,l),v=a.intersectLinePolygon(o,n,l),_=a.intersectLinePolygon(n,e,l),b=new a;return b.appendPoints(d.points),b.appendPoints(g.points),b.appendPoints(v.points),b.appendPoints(_.points),b.points.length>0&&(b.status="Intersection"),b}}(c),function(u){var r=u.fabric||(u.fabric={});if(r.Color){r.warn("fabric.Color is already defined.");return}function a(i){i?this._tryParsingColor(i):this.setSource([0,0,0,1])}r.Color=a,r.Color.prototype={_tryParsingColor:function(i){var s;i in a.colorNameMap&&(i=a.colorNameMap[i]),i==="transparent"&&(s=[255,255,255,0]),s||(s=a.sourceFromHex(i)),s||(s=a.sourceFromRgb(i)),s||(s=a.sourceFromHsl(i)),s||(s=[0,0,0,1]),s&&this.setSource(s)},_rgbToHsl:function(i,s,e){i/=255,s/=255,e/=255;var o,h,n,d=r.util.array.max([i,s,e]),g=r.util.array.min([i,s,e]);if(n=(d+g)/2,d===g)o=h=0;else{var v=d-g;switch(h=n>.5?v/(2-d-g):v/(d+g),d){case i:o=(s-e)/v+(s<e?6:0);break;case s:o=(e-i)/v+2;break;case e:o=(i-s)/v+4;break}o/=6}return[Math.round(o*360),Math.round(h*100),Math.round(n*100)]},getSource:function(){return this._source},setSource:function(i){this._source=i},toRgb:function(){var i=this.getSource();return"rgb("+i[0]+","+i[1]+","+i[2]+")"},toRgba:function(){var i=this.getSource();return"rgba("+i[0]+","+i[1]+","+i[2]+","+i[3]+")"},toHsl:function(){var i=this.getSource(),s=this._rgbToHsl(i[0],i[1],i[2]);return"hsl("+s[0]+","+s[1]+"%,"+s[2]+"%)"},toHsla:function(){var i=this.getSource(),s=this._rgbToHsl(i[0],i[1],i[2]);return"hsla("+s[0]+","+s[1]+"%,"+s[2]+"%,"+i[3]+")"},toHex:function(){var i=this.getSource(),s,e,o;return s=i[0].toString(16),s=s.length===1?"0"+s:s,e=i[1].toString(16),e=e.length===1?"0"+e:e,o=i[2].toString(16),o=o.length===1?"0"+o:o,s.toUpperCase()+e.toUpperCase()+o.toUpperCase()},toHexa:function(){var i=this.getSource(),s;return s=Math.round(i[3]*255),s=s.toString(16),s=s.length===1?"0"+s:s,this.toHex()+s.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(i){var s=this.getSource();return s[3]=i,this.setSource(s),this},toGrayscale:function(){var i=this.getSource(),s=parseInt((i[0]*.3+i[1]*.59+i[2]*.11).toFixed(0),10),e=i[3];return this.setSource([s,s,s,e]),this},toBlackWhite:function(i){var s=this.getSource(),e=(s[0]*.3+s[1]*.59+s[2]*.11).toFixed(0),o=s[3];return i=i||127,e=Number(e)<Number(i)?0:255,this.setSource([e,e,e,o]),this},overlayWith:function(i){i instanceof a||(i=new a(i));var s=[],e=this.getAlpha(),o=.5,h=this.getSource(),n=i.getSource(),d;for(d=0;d<3;d++)s.push(Math.round(h[d]*(1-o)+n[d]*o));return s[3]=e,this.setSource(s),this}},r.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,r.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,r.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,r.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function l(i,s,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?i+(s-i)*6*e:e<1/2?s:e<2/3?i+(s-i)*(2/3-e)*6:i}r.Color.fromRgb=function(i){return a.fromSource(a.sourceFromRgb(i))},r.Color.sourceFromRgb=function(i){var s=i.match(a.reRGBa);if(s){var e=parseInt(s[1],10)/(/%$/.test(s[1])?100:1)*(/%$/.test(s[1])?255:1),o=parseInt(s[2],10)/(/%$/.test(s[2])?100:1)*(/%$/.test(s[2])?255:1),h=parseInt(s[3],10)/(/%$/.test(s[3])?100:1)*(/%$/.test(s[3])?255:1);return[parseInt(e,10),parseInt(o,10),parseInt(h,10),s[4]?parseFloat(s[4]):1]}},r.Color.fromRgba=a.fromRgb,r.Color.fromHsl=function(i){return a.fromSource(a.sourceFromHsl(i))},r.Color.sourceFromHsl=function(i){var s=i.match(a.reHSLa);if(s){var e=(parseFloat(s[1])%360+360)%360/360,o=parseFloat(s[2])/(/%$/.test(s[2])?100:1),h=parseFloat(s[3])/(/%$/.test(s[3])?100:1),n,d,g;if(o===0)n=d=g=h;else{var v=h<=.5?h*(o+1):h+o-h*o,_=h*2-v;n=l(_,v,e+1/3),d=l(_,v,e),g=l(_,v,e-1/3)}return[Math.round(n*255),Math.round(d*255),Math.round(g*255),s[4]?parseFloat(s[4]):1]}},r.Color.fromHsla=a.fromHsl,r.Color.fromHex=function(i){return a.fromSource(a.sourceFromHex(i))},r.Color.sourceFromHex=function(i){if(i.match(a.reHex)){var s=i.slice(i.indexOf("#")+1),e=s.length===3||s.length===4,o=s.length===8||s.length===4,h=e?s.charAt(0)+s.charAt(0):s.substring(0,2),n=e?s.charAt(1)+s.charAt(1):s.substring(2,4),d=e?s.charAt(2)+s.charAt(2):s.substring(4,6),g=o?e?s.charAt(3)+s.charAt(3):s.substring(6,8):"FF";return[parseInt(h,16),parseInt(n,16),parseInt(d,16),parseFloat((parseInt(g,16)/255).toFixed(2))]}},r.Color.fromSource=function(i){var s=new a;return s.setSource(i),s}}(c),function(u){var r=u.fabric||(u.fabric={}),a=["e","se","s","sw","w","nw","n","ne","e"],l=["ns","nesw","ew","nwse"],i={},s="left",e="top",o="right",h="bottom",n="center",d={top:h,bottom:e,left:o,right:s,center:n},g=r.util.radiansToDegrees,v=Math.sign||function(Y){return(Y>0)-(Y<0)||+Y};function _(Y,H){var tt=Y.angle+g(Math.atan2(H.y,H.x))+360;return Math.round(tt%360/45)}function b(Y,H){var tt=H.transform.target,et=tt.canvas,G=r.util.object.clone(H);G.target=tt,et&&et.fire("object:"+Y,G),tt.fire(Y,H)}function C(Y,H){var tt=H.canvas,et=tt.uniScaleKey,G=Y[et];return tt.uniformScaling&&!G||!tt.uniformScaling&&G}function S(Y){return Y.originX===n&&Y.originY===n}function E(Y,H,tt){var et=Y.lockScalingX,G=Y.lockScalingY;return!!(et&&G||!H&&(et||G)&&tt||et&&H==="x"||G&&H==="y")}function z(Y,H,tt){var et="not-allowed",G=C(Y,tt),rt="";if(H.x!==0&&H.y===0?rt="x":H.x===0&&H.y!==0&&(rt="y"),E(tt,rt,G))return et;var ut=_(tt,H);return a[ut]+"-resize"}function V(Y,H,tt){var et="not-allowed";if(H.x!==0&&tt.lockSkewingY||H.y!==0&&tt.lockSkewingX)return et;var G=_(tt,H)%4;return l[G]+"-resize"}function W(Y,H,tt){return Y[tt.canvas.altActionKey]?i.skewCursorStyleHandler(Y,H,tt):i.scaleCursorStyleHandler(Y,H,tt)}function L(Y,H,tt){var et=Y[tt.canvas.altActionKey];if(H.x===0)return et?"skewX":"scaleY";if(H.y===0)return et?"skewY":"scaleX"}function A(Y,H,tt){return tt.lockRotation?"not-allowed":H.cursorStyle}function X(Y,H,tt,et){return{e:Y,transform:H,pointer:{x:tt,y:et}}}function B(Y){return function(H,tt,et,G){var rt=tt.target,ut=rt.getCenterPoint(),mt=rt.translateToOriginPoint(ut,tt.originX,tt.originY),gt=Y(H,tt,et,G);return rt.setPositionByOrigin(mt,tt.originX,tt.originY),gt}}function st(Y,H){return function(tt,et,G,rt){var ut=H(tt,et,G,rt);return ut&&b(Y,X(tt,et,G,rt)),ut}}function ht(Y,H,tt,et,G){var rt=Y.target,ut=rt.controls[Y.corner],mt=rt.canvas.getZoom(),gt=rt.padding/mt,Q=rt.toLocalPoint(new r.Point(et,G),H,tt);return Q.x>=gt&&(Q.x-=gt),Q.x<=-gt&&(Q.x+=gt),Q.y>=gt&&(Q.y-=gt),Q.y<=gt&&(Q.y+=gt),Q.x-=ut.offsetX,Q.y-=ut.offsetY,Q}function ft(Y){return Y.flipX!==Y.flipY}function O(Y,H,tt,et,G){if(Y[H]!==0){var rt=Y._getTransformedDimensions()[et],ut=G/rt*Y[tt];Y.set(tt,ut)}}function F(Y,H,tt,et){var G=H.target,rt=G._getTransformedDimensions(0,G.skewY),ut=ht(H,H.originX,H.originY,tt,et),mt=Math.abs(ut.x*2)-rt.x,gt=G.skewX,Q;mt<2?Q=0:(Q=g(Math.atan2(mt/G.scaleX,rt.y/G.scaleY)),H.originX===s&&H.originY===h&&(Q=-Q),H.originX===o&&H.originY===e&&(Q=-Q),ft(G)&&(Q=-Q));var pt=gt!==Q;if(pt){var _t=G._getTransformedDimensions().y;G.set("skewX",Q),O(G,"skewY","scaleY","y",_t)}return pt}function j(Y,H,tt,et){var G=H.target,rt=G._getTransformedDimensions(G.skewX,0),ut=ht(H,H.originX,H.originY,tt,et),mt=Math.abs(ut.y*2)-rt.y,gt=G.skewY,Q;mt<2?Q=0:(Q=g(Math.atan2(mt/G.scaleY,rt.x/G.scaleX)),H.originX===s&&H.originY===h&&(Q=-Q),H.originX===o&&H.originY===e&&(Q=-Q),ft(G)&&(Q=-Q));var pt=gt!==Q;if(pt){var _t=G._getTransformedDimensions().x;G.set("skewY",Q),O(G,"skewX","scaleX","x",_t)}return pt}function P(Y,H,tt,et){var G=H.target,rt=G.skewX,ut,mt=H.originY;if(G.lockSkewingX)return!1;if(rt===0){var gt=ht(H,n,n,tt,et);gt.x>0?ut=s:ut=o}else rt>0&&(ut=mt===e?s:o),rt<0&&(ut=mt===e?o:s),ft(G)&&(ut=ut===s?o:s);H.originX=ut;var Q=st("skewing",B(F));return Q(Y,H,tt,et)}function U(Y,H,tt,et){var G=H.target,rt=G.skewY,ut,mt=H.originX;if(G.lockSkewingY)return!1;if(rt===0){var gt=ht(H,n,n,tt,et);gt.y>0?ut=e:ut=h}else rt>0&&(ut=mt===s?e:h),rt<0&&(ut=mt===s?h:e),ft(G)&&(ut=ut===e?h:e);H.originY=ut;var Q=st("skewing",B(j));return Q(Y,H,tt,et)}function T(Y,H,tt,et){var G=H,rt=G.target,ut=rt.translateToOriginPoint(rt.getCenterPoint(),G.originX,G.originY);if(rt.lockRotation)return!1;var mt=Math.atan2(G.ey-ut.y,G.ex-ut.x),gt=Math.atan2(et-ut.y,tt-ut.x),Q=g(gt-mt+G.theta),pt=!0;if(rt.snapAngle>0){var _t=rt.snapAngle,xt=rt.snapThreshold||_t,jt=Math.ceil(Q/_t)*_t,St=Math.floor(Q/_t)*_t;Math.abs(Q-St)<xt?Q=St:Math.abs(Q-jt)<xt&&(Q=jt)}return Q<0&&(Q=360+Q),Q%=360,pt=rt.angle!==Q,rt.angle=Q,pt}function x(Y,H,tt,et,G){G=G||{};var rt=H.target,ut=rt.lockScalingX,mt=rt.lockScalingY,gt=G.by,Q,pt,_t,xt,jt=C(Y,rt),St=E(rt,gt,jt),Kt,zt,Ce=H.gestureScale;if(St)return!1;if(Ce)pt=H.scaleX*Ce,_t=H.scaleY*Ce;else{if(Q=ht(H,H.originX,H.originY,tt,et),Kt=gt!=="y"?v(Q.x):1,zt=gt!=="x"?v(Q.y):1,H.signX||(H.signX=Kt),H.signY||(H.signY=zt),rt.lockScalingFlip&&(H.signX!==Kt||H.signY!==zt))return!1;if(xt=rt._getTransformedDimensions(),jt&&!gt){var Be=Math.abs(Q.x)+Math.abs(Q.y),ee=H.original,mo=Math.abs(xt.x*ee.scaleX/rt.scaleX)+Math.abs(xt.y*ee.scaleY/rt.scaleY),Fn=Be/mo;pt=ee.scaleX*Fn,_t=ee.scaleY*Fn}else pt=Math.abs(Q.x*rt.scaleX/xt.x),_t=Math.abs(Q.y*rt.scaleY/xt.y);S(H)&&(pt*=2,_t*=2),H.signX!==Kt&&gt!=="y"&&(H.originX=d[H.originX],pt*=-1,H.signX=Kt),H.signY!==zt&&gt!=="x"&&(H.originY=d[H.originY],_t*=-1,H.signY=zt)}var _o=rt.scaleX,yo=rt.scaleY;return gt?(gt==="x"&&rt.set("scaleX",pt),gt==="y"&&rt.set("scaleY",_t)):(!ut&&rt.set("scaleX",pt),!mt&&rt.set("scaleY",_t)),_o!==rt.scaleX||yo!==rt.scaleY}function k(Y,H,tt,et){return x(Y,H,tt,et)}function R(Y,H,tt,et){return x(Y,H,tt,et,{by:"x"})}function q(Y,H,tt,et){return x(Y,H,tt,et,{by:"y"})}function N(Y,H,tt,et){return Y[H.target.canvas.altActionKey]?i.skewHandlerX(Y,H,tt,et):i.scalingY(Y,H,tt,et)}function nt(Y,H,tt,et){return Y[H.target.canvas.altActionKey]?i.skewHandlerY(Y,H,tt,et):i.scalingX(Y,H,tt,et)}function ot(Y,H,tt,et){var G=H.target,rt=ht(H,H.originX,H.originY,tt,et),ut=G.strokeWidth/(G.strokeUniform?G.scaleX:1),mt=S(H)?2:1,gt=G.width,Q=Math.abs(rt.x*mt/G.scaleX)-ut;return G.set("width",Math.max(Q,0)),gt!==Q}function lt(Y,H,tt,et){var G=H.target,rt=tt-H.offsetX,ut=et-H.offsetY,mt=!G.get("lockMovementX")&&G.left!==rt,gt=!G.get("lockMovementY")&&G.top!==ut;return mt&&G.set("left",rt),gt&&G.set("top",ut),(mt||gt)&&b("moving",X(Y,H,tt,et)),mt||gt}i.scaleCursorStyleHandler=z,i.skewCursorStyleHandler=V,i.scaleSkewCursorStyleHandler=W,i.rotationWithSnapping=st("rotating",B(T)),i.scalingEqually=st("scaling",B(k)),i.scalingX=st("scaling",B(R)),i.scalingY=st("scaling",B(q)),i.scalingYOrSkewingX=N,i.scalingXOrSkewingY=nt,i.changeWidth=st("resizing",B(ot)),i.skewHandlerX=P,i.skewHandlerY=U,i.dragHandler=lt,i.scaleOrSkewActionName=L,i.rotationStyleHandler=A,i.fireEvent=b,i.wrapWithFixedAnchor=B,i.wrapWithFireEvent=st,i.getLocalPoint=ht,r.controlsUtils=i}(c),function(u){var r=u.fabric||(u.fabric={}),a=r.util.degreesToRadians,l=r.controlsUtils;function i(e,o,h,n,d){n=n||{};var g=this.sizeX||n.cornerSize||d.cornerSize,v=this.sizeY||n.cornerSize||d.cornerSize,_=typeof n.transparentCorners!="undefined"?n.transparentCorners:d.transparentCorners,b=_?"stroke":"fill",C=!_&&(n.cornerStrokeColor||d.cornerStrokeColor),S=o,E=h,z;e.save(),e.fillStyle=n.cornerColor||d.cornerColor,e.strokeStyle=n.cornerStrokeColor||d.cornerStrokeColor,g>v?(z=g,e.scale(1,v/g),E=h*g/v):v>g?(z=v,e.scale(g/v,1),S=o*v/g):z=g,e.lineWidth=1,e.beginPath(),e.arc(S,E,z/2,0,2*Math.PI,!1),e[b](),C&&e.stroke(),e.restore()}function s(e,o,h,n,d){n=n||{};var g=this.sizeX||n.cornerSize||d.cornerSize,v=this.sizeY||n.cornerSize||d.cornerSize,_=typeof n.transparentCorners!="undefined"?n.transparentCorners:d.transparentCorners,b=_?"stroke":"fill",C=!_&&(n.cornerStrokeColor||d.cornerStrokeColor),S=g/2,E=v/2;e.save(),e.fillStyle=n.cornerColor||d.cornerColor,e.strokeStyle=n.cornerStrokeColor||d.cornerStrokeColor,e.lineWidth=1,e.translate(o,h),e.rotate(a(d.angle)),e[b+"Rect"](-S,-E,g,v),C&&e.strokeRect(-S,-E,g,v),e.restore()}l.renderCircleControl=i,l.renderSquareControl=s}(c),function(u){var r=u.fabric||(u.fabric={});function a(l){for(var i in l)this[i]=l[i]}r.Control=a,r.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(l,i){return i.cursorStyle},getActionName:function(l,i){return i.actionName},getVisibility:function(l,i){var s=l._controlsVisibility;return s&&typeof s[i]!="undefined"?s[i]:this.visible},setVisibility:function(l){this.visible=l},positionHandler:function(l,i){var s=r.util.transformPoint({x:this.x*l.x+this.offsetX,y:this.y*l.y+this.offsetY},i);return s},calcCornerCoords:function(l,i,s,e,o){var h,n,d,g,v=o?this.touchSizeX:this.sizeX,_=o?this.touchSizeY:this.sizeY;if(v&&_&&v!==_){var b=Math.atan2(_,v),C=Math.sqrt(v*v+_*_)/2,S=b-r.util.degreesToRadians(l),E=Math.PI/2-b-r.util.degreesToRadians(l);h=C*r.util.cos(S),n=C*r.util.sin(S),d=C*r.util.cos(E),g=C*r.util.sin(E)}else{var z=v&&_?v:i;C=z*.7071067812;var S=r.util.degreesToRadians(45-l);h=d=C*r.util.cos(S),n=g=C*r.util.sin(S)}return{tl:{x:s-g,y:e-d},tr:{x:s+h,y:e-n},bl:{x:s-h,y:e+n},br:{x:s+g,y:e+d}}},render:function(l,i,s,e,o){switch(e=e||{},e.cornerStyle||o.cornerStyle){case"circle":r.controlsUtils.renderCircleControl.call(this,l,i,s,e,o);break;default:r.controlsUtils.renderSquareControl.call(this,l,i,s,e,o)}}}}(c),function(){function u(s,e){var o=s.getAttribute("style"),h=s.getAttribute("offset")||0,n,d,g,v;if(h=parseFloat(h)/(/%$/.test(h)?100:1),h=h<0?0:h>1?1:h,o){var _=o.split(/\s*;\s*/);for(_[_.length-1]===""&&_.pop(),v=_.length;v--;){var b=_[v].split(/\s*:\s*/),C=b[0].trim(),S=b[1].trim();C==="stop-color"?n=S:C==="stop-opacity"&&(g=S)}}return n||(n=s.getAttribute("stop-color")||"rgb(0,0,0)"),g||(g=s.getAttribute("stop-opacity")),n=new t.Color(n),d=n.getAlpha(),g=isNaN(parseFloat(g))?1:parseFloat(g),g*=d*e,{offset:h,color:n.toRgb(),opacity:g}}function r(s){return{x1:s.getAttribute("x1")||0,y1:s.getAttribute("y1")||0,x2:s.getAttribute("x2")||"100%",y2:s.getAttribute("y2")||0}}function a(s){return{x1:s.getAttribute("fx")||s.getAttribute("cx")||"50%",y1:s.getAttribute("fy")||s.getAttribute("cy")||"50%",r1:0,x2:s.getAttribute("cx")||"50%",y2:s.getAttribute("cy")||"50%",r2:s.getAttribute("r")||"50%"}}var l=t.util.object.clone;t.Gradient=t.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(s){s||(s={}),s.coords||(s.coords={});var e,o=this;Object.keys(s).forEach(function(h){o[h]=s[h]}),this.id?this.id+="_"+t.Object.__uid++:this.id=t.Object.__uid++,e={x1:s.coords.x1||0,y1:s.coords.y1||0,x2:s.coords.x2||0,y2:s.coords.y2||0},this.type==="radial"&&(e.r1=s.coords.r1||0,e.r2=s.coords.r2||0),this.coords=e,this.colorStops=s.colorStops.slice()},addColorStop:function(s){for(var e in s){var o=new t.Color(s[e]);this.colorStops.push({offset:parseFloat(e),color:o.toRgb(),opacity:o.getAlpha()})}return this},toObject:function(s){var e={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return t.util.populateWithProperties(this,e,s),e},toSVG:function(s,d){var o=l(this.coords,!0),h,n,d=d||{},g,v,_=l(this.colorStops,!0),b=o.r1>o.r2,C=this.gradientTransform?this.gradientTransform.concat():t.iMatrix.concat(),S=-this.offsetX,E=-this.offsetY,z=!!d.additionalTransform,V=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(_.sort(function(B,st){return B.offset-st.offset}),V==="objectBoundingBox"?(S/=s.width,E/=s.height):(S+=s.width/2,E+=s.height/2),s.type==="path"&&this.gradientUnits!=="percentage"&&(S-=s.pathOffset.x,E-=s.pathOffset.y),C[4]-=S,C[5]-=E,v='id="SVGID_'+this.id+'" gradientUnits="'+V+'"',v+=' gradientTransform="'+(z?d.additionalTransform+" ":"")+t.util.matrixToSVG(C)+'" ',this.type==="linear"?g=["<linearGradient ",v,' x1="',o.x1,'" y1="',o.y1,'" x2="',o.x2,'" y2="',o.y2,`">
`]:this.type==="radial"&&(g=["<radialGradient ",v,' cx="',b?o.x1:o.x2,'" cy="',b?o.y1:o.y2,'" r="',b?o.r1:o.r2,'" fx="',b?o.x2:o.x1,'" fy="',b?o.y2:o.y1,`">
`]),this.type==="radial"){if(b)for(_=_.concat(),_.reverse(),h=0,n=_.length;h<n;h++)_[h].offset=1-_[h].offset;var W=Math.min(o.r1,o.r2);if(W>0){var L=Math.max(o.r1,o.r2),A=W/L;for(h=0,n=_.length;h<n;h++)_[h].offset+=A*(1-_[h].offset)}}for(h=0,n=_.length;h<n;h++){var X=_[h];g.push("<stop ",'offset="',X.offset*100+"%",'" style="stop-color:',X.color,typeof X.opacity!="undefined"?";stop-opacity: "+X.opacity:";",`"/>
`)}return g.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),g.join("")},toLive:function(s){var e,o=t.util.object.clone(this.coords),h,n;if(this.type){for(this.type==="linear"?e=s.createLinearGradient(o.x1,o.y1,o.x2,o.y2):this.type==="radial"&&(e=s.createRadialGradient(o.x1,o.y1,o.r1,o.x2,o.y2,o.r2)),h=0,n=this.colorStops.length;h<n;h++){var d=this.colorStops[h].color,g=this.colorStops[h].opacity,v=this.colorStops[h].offset;typeof g!="undefined"&&(d=new t.Color(d).setAlpha(g).toRgba()),e.addColorStop(v,d)}return e}}}),t.util.object.extend(t.Gradient,{fromElement:function(s,e,o,h){var n=parseFloat(o)/(/%$/.test(o)?100:1);n=n<0?0:n>1?1:n,isNaN(n)&&(n=1);var d=s.getElementsByTagName("stop"),g,v=s.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",_=s.getAttribute("gradientTransform")||"",b=[],C,S,E=0,z=0,V;for(s.nodeName==="linearGradient"||s.nodeName==="LINEARGRADIENT"?(g="linear",C=r(s)):(g="radial",C=a(s)),S=d.length;S--;)b.push(u(d[S],n));V=t.parseTransformAttribute(_),i(e,C,h,v),v==="pixels"&&(E=-e.left,z=-e.top);var W=new t.Gradient({id:s.getAttribute("id"),type:g,coords:C,colorStops:b,gradientUnits:v,gradientTransform:V,offsetX:E,offsetY:z});return W}});function i(s,e,o,h){var n,d;Object.keys(e).forEach(function(g){n=e[g],n==="Infinity"?d=1:n==="-Infinity"?d=0:(d=parseFloat(e[g],10),typeof n=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(n)&&(d*=.01,h==="pixels"&&((g==="x1"||g==="x2"||g==="r2")&&(d*=o.viewBoxWidth||o.width),(g==="y1"||g==="y2")&&(d*=o.viewBoxHeight||o.height)))),e[g]=d})}}(),function(){var u=t.util.toFixed;t.Pattern=t.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(r,a){if(r||(r={}),this.id=t.Object.__uid++,this.setOptions(r),!r.source||r.source&&typeof r.source!="string"){a&&a(this);return}else{var l=this;this.source=t.util.createImage(),t.util.loadImage(r.source,function(i,s){l.source=i,a&&a(l,s)},null,this.crossOrigin)}},toObject:function(r){var a=t.Object.NUM_FRACTION_DIGITS,l,i;return typeof this.source.src=="string"?l=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(l=this.source.toDataURL()),i={type:"pattern",source:l,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:u(this.offsetX,a),offsetY:u(this.offsetY,a),patternTransform:this.patternTransform?this.patternTransform.concat():null},t.util.populateWithProperties(this,i,r),i},toSVG:function(r){var a=typeof this.source=="function"?this.source():this.source,l=a.width/r.width,i=a.height/r.height,s=this.offsetX/r.width,e=this.offsetY/r.height,o="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(i=1,e&&(i+=Math.abs(e))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(l=1,s&&(l+=Math.abs(s))),a.src?o=a.src:a.toDataURL&&(o=a.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+s+'" y="'+e+'" width="'+l+'" height="'+i+`">
<image x="0" y="0" width="`+a.width+'" height="'+a.height+'" xlink:href="'+o+`"></image>
</pattern>
`},setOptions:function(r){for(var a in r)this[a]=r[a]},toLive:function(r){var a=this.source;return!a||typeof a.src!="undefined"&&(!a.complete||a.naturalWidth===0||a.naturalHeight===0)?"":r.createPattern(a,this.repeat)}})}(),function(u){var r=u.fabric||(u.fabric={}),a=r.util.toFixed;if(r.Shadow){r.warn("fabric.Shadow is already defined.");return}r.Shadow=r.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(l){typeof l=="string"&&(l=this._parseShadow(l));for(var i in l)this[i]=l[i];this.id=r.Object.__uid++},_parseShadow:function(l){var i=l.trim(),s=r.Shadow.reOffsetsAndBlur.exec(i)||[],e=i.replace(r.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:e.trim(),offsetX:parseFloat(s[1],10)||0,offsetY:parseFloat(s[2],10)||0,blur:parseFloat(s[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(l){var i=40,s=40,e=r.Object.NUM_FRACTION_DIGITS,o=r.util.rotateVector({x:this.offsetX,y:this.offsetY},r.util.degreesToRadians(-l.angle)),h=20,n=new r.Color(this.color);return l.width&&l.height&&(i=a((Math.abs(o.x)+this.blur)/l.width,e)*100+h,s=a((Math.abs(o.y)+this.blur)/l.height,e)*100+h),l.flipX&&(o.x*=-1),l.flipY&&(o.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+s+'%" height="'+(100+2*s)+'%" x="-'+i+'%" width="'+(100+2*i)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+a(this.blur?this.blur/2:0,e)+`"></feGaussianBlur>
	<feOffset dx="`+a(o.x,e)+'" dy="'+a(o.y,e)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+n.toRgb()+'" flood-opacity="'+n.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var l={},i=r.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(s){this[s]!==i[s]&&(l[s]=this[s])},this),l}}),r.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/}(c),function(){if(t.StaticCanvas){t.warn("fabric.StaticCanvas is already defined.");return}var u=t.util.object.extend,r=t.util.getElementOffset,a=t.util.removeFromArray,l=t.util.toFixed,i=t.util.transformPoint,s=t.util.invertTransform,e=t.util.getNodeCanvas,o=t.util.createCanvasElement,h=new Error("Could not initialize `canvas` element");t.StaticCanvas=t.util.createClass(t.CommonMethods,{initialize:function(n,d){d||(d={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(n,d)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:t.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(n,d){var g=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(n),this._initOptions(d),this.interactive||this._initRetinaScaling(),d.overlayImage&&this.setOverlayImage(d.overlayImage,g),d.backgroundImage&&this.setBackgroundImage(d.backgroundImage,g),d.backgroundColor&&this.setBackgroundColor(d.backgroundColor,g),d.overlayColor&&this.setOverlayColor(d.overlayColor,g),this.calcOffset()},_isRetinaScaling:function(){return t.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,t.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var n=t.devicePixelRatio;this.__initRetinaScaling(n,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(n,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(n,d,g){d.setAttribute("width",this.width*n),d.setAttribute("height",this.height*n),g.scale(n,n)},calcOffset:function(){return this._offset=r(this.lowerCanvasEl),this},setOverlayImage:function(n,d,g){return this.__setBgOverlayImage("overlayImage",n,d,g)},setBackgroundImage:function(n,d,g){return this.__setBgOverlayImage("backgroundImage",n,d,g)},setOverlayColor:function(n,d){return this.__setBgOverlayColor("overlayColor",n,d)},setBackgroundColor:function(n,d){return this.__setBgOverlayColor("backgroundColor",n,d)},__setBgOverlayImage:function(n,d,g,v){return typeof d=="string"?t.util.loadImage(d,function(_,b){if(_){var C=new t.Image(_,v);this[n]=C,C.canvas=this}g&&g(_,b)},this,v&&v.crossOrigin):(v&&d.setOptions(v),this[n]=d,d&&(d.canvas=this),g&&g(d,!1)),this},__setBgOverlayColor:function(n,d,g){return this[n]=d,this._initGradient(d,n),this._initPattern(d,n,g),this},_createCanvasElement:function(){var n=o();if(!n||(n.style||(n.style={}),typeof n.getContext=="undefined"))throw h;return n},_initOptions:function(n){var d=this.lowerCanvasEl;this._setOptions(n),this.width=this.width||parseInt(d.width,10)||0,this.height=this.height||parseInt(d.height,10)||0,this.lowerCanvasEl.style&&(d.width=this.width,d.height=this.height,d.style.width=this.width+"px",d.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(n){n&&n.getContext?this.lowerCanvasEl=n:this.lowerCanvasEl=t.util.getById(n)||this._createCanvasElement(),t.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(n,d){return this.setDimensions({width:n},d)},setHeight:function(n,d){return this.setDimensions({height:n},d)},setDimensions:function(n,d){var g;d=d||{};for(var v in n)g=n[v],d.cssOnly||(this._setBackstoreDimension(v,n[v]),g+="px",this.hasLostContext=!0),d.backstoreOnly||this._setCssDimension(v,g);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),d.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(n,d){return this.lowerCanvasEl[n]=d,this.upperCanvasEl&&(this.upperCanvasEl[n]=d),this.cacheCanvasEl&&(this.cacheCanvasEl[n]=d),this[n]=d,this},_setCssDimension:function(n,d){return this.lowerCanvasEl.style[n]=d,this.upperCanvasEl&&(this.upperCanvasEl.style[n]=d),this.wrapperEl&&(this.wrapperEl.style[n]=d),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(n){var d=this._activeObject,g=this.backgroundImage,v=this.overlayImage,_,b,C;for(this.viewportTransform=n,b=0,C=this._objects.length;b<C;b++)_=this._objects[b],_.group||_.setCoords(!0);return d&&d.setCoords(),g&&g.setCoords(!0),v&&v.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(n,d){var g=n,v=this.viewportTransform.slice(0);n=i(n,s(this.viewportTransform)),v[0]=d,v[3]=d;var _=i(n,v);return v[4]+=g.x-_.x,v[5]+=g.y-_.y,this.setViewportTransform(v)},setZoom:function(n){return this.zoomToPoint(new t.Point(0,0),n),this},absolutePan:function(n){var d=this.viewportTransform.slice(0);return d[4]=-n.x,d[5]=-n.y,this.setViewportTransform(d)},relativePan:function(n){return this.absolutePan(new t.Point(-n.x-this.viewportTransform[4],-n.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(n){this.stateful&&n.setupState(),n._set("canvas",this),n.setCoords(),this.fire("object:added",{target:n}),n.fire("added")},_onObjectRemoved:function(n){this.fire("object:removed",{target:n}),n.fire("removed"),delete n.canvas},clearContext:function(n){return n.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var n=this.contextContainer;return this.renderCanvas(n,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=t.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var n={},d=this.width,g=this.height,v=s(this.viewportTransform);return n.tl=i({x:0,y:0},v),n.br=i({x:d,y:g},v),n.tr=new t.Point(n.br.x,n.tl.y),n.bl=new t.Point(n.tl.x,n.br.y),this.vptCoords=n,n},cancelRequestedRender:function(){this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(n,d){var g=this.viewportTransform,v=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(n),t.util.setImageSmoothing(n,this.imageSmoothingEnabled),this.fire("before:render",{ctx:n}),this._renderBackground(n),n.save(),n.transform(g[0],g[1],g[2],g[3],g[4],g[5]),this._renderObjects(n,d),n.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(n),v&&(v.canvas=this,v.shouldCache(),v._transformDone=!0,v.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(n)),this._renderOverlay(n),this.controlsAboveOverlay&&this.interactive&&this.drawControls(n),this.fire("after:render",{ctx:n})},drawClipPathOnCanvas:function(n){var d=this.viewportTransform,g=this.clipPath;n.save(),n.transform(d[0],d[1],d[2],d[3],d[4],d[5]),n.globalCompositeOperation="destination-in",g.transform(n),n.scale(1/g.zoomX,1/g.zoomY),n.drawImage(g._cacheCanvas,-g.cacheTranslationX,-g.cacheTranslationY),n.restore()},_renderObjects:function(n,d){var g,v;for(g=0,v=d.length;g<v;++g)d[g]&&d[g].render(n)},_renderBackgroundOrOverlay:function(n,d){var g=this[d+"Color"],v=this[d+"Image"],_=this.viewportTransform,b=this[d+"Vpt"];if(!(!g&&!v)){if(g){n.save(),n.beginPath(),n.moveTo(0,0),n.lineTo(this.width,0),n.lineTo(this.width,this.height),n.lineTo(0,this.height),n.closePath(),n.fillStyle=g.toLive?g.toLive(n,this):g,b&&n.transform(_[0],_[1],_[2],_[3],_[4],_[5]),n.transform(1,0,0,1,g.offsetX||0,g.offsetY||0);var C=g.gradientTransform||g.patternTransform;C&&n.transform(C[0],C[1],C[2],C[3],C[4],C[5]),n.fill(),n.restore()}v&&(n.save(),b&&n.transform(_[0],_[1],_[2],_[3],_[4],_[5]),v.render(n),n.restore())}},_renderBackground:function(n){this._renderBackgroundOrOverlay(n,"background")},_renderOverlay:function(n){this._renderBackgroundOrOverlay(n,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new t.Point(this.width/2,this.height/2)},centerObjectH:function(n){return this._centerObject(n,new t.Point(this.getCenterPoint().x,n.getCenterPoint().y))},centerObjectV:function(n){return this._centerObject(n,new t.Point(n.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(n){var d=this.getCenterPoint();return this._centerObject(n,d)},viewportCenterObject:function(n){var d=this.getVpCenter();return this._centerObject(n,d)},viewportCenterObjectH:function(n){var d=this.getVpCenter();return this._centerObject(n,new t.Point(d.x,n.getCenterPoint().y)),this},viewportCenterObjectV:function(n){var d=this.getVpCenter();return this._centerObject(n,new t.Point(n.getCenterPoint().x,d.y))},getVpCenter:function(){var n=this.getCenterPoint(),d=s(this.viewportTransform);return i(n,d)},_centerObject:function(n,d){return n.setPositionByOrigin(d,"center","center"),n.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(n){return this.toDatalessObject(n)},toObject:function(n){return this._toObjectMethod("toObject",n)},toDatalessObject:function(n){return this._toObjectMethod("toDatalessObject",n)},_toObjectMethod:function(n,d){var g=this.clipPath,v={version:t.version,objects:this._toObjects(n,d)};return g&&!g.excludeFromExport&&(v.clipPath=this._toObject(this.clipPath,n,d)),u(v,this.__serializeBgOverlay(n,d)),t.util.populateWithProperties(this,v,d),v},_toObjects:function(n,d){return this._objects.filter(function(g){return!g.excludeFromExport}).map(function(g){return this._toObject(g,n,d)},this)},_toObject:function(n,d,g){var v;this.includeDefaultValues||(v=n.includeDefaultValues,n.includeDefaultValues=!1);var _=n[d](g);return this.includeDefaultValues||(n.includeDefaultValues=v),_},__serializeBgOverlay:function(n,d){var g={},v=this.backgroundImage,_=this.overlayImage,b=this.backgroundColor,C=this.overlayColor;return b&&b.toObject?b.excludeFromExport||(g.background=b.toObject(d)):b&&(g.background=b),C&&C.toObject?C.excludeFromExport||(g.overlay=C.toObject(d)):C&&(g.overlay=C),v&&!v.excludeFromExport&&(g.backgroundImage=this._toObject(v,n,d)),_&&!_.excludeFromExport&&(g.overlayImage=this._toObject(_,n,d)),g},svgViewportTransformation:!0,toSVG:function(n,d){n||(n={}),n.reviver=d;var g=[];return this._setSVGPreamble(g,n),this._setSVGHeader(g,n),this.clipPath&&g.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(g,"background"),this._setSVGBgOverlayImage(g,"backgroundImage",d),this._setSVGObjects(g,d),this.clipPath&&g.push(`</g>
`),this._setSVGBgOverlayColor(g,"overlay"),this._setSVGBgOverlayImage(g,"overlayImage",d),g.push("</svg>"),g.join("")},_setSVGPreamble:function(n,d){d.suppressPreamble||n.push('<?xml version="1.0" encoding="',d.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(n,d){var g=d.width||this.width,v=d.height||this.height,_,b='viewBox="0 0 '+this.width+" "+this.height+'" ',C=t.Object.NUM_FRACTION_DIGITS;d.viewBox?b='viewBox="'+d.viewBox.x+" "+d.viewBox.y+" "+d.viewBox.width+" "+d.viewBox.height+'" ':this.svgViewportTransformation&&(_=this.viewportTransform,b='viewBox="'+l(-_[4]/_[0],C)+" "+l(-_[5]/_[3],C)+" "+l(this.width/_[0],C)+" "+l(this.height/_[3],C)+'" '),n.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',g,'" ','height="',v,'" ',b,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",t.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(d),`</defs>
`)},createSVGClipPathMarkup:function(n){var d=this.clipPath;return d?(d.clipPathId="CLIPPATH_"+t.Object.__uid++,'<clipPath id="'+d.clipPathId+`" >
`+this.clipPath.toClipPathSVG(n.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var n=this,d=["background","overlay"].map(function(g){var v=n[g+"Color"];if(v&&v.toLive){var _=n[g+"Vpt"],b=n.viewportTransform,C={width:n.width/(_?b[0]:1),height:n.height/(_?b[3]:1)};return v.toSVG(C,{additionalTransform:_?t.util.matrixToSVG(b):""})}});return d.join("")},createSVGFontFacesMarkup:function(){var n="",d={},g,v,_,b,C,S,E,z,V,W=t.fontPaths,L=[];for(this._objects.forEach(function X(B){L.push(B),B._objects&&B._objects.forEach(X)}),z=0,V=L.length;z<V;z++)if(g=L[z],v=g.fontFamily,!(g.type.indexOf("text")===-1||d[v]||!W[v])&&(d[v]=!0,!!g.styles)){_=g.styles;for(C in _){b=_[C];for(E in b)S=b[E],v=S.fontFamily,!d[v]&&W[v]&&(d[v]=!0)}}for(var A in d)n+=[`		@font-face {
`,"			font-family: '",A,`';
`,"			src: url('",W[A],`');
`,`		}
`].join("");return n&&(n=['	<style type="text/css">',`<![CDATA[
`,n,"]]>",`</style>
`].join("")),n},_setSVGObjects:function(n,d){var g,v,_,b=this._objects;for(v=0,_=b.length;v<_;v++)g=b[v],!g.excludeFromExport&&this._setSVGObject(n,g,d)},_setSVGObject:function(n,d,g){n.push(d.toSVG(g))},_setSVGBgOverlayImage:function(n,d,g){this[d]&&!this[d].excludeFromExport&&this[d].toSVG&&n.push(this[d].toSVG(g))},_setSVGBgOverlayColor:function(n,d){var g=this[d+"Color"],v=this.viewportTransform,_=this.width,b=this.height;if(g)if(g.toLive){var C=g.repeat,S=t.util.invertTransform(v),E=this[d+"Vpt"],z=E?t.util.matrixToSVG(S):"";n.push('<rect transform="'+z+" translate(",_/2,",",b/2,')"',' x="',g.offsetX-_/2,'" y="',g.offsetY-b/2,'" ','width="',C==="repeat-y"||C==="no-repeat"?g.source.width:_,'" height="',C==="repeat-x"||C==="no-repeat"?g.source.height:b,'" fill="url(#SVGID_'+g.id+')"',`></rect>
`)}else n.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',g,'"',`></rect>
`)},sendToBack:function(n){if(!n)return this;var d=this._activeObject,g,v,_;if(n===d&&n.type==="activeSelection")for(_=d._objects,g=_.length;g--;)v=_[g],a(this._objects,v),this._objects.unshift(v);else a(this._objects,n),this._objects.unshift(n);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(n){if(!n)return this;var d=this._activeObject,g,v,_;if(n===d&&n.type==="activeSelection")for(_=d._objects,g=0;g<_.length;g++)v=_[g],a(this._objects,v),this._objects.push(v);else a(this._objects,n),this._objects.push(n);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(n,d){if(!n)return this;var g=this._activeObject,v,_,b,C,S,E=0;if(n===g&&n.type==="activeSelection")for(S=g._objects,v=0;v<S.length;v++)_=S[v],b=this._objects.indexOf(_),b>0+E&&(C=b-1,a(this._objects,_),this._objects.splice(C,0,_)),E++;else b=this._objects.indexOf(n),b!==0&&(C=this._findNewLowerIndex(n,b,d),a(this._objects,n),this._objects.splice(C,0,n));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(n,d,g){var v,_;if(g)for(v=d,_=d-1;_>=0;--_){var b=n.intersectsWithObject(this._objects[_])||n.isContainedWithinObject(this._objects[_])||this._objects[_].isContainedWithinObject(n);if(b){v=_;break}}else v=d-1;return v},bringForward:function(n,d){if(!n)return this;var g=this._activeObject,v,_,b,C,S,E=0;if(n===g&&n.type==="activeSelection")for(S=g._objects,v=S.length;v--;)_=S[v],b=this._objects.indexOf(_),b<this._objects.length-1-E&&(C=b+1,a(this._objects,_),this._objects.splice(C,0,_)),E++;else b=this._objects.indexOf(n),b!==this._objects.length-1&&(C=this._findNewUpperIndex(n,b,d),a(this._objects,n),this._objects.splice(C,0,n));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(n,d,g){var v,_,b;if(g)for(v=d,_=d+1,b=this._objects.length;_<b;++_){var C=n.intersectsWithObject(this._objects[_])||n.isContainedWithinObject(this._objects[_])||this._objects[_].isContainedWithinObject(n);if(C){v=_;break}}else v=d+1;return v},moveTo:function(n,d){return a(this._objects,n),this._objects.splice(d,0,n),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(n){n.dispose&&n.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),t.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),t.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),u(t.StaticCanvas.prototype,t.Observable),u(t.StaticCanvas.prototype,t.Collection),u(t.StaticCanvas.prototype,t.DataURLExporter),u(t.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(n){var d=o();if(!d||!d.getContext)return null;var g=d.getContext("2d");if(!g)return null;switch(n){case"setLineDash":return typeof g.setLineDash!="undefined";default:return null}}}),t.StaticCanvas.prototype.toJSON=t.StaticCanvas.prototype.toObject,t.isLikelyNode&&(t.StaticCanvas.prototype.createPNGStream=function(){var n=e(this.lowerCanvasEl);return n&&n.createPNGStream()},t.StaticCanvas.prototype.createJPEGStream=function(n){var d=e(this.lowerCanvasEl);return d&&d.createJPEGStream(n)})}(),t.BaseBrush=t.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(u){u.strokeStyle=this.color,u.lineWidth=this.width,u.lineCap=this.strokeLineCap,u.miterLimit=this.strokeMiterLimit,u.lineJoin=this.strokeLineJoin,u.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(u){var r=this.canvas.viewportTransform;u.save(),u.transform(r[0],r[1],r[2],r[3],r[4],r[5])},_setShadow:function(){if(this.shadow){var u=this.canvas,r=this.shadow,a=u.contextTop,l=u.getZoom();u&&u._isRetinaScaling()&&(l*=t.devicePixelRatio),a.shadowColor=r.color,a.shadowBlur=r.blur*l,a.shadowOffsetX=r.offsetX*l,a.shadowOffsetY=r.offsetY*l}},needsFullRender:function(){var u=new t.Color(this.color);return u.getAlpha()<1||!!this.shadow},_resetShadow:function(){var u=this.canvas.contextTop;u.shadowColor="",u.shadowBlur=u.shadowOffsetX=u.shadowOffsetY=0},_isOutSideCanvas:function(u){return u.x<0||u.x>this.canvas.getWidth()||u.y<0||u.y>this.canvas.getHeight()}}),function(){t.PencilBrush=t.util.createClass(t.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(u){this.canvas=u,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(u,r,a){var l=r.midPointFrom(a);return u.quadraticCurveTo(r.x,r.y,l.x,l.y),l},onMouseDown:function(u,r){this.canvas._isMainEvent(r.e)&&(this.drawStraightLine=r.e[this.straightLineKey],this._prepareForDrawing(u),this._captureDrawingPath(u),this._render())},onMouseMove:function(u,r){if(this.canvas._isMainEvent(r.e)&&(this.drawStraightLine=r.e[this.straightLineKey],!(this.limitedToCanvasSize===!0&&this._isOutSideCanvas(u))&&this._captureDrawingPath(u)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var a=this._points,l=a.length,i=this.canvas.contextTop;this._saveAndTransform(i),this.oldEnd&&(i.beginPath(),i.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(i,a[l-2],a[l-1],!0),i.stroke(),i.restore()}},onMouseUp:function(u){return this.canvas._isMainEvent(u.e)?(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(u){var r=new t.Point(u.x,u.y);this._reset(),this._addPoint(r),this.canvas.contextTop.moveTo(r.x,r.y)},_addPoint:function(u){return this._points.length>1&&u.eq(this._points[this._points.length-1])?!1:(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(u),!0)},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(u){var r=new t.Point(u.x,u.y);return this._addPoint(r)},_render:function(u){var r,a,l=this._points[0],i=this._points[1];if(u=u||this.canvas.contextTop,this._saveAndTransform(u),u.beginPath(),this._points.length===2&&l.x===i.x&&l.y===i.y){var s=this.width/1e3;l=new t.Point(l.x,l.y),i=new t.Point(i.x,i.y),l.x-=s,i.x+=s}for(u.moveTo(l.x,l.y),r=1,a=this._points.length;r<a;r++)this._drawSegment(u,l,i),l=this._points[r],i=this._points[r+1];u.lineTo(l.x,l.y),u.stroke(),u.restore()},convertPointsToSVGPath:function(u){var r=this.width/1e3;return t.util.getSmoothPathFromPoints(u,r)},_isEmptySVGPath:function(u){var r=t.util.joinPath(u);return r==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(u){var r=new t.Path(u,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,r.shadow=new t.Shadow(this.shadow)),r},decimatePoints:function(u,r){if(u.length<=2)return u;var a=this.canvas.getZoom(),l=Math.pow(r/a,2),i,s=u.length-1,e=u[0],o=[e],h;for(i=1;i<s-1;i++)h=Math.pow(e.x-u[i].x,2)+Math.pow(e.y-u[i].y,2),h>=l&&(e=u[i],o.push(e));return o.push(u[s]),o},_finalizeAndAddPath:function(){var u=this.canvas.contextTop;u.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var r=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(r)){this.canvas.requestRenderAll();return}var a=this.createPath(r);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:a}),this.canvas.add(a),this.canvas.requestRenderAll(),a.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:a})}})}(),t.CircleBrush=t.util.createClass(t.BaseBrush,{width:10,initialize:function(u){this.canvas=u,this.points=[]},drawDot:function(u){var r=this.addPoint(u),a=this.canvas.contextTop;this._saveAndTransform(a),this.dot(a,r),a.restore()},dot:function(u,r){u.fillStyle=r.fill,u.beginPath(),u.arc(r.x,r.y,r.radius,0,Math.PI*2,!1),u.closePath(),u.fill()},onMouseDown:function(u){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(u)},_render:function(){var u=this.canvas.contextTop,r,a,l=this.points;for(this._saveAndTransform(u),r=0,a=l.length;r<a;r++)this.dot(u,l[r]);u.restore()},onMouseMove:function(u){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(u)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(u),this._render()):this.drawDot(u))},onMouseUp:function(){var u=this.canvas.renderOnAddRemove,r,a;this.canvas.renderOnAddRemove=!1;var l=[];for(r=0,a=this.points.length;r<a;r++){var i=this.points[r],s=new t.Circle({radius:i.radius,left:i.x,top:i.y,originX:"center",originY:"center",fill:i.fill});this.shadow&&(s.shadow=new t.Shadow(this.shadow)),l.push(s)}var e=new t.Group(l);e.canvas=this.canvas,this.canvas.fire("before:path:created",{path:e}),this.canvas.add(e),this.canvas.fire("path:created",{path:e}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=u,this.canvas.requestRenderAll()},addPoint:function(u){var r=new t.Point(u.x,u.y),a=t.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,l=new t.Color(this.color).setAlpha(t.util.getRandomInt(0,100)/100).toRgba();return r.radius=a,r.fill=l,this.points.push(r),r}}),t.SprayBrush=t.util.createClass(t.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(u){this.canvas=u,this.sprayChunks=[]},onMouseDown:function(u){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(u),this.render(this.sprayChunkPoints)},onMouseMove:function(u){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(u)||(this.addSprayChunk(u),this.render(this.sprayChunkPoints))},onMouseUp:function(){var u=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var r=[],a=0,l=this.sprayChunks.length;a<l;a++)for(var i=this.sprayChunks[a],s=0,e=i.length;s<e;s++){var o=new t.Rect({width:i[s].width,height:i[s].width,left:i[s].x+1,top:i[s].y+1,originX:"center",originY:"center",fill:this.color});r.push(o)}this.optimizeOverlapping&&(r=this._getOptimizedRects(r));var h=new t.Group(r);this.shadow&&h.set("shadow",new t.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:h}),this.canvas.add(h),this.canvas.fire("path:created",{path:h}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=u,this.canvas.requestRenderAll()},_getOptimizedRects:function(u){var r={},a,l,i;for(l=0,i=u.length;l<i;l++)a=u[l].left+""+u[l].top,r[a]||(r[a]=u[l]);var s=[];for(a in r)s.push(r[a]);return s},render:function(u){var r=this.canvas.contextTop,a,l;for(r.fillStyle=this.color,this._saveAndTransform(r),a=0,l=u.length;a<l;a++){var i=u[a];typeof i.opacity!="undefined"&&(r.globalAlpha=i.opacity),r.fillRect(i.x,i.y,i.width,i.width)}r.restore()},_render:function(){var u=this.canvas.contextTop,r,a;for(u.fillStyle=this.color,this._saveAndTransform(u),r=0,a=this.sprayChunks.length;r<a;r++)this.render(this.sprayChunks[r]);u.restore()},addSprayChunk:function(u){this.sprayChunkPoints=[];var r,a,l,i=this.width/2,s;for(s=0;s<this.density;s++){r=t.util.getRandomInt(u.x-i,u.x+i),a=t.util.getRandomInt(u.y-i,u.y+i),this.dotWidthVariance?l=t.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):l=this.dotWidth;var e=new t.Point(r,a);e.width=l,this.randomOpacity&&(e.opacity=t.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(e)}this.sprayChunks.push(this.sprayChunkPoints)}}),t.PatternBrush=t.util.createClass(t.PencilBrush,{getPatternSrc:function(){var u=20,r=5,a=t.util.createCanvasElement(),l=a.getContext("2d");return a.width=a.height=u+r,l.fillStyle=this.color,l.beginPath(),l.arc(u/2,u/2,u/2,0,Math.PI*2,!1),l.closePath(),l.fill(),a},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(u){return u.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(u){this.callSuper("_setBrushStyles",u),u.strokeStyle=this.getPattern(u)},createPath:function(u){var r=this.callSuper("createPath",u),a=r._getLeftTopCoords().scalarAdd(r.strokeWidth/2);return r.stroke=new t.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-a.x,offsetY:-a.y}),r}}),function(){var u=t.util.getPointer,r=t.util.degreesToRadians,a=t.util.isTouchEvent;t.Canvas=t.util.createClass(t.StaticCanvas,{initialize:function(i,s){s||(s={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(i,s),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=t.PencilBrush&&new t.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var i=this.getActiveObjects(),s,e,o;if(i.length>0&&!this.preserveObjectStacking){e=[],o=[];for(var h=0,n=this._objects.length;h<n;h++)s=this._objects[h],i.indexOf(s)===-1?e.push(s):o.push(s);i.length>1&&(this._activeObject._objects=o),e.push.apply(e,o)}else e=this._objects;return e},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var i=this.contextContainer;return this.renderCanvas(i,this._chooseObjectsToRender()),this},renderTopLayer:function(i){i.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(i),this.contextTopDirty=!0),i.restore()},renderTop:function(){var i=this.contextTop;return this.clearContext(i),this.renderTopLayer(i),this.fire("after:render"),this},_normalizePointer:function(i,s){var e=i.calcTransformMatrix(),o=t.util.invertTransform(e),h=this.restorePointerVpt(s);return t.util.transformPoint(h,o)},isTargetTransparent:function(i,s,e){if(i.shouldCache()&&i._cacheCanvas&&i!==this._activeObject){var o=this._normalizePointer(i,{x:s,y:e}),h=Math.max(i.cacheTranslationX+o.x*i.zoomX,0),n=Math.max(i.cacheTranslationY+o.y*i.zoomY,0),_=t.util.isTransparent(i._cacheContext,Math.round(h),Math.round(n),this.targetFindTolerance);return _}var d=this.contextCache,g=i.selectionBackgroundColor,v=this.viewportTransform;i.selectionBackgroundColor="",this.clearContext(d),d.save(),d.transform(v[0],v[1],v[2],v[3],v[4],v[5]),i.render(d),d.restore(),i.selectionBackgroundColor=g;var _=t.util.isTransparent(d,s,e,this.targetFindTolerance);return _},_isSelectionKeyPressed:function(i){var s=!1;return Array.isArray(this.selectionKey)?s=!!this.selectionKey.find(function(e){return i[e]===!0}):s=i[this.selectionKey],s},_shouldClearSelection:function(i,s){var e=this.getActiveObjects(),o=this._activeObject;return!s||s&&o&&e.length>1&&e.indexOf(s)===-1&&o!==s&&!this._isSelectionKeyPressed(i)||s&&!s.evented||s&&!s.selectable&&o&&o!==s},_shouldCenterTransform:function(i,s,e){if(i){var o;return s==="scale"||s==="scaleX"||s==="scaleY"||s==="resizing"?o=this.centeredScaling||i.centeredScaling:s==="rotate"&&(o=this.centeredRotation||i.centeredRotation),o?!e:e}},_getOriginFromCorner:function(i,s){var e={x:i.originX,y:i.originY};return s==="ml"||s==="tl"||s==="bl"?e.x="right":(s==="mr"||s==="tr"||s==="br")&&(e.x="left"),s==="tl"||s==="mt"||s==="tr"?e.y="bottom":(s==="bl"||s==="mb"||s==="br")&&(e.y="top"),e},_getActionFromCorner:function(i,s,e,o){if(!s||!i)return"drag";var h=o.controls[s];return h.getActionName(e,h,o)},_setupCurrentTransform:function(i,s,e){if(s){var o=this.getPointer(i),h=s.__corner,n=s.controls[h],d=e&&h?n.getActionHandler(i,s,n):t.controlsUtils.dragHandler,g=this._getActionFromCorner(e,h,i,s),v=this._getOriginFromCorner(s,h),_=i[this.centeredKey],b={target:s,action:g,actionHandler:d,corner:h,scaleX:s.scaleX,scaleY:s.scaleY,skewX:s.skewX,skewY:s.skewY,offsetX:o.x-s.left,offsetY:o.y-s.top,originX:v.x,originY:v.y,ex:o.x,ey:o.y,lastX:o.x,lastY:o.y,theta:r(s.angle),width:s.width*s.scaleX,shiftKey:i.shiftKey,altKey:_,original:t.util.saveObjectTransform(s)};this._shouldCenterTransform(s,g,_)&&(b.originX="center",b.originY="center"),b.original.originX=v.x,b.original.originY=v.y,this._currentTransform=b,this._beforeTransform(i)}},setCursor:function(i){this.upperCanvasEl.style.cursor=i},_drawSelection:function(i){var s=this._groupSelector,e=new t.Point(s.ex,s.ey),o=t.util.transformPoint(e,this.viewportTransform),h=new t.Point(s.ex+s.left,s.ey+s.top),n=t.util.transformPoint(h,this.viewportTransform),d=Math.min(o.x,n.x),g=Math.min(o.y,n.y),v=Math.max(o.x,n.x),_=Math.max(o.y,n.y),b=this.selectionLineWidth/2;this.selectionColor&&(i.fillStyle=this.selectionColor,i.fillRect(d,g,v-d,_-g)),!(!this.selectionLineWidth||!this.selectionBorderColor)&&(i.lineWidth=this.selectionLineWidth,i.strokeStyle=this.selectionBorderColor,d+=b,g+=b,v-=b,_-=b,t.Object.prototype._setLineDash.call(this,i,this.selectionDashArray),i.strokeRect(d,g,v-d,_-g))},findTarget:function(i,s){if(!this.skipTargetFind){var e=!0,o=this.getPointer(i,e),h=this._activeObject,n=this.getActiveObjects(),d,g,v=a(i),_=n.length>1&&!s||n.length===1;if(this.targets=[],_&&h._findTargetCorner(o,v)||n.length>1&&!s&&h===this._searchPossibleTargets([h],o))return h;if(n.length===1&&h===this._searchPossibleTargets([h],o))if(this.preserveObjectStacking)d=h,g=this.targets,this.targets=[];else return h;var b=this._searchPossibleTargets(this._objects,o);return i[this.altSelectionKey]&&b&&d&&b!==d&&(b=d,this.targets=g),b}},_checkTarget:function(i,s,e){if(s&&s.visible&&s.evented&&s.containsPoint(i))if((this.perPixelTargetFind||s.perPixelTargetFind)&&!s.isEditing){var o=this.isTargetTransparent(s,e.x,e.y);if(!o)return!0}else return!0},_searchPossibleTargets:function(i,s){for(var e,o=i.length,h;o--;){var n=i[o],d=n.group?this._normalizePointer(n.group,s):s;if(this._checkTarget(d,n,s)){e=i[o],e.subTargetCheck&&e instanceof t.Group&&(h=this._searchPossibleTargets(e._objects,s),h&&this.targets.push(h));break}}return e},restorePointerVpt:function(i){return t.util.transformPoint(i,t.util.invertTransform(this.viewportTransform))},getPointer:function(i,s){if(this._absolutePointer&&!s)return this._absolutePointer;if(this._pointer&&s)return this._pointer;var e=u(i),o=this.upperCanvasEl,h=o.getBoundingClientRect(),n=h.width||0,d=h.height||0,g;(!n||!d)&&("top"in h&&"bottom"in h&&(d=Math.abs(h.top-h.bottom)),"right"in h&&"left"in h&&(n=Math.abs(h.right-h.left))),this.calcOffset(),e.x=e.x-this._offset.left,e.y=e.y-this._offset.top,s||(e=this.restorePointerVpt(e));var v=this.getRetinaScaling();return v!==1&&(e.x/=v,e.y/=v),n===0||d===0?g={width:1,height:1}:g={width:o.width/n,height:o.height/d},{x:e.x*g.width,y:e.y*g.height}},_createUpperCanvas:function(){var i=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),s=this.lowerCanvasEl,e=this.upperCanvasEl;e?e.className="":(e=this._createCanvasElement(),this.upperCanvasEl=e),t.util.addClass(e,"upper-canvas "+i),this.wrapperEl.appendChild(e),this._copyCanvasStyle(s,e),this._applyCanvasStyle(e),this.contextTop=e.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=t.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),t.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),t.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(i){var s=this.width||i.width,e=this.height||i.height;t.util.setStyle(i,{position:"absolute",width:s+"px",height:e+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),i.width=s,i.height=e,t.util.makeElementUnselectable(i)},_copyCanvasStyle:function(i,s){s.style.cssText=i.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var i=this._activeObject;return i?i.type==="activeSelection"&&i._objects?i._objects.slice(0):[i]:[]},_onObjectRemoved:function(i){i===this._activeObject&&(this.fire("before:selection:cleared",{target:i}),this._discardActiveObject(),this.fire("selection:cleared",{target:i}),i.fire("deselected")),i===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",i)},_fireSelectionEvents:function(i,s){var e=!1,o=this.getActiveObjects(),h=[],n=[];i.forEach(function(d){o.indexOf(d)===-1&&(e=!0,d.fire("deselected",{e:s,target:d}),n.push(d))}),o.forEach(function(d){i.indexOf(d)===-1&&(e=!0,d.fire("selected",{e:s,target:d}),h.push(d))}),i.length>0&&o.length>0?e&&this.fire("selection:updated",{e:s,selected:h,deselected:n}):o.length>0?this.fire("selection:created",{e:s,selected:h}):i.length>0&&this.fire("selection:cleared",{e:s,deselected:n})},setActiveObject:function(i,s){var e=this.getActiveObjects();return this._setActiveObject(i,s),this._fireSelectionEvents(e,s),this},_setActiveObject:function(i,s){return this._activeObject===i||!this._discardActiveObject(s,i)||i.onSelect({e:s})?!1:(this._activeObject=i,!0)},_discardActiveObject:function(i,s){var e=this._activeObject;if(e){if(e.onDeselect({e:i,object:s}))return!1;this._activeObject=null}return!0},discardActiveObject:function(i){var s=this.getActiveObjects(),e=this.getActiveObject();return s.length&&this.fire("before:selection:cleared",{target:e,e:i}),this._discardActiveObject(i),this._fireSelectionEvents(s,i),this},dispose:function(){var i=this.wrapperEl;return this.removeListeners(),i.removeChild(this.upperCanvasEl),i.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(s){t.util.cleanUpJsdomNode(this[s]),this[s]=void 0}.bind(this)),i.parentNode&&i.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,t.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(i){var s=this._activeObject;s&&s._renderControls(i)},_toObject:function(i,s,e){var o=this._realizeGroupTransformOnObject(i),h=this.callSuper("_toObject",i,s,e);return this._unwindGroupTransformOnObject(i,o),h},_realizeGroupTransformOnObject:function(i){if(i.group&&i.group.type==="activeSelection"&&this._activeObject===i.group){var s=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],e={};return s.forEach(function(o){e[o]=i[o]}),t.util.addTransformToObject(i,this._activeObject.calcOwnMatrix()),e}else return null},_unwindGroupTransformOnObject:function(i,s){s&&i.set(s)},_setSVGObject:function(i,s,e){var o=this._realizeGroupTransformOnObject(s);this.callSuper("_setSVGObject",i,s,e),this._unwindGroupTransformOnObject(s,o)},setViewportTransform:function(i){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),t.StaticCanvas.prototype.setViewportTransform.call(this,i)}});for(var l in t.StaticCanvas)l!=="prototype"&&(t.Canvas[l]=t.StaticCanvas[l])}(),function(){var u=t.util.addListener,r=t.util.removeListener,a=3,l=2,i=1,s={passive:!1};function e(o,h){return o.button&&o.button===h-1}t.util.object.extend(t.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(u,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(o,h){var n=this.upperCanvasEl,d=this._getEventPrefix();o(t.window,"resize",this._onResize),o(n,d+"down",this._onMouseDown),o(n,d+"move",this._onMouseMove,s),o(n,d+"out",this._onMouseOut),o(n,d+"enter",this._onMouseEnter),o(n,"wheel",this._onMouseWheel),o(n,"contextmenu",this._onContextMenu),o(n,"dblclick",this._onDoubleClick),o(n,"dragover",this._onDragOver),o(n,"dragenter",this._onDragEnter),o(n,"dragleave",this._onDragLeave),o(n,"drop",this._onDrop),this.enablePointerEvents||o(n,"touchstart",this._onTouchStart,s),typeof eventjs!="undefined"&&h in eventjs&&(eventjs[h](n,"gesture",this._onGesture),eventjs[h](n,"drag",this._onDrag),eventjs[h](n,"orientation",this._onOrientationChange),eventjs[h](n,"shake",this._onShake),eventjs[h](n,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(r,"remove");var o=this._getEventPrefix();r(t.document,o+"up",this._onMouseUp),r(t.document,"touchend",this._onTouchEnd,s),r(t.document,o+"move",this._onMouseMove,s),r(t.document,"touchmove",this._onMouseMove,s)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(o,h){this.__onTransformGesture&&this.__onTransformGesture(o,h)},_onDrag:function(o,h){this.__onDrag&&this.__onDrag(o,h)},_onMouseWheel:function(o){this.__onMouseWheel(o)},_onMouseOut:function(o){var h=this._hoveredTarget;this.fire("mouse:out",{target:h,e:o}),this._hoveredTarget=null,h&&h.fire("mouseout",{e:o});var n=this;this._hoveredTargets.forEach(function(d){n.fire("mouse:out",{target:h,e:o}),d&&h.fire("mouseout",{e:o})}),this._hoveredTargets=[]},_onMouseEnter:function(o){!this._currentTransform&&!this.findTarget(o)&&(this.fire("mouse:over",{target:null,e:o}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(o,h){this.__onOrientationChange&&this.__onOrientationChange(o,h)},_onShake:function(o,h){this.__onShake&&this.__onShake(o,h)},_onLongPress:function(o,h){this.__onLongPress&&this.__onLongPress(o,h)},_onDragOver:function(o){o.preventDefault();var h=this._simpleEventHandler("dragover",o);this._fireEnterLeaveEvents(h,o)},_onDrop:function(o){return this._simpleEventHandler("drop:before",o),this._simpleEventHandler("drop",o)},_onContextMenu:function(o){return this.stopContextMenu&&(o.stopPropagation(),o.preventDefault()),!1},_onDoubleClick:function(o){this._cacheTransformEventData(o),this._handleEvent(o,"dblclick"),this._resetTransformEventData(o)},getPointerId:function(o){var h=o.changedTouches;return h?h[0]&&h[0].identifier:this.enablePointerEvents?o.pointerId:-1},_isMainEvent:function(o){return o.isPrimary===!0?!0:o.isPrimary===!1?!1:o.type==="touchend"&&o.touches.length===0?!0:o.changedTouches?o.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(o){o.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(o)),this.__onMouseDown(o),this._resetTransformEventData();var h=this.upperCanvasEl,n=this._getEventPrefix();u(t.document,"touchend",this._onTouchEnd,s),u(t.document,"touchmove",this._onMouseMove,s),r(h,n+"down",this._onMouseDown)},_onMouseDown:function(o){this.__onMouseDown(o),this._resetTransformEventData();var h=this.upperCanvasEl,n=this._getEventPrefix();r(h,n+"move",this._onMouseMove,s),u(t.document,n+"up",this._onMouseUp),u(t.document,n+"move",this._onMouseMove,s)},_onTouchEnd:function(o){if(!(o.touches.length>0)){this.__onMouseUp(o),this._resetTransformEventData(),this.mainTouchId=null;var h=this._getEventPrefix();r(t.document,"touchend",this._onTouchEnd,s),r(t.document,"touchmove",this._onMouseMove,s);var n=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){u(n.upperCanvasEl,h+"down",n._onMouseDown),n._willAddMouseDown=0},400)}},_onMouseUp:function(o){this.__onMouseUp(o),this._resetTransformEventData();var h=this.upperCanvasEl,n=this._getEventPrefix();this._isMainEvent(o)&&(r(t.document,n+"up",this._onMouseUp),r(t.document,n+"move",this._onMouseMove,s),u(h,n+"move",this._onMouseMove,s))},_onMouseMove:function(o){!this.allowTouchScrolling&&o.preventDefault&&o.preventDefault(),this.__onMouseMove(o)},_onResize:function(){this.calcOffset()},_shouldRender:function(o){var h=this._activeObject;return!!h!=!!o||h&&o&&h!==o?!0:(h&&h.isEditing,!1)},__onMouseUp:function(o){var h,n=this._currentTransform,d=this._groupSelector,g=!1,v=!d||d.left===0&&d.top===0;if(this._cacheTransformEventData(o),h=this._target,this._handleEvent(o,"up:before"),e(o,a)){this.fireRightClick&&this._handleEvent(o,"up",a,v);return}if(e(o,l)){this.fireMiddleClick&&this._handleEvent(o,"up",l,v),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(o);return}if(this._isMainEvent(o)){if(n&&(this._finalizeCurrentTransform(o),g=n.actionPerformed),!v){var _=h===this._activeObject;this._maybeGroupObjects(o),g||(g=this._shouldRender(h)||!_&&h===this._activeObject)}var b,C;if(h){if(b=h._findTargetCorner(this.getPointer(o,!0),t.util.isTouchEvent(o)),h.selectable&&h!==this._activeObject&&h.activeOn==="up")this.setActiveObject(h,o),g=!0;else{var S=h.controls[b],E=S&&S.getMouseUpHandler(o,h,S);E&&(C=this.getPointer(o),E(o,n,C.x,C.y))}h.isMoving=!1}if(n&&(n.target!==h||n.corner!==b)){var z=n.target&&n.target.controls[n.corner],V=z&&z.getMouseUpHandler(o,h,S);C=C||this.getPointer(o),V&&V(o,n,C.x,C.y)}this._setCursorFromEvent(o,h),this._handleEvent(o,"up",i,v),this._groupSelector=null,this._currentTransform=null,h&&(h.__corner=0),g?this.requestRenderAll():v||this.renderTop()}},_simpleEventHandler:function(o,h){var n=this.findTarget(h),d=this.targets,g={e:h,target:n,subTargets:d};if(this.fire(o,g),n&&n.fire(o,g),!d)return n;for(var v=0;v<d.length;v++)d[v].fire(o,g);return n},_handleEvent:function(o,h,n,d){var g=this._target,v=this.targets||[],_={e:o,target:g,subTargets:v,button:n||i,isClick:d||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};h==="up"&&(_.currentTarget=this.findTarget(o),_.currentSubTargets=this.targets),this.fire("mouse:"+h,_),g&&g.fire("mouse"+h,_);for(var b=0;b<v.length;b++)v[b].fire("mouse"+h,_)},_finalizeCurrentTransform:function(o){var h=this._currentTransform,n=h.target,d={e:o,target:n,transform:h,action:h.action};n._scaling&&(n._scaling=!1),n.setCoords(),(h.actionPerformed||this.stateful&&n.hasStateChanged())&&this._fire("modified",d)},_onMouseDownInDrawingMode:function(o){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(o).requestRenderAll();var h=this.getPointer(o);this.freeDrawingBrush.onMouseDown(h,{e:o,pointer:h}),this._handleEvent(o,"down")},_onMouseMoveInDrawingMode:function(o){if(this._isCurrentlyDrawing){var h=this.getPointer(o);this.freeDrawingBrush.onMouseMove(h,{e:o,pointer:h})}this.setCursor(this.freeDrawingCursor),this._handleEvent(o,"move")},_onMouseUpInDrawingMode:function(o){var h=this.getPointer(o);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:o,pointer:h}),this._handleEvent(o,"up")},__onMouseDown:function(o){this._cacheTransformEventData(o),this._handleEvent(o,"down:before");var h=this._target;if(e(o,a)){this.fireRightClick&&this._handleEvent(o,"down",a);return}if(e(o,l)){this.fireMiddleClick&&this._handleEvent(o,"down",l);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(o);return}if(this._isMainEvent(o)&&!this._currentTransform){var n=this._pointer;this._previousPointer=n;var d=this._shouldRender(h),g=this._shouldGroup(o,h);if(this._shouldClearSelection(o,h)?this.discardActiveObject(o):g&&(this._handleGrouping(o,h),h=this._activeObject),this.selection&&(!h||!h.selectable&&!h.isEditing&&h!==this._activeObject)&&(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),h){var v=h===this._activeObject;h.selectable&&h.activeOn==="down"&&this.setActiveObject(h,o);var _=h._findTargetCorner(this.getPointer(o,!0),t.util.isTouchEvent(o));if(h.__corner=_,h===this._activeObject&&(_||!g)){this._setupCurrentTransform(o,h,v);var b=h.controls[_],n=this.getPointer(o),C=b&&b.getMouseDownHandler(o,h,b);C&&C(o,this._currentTransform,n.x,n.y)}}this._handleEvent(o,"down"),(d||g)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(o){this._resetTransformEventData(),this._pointer=this.getPointer(o,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(o)||null},_beforeTransform:function(o){var h=this._currentTransform;this.stateful&&h.target.saveState(),this.fire("before:transform",{e:o,transform:h})},__onMouseMove:function(o){this._handleEvent(o,"move:before"),this._cacheTransformEventData(o);var h,n;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(o);return}if(this._isMainEvent(o)){var d=this._groupSelector;d?(n=this._absolutePointer,d.left=n.x-d.ex,d.top=n.y-d.ey,this.renderTop()):this._currentTransform?this._transformObject(o):(h=this.findTarget(o)||null,this._setCursorFromEvent(o,h),this._fireOverOutEvents(h,o)),this._handleEvent(o,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(o,h){var n=this._hoveredTarget,d=this._hoveredTargets,g=this.targets,v=Math.max(d.length,g.length);this.fireSyntheticInOutEvents(o,h,{oldTarget:n,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var _=0;_<v;_++)this.fireSyntheticInOutEvents(g[_],h,{oldTarget:d[_],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=o,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(o,h){var n=this._draggedoverTarget,d=this._hoveredTargets,g=this.targets,v=Math.max(d.length,g.length);this.fireSyntheticInOutEvents(o,h,{oldTarget:n,evtOut:"dragleave",evtIn:"dragenter"});for(var _=0;_<v;_++)this.fireSyntheticInOutEvents(g[_],h,{oldTarget:d[_],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=o},fireSyntheticInOutEvents:function(o,h,n){var d,g,v=n.oldTarget,_,b,C=v!==o,S=n.canvasEvtIn,E=n.canvasEvtOut;C&&(d={e:h,target:o,previousTarget:v},g={e:h,target:v,nextTarget:o}),b=o&&C,_=v&&C,_&&(E&&this.fire(E,g),v.fire(n.evtOut,g)),b&&(S&&this.fire(S,d),o.fire(n.evtIn,d))},__onMouseWheel:function(o){this._cacheTransformEventData(o),this._handleEvent(o,"wheel"),this._resetTransformEventData()},_transformObject:function(o){var h=this.getPointer(o),n=this._currentTransform;n.reset=!1,n.shiftKey=o.shiftKey,n.altKey=o[this.centeredKey],this._performTransformAction(o,n,h),n.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(o,h,n){var d=n.x,g=n.y,v=h.action,_=!1,b=h.actionHandler;b&&(_=b(o,h,d,g)),v==="drag"&&_&&(h.target.isMoving=!0,this.setCursor(h.target.moveCursor||this.moveCursor)),h.actionPerformed=h.actionPerformed||_},_fire:t.controlsUtils.fireEvent,_setCursorFromEvent:function(o,h){if(!h)return this.setCursor(this.defaultCursor),!1;var n=h.hoverCursor||this.hoverCursor,d=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,g=(!d||!d.contains(h))&&h._findTargetCorner(this.getPointer(o,!0));g?this.setCursor(this.getCornerCursor(g,h,o)):(h.subTargetCheck&&this.targets.concat().reverse().map(function(v){n=v.hoverCursor||n}),this.setCursor(n))},getCornerCursor:function(o,h,n){var d=h.controls[o];return d.cursorStyleHandler(n,d,h)}})}(),function(){var u=Math.min,r=Math.max;t.util.object.extend(t.Canvas.prototype,{_shouldGroup:function(a,l){var i=this._activeObject;return i&&this._isSelectionKeyPressed(a)&&l&&l.selectable&&this.selection&&(i!==l||i.type==="activeSelection")&&!l.onSelect({e:a})},_handleGrouping:function(a,l){var i=this._activeObject;i.__corner||l===i&&(l=this.findTarget(a,!0),!l||!l.selectable)||(i&&i.type==="activeSelection"?this._updateActiveSelection(l,a):this._createActiveSelection(l,a))},_updateActiveSelection:function(a,l){var i=this._activeObject,s=i._objects.slice(0);i.contains(a)?(i.removeWithUpdate(a),this._hoveredTarget=a,this._hoveredTargets=this.targets.concat(),i.size()===1&&this._setActiveObject(i.item(0),l)):(i.addWithUpdate(a),this._hoveredTarget=i,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(s,l)},_createActiveSelection:function(a,l){var i=this.getActiveObjects(),s=this._createGroup(a);this._hoveredTarget=s,this._setActiveObject(s,l),this._fireSelectionEvents(i,l)},_createGroup:function(a){var l=this._objects,i=l.indexOf(this._activeObject)<l.indexOf(a),s=i?[this._activeObject,a]:[a,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new t.ActiveSelection(s,{canvas:this})},_groupSelectedObjects:function(a){var l=this._collectObjects(a),i;l.length===1?this.setActiveObject(l[0],a):l.length>1&&(i=new t.ActiveSelection(l.reverse(),{canvas:this}),this.setActiveObject(i,a))},_collectObjects:function(a){for(var l=[],i,s=this._groupSelector.ex,e=this._groupSelector.ey,o=s+this._groupSelector.left,h=e+this._groupSelector.top,n=new t.Point(u(s,o),u(e,h)),d=new t.Point(r(s,o),r(e,h)),g=!this.selectionFullyContained,v=s===o&&e===h,_=this._objects.length;_--&&(i=this._objects[_],!(!(!i||!i.selectable||!i.visible)&&(g&&i.intersectsWithRect(n,d,!0)||i.isContainedWithinRect(n,d,!0)||g&&i.containsPoint(n,null,!0)||g&&i.containsPoint(d,null,!0))&&(l.push(i),v))););return l.length>1&&(l=l.filter(function(b){return!b.onSelect({e:a})})),l},_maybeGroupObjects:function(a){this.selection&&this._groupSelector&&this._groupSelectedObjects(a),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){t.util.object.extend(t.StaticCanvas.prototype,{toDataURL:function(u){u||(u={});var r=u.format||"png",a=u.quality||1,l=(u.multiplier||1)*(u.enableRetinaScaling?this.getRetinaScaling():1),i=this.toCanvasElement(l,u);return t.util.toDataURL(i,r,a)},toCanvasElement:function(u,r){u=u||1,r=r||{};var a=(r.width||this.width)*u,l=(r.height||this.height)*u,i=this.getZoom(),s=this.width,e=this.height,o=i*u,h=this.viewportTransform,n=(h[4]-(r.left||0))*u,d=(h[5]-(r.top||0))*u,g=this.interactive,v=[o,0,0,o,n,d],_=this.enableRetinaScaling,b=t.util.createCanvasElement(),C=this.contextTop;return b.width=a,b.height=l,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=v,this.width=a,this.height=l,this.calcViewportBoundaries(),this.renderCanvas(b.getContext("2d"),this._objects),this.viewportTransform=h,this.width=s,this.height=e,this.calcViewportBoundaries(),this.interactive=g,this.enableRetinaScaling=_,this.contextTop=C,b}})}(),t.util.object.extend(t.StaticCanvas.prototype,{loadFromJSON:function(u,r,a){if(u){var l=typeof u=="string"?JSON.parse(u):t.util.object.clone(u),i=this,s=l.clipPath,e=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete l.clipPath,this._enlivenObjects(l.objects,function(o){i.clear(),i._setBgOverlay(l,function(){s?i._enlivenObjects([s],function(h){i.clipPath=h[0],i.__setupCanvas.call(i,l,o,e,r)}):i.__setupCanvas.call(i,l,o,e,r)})},a),this}},__setupCanvas:function(u,r,a,l){var i=this;r.forEach(function(s,e){i.insertAt(s,e)}),this.renderOnAddRemove=a,delete u.objects,delete u.backgroundImage,delete u.overlayImage,delete u.background,delete u.overlay,this._setOptions(u),this.renderAll(),l&&l()},_setBgOverlay:function(u,r){var a={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!u.backgroundImage&&!u.overlayImage&&!u.background&&!u.overlay){r&&r();return}var l=function(){a.backgroundImage&&a.overlayImage&&a.backgroundColor&&a.overlayColor&&r&&r()};this.__setBgOverlay("backgroundImage",u.backgroundImage,a,l),this.__setBgOverlay("overlayImage",u.overlayImage,a,l),this.__setBgOverlay("backgroundColor",u.background,a,l),this.__setBgOverlay("overlayColor",u.overlay,a,l)},__setBgOverlay:function(u,r,a,l){var i=this;if(!r){a[u]=!0,l&&l();return}u==="backgroundImage"||u==="overlayImage"?t.util.enlivenObjects([r],function(s){i[u]=s[0],a[u]=!0,l&&l()}):this["set"+t.util.string.capitalize(u,!0)](r,function(){a[u]=!0,l&&l()})},_enlivenObjects:function(u,r,a){if(!u||u.length===0){r&&r([]);return}t.util.enlivenObjects(u,function(l){r&&r(l)},null,a)},_toDataURL:function(u,r){this.clone(function(a){r(a.toDataURL(u))})},_toDataURLWithMultiplier:function(u,r,a){this.clone(function(l){a(l.toDataURLWithMultiplier(u,r))})},clone:function(u,r){var a=JSON.stringify(this.toJSON(r));this.cloneWithoutData(function(l){l.loadFromJSON(a,function(){u&&u(l)})})},cloneWithoutData:function(u){var r=t.util.createCanvasElement();r.width=this.width,r.height=this.height;var a=new t.Canvas(r);this.backgroundImage?(a.setBackgroundImage(this.backgroundImage.src,function(){a.renderAll(),u&&u(a)}),a.backgroundImageOpacity=this.backgroundImageOpacity,a.backgroundImageStretch=this.backgroundImageStretch):u&&u(a)}}),function(u){var r=u.fabric||(u.fabric={}),a=r.util.object.extend,l=r.util.object.clone,i=r.util.toFixed,s=r.util.string.capitalize,e=r.util.degreesToRadians,o=!r.isLikelyNode,h=2;r.Object||(r.Object=r.util.createClass(r.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:o,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(n){n&&this.setOptions(n)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=r.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(n){var d=r.perfLimitSizeTotal,g=n.width,v=n.height,_=r.maxCacheSideLimit,b=r.minCacheSideLimit;if(g<=_&&v<=_&&g*v<=d)return g<b&&(n.width=b),v<b&&(n.height=b),n;var C=g/v,S=r.util.limitDimsByArea(C,d),E=r.util.capValue,z=E(b,S.x,_),V=E(b,S.y,_);return g>z&&(n.zoomX/=g/z,n.width=z,n.capped=!0),v>V&&(n.zoomY/=v/V,n.height=V,n.capped=!0),n},_getCacheCanvasDimensions:function(){var n=this.getTotalObjectScaling(),d=this._getTransformedDimensions(0,0),g=d.x*n.scaleX/this.scaleX,v=d.y*n.scaleY/this.scaleY;return{width:g+h,height:v+h,zoomX:n.scaleX,zoomY:n.scaleY,x:g,y:v}},_updateCacheCanvas:function(){var n=this.canvas;if(this.noScaleCache&&n&&n._currentTransform){var d=n._currentTransform.target,g=n._currentTransform.action;if(this===d&&g.slice&&g.slice(0,5)==="scale")return!1}var v=this._cacheCanvas,_=this._limitCacheSize(this._getCacheCanvasDimensions()),b=r.minCacheSideLimit,C=_.width,S=_.height,E,z,V=_.zoomX,W=_.zoomY,L=C!==this.cacheWidth||S!==this.cacheHeight,A=this.zoomX!==V||this.zoomY!==W,X=L||A,B=0,st=0,ht=!1;if(L){var ft=this._cacheCanvas.width,O=this._cacheCanvas.height,F=C>ft||S>O,j=(C<ft*.9||S<O*.9)&&ft>b&&O>b;ht=F||j,F&&!_.capped&&(C>b||S>b)&&(B=C*.1,st=S*.1)}return this instanceof r.Text&&this.path&&(X=!0,ht=!0,B+=this.getHeightOfLine(0)*this.zoomX,st+=this.getHeightOfLine(0)*this.zoomY),X?(ht?(v.width=Math.ceil(C+B),v.height=Math.ceil(S+st)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,v.width,v.height)),E=_.x/2,z=_.y/2,this.cacheTranslationX=Math.round(v.width/2-E)+E,this.cacheTranslationY=Math.round(v.height/2-z)+z,this.cacheWidth=C,this.cacheHeight=S,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(V,W),this.zoomX=V,this.zoomY=W,!0):!1},setOptions:function(n){this._setOptions(n),this._initGradient(n.fill,"fill"),this._initGradient(n.stroke,"stroke"),this._initPattern(n.fill,"fill"),this._initPattern(n.stroke,"stroke")},transform:function(n){var d=this.group&&!this.group._transformDone||this.group&&this.canvas&&n===this.canvas.contextTop,g=this.calcTransformMatrix(!d);n.transform(g[0],g[1],g[2],g[3],g[4],g[5])},toObject:function(n){var d=r.Object.NUM_FRACTION_DIGITS,g={type:this.type,version:r.version,originX:this.originX,originY:this.originY,left:i(this.left,d),top:i(this.top,d),width:i(this.width,d),height:i(this.height,d),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:i(this.strokeWidth,d),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:i(this.strokeMiterLimit,d),scaleX:i(this.scaleX,d),scaleY:i(this.scaleY,d),angle:i(this.angle,d),flipX:this.flipX,flipY:this.flipY,opacity:i(this.opacity,d),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:i(this.skewX,d),skewY:i(this.skewY,d)};return this.clipPath&&!this.clipPath.excludeFromExport&&(g.clipPath=this.clipPath.toObject(n),g.clipPath.inverted=this.clipPath.inverted,g.clipPath.absolutePositioned=this.clipPath.absolutePositioned),r.util.populateWithProperties(this,g,n),this.includeDefaultValues||(g=this._removeDefaultValues(g)),g},toDatalessObject:function(n){return this.toObject(n)},_removeDefaultValues:function(n){var d=r.util.getKlass(n.type).prototype,g=d.stateProperties;return g.forEach(function(v){v==="left"||v==="top"||(n[v]===d[v]&&delete n[v],Array.isArray(n[v])&&Array.isArray(d[v])&&n[v].length===0&&d[v].length===0&&delete n[v])}),n},toString:function(){return"#<fabric."+s(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var n=r.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(n.scaleX),scaleY:Math.abs(n.scaleY)}},getTotalObjectScaling:function(){var n=this.getObjectScaling(),d=n.scaleX,g=n.scaleY;if(this.canvas){var v=this.canvas.getZoom(),_=this.canvas.getRetinaScaling();d*=v*_,g*=v*_}return{scaleX:d,scaleY:g}},getObjectOpacity:function(){var n=this.opacity;return this.group&&(n*=this.group.getObjectOpacity()),n},_set:function(n,d){var g=n==="scaleX"||n==="scaleY",v=this[n]!==d,_=!1;return g&&(d=this._constrainScale(d)),n==="scaleX"&&d<0?(this.flipX=!this.flipX,d*=-1):n==="scaleY"&&d<0?(this.flipY=!this.flipY,d*=-1):n==="shadow"&&d&&!(d instanceof r.Shadow)?d=new r.Shadow(d):n==="dirty"&&this.group&&this.group.set("dirty",d),this[n]=d,v&&(_=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(n)>-1?(this.dirty=!0,_&&this.group.set("dirty",!0)):_&&this.stateProperties.indexOf(n)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:r.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(n){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(n.save(),this._setupCompositeOperation(n),this.drawSelectionBackground(n),this.transform(n),this._setOpacity(n),this._setShadow(n,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(n)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(n),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),n.restore())},renderCache:function(n){n=n||{},(!this._cacheCanvas||!this._cacheContext)&&this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,n.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(n,d){if(n.save(),d.inverted?n.globalCompositeOperation="destination-out":n.globalCompositeOperation="destination-in",d.absolutePositioned){var g=r.util.invertTransform(this.calcTransformMatrix());n.transform(g[0],g[1],g[2],g[3],g[4],g[5])}d.transform(n),n.scale(1/d.zoomX,1/d.zoomY),n.drawImage(d._cacheCanvas,-d.cacheTranslationX,-d.cacheTranslationY),n.restore()},drawObject:function(n,d){var g=this.fill,v=this.stroke;d?(this.fill="black",this.stroke="",this._setClippingProperties(n)):this._renderBackground(n),this._render(n),this._drawClipPath(n,this.clipPath),this.fill=g,this.stroke=v},_drawClipPath:function(n,d){d&&(d.canvas=this.canvas,d.shouldCache(),d._transformDone=!0,d.renderCache({forClipping:!0}),this.drawClipPathOnCache(n,d))},drawCacheOnCanvas:function(n){n.scale(1/this.zoomX,1/this.zoomY),n.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(n){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!n&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!n){var d=this.cacheWidth/this.zoomX,g=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-d/2,-g/2,d,g)}return!0}return!1},_renderBackground:function(n){if(this.backgroundColor){var d=this._getNonTransformedDimensions();n.fillStyle=this.backgroundColor,n.fillRect(-d.x/2,-d.y/2,d.x,d.y),this._removeShadow(n)}},_setOpacity:function(n){this.group&&!this.group._transformDone?n.globalAlpha=this.getObjectOpacity():n.globalAlpha*=this.opacity},_setStrokeStyles:function(n,d){var g=d.stroke;g&&(n.lineWidth=d.strokeWidth,n.lineCap=d.strokeLineCap,n.lineDashOffset=d.strokeDashOffset,n.lineJoin=d.strokeLineJoin,n.miterLimit=d.strokeMiterLimit,g.toLive?g.gradientUnits==="percentage"||g.gradientTransform||g.patternTransform?this._applyPatternForTransformedGradient(n,g):(n.strokeStyle=g.toLive(n,this),this._applyPatternGradientTransform(n,g)):n.strokeStyle=d.stroke)},_setFillStyles:function(n,d){var g=d.fill;g&&(g.toLive?(n.fillStyle=g.toLive(n,this),this._applyPatternGradientTransform(n,d.fill)):n.fillStyle=g)},_setClippingProperties:function(n){n.globalAlpha=1,n.strokeStyle="transparent",n.fillStyle="#000000"},_setLineDash:function(n,d){!d||d.length===0||(1&d.length&&d.push.apply(d,d),n.setLineDash(d))},_renderControls:function(n,d){var g=this.getViewportTransform(),v=this.calcTransformMatrix(),_,b,C;d=d||{},b=typeof d.hasBorders!="undefined"?d.hasBorders:this.hasBorders,C=typeof d.hasControls!="undefined"?d.hasControls:this.hasControls,v=r.util.multiplyTransformMatrices(g,v),_=r.util.qrDecompose(v),n.save(),n.translate(_.translateX,_.translateY),n.lineWidth=1*this.borderScaleFactor,this.group||(n.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(_.angle-=180),n.rotate(e(this.group?_.angle:this.angle)),d.forActiveSelection||this.group?b&&this.drawBordersInGroup(n,_,d):b&&this.drawBorders(n,d),C&&this.drawControls(n,d),n.restore()},_setShadow:function(n){if(this.shadow){var d=this.shadow,g=this.canvas,v,_=g&&g.viewportTransform[0]||1,b=g&&g.viewportTransform[3]||1;d.nonScaling?v={scaleX:1,scaleY:1}:v=this.getObjectScaling(),g&&g._isRetinaScaling()&&(_*=r.devicePixelRatio,b*=r.devicePixelRatio),n.shadowColor=d.color,n.shadowBlur=d.blur*r.browserShadowBlurConstant*(_+b)*(v.scaleX+v.scaleY)/4,n.shadowOffsetX=d.offsetX*_*v.scaleX,n.shadowOffsetY=d.offsetY*b*v.scaleY}},_removeShadow:function(n){this.shadow&&(n.shadowColor="",n.shadowBlur=n.shadowOffsetX=n.shadowOffsetY=0)},_applyPatternGradientTransform:function(n,d){if(!d||!d.toLive)return{offsetX:0,offsetY:0};var g=d.gradientTransform||d.patternTransform,v=-this.width/2+d.offsetX||0,_=-this.height/2+d.offsetY||0;return d.gradientUnits==="percentage"?n.transform(this.width,0,0,this.height,v,_):n.transform(1,0,0,1,v,_),g&&n.transform(g[0],g[1],g[2],g[3],g[4],g[5]),{offsetX:v,offsetY:_}},_renderPaintInOrder:function(n){this.paintFirst==="stroke"?(this._renderStroke(n),this._renderFill(n)):(this._renderFill(n),this._renderStroke(n))},_render:function(){},_renderFill:function(n){this.fill&&(n.save(),this._setFillStyles(n,this),this.fillRule==="evenodd"?n.fill("evenodd"):n.fill(),n.restore())},_renderStroke:function(n){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(n),n.save(),this.strokeUniform&&this.group){var d=this.getObjectScaling();n.scale(1/d.scaleX,1/d.scaleY)}else this.strokeUniform&&n.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(n,this.strokeDashArray),this._setStrokeStyles(n,this),n.stroke(),n.restore()}},_applyPatternForTransformedGradient:function(n,d){var g=this._limitCacheSize(this._getCacheCanvasDimensions()),v=r.util.createCanvasElement(),_,b=this.canvas.getRetinaScaling(),C=g.x/this.scaleX/b,S=g.y/this.scaleY/b;v.width=C,v.height=S,_=v.getContext("2d"),_.beginPath(),_.moveTo(0,0),_.lineTo(C,0),_.lineTo(C,S),_.lineTo(0,S),_.closePath(),_.translate(C/2,S/2),_.scale(g.zoomX/this.scaleX/b,g.zoomY/this.scaleY/b),this._applyPatternGradientTransform(_,d),_.fillStyle=d.toLive(n),_.fill(),n.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),n.scale(b*this.scaleX/g.zoomX,b*this.scaleY/g.zoomY),n.strokeStyle=_.createPattern(v,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var n=r.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",n.scaleX),this.set("scaleY",n.scaleY),this.angle=n.angle,this.skewX=n.skewX,this.skewY=0}},_removeTransformMatrix:function(n){var d=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),d=r.util.transformPoint(d,this.transformMatrix)),this.transformMatrix=null,n&&(this.scaleX*=n.scaleX,this.scaleY*=n.scaleY,this.cropX=n.cropX,this.cropY=n.cropY,d.x+=n.offsetLeft,d.y+=n.offsetTop,this.width=n.width,this.height=n.height),this.setPositionByOrigin(d,"center","center")},clone:function(n,d){var g=this.toObject(d);this.constructor.fromObject?this.constructor.fromObject(g,n):r.Object._fromObject("Object",g,n)},cloneAsImage:function(n,d){var g=this.toCanvasElement(d);return n&&n(new r.Image(g)),this},toCanvasElement:function(n){n||(n={});var d=r.util,g=d.saveObjectTransform(this),v=this.group,_=this.shadow,b=Math.abs,C=(n.multiplier||1)*(n.enableRetinaScaling?r.devicePixelRatio:1);delete this.group,n.withoutTransform&&d.resetObjectTransform(this),n.withoutShadow&&(this.shadow=null);var S=r.util.createCanvasElement(),E=this.getBoundingRect(!0,!0),z=this.shadow,V,W={x:0,y:0},L,A,X;z&&(L=z.blur,z.nonScaling?V={scaleX:1,scaleY:1}:V=this.getObjectScaling(),W.x=2*Math.round(b(z.offsetX)+L)*b(V.scaleX),W.y=2*Math.round(b(z.offsetY)+L)*b(V.scaleY)),A=E.width+W.x,X=E.height+W.y,S.width=Math.ceil(A),S.height=Math.ceil(X);var B=new r.StaticCanvas(S,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});n.format==="jpeg"&&(B.backgroundColor="#fff"),this.setPositionByOrigin(new r.Point(B.width/2,B.height/2),"center","center");var st=this.canvas;B.add(this);var ht=B.toCanvasElement(C||1,n);return this.shadow=_,this.set("canvas",st),v&&(this.group=v),this.set(g).setCoords(),B._objects=[],B.dispose(),B=null,ht},toDataURL:function(n){return n||(n={}),r.util.toDataURL(this.toCanvasElement(n),n.format||"png",n.quality||1)},isType:function(n){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===n},complexity:function(){return 1},toJSON:function(n){return this.toObject(n)},rotate:function(n){var d=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return d&&this._setOriginToCenter(),this.set("angle",n),d&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(n,d){d=d||this.canvas.getPointer(n);var g=new r.Point(d.x,d.y),v=this._getLeftTopCoords();return this.angle&&(g=r.util.rotatePoint(g,v,e(-this.angle))),{x:g.x-v.x,y:g.y-v.y}},_setupCompositeOperation:function(n){this.globalCompositeOperation&&(n.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){r.runningAnimations&&r.runningAnimations.cancelByTarget(this)}}),r.util.createAccessors&&r.util.createAccessors(r.Object),a(r.Object.prototype,r.Observable),r.Object.NUM_FRACTION_DIGITS=2,r.Object.ENLIVEN_PROPS=["clipPath"],r.Object._fromObject=function(n,d,g,v){var _=r[n];d=l(d,!0),r.util.enlivenPatterns([d.fill,d.stroke],function(b){typeof b[0]!="undefined"&&(d.fill=b[0]),typeof b[1]!="undefined"&&(d.stroke=b[1]),r.util.enlivenObjectEnlivables(d,d,function(){var C=v?new _(d[v],d):new _(d);g&&g(C)})})},r.Object.__uid=0)}(c),function(){var u=t.util.degreesToRadians,r={left:-.5,center:0,right:.5},a={top:-.5,center:0,bottom:.5};t.util.object.extend(t.Object.prototype,{translateToGivenOrigin:function(l,i,s,e,o){var h=l.x,n=l.y,d,g,v;return typeof i=="string"?i=r[i]:i-=.5,typeof e=="string"?e=r[e]:e-=.5,d=e-i,typeof s=="string"?s=a[s]:s-=.5,typeof o=="string"?o=a[o]:o-=.5,g=o-s,(d||g)&&(v=this._getTransformedDimensions(),h=l.x+d*v.x,n=l.y+g*v.y),new t.Point(h,n)},translateToCenterPoint:function(l,i,s){var e=this.translateToGivenOrigin(l,i,s,"center","center");return this.angle?t.util.rotatePoint(e,l,u(this.angle)):e},translateToOriginPoint:function(l,i,s){var e=this.translateToGivenOrigin(l,"center","center",i,s);return this.angle?t.util.rotatePoint(e,l,u(this.angle)):e},getCenterPoint:function(){var l=new t.Point(this.left,this.top);return this.translateToCenterPoint(l,this.originX,this.originY)},getPointByOrigin:function(l,i){var s=this.getCenterPoint();return this.translateToOriginPoint(s,l,i)},toLocalPoint:function(l,i,s){var e=this.getCenterPoint(),o,h;return typeof i!="undefined"&&typeof s!="undefined"?o=this.translateToGivenOrigin(e,"center","center",i,s):o=new t.Point(this.left,this.top),h=new t.Point(l.x,l.y),this.angle&&(h=t.util.rotatePoint(h,e,-u(this.angle))),h.subtractEquals(o)},setPositionByOrigin:function(l,i,s){var e=this.translateToCenterPoint(l,i,s),o=this.translateToOriginPoint(e,this.originX,this.originY);this.set("left",o.x),this.set("top",o.y)},adjustPosition:function(l){var i=u(this.angle),s=this.getScaledWidth(),e=t.util.cos(i)*s,o=t.util.sin(i)*s,h,n;typeof this.originX=="string"?h=r[this.originX]:h=this.originX-.5,typeof l=="string"?n=r[l]:n=l-.5,this.left+=e*(n-h),this.top+=o*(n-h),this.setCoords(),this.originX=l},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var l=this.getCenterPoint();this.originX="center",this.originY="center",this.left=l.x,this.top=l.y},_resetOrigin:function(){var l=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=l.x,this.top=l.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function u(s){return[new t.Point(s.tl.x,s.tl.y),new t.Point(s.tr.x,s.tr.y),new t.Point(s.br.x,s.br.y),new t.Point(s.bl.x,s.bl.y)]}var r=t.util,a=r.degreesToRadians,l=r.multiplyTransformMatrices,i=r.transformPoint;r.object.extend(t.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(s,e){return e?s?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),s?this.aCoords:this.lineCoords)},getCoords:function(s,e){return u(this._getCoords(s,e))},intersectsWithRect:function(s,e,o,h){var n=this.getCoords(o,h),d=t.Intersection.intersectPolygonRectangle(n,s,e);return d.status==="Intersection"},intersectsWithObject:function(s,e,o){var h=t.Intersection.intersectPolygonPolygon(this.getCoords(e,o),s.getCoords(e,o));return h.status==="Intersection"||s.isContainedWithinObject(this,e,o)||this.isContainedWithinObject(s,e,o)},isContainedWithinObject:function(s,e,o){for(var h=this.getCoords(e,o),n=e?s.aCoords:s.lineCoords,d=0,g=s._getImageLines(n);d<4;d++)if(!s.containsPoint(h[d],g))return!1;return!0},isContainedWithinRect:function(s,e,o,h){var n=this.getBoundingRect(o,h);return n.left>=s.x&&n.left+n.width<=e.x&&n.top>=s.y&&n.top+n.height<=e.y},containsPoint:function(s,d,o,h){var n=this._getCoords(o,h),d=d||this._getImageLines(n),g=this._findCrossPoints(s,d);return g!==0&&g%2===1},isOnScreen:function(s){if(!this.canvas)return!1;var e=this.canvas.vptCoords.tl,o=this.canvas.vptCoords.br,h=this.getCoords(!0,s);return h.some(function(n){return n.x<=o.x&&n.x>=e.x&&n.y<=o.y&&n.y>=e.y})||this.intersectsWithRect(e,o,!0,s)?!0:this._containsCenterOfCanvas(e,o,s)},_containsCenterOfCanvas:function(s,e,o){var h={x:(s.x+e.x)/2,y:(s.y+e.y)/2};return!!this.containsPoint(h,null,!0,o)},isPartiallyOnScreen:function(s){if(!this.canvas)return!1;var e=this.canvas.vptCoords.tl,o=this.canvas.vptCoords.br;if(this.intersectsWithRect(e,o,!0,s))return!0;var h=this.getCoords(!0,s).every(function(n){return(n.x>=o.x||n.x<=e.x)&&(n.y>=o.y||n.y<=e.y)});return h&&this._containsCenterOfCanvas(e,o,s)},_getImageLines:function(s){var e={topline:{o:s.tl,d:s.tr},rightline:{o:s.tr,d:s.br},bottomline:{o:s.br,d:s.bl},leftline:{o:s.bl,d:s.tl}};return e},_findCrossPoints:function(s,e){var o,h,n,d,g,v=0,_;for(var b in e)if(_=e[b],!(_.o.y<s.y&&_.d.y<s.y)&&!(_.o.y>=s.y&&_.d.y>=s.y)&&(_.o.x===_.d.x&&_.o.x>=s.x?g=_.o.x:(o=0,h=(_.d.y-_.o.y)/(_.d.x-_.o.x),n=s.y-o*s.x,d=_.o.y-h*_.o.x,g=-(n-d)/(o-h)),g>=s.x&&(v+=1),v===2))break;return v},getBoundingRect:function(s,e){var o=this.getCoords(s,e);return r.makeBoundingBoxFromPoints(o)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(s){return Math.abs(s)<this.minScaleLimit?s<0?-this.minScaleLimit:this.minScaleLimit:s===0?1e-4:s},scale:function(s){return this._set("scaleX",s),this._set("scaleY",s),this.setCoords()},scaleToWidth:function(s,e){var o=this.getBoundingRect(e).width/this.getScaledWidth();return this.scale(s/this.width/o)},scaleToHeight:function(s,e){var o=this.getBoundingRect(e).height/this.getScaledHeight();return this.scale(s/this.height/o)},calcLineCoords:function(){var s=this.getViewportTransform(),e=this.padding,o=a(this.angle),h=r.cos(o),n=r.sin(o),d=h*e,g=n*e,v=d+g,_=d-g,b=this.calcACoords(),C={tl:i(b.tl,s),tr:i(b.tr,s),bl:i(b.bl,s),br:i(b.br,s)};return e&&(C.tl.x-=_,C.tl.y-=v,C.tr.x+=v,C.tr.y-=_,C.bl.x-=v,C.bl.y+=_,C.br.x+=_,C.br.y+=v),C},calcOCoords:function(){var s=this._calcRotateMatrix(),e=this._calcTranslateMatrix(),o=this.getViewportTransform(),h=l(o,e),n=l(h,s),n=l(n,[1/o[0],0,0,1/o[3],0,0]),d=this._calculateCurrentDimensions(),g={};return this.forEachControl(function(v,_,b){g[_]=v.positionHandler(d,n,b)}),g},calcACoords:function(){var s=this._calcRotateMatrix(),e=this._calcTranslateMatrix(),o=l(e,s),h=this._getTransformedDimensions(),n=h.x/2,d=h.y/2;return{tl:i({x:-n,y:-d},o),tr:i({x:n,y:-d},o),bl:i({x:-n,y:d},o),br:i({x:n,y:d},o)}},setCoords:function(s){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),s?this:(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords(),this)},_calcRotateMatrix:function(){return r.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var s=this.getCenterPoint();return[1,0,0,1,s.x,s.y]},transformMatrixKey:function(s){var e="_",o="";return!s&&this.group&&(o=this.group.transformMatrixKey(s)+e),o+this.top+e+this.left+e+this.scaleX+e+this.scaleY+e+this.skewX+e+this.skewY+e+this.angle+e+this.originX+e+this.originY+e+this.width+e+this.height+e+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(s){var e=this.calcOwnMatrix();if(s||!this.group)return e;var o=this.transformMatrixKey(s),h=this.matrixCache||(this.matrixCache={});return h.key===o?h.value:(this.group&&(e=l(this.group.calcTransformMatrix(!1),e)),h.key=o,h.value=e,e)},calcOwnMatrix:function(){var s=this.transformMatrixKey(!0),e=this.ownMatrixCache||(this.ownMatrixCache={});if(e.key===s)return e.value;var o=this._calcTranslateMatrix(),h={angle:this.angle,translateX:o[4],translateY:o[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return e.key=s,e.value=r.composeMatrix(h),e.value},_getNonTransformedDimensions:function(){var s=this.strokeWidth,e=this.width+s,o=this.height+s;return{x:e,y:o}},_getTransformedDimensions:function(s,e){typeof s=="undefined"&&(s=this.skewX),typeof e=="undefined"&&(e=this.skewY);var o,h,n,d=s===0&&e===0;if(this.strokeUniform?(h=this.width,n=this.height):(o=this._getNonTransformedDimensions(),h=o.x,n=o.y),d)return this._finalizeDimensions(h*this.scaleX,n*this.scaleY);var g=r.sizeAfterTransform(h,n,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:s,skewY:e});return this._finalizeDimensions(g.x,g.y)},_finalizeDimensions:function(s,e){return this.strokeUniform?{x:s+this.strokeWidth,y:e+this.strokeWidth}:{x:s,y:e}},_calculateCurrentDimensions:function(){var s=this.getViewportTransform(),e=this._getTransformedDimensions(),o=i(e,s,!0);return o.scalarAdd(2*this.padding)}})}(),t.util.object.extend(t.Object.prototype,{sendToBack:function(){return this.group?t.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?t.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(u){return this.group?t.StaticCanvas.prototype.sendBackwards.call(this.group,this,u):this.canvas&&this.canvas.sendBackwards(this,u),this},bringForward:function(u){return this.group?t.StaticCanvas.prototype.bringForward.call(this.group,this,u):this.canvas&&this.canvas.bringForward(this,u),this},moveTo:function(u){return this.group&&this.group.type!=="activeSelection"?t.StaticCanvas.prototype.moveTo.call(this.group,this,u):this.canvas&&this.canvas.moveTo(this,u),this}}),function(){function u(a,l){if(l){if(l.toLive)return a+": url(#SVGID_"+l.id+"); ";var i=new t.Color(l),s=a+": "+i.toRgb()+"; ",e=i.getAlpha();return e!==1&&(s+=a+"-opacity: "+e.toString()+"; "),s}else return a+": none; "}var r=t.util.toFixed;t.util.object.extend(t.Object.prototype,{getSvgStyles:function(a){var l=this.fillRule?this.fillRule:"nonzero",i=this.strokeWidth?this.strokeWidth:"0",s=this.strokeDashArray?this.strokeDashArray.join(" "):"none",e=this.strokeDashOffset?this.strokeDashOffset:"0",o=this.strokeLineCap?this.strokeLineCap:"butt",h=this.strokeLineJoin?this.strokeLineJoin:"miter",n=this.strokeMiterLimit?this.strokeMiterLimit:"4",d=typeof this.opacity!="undefined"?this.opacity:"1",g=this.visible?"":" visibility: hidden;",v=a?"":this.getSvgFilter(),_=u("fill",this.fill),b=u("stroke",this.stroke);return[b,"stroke-width: ",i,"; ","stroke-dasharray: ",s,"; ","stroke-linecap: ",o,"; ","stroke-dashoffset: ",e,"; ","stroke-linejoin: ",h,"; ","stroke-miterlimit: ",n,"; ",_,"fill-rule: ",l,"; ","opacity: ",d,";",v,g].join("")},getSvgSpanStyles:function(a,l){var i="; ",e=a.fontFamily?"font-family: "+(a.fontFamily.indexOf("'")===-1&&a.fontFamily.indexOf('"')===-1?"'"+a.fontFamily+"'":a.fontFamily)+i:"",s=a.strokeWidth?"stroke-width: "+a.strokeWidth+i:"",e=e,o=a.fontSize?"font-size: "+a.fontSize+"px"+i:"",h=a.fontStyle?"font-style: "+a.fontStyle+i:"",n=a.fontWeight?"font-weight: "+a.fontWeight+i:"",d=a.fill?u("fill",a.fill):"",g=a.stroke?u("stroke",a.stroke):"",v=this.getSvgTextDecoration(a),_=a.deltaY?"baseline-shift: "+-a.deltaY+"; ":"";return v&&(v="text-decoration: "+v+i),[g,s,e,o,h,n,v,d,_,l?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(a){return["overline","underline","line-through"].filter(function(l){return a[l.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(a,l){var i=a?this.calcTransformMatrix():this.calcOwnMatrix(),s='transform="'+t.util.matrixToSVG(i);return s+(l||"")+'" '},_setSVGBg:function(a){if(this.backgroundColor){var l=t.Object.NUM_FRACTION_DIGITS;a.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',r(-this.width/2,l),'" y="',r(-this.height/2,l),'" width="',r(this.width,l),'" height="',r(this.height,l),`"></rect>
`)}},toSVG:function(a){return this._createBaseSVGMarkup(this._toSVG(a),{reviver:a})},toClipPathSVG:function(a){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(a),{reviver:a})},_createBaseClipPathSVGMarkup:function(a,l){l=l||{};var i=l.reviver,s=l.additionalTransform||"",e=[this.getSvgTransform(!0,s),this.getSvgCommons()].join(""),o=a.indexOf("COMMON_PARTS");return a[o]=e,i?i(a.join("")):a.join("")},_createBaseSVGMarkup:function(a,l){l=l||{};var i=l.noStyle,s=l.reviver,e=i?"":'style="'+this.getSvgStyles()+'" ',o=l.withShadow?'style="'+this.getSvgFilter()+'" ':"",h=this.clipPath,n=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",d=h&&h.absolutePositioned,g=this.stroke,v=this.fill,_=this.shadow,b,C=[],S,E=a.indexOf("COMMON_PARTS"),z=l.additionalTransform;return h&&(h.clipPathId="CLIPPATH_"+t.Object.__uid++,S='<clipPath id="'+h.clipPathId+`" >
`+h.toClipPathSVG(s)+`</clipPath>
`),d&&C.push("<g ",o,this.getSvgCommons(),` >
`),C.push("<g ",this.getSvgTransform(!1),d?"":o+this.getSvgCommons(),` >
`),b=[e,n,i?"":this.addPaintOrder()," ",z?'transform="'+z+'" ':""].join(""),a[E]=b,v&&v.toLive&&C.push(v.toSVG(this)),g&&g.toLive&&C.push(g.toSVG(this)),_&&C.push(_.toSVG(this)),h&&C.push(S),C.push(a.join("")),C.push(`</g>
`),d&&C.push(`</g>
`),s?s(C.join("")):C.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var u=t.util.object.extend,r="stateProperties";function a(i,s,e){var o={},h=!0;e.forEach(function(n){o[n]=i[n]}),u(i[s],o,h)}function l(i,s,e){if(i===s)return!0;if(Array.isArray(i)){if(!Array.isArray(s)||i.length!==s.length)return!1;for(var o=0,h=i.length;o<h;o++)if(!l(i[o],s[o]))return!1;return!0}else if(i&&typeof i=="object"){var n=Object.keys(i),d;if(!s||typeof s!="object"||!e&&n.length!==Object.keys(s).length)return!1;for(var o=0,h=n.length;o<h;o++)if(d=n[o],!(d==="canvas"||d==="group")&&!l(i[d],s[d]))return!1;return!0}}t.util.object.extend(t.Object.prototype,{hasStateChanged:function(i){i=i||r;var s="_"+i;return Object.keys(this[s]).length<this[i].length?!0:!l(this[s],this,!0)},saveState:function(i){var s=i&&i.propertySet||r,e="_"+s;return this[e]?(a(this,e,this[s]),i&&i.stateProperties&&a(this,e,i.stateProperties),this):this.setupState(i)},setupState:function(i){i=i||{};var s=i.propertySet||r;return i.propertySet=s,this["_"+s]={},this.saveState(i),this}})}(),function(){var u=t.util.degreesToRadians;t.util.object.extend(t.Object.prototype,{_findTargetCorner:function(r,a){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var l=r.x,i=r.y,s,e,o=Object.keys(this.oCoords),h=o.length-1,n;for(this.__corner=0;h>=0;h--)if(n=o[h],!!this.isControlVisible(n)&&(e=this._getImageLines(a?this.oCoords[n].touchCorner:this.oCoords[n].corner),s=this._findCrossPoints({x:l,y:i},e),s!==0&&s%2===1))return this.__corner=n,n;return!1},forEachControl:function(r){for(var a in this.controls)r(this.controls[a],a,this)},_setCornerCoords:function(){var r=this.oCoords;for(var a in r){var l=this.controls[a];r[a].corner=l.calcCornerCoords(this.angle,this.cornerSize,r[a].x,r[a].y,!1),r[a].touchCorner=l.calcCornerCoords(this.angle,this.touchCornerSize,r[a].x,r[a].y,!0)}},drawSelectionBackground:function(r){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;r.save();var a=this.getCenterPoint(),l=this._calculateCurrentDimensions(),i=this.canvas.viewportTransform;return r.translate(a.x,a.y),r.scale(1/i[0],1/i[3]),r.rotate(u(this.angle)),r.fillStyle=this.selectionBackgroundColor,r.fillRect(-l.x/2,-l.y/2,l.x,l.y),r.restore(),this},drawBorders:function(r,a){a=a||{};var l=this._calculateCurrentDimensions(),i=this.borderScaleFactor,s=l.x+i,e=l.y+i,o=typeof a.hasControls!="undefined"?a.hasControls:this.hasControls,h=!1;return r.save(),r.strokeStyle=a.borderColor||this.borderColor,this._setLineDash(r,a.borderDashArray||this.borderDashArray),r.strokeRect(-s/2,-e/2,s,e),o&&(r.beginPath(),this.forEachControl(function(n,d,g){n.withConnection&&n.getVisibility(g,d)&&(h=!0,r.moveTo(n.x*s,n.y*e),r.lineTo(n.x*s+n.offsetX,n.y*e+n.offsetY))}),h&&r.stroke()),r.restore(),this},drawBordersInGroup:function(r,a,l){l=l||{};var i=t.util.sizeAfterTransform(this.width,this.height,a),s=this.strokeWidth,e=this.strokeUniform,o=this.borderScaleFactor,h=i.x+s*(e?this.canvas.getZoom():a.scaleX)+o,n=i.y+s*(e?this.canvas.getZoom():a.scaleY)+o;return r.save(),this._setLineDash(r,l.borderDashArray||this.borderDashArray),r.strokeStyle=l.borderColor||this.borderColor,r.strokeRect(-h/2,-n/2,h,n),r.restore(),this},drawControls:function(r,a){a=a||{},r.save();var l=this.canvas.getRetinaScaling(),i,s;return r.setTransform(l,0,0,l,0,0),r.strokeStyle=r.fillStyle=a.cornerColor||this.cornerColor,this.transparentCorners||(r.strokeStyle=a.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(r,a.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(i=this.group.calcTransformMatrix()),this.forEachControl(function(e,o,h){s=h.oCoords[o],e.getVisibility(h,o)&&(i&&(s=t.util.transformPoint(s,i)),e.render(r,s.x,s.y,a,h))}),r.restore(),this},isControlVisible:function(r){return this.controls[r]&&this.controls[r].getVisibility(this,r)},setControlVisible:function(r,a){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[r]=a,this},setControlsVisibility:function(r){r||(r={});for(var a in r)this.setControlVisible(a,r[a]);return this},onDeselect:function(){},onSelect:function(){}})}(),t.util.object.extend(t.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(u,r){r=r||{};var a=function(){},l=r.onComplete||a,i=r.onChange||a,s=this;return t.util.animate({target:this,startValue:u.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(e){u.set("left",e),s.requestRenderAll(),i()},onComplete:function(){u.setCoords(),l()}})},fxCenterObjectV:function(u,r){r=r||{};var a=function(){},l=r.onComplete||a,i=r.onChange||a,s=this;return t.util.animate({target:this,startValue:u.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(e){u.set("top",e),s.requestRenderAll(),i()},onComplete:function(){u.setCoords(),l()}})},fxRemove:function(u,r){r=r||{};var a=function(){},l=r.onComplete||a,i=r.onChange||a,s=this;return t.util.animate({target:this,startValue:u.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(e){u.set("opacity",e),s.requestRenderAll(),i()},onComplete:function(){s.remove(u),l()}})}}),t.util.object.extend(t.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var u=[],r,a,l=[];for(r in arguments[0])u.push(r);for(var i=0,s=u.length;i<s;i++)r=u[i],a=i!==s-1,l.push(this._animate(r,arguments[0][r],arguments[1],a));return l}else return this._animate.apply(this,arguments)},_animate:function(u,r,a,l){var i=this,s;r=r.toString(),a?a=t.util.object.clone(a):a={},~u.indexOf(".")&&(s=u.split("."));var e=i.colorProperties.indexOf(u)>-1||s&&i.colorProperties.indexOf(s[1])>-1,o=s?this.get(s[0])[s[1]]:this.get(u);"from"in a||(a.from=o),e||(~r.indexOf("=")?r=o+parseFloat(r.replace("=","")):r=parseFloat(r));var h={target:this,startValue:a.from,endValue:r,byValue:a.by,easing:a.easing,duration:a.duration,abort:a.abort&&function(n,d,g){return a.abort.call(i,n,d,g)},onChange:function(n,d,g){s?i[s[0]][s[1]]=n:i.set(u,n),!l&&a.onChange&&a.onChange(n,d,g)},onComplete:function(n,d,g){l||(i.setCoords(),a.onComplete&&a.onComplete(n,d,g))}};return e?t.util.animateColor(h.startValue,h.endValue,h.duration,h):t.util.animate(h)}}),function(u){var r=u.fabric||(u.fabric={}),a=r.util.object.extend,l=r.util.object.clone,i={x1:1,x2:1,y1:1,y2:1};if(r.Line){r.warn("fabric.Line is already defined");return}r.Line=r.util.createClass(r.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:r.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(e,o){e||(e=[0,0,0,0]),this.callSuper("initialize",o),this.set("x1",e[0]),this.set("y1",e[1]),this.set("x2",e[2]),this.set("y2",e[3]),this._setWidthHeight(o)},_setWidthHeight:function(e){e||(e={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in e?e.left:this._getLeftToOriginX(),this.top="top"in e?e.top:this._getTopToOriginY()},_set:function(e,o){return this.callSuper("_set",e,o),typeof i[e]!="undefined"&&this._setWidthHeight(),this},_getLeftToOriginX:s({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:s({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(e){e.beginPath();var o=this.calcLinePoints();e.moveTo(o.x1,o.y1),e.lineTo(o.x2,o.y2),e.lineWidth=this.strokeWidth;var h=e.strokeStyle;e.strokeStyle=this.stroke||e.fillStyle,this.stroke&&this._renderStroke(e),e.strokeStyle=h},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(e){return a(this.callSuper("toObject",e),this.calcLinePoints())},_getNonTransformedDimensions:function(){var e=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(e.y-=this.strokeWidth),this.height===0&&(e.x-=this.strokeWidth)),e},calcLinePoints:function(){var e=this.x1<=this.x2?-1:1,o=this.y1<=this.y2?-1:1,h=e*this.width*.5,n=o*this.height*.5,d=e*this.width*-.5,g=o*this.height*-.5;return{x1:h,x2:d,y1:n,y2:g}},_toSVG:function(){var e=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',e.x1,'" y1="',e.y1,'" x2="',e.x2,'" y2="',e.y2,`" />
`]}}),r.Line.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),r.Line.fromElement=function(e,o,h){h=h||{};var n=r.parseAttributes(e,r.Line.ATTRIBUTE_NAMES),d=[n.x1||0,n.y1||0,n.x2||0,n.y2||0];o(new r.Line(d,a(n,h)))},r.Line.fromObject=function(e,o){function h(d){delete d.points,o&&o(d)}var n=l(e,!0);n.points=[e.x1,e.y1,e.x2,e.y2],r.Object._fromObject("Line",n,h,"points")};function s(e,o){var h=e.origin,n=e.axis1,d=e.axis2,g=e.dimension,v=o.nearest,_=o.center,b=o.farthest;return function(){switch(this.get(h)){case v:return Math.min(this.get(n),this.get(d));case _:return Math.min(this.get(n),this.get(d))+.5*this.get(g);case b:return Math.max(this.get(n),this.get(d))}}}}(c),function(u){var r=u.fabric||(u.fabric={}),a=r.util.degreesToRadians;if(r.Circle){r.warn("fabric.Circle is already defined.");return}r.Circle=r.util.createClass(r.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:r.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(i,s){return this.callSuper("_set",i,s),i==="radius"&&this.setRadius(s),this},toObject:function(i){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(i))},_toSVG:function(){var i,s=0,e=0,o=(this.endAngle-this.startAngle)%360;if(o===0)i=["<circle ","COMMON_PARTS",'cx="'+s+'" cy="'+e+'" ','r="',this.radius,`" />
`];else{var h=a(this.startAngle),n=a(this.endAngle),d=this.radius,g=r.util.cos(h)*d,v=r.util.sin(h)*d,_=r.util.cos(n)*d,b=r.util.sin(n)*d,C=o>180?"1":"0";i=['<path d="M '+g+" "+v," A "+d+" "+d," 0 ",+C+" 1"," "+_+" "+b,'" ',"COMMON_PARTS",` />
`]}return i},_render:function(i){i.beginPath(),i.arc(0,0,this.radius,a(this.startAngle),a(this.endAngle),!1),this._renderPaintInOrder(i)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(i){return this.radius=i,this.set("width",i*2).set("height",i*2)}}),r.Circle.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),r.Circle.fromElement=function(i,s){var e=r.parseAttributes(i,r.Circle.ATTRIBUTE_NAMES);if(!l(e))throw new Error("value of `r` attribute is required and can not be negative");e.left=(e.left||0)-e.radius,e.top=(e.top||0)-e.radius,s(new r.Circle(e))};function l(i){return"radius"in i&&i.radius>=0}r.Circle.fromObject=function(i,s){r.Object._fromObject("Circle",i,s)}}(c),function(u){var r=u.fabric||(u.fabric={});if(r.Triangle){r.warn("fabric.Triangle is already defined");return}r.Triangle=r.util.createClass(r.Object,{type:"triangle",width:100,height:100,_render:function(a){var l=this.width/2,i=this.height/2;a.beginPath(),a.moveTo(-l,i),a.lineTo(0,-i),a.lineTo(l,i),a.closePath(),this._renderPaintInOrder(a)},_toSVG:function(){var a=this.width/2,l=this.height/2,i=[-a+" "+l,"0 "+-l,a+" "+l].join(",");return["<polygon ","COMMON_PARTS",'points="',i,'" />']}}),r.Triangle.fromObject=function(a,l){return r.Object._fromObject("Triangle",a,l)}}(c),function(u){var r=u.fabric||(u.fabric={}),a=Math.PI*2;if(r.Ellipse){r.warn("fabric.Ellipse is already defined.");return}r.Ellipse=r.util.createClass(r.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:r.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(l){this.callSuper("initialize",l),this.set("rx",l&&l.rx||0),this.set("ry",l&&l.ry||0)},_set:function(l,i){switch(this.callSuper("_set",l,i),l){case"rx":this.rx=i,this.set("width",i*2);break;case"ry":this.ry=i,this.set("height",i*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(l){return this.callSuper("toObject",["rx","ry"].concat(l))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(l){l.beginPath(),l.save(),l.transform(1,0,0,this.ry/this.rx,0,0),l.arc(0,0,this.rx,0,a,!1),l.restore(),this._renderPaintInOrder(l)}}),r.Ellipse.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),r.Ellipse.fromElement=function(l,i){var s=r.parseAttributes(l,r.Ellipse.ATTRIBUTE_NAMES);s.left=(s.left||0)-s.rx,s.top=(s.top||0)-s.ry,i(new r.Ellipse(s))},r.Ellipse.fromObject=function(l,i){r.Object._fromObject("Ellipse",l,i)}}(c),function(u){var r=u.fabric||(u.fabric={}),a=r.util.object.extend;if(r.Rect){r.warn("fabric.Rect is already defined");return}r.Rect=r.util.createClass(r.Object,{stateProperties:r.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:r.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(l){this.callSuper("initialize",l),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(l){var i=this.rx?Math.min(this.rx,this.width/2):0,s=this.ry?Math.min(this.ry,this.height/2):0,e=this.width,o=this.height,h=-this.width/2,n=-this.height/2,d=i!==0||s!==0,g=1-.5522847498;l.beginPath(),l.moveTo(h+i,n),l.lineTo(h+e-i,n),d&&l.bezierCurveTo(h+e-g*i,n,h+e,n+g*s,h+e,n+s),l.lineTo(h+e,n+o-s),d&&l.bezierCurveTo(h+e,n+o-g*s,h+e-g*i,n+o,h+e-i,n+o),l.lineTo(h+i,n+o),d&&l.bezierCurveTo(h+g*i,n+o,h,n+o-g*s,h,n+o-s),l.lineTo(h,n+s),d&&l.bezierCurveTo(h,n+g*s,h+g*i,n,h+i,n),l.closePath(),this._renderPaintInOrder(l)},toObject:function(l){return this.callSuper("toObject",["rx","ry"].concat(l))},_toSVG:function(){var l=-this.width/2,i=-this.height/2;return["<rect ","COMMON_PARTS",'x="',l,'" y="',i,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),r.Rect.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),r.Rect.fromElement=function(l,i,s){if(!l)return i(null);s=s||{};var e=r.parseAttributes(l,r.Rect.ATTRIBUTE_NAMES);e.left=e.left||0,e.top=e.top||0,e.height=e.height||0,e.width=e.width||0;var o=new r.Rect(a(s?r.util.object.clone(s):{},e));o.visible=o.visible&&o.width>0&&o.height>0,i(o)},r.Rect.fromObject=function(l,i){return r.Object._fromObject("Rect",l,i)}}(c),function(u){var r=u.fabric||(u.fabric={}),a=r.util.object.extend,l=r.util.array.min,i=r.util.array.max,s=r.util.toFixed,e=r.util.projectStrokeOnPoints;if(r.Polyline){r.warn("fabric.Polyline is already defined");return}r.Polyline=r.util.createClass(r.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:r.Object.prototype.cacheProperties.concat("points"),initialize:function(o,h){h=h||{},this.points=o||[],this.callSuper("initialize",h),this._setPositionDimensions(h)},_projectStrokeOnPoints:function(){return e(this.points,this,!0)},_setPositionDimensions:function(o){var h=this._calcDimensions(o),n,d=this.exactBoundingBox?this.strokeWidth:0;this.width=h.width-d,this.height=h.height-d,o.fromSVG||(n=this.translateToGivenOrigin({x:h.left-this.strokeWidth/2+d/2,y:h.top-this.strokeWidth/2+d/2},"left","top",this.originX,this.originY)),typeof o.left=="undefined"&&(this.left=o.fromSVG?h.left:n.x),typeof o.top=="undefined"&&(this.top=o.fromSVG?h.top:n.y),this.pathOffset={x:h.left+this.width/2+d/2,y:h.top+this.height/2+d/2}},_calcDimensions:function(){var o=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,h=l(o,"x")||0,n=l(o,"y")||0,d=i(o,"x")||0,g=i(o,"y")||0,v=d-h,_=g-n;return{left:h,top:n,width:v,height:_}},toObject:function(o){return a(this.callSuper("toObject",o),{points:this.points.concat()})},_toSVG:function(){for(var o=[],h=this.pathOffset.x,n=this.pathOffset.y,d=r.Object.NUM_FRACTION_DIGITS,g=0,v=this.points.length;g<v;g++)o.push(s(this.points[g].x-h,d),",",s(this.points[g].y-n,d)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',o.join(""),`" />
`]},commonRender:function(o){var h,n=this.points.length,d=this.pathOffset.x,g=this.pathOffset.y;if(!n||isNaN(this.points[n-1].y))return!1;o.beginPath(),o.moveTo(this.points[0].x-d,this.points[0].y-g);for(var v=0;v<n;v++)h=this.points[v],o.lineTo(h.x-d,h.y-g);return!0},_render:function(o){this.commonRender(o)&&this._renderPaintInOrder(o)},complexity:function(){return this.get("points").length}}),r.Polyline.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat(),r.Polyline.fromElementGenerator=function(o){return function(h,n,d){if(!h)return n(null);d||(d={});var g=r.parsePointsAttribute(h.getAttribute("points")),v=r.parseAttributes(h,r[o].ATTRIBUTE_NAMES);v.fromSVG=!0,n(new r[o](g,a(v,d)))}},r.Polyline.fromElement=r.Polyline.fromElementGenerator("Polyline"),r.Polyline.fromObject=function(o,h){return r.Object._fromObject("Polyline",o,h,"points")}}(c),function(u){var r=u.fabric||(u.fabric={}),a=r.util.projectStrokeOnPoints;if(r.Polygon){r.warn("fabric.Polygon is already defined");return}r.Polygon=r.util.createClass(r.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return a(this.points,this)},_render:function(l){this.commonRender(l)&&(l.closePath(),this._renderPaintInOrder(l))}}),r.Polygon.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat(),r.Polygon.fromElement=r.Polyline.fromElementGenerator("Polygon"),r.Polygon.fromObject=function(l,i){r.Object._fromObject("Polygon",l,i,"points")}}(c),function(u){var r=u.fabric||(u.fabric={}),a=r.util.array.min,l=r.util.array.max,i=r.util.object.extend,s=r.util.object.clone,e=r.util.toFixed;if(r.Path){r.warn("fabric.Path is already defined");return}r.Path=r.util.createClass(r.Object,{type:"path",path:null,cacheProperties:r.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:r.Object.prototype.stateProperties.concat("path"),initialize:function(o,h){h=s(h||{}),delete h.path,this.callSuper("initialize",h),this._setPath(o||[],h)},_setPath:function(o,h){this.path=r.util.makePathSimpler(Array.isArray(o)?o:r.util.parsePath(o)),r.Polyline.prototype._setPositionDimensions.call(this,h||{})},_renderPathCommands:function(o){var h,n=0,d=0,g=0,v=0,_=0,b=0,C=-this.pathOffset.x,S=-this.pathOffset.y;o.beginPath();for(var E=0,z=this.path.length;E<z;++E)switch(h=this.path[E],h[0]){case"L":g=h[1],v=h[2],o.lineTo(g+C,v+S);break;case"M":g=h[1],v=h[2],n=g,d=v,o.moveTo(g+C,v+S);break;case"C":g=h[5],v=h[6],_=h[3],b=h[4],o.bezierCurveTo(h[1]+C,h[2]+S,_+C,b+S,g+C,v+S);break;case"Q":o.quadraticCurveTo(h[1]+C,h[2]+S,h[3]+C,h[4]+S),g=h[3],v=h[4],_=h[1],b=h[2];break;case"z":case"Z":g=n,v=d,o.closePath();break}},_render:function(o){this._renderPathCommands(o),this._renderPaintInOrder(o)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(o){return i(this.callSuper("toObject",o),{path:this.path.map(function(h){return h.slice()})})},toDatalessObject:function(o){var h=this.toObject(["sourcePath"].concat(o));return h.sourcePath&&delete h.path,h},_toSVG:function(){var o=r.util.joinPath(this.path);return["<path ","COMMON_PARTS",'d="',o,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var o=r.Object.NUM_FRACTION_DIGITS;return" translate("+e(-this.pathOffset.x,o)+", "+e(-this.pathOffset.y,o)+")"},toClipPathSVG:function(o){var h=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:o,additionalTransform:h})},toSVG:function(o){var h=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:o,additionalTransform:h})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var o=[],h=[],n,d=0,g=0,v=0,_=0,b,C=0,S=this.path.length;C<S;++C){switch(n=this.path[C],n[0]){case"L":v=n[1],_=n[2],b=[];break;case"M":v=n[1],_=n[2],d=v,g=_,b=[];break;case"C":b=r.util.getBoundsOfCurve(v,_,n[1],n[2],n[3],n[4],n[5],n[6]),v=n[5],_=n[6];break;case"Q":b=r.util.getBoundsOfCurve(v,_,n[1],n[2],n[1],n[2],n[3],n[4]),v=n[3],_=n[4];break;case"z":case"Z":v=d,_=g;break}b.forEach(function(X){o.push(X.x),h.push(X.y)}),o.push(v),h.push(_)}var E=a(o)||0,z=a(h)||0,V=l(o)||0,W=l(h)||0,L=V-E,A=W-z;return{left:E,top:z,width:L,height:A}}}),r.Path.fromObject=function(o,h){if(typeof o.sourcePath=="string"){var n=o.sourcePath;r.loadSVGFromURL(n,function(d){var g=d[0];g.setOptions(o),o.clipPath?r.util.enlivenObjects([o.clipPath],function(v){g.clipPath=v[0],h&&h(g)}):h&&h(g)})}else r.Object._fromObject("Path",o,h,"path")},r.Path.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat(["d"]),r.Path.fromElement=function(o,h,n){var d=r.parseAttributes(o,r.Path.ATTRIBUTE_NAMES);d.fromSVG=!0,h(new r.Path(d.d,i(d,n)))}}(c),function(u){var r=u.fabric||(u.fabric={}),a=r.util.array.min,l=r.util.array.max;r.Group||(r.Group=r.util.createClass(r.Object,r.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(i,s,e){s=s||{},this._objects=[],e&&this.callSuper("initialize",s),this._objects=i||[];for(var o=this._objects.length;o--;)this._objects[o].group=this;if(e)this._updateObjectsACoords();else{var h=s&&s.centerPoint;s.originX!==void 0&&(this.originX=s.originX),s.originY!==void 0&&(this.originY=s.originY),h||this._calcBounds(),this._updateObjectsCoords(h),delete s.centerPoint,this.callSuper("initialize",s)}this.setCoords()},_updateObjectsACoords:function(){for(var i=!0,s=this._objects.length;s--;)this._objects[s].setCoords(i)},_updateObjectsCoords:function(s){for(var s=s||this.getCenterPoint(),e=this._objects.length;e--;)this._updateObjectCoords(this._objects[e],s)},_updateObjectCoords:function(i,s){var e=i.left,o=i.top,h=!0;i.set({left:e-s.x,top:o-s.y}),i.group=this,i.setCoords(h)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(i){var s=!!this.group;return this._restoreObjectsState(),r.util.resetObjectTransform(this),i&&(s&&r.util.removeTransformFromObject(i,this.group.calcTransformMatrix()),this._objects.push(i),i.group=this,i._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,s?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(i){return this._restoreObjectsState(),r.util.resetObjectTransform(this),this.remove(i),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(i){this.dirty=!0,i.group=this,i._set("canvas",this.canvas)},_onObjectRemoved:function(i){this.dirty=!0,delete i.group},_set:function(i,s){var e=this._objects.length;if(this.useSetOnGroup)for(;e--;)this._objects[e].setOnGroup(i,s);if(i==="canvas")for(;e--;)this._objects[e]._set(i,s);r.Object.prototype._set.call(this,i,s)},toObject:function(i){var s=this.includeDefaultValues,e=this._objects.filter(function(h){return!h.excludeFromExport}).map(function(h){var n=h.includeDefaultValues;h.includeDefaultValues=s;var d=h.toObject(i);return h.includeDefaultValues=n,d}),o=r.Object.prototype.toObject.call(this,i);return o.objects=e,o},toDatalessObject:function(i){var s,e=this.sourcePath;if(e)s=e;else{var o=this.includeDefaultValues;s=this._objects.map(function(n){var d=n.includeDefaultValues;n.includeDefaultValues=o;var g=n.toDatalessObject(i);return n.includeDefaultValues=d,g})}var h=r.Object.prototype.toDatalessObject.call(this,i);return h.objects=s,h},render:function(i){this._transformDone=!0,this.callSuper("render",i),this._transformDone=!1},shouldCache:function(){var i=r.Object.prototype.shouldCache.call(this);if(i){for(var s=0,e=this._objects.length;s<e;s++)if(this._objects[s].willDrawShadow())return this.ownCaching=!1,!1}return i},willDrawShadow:function(){if(r.Object.prototype.willDrawShadow.call(this))return!0;for(var i=0,s=this._objects.length;i<s;i++)if(this._objects[i].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(i){for(var s=0,e=this._objects.length;s<e;s++)this._objects[s].render(i);this._drawClipPath(i,this.clipPath)},isCacheDirty:function(i){if(this.callSuper("isCacheDirty",i))return!0;if(!this.statefullCache)return!1;for(var s=0,e=this._objects.length;s<e;s++)if(this._objects[s].isCacheDirty(!0)){if(this._cacheCanvas){var o=this.cacheWidth/this.zoomX,h=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-o/2,-h/2,o,h)}return!0}return!1},_restoreObjectsState:function(){var i=this.calcOwnMatrix();return this._objects.forEach(function(s){r.util.addTransformToObject(s,i),delete s.group,s.setCoords()}),this},destroy:function(){return this._objects.forEach(function(i){i.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(i){i.dispose&&i.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var i=this._objects,s=this.canvas;this._objects=[];var e=this.toObject();delete e.objects;var o=new r.ActiveSelection([]);return o.set(e),o.type="activeSelection",s.remove(this),i.forEach(function(h){h.group=o,h.dirty=!0,s.add(h)}),o.canvas=s,o._objects=i,s._activeObject=o,o.setCoords(),o}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var i=!0;return this.forEachObject(function(s){s.setCoords(i)}),this},_calcBounds:function(i){for(var s=[],e=[],o,h,n,d=["tr","br","bl","tl"],g=0,v=this._objects.length,_,b=d.length;g<v;++g){for(o=this._objects[g],n=o.calcACoords(),_=0;_<b;_++)h=d[_],s.push(n[h].x),e.push(n[h].y);o.aCoords=n}this._getBounds(s,e,i)},_getBounds:function(i,s,e){var o=new r.Point(a(i),a(s)),h=new r.Point(l(i),l(s)),n=o.y||0,d=o.x||0,g=h.x-o.x||0,v=h.y-o.y||0;this.width=g,this.height=v,e||this.setPositionByOrigin({x:d,y:n},"left","top")},_toSVG:function(i){for(var s=["<g ","COMMON_PARTS",` >
`],e=0,o=this._objects.length;e<o;e++)s.push("		",this._objects[e].toSVG(i));return s.push(`</g>
`),s},getSvgStyles:function(){var i=typeof this.opacity!="undefined"&&this.opacity!==1?"opacity: "+this.opacity+";":"",s=this.visible?"":" visibility: hidden;";return[i,this.getSvgFilter(),s].join("")},toClipPathSVG:function(i){for(var s=[],e=0,o=this._objects.length;e<o;e++)s.push("	",this._objects[e].toClipPathSVG(i));return this._createBaseClipPathSVGMarkup(s,{reviver:i})}}),r.Group.fromObject=function(i,s){var e=i.objects,o=r.util.object.clone(i,!0);if(delete o.objects,typeof e=="string"){r.loadSVGFromURL(e,function(h){var n=r.util.groupSVGElements(h,i,e),d=o.clipPath;delete o.clipPath,n.set(o),d?r.util.enlivenObjects([d],function(g){n.clipPath=g[0],s&&s(n)}):s&&s(n)});return}r.util.enlivenObjects(e,function(h){r.util.enlivenObjectEnlivables(i,o,function(){s&&s(new r.Group(h,o,!0))})})})}(c),function(u){var r=u.fabric||(u.fabric={});r.ActiveSelection||(r.ActiveSelection=r.util.createClass(r.Group,{type:"activeSelection",initialize:function(a,l){l=l||{},this._objects=a||[];for(var i=this._objects.length;i--;)this._objects[i].group=this;l.originX&&(this.originX=l.originX),l.originY&&(this.originY=l.originY),this._calcBounds(),this._updateObjectsCoords(),r.Object.prototype.initialize.call(this,l),this.setCoords()},toGroup:function(){var a=this._objects.concat();this._objects=[];var l=r.Object.prototype.toObject.call(this),i=new r.Group([]);if(delete l.type,i.set(l),a.forEach(function(e){e.canvas.remove(e),e.group=i}),i._objects=a,!this.canvas)return i;var s=this.canvas;return s.add(i),s._activeObject=i,i.setCoords(),i},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(a,l,i){a.save(),a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",a,l),i=i||{},typeof i.hasControls=="undefined"&&(i.hasControls=!1),i.forActiveSelection=!0;for(var s=0,e=this._objects.length;s<e;s++)this._objects[s]._renderControls(a,i);a.restore()}}),r.ActiveSelection.fromObject=function(a,l){r.util.enlivenObjects(a.objects,function(i){delete a.objects,l&&l(new r.ActiveSelection(i,a,!0))})})}(c),function(u){var r=t.util.object.extend;if(u.fabric||(u.fabric={}),u.fabric.Image){t.warn("fabric.Image is already defined.");return}t.Image=t.util.createClass(t.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:t.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:t.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(a,l){l||(l={}),this.filters=[],this.cacheKey="texture"+t.Object.__uid++,this.callSuper("initialize",l),this._initElement(a,l)},getElement:function(){return this._element||{}},setElement:function(a,l){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=a,this._originalElement=a,this._initConfig(l),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(a){var l=t.filterBackend;l&&l.evictCachesForKey&&l.evictCachesForKey(a)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(a){t.util.cleanUpJsdomNode(this[a]),this[a]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var a=this.getElement();return{width:a.naturalWidth||a.width,height:a.naturalHeight||a.height}},_stroke:function(a){if(!(!this.stroke||this.strokeWidth===0)){var l=this.width/2,i=this.height/2;a.beginPath(),a.moveTo(-l,-i),a.lineTo(l,-i),a.lineTo(l,i),a.lineTo(-l,i),a.lineTo(-l,-i),a.closePath()}},toObject:function(a){var l=[];this.filters.forEach(function(s){s&&l.push(s.toObject())});var i=r(this.callSuper("toObject",["cropX","cropY"].concat(a)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:l});return this.resizeFilter&&(i.resizeFilter=this.resizeFilter.toObject()),i},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var a=[],l=[],i,s=this._element,e=-this.width/2,o=-this.height/2,h="",n="";if(!s)return[];if(this.hasCrop()){var d=t.Object.__uid++;a.push('<clipPath id="imageCrop_'+d+`">
`,'	<rect x="'+e+'" y="'+o+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),h=' clip-path="url(#imageCrop_'+d+')" '}if(this.imageSmoothing||(n='" image-rendering="optimizeSpeed'),l.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',e-this.cropX,'" y="',o-this.cropY,'" width="',s.width||s.naturalWidth,'" height="',s.height||s.height,n,'"',h,`></image>
`),this.stroke||this.strokeDashArray){var g=this.fill;this.fill=null,i=["	<rect ",'x="',e,'" y="',o,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=g}return this.paintFirst!=="fill"?a=a.concat(i,l):a=a.concat(l,i),a},getSrc:function(a){var l=a?this._element:this._originalElement;return l?l.toDataURL?l.toDataURL():this.srcFromAttribute?l.getAttribute("src"):l.src:this.src||""},setSrc:function(a,l,i){return t.util.loadImage(a,function(s,e){this.setElement(s,i),this._setWidthHeight(),l&&l(this,e)},this,i&&i.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var a=this.resizeFilter,l=this.minimumScaleTrigger,i=this.getTotalObjectScaling(),s=i.scaleX,e=i.scaleY,o=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!a||s>l&&e>l){this._element=o,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=s,this._lastScaleY=e;return}t.filterBackend||(t.filterBackend=t.initFilterBackend());var h=t.util.createCanvasElement(),n=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,d=o.width,g=o.height;h.width=d,h.height=g,this._element=h,this._lastScaleX=a.scaleX=s,this._lastScaleY=a.scaleY=e,t.filterBackend.applyFilters([a],o,d,g,this._element,n),this._filterScalingX=h.width/this._originalElement.width,this._filterScalingY=h.height/this._originalElement.height},applyFilters:function(a){if(a=a||this.filters||[],a=a.filter(function(o){return o&&!o.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),a.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var l=this._originalElement,i=l.naturalWidth||l.width,s=l.naturalHeight||l.height;if(this._element===this._originalElement){var e=t.util.createCanvasElement();e.width=i,e.height=s,this._element=e,this._filteredEl=e}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,i,s),this._lastScaleX=1,this._lastScaleY=1;return t.filterBackend||(t.filterBackend=t.initFilterBackend()),t.filterBackend.applyFilters(a,this._originalElement,i,s,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(a){t.util.setImageSmoothing(a,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(a),this._renderPaintInOrder(a)},drawCacheOnCanvas:function(a){t.util.setImageSmoothing(a,this.imageSmoothing),t.Object.prototype.drawCacheOnCanvas.call(this,a)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(a){var l=this._element;if(l){var i=this._filterScalingX,s=this._filterScalingY,e=this.width,o=this.height,h=Math.min,n=Math.max,d=n(this.cropX,0),g=n(this.cropY,0),v=l.naturalWidth||l.width,_=l.naturalHeight||l.height,b=d*i,C=g*s,S=h(e*i,v-b),E=h(o*s,_-C),z=-e/2,V=-o/2,W=h(e,v/i-d),L=h(o,_/s-g);l&&a.drawImage(l,b,C,S,E,z,V,W,L)}},_needsResize:function(){var a=this.getTotalObjectScaling();return a.scaleX!==this._lastScaleX||a.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(a,l){this.setElement(t.util.getById(a),l),t.util.addClass(this.getElement(),t.Image.CSS_CANVAS)},_initConfig:function(a){a||(a={}),this.setOptions(a),this._setWidthHeight(a)},_initFilters:function(a,l){a&&a.length?t.util.enlivenObjects(a,function(i){l&&l(i)},"fabric.Image.filters"):l&&l()},_setWidthHeight:function(a){a||(a={});var l=this.getElement();this.width=a.width||l.naturalWidth||l.width||0,this.height=a.height||l.naturalHeight||l.height||0},parsePreserveAspectRatioAttribute:function(){var a=t.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),l=this._element.width,i=this._element.height,s=1,e=1,o=0,h=0,n=0,d=0,g,v=this.width,_=this.height,b={width:v,height:_};return a&&(a.alignX!=="none"||a.alignY!=="none")?(a.meetOrSlice==="meet"&&(s=e=t.util.findScaleToFit(this._element,b),g=(v-l*s)/2,a.alignX==="Min"&&(o=-g),a.alignX==="Max"&&(o=g),g=(_-i*e)/2,a.alignY==="Min"&&(h=-g),a.alignY==="Max"&&(h=g)),a.meetOrSlice==="slice"&&(s=e=t.util.findScaleToCover(this._element,b),g=l-v/s,a.alignX==="Mid"&&(n=g/2),a.alignX==="Max"&&(n=g),g=i-_/e,a.alignY==="Mid"&&(d=g/2),a.alignY==="Max"&&(d=g),l=v/s,i=_/e)):(s=v/l,e=_/i),{width:l,height:i,scaleX:s,scaleY:e,offsetLeft:o,offsetTop:h,cropX:n,cropY:d}}}),t.Image.CSS_CANVAS="canvas-img",t.Image.prototype.getSvgSrc=t.Image.prototype.getSrc,t.Image.fromObject=function(a,l){var i=t.util.object.clone(a);t.util.loadImage(i.src,function(s,e){if(e){l&&l(null,!0);return}t.Image.prototype._initFilters.call(i,i.filters,function(o){i.filters=o||[],t.Image.prototype._initFilters.call(i,[i.resizeFilter],function(h){i.resizeFilter=h[0],t.util.enlivenObjectEnlivables(i,i,function(){var n=new t.Image(s,i);l(n,!1)})})})},null,i.crossOrigin)},t.Image.fromURL=function(a,l,i){t.util.loadImage(a,function(s,e){l&&l(new t.Image(s,i),e)},null,i&&i.crossOrigin)},t.Image.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),t.Image.fromElement=function(a,l,i){var s=t.parseAttributes(a,t.Image.ATTRIBUTE_NAMES);t.Image.fromURL(s["xlink:href"],l,r(i?t.util.object.clone(i):{},s))}}(c),t.util.object.extend(t.Object.prototype,{_getAngleValueForStraighten:function(){var u=this.angle%360;return u>0?Math.round((u-1)/90)*90:Math.round(u/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(u){u=u||{};var r=function(){},a=u.onComplete||r,l=u.onChange||r,i=this;return t.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(s){i.rotate(s),l()},onComplete:function(){i.setCoords(),a()}})}}),t.util.object.extend(t.StaticCanvas.prototype,{straightenObject:function(u){return u.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(u){return u.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function u(a,l){var i="precision "+l+` float;
void main(){}`,s=a.createShader(a.FRAGMENT_SHADER);return a.shaderSource(s,i),a.compileShader(s),!!a.getShaderParameter(s,a.COMPILE_STATUS)}t.isWebglSupported=function(a){if(t.isLikelyNode)return!1;a=a||t.WebglFilterBackend.prototype.tileSize;var l=document.createElement("canvas"),i=l.getContext("webgl")||l.getContext("experimental-webgl"),s=!1;if(i){t.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),s=t.maxTextureSize>=a;for(var e=["highp","mediump","lowp"],o=0;o<3;o++)if(u(i,e[o])){t.webGlPrecision=e[o];break}}return this.isSupported=s,s},t.WebglFilterBackend=r;function r(a){a&&a.tileSize&&(this.tileSize=a.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}r.prototype={tileSize:2048,resources:{},setupGLContext:function(a,l){this.dispose(),this.createWebGLCanvas(a,l),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(a,l)},chooseFastestCopyGLTo2DMethod:function(a,l){var i=typeof window.performance!="undefined",s;try{new ImageData(1,1),s=!0}catch(b){s=!1}var e=typeof ArrayBuffer!="undefined",o=typeof Uint8ClampedArray!="undefined";if(i&&s&&e&&o){var h=t.util.createCanvasElement(),n=new ArrayBuffer(a*l*4);if(t.forceGLPutImageData){this.imageBuffer=n,this.copyGLTo2D=w;return}var d={imageBuffer:n,destinationWidth:a,destinationHeight:l,targetCanvas:h},g,v,_;h.width=a,h.height=l,g=window.performance.now(),y.call(d,this.gl,d),v=window.performance.now()-g,g=window.performance.now(),w.call(d,this.gl,d),_=window.performance.now()-g,v>_?(this.imageBuffer=n,this.copyGLTo2D=w):this.copyGLTo2D=y}},createWebGLCanvas:function(a,l){var i=t.util.createCanvasElement();i.width=a,i.height=l;var s={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},e=i.getContext("webgl",s);e||(e=i.getContext("experimental-webgl",s)),e&&(e.clearColor(0,0,0,0),this.canvas=i,this.gl=e)},applyFilters:function(a,l,i,s,e,o){var h=this.gl,n;o&&(n=this.getCachedTexture(o,l));var d={originalWidth:l.width||l.originalWidth,originalHeight:l.height||l.originalHeight,sourceWidth:i,sourceHeight:s,destinationWidth:i,destinationHeight:s,context:h,sourceTexture:this.createTexture(h,i,s,!n&&l),targetTexture:this.createTexture(h,i,s),originalTexture:n||this.createTexture(h,i,s,!n&&l),passes:a.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:e},g=h.createFramebuffer();return h.bindFramebuffer(h.FRAMEBUFFER,g),a.forEach(function(v){v&&v.applyTo(d)}),m(d),this.copyGLTo2D(h,d),h.bindTexture(h.TEXTURE_2D,null),h.deleteTexture(d.sourceTexture),h.deleteTexture(d.targetTexture),h.deleteFramebuffer(g),e.getContext("2d").setTransform(1,0,0,1,0,0),d},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(a,l,i,s,e){var o=a.createTexture();return a.bindTexture(a.TEXTURE_2D,o),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e||a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,e||a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),s?a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,s):a.texImage2D(a.TEXTURE_2D,0,a.RGBA,l,i,0,a.RGBA,a.UNSIGNED_BYTE,null),o},getCachedTexture:function(a,l){if(this.textureCache[a])return this.textureCache[a];var i=this.createTexture(this.gl,l.width,l.height,l);return this.textureCache[a]=i,i},evictCachesForKey:function(a){this.textureCache[a]&&(this.gl.deleteTexture(this.textureCache[a]),delete this.textureCache[a])},copyGLTo2D:y,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var a=this.gl,l={renderer:"",vendor:""};if(!a)return l;var i=a.getExtension("WEBGL_debug_renderer_info");if(i){var s=a.getParameter(i.UNMASKED_RENDERER_WEBGL),e=a.getParameter(i.UNMASKED_VENDOR_WEBGL);s&&(l.renderer=s.toLowerCase()),e&&(l.vendor=e.toLowerCase())}return this.gpuInfo=l,l}}}();function m(u){var r=u.targetCanvas,a=r.width,l=r.height,i=u.destinationWidth,s=u.destinationHeight;(a!==i||l!==s)&&(r.width=i,r.height=s)}function y(u,r){var a=u.canvas,l=r.targetCanvas,i=l.getContext("2d");i.translate(0,l.height),i.scale(1,-1);var s=a.height-l.height;i.drawImage(a,0,s,l.width,l.height,0,0,l.width,l.height)}function w(u,r){var a=r.targetCanvas,l=a.getContext("2d"),i=r.destinationWidth,s=r.destinationHeight,e=i*s*4,o=new Uint8Array(this.imageBuffer,0,e),h=new Uint8ClampedArray(this.imageBuffer,0,e);u.readPixels(0,0,i,s,u.RGBA,u.UNSIGNED_BYTE,o);var n=new ImageData(h,i,s);l.putImageData(n,0,0)}(function(){var u=function(){};t.Canvas2dFilterBackend=r;function r(){}r.prototype={evictCachesForKey:u,dispose:u,clearWebGLCaches:u,resources:{},applyFilters:function(a,l,i,s,e){var o=e.getContext("2d");o.drawImage(l,0,0,i,s);var h=o.getImageData(0,0,i,s),n=o.getImageData(0,0,i,s),d={sourceWidth:i,sourceHeight:s,imageData:h,originalEl:l,originalImageData:n,canvasEl:e,ctx:o,filterBackend:this};return a.forEach(function(g){g.applyTo(d)}),(d.imageData.width!==i||d.imageData.height!==s)&&(e.width=d.imageData.width,e.height=d.imageData.height),o.putImageData(d.imageData,0,0),d}}})(),t.Image=t.Image||{},t.Image.filters=t.Image.filters||{},t.Image.filters.BaseFilter=t.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(u){u&&this.setOptions(u)},setOptions:function(u){for(var r in u)this[r]=u[r]},createProgram:function(u,r,a){r=r||this.fragmentSource,a=a||this.vertexSource,t.webGlPrecision!=="highp"&&(r=r.replace(/precision highp float/g,"precision "+t.webGlPrecision+" float"));var l=u.createShader(u.VERTEX_SHADER);if(u.shaderSource(l,a),u.compileShader(l),!u.getShaderParameter(l,u.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+u.getShaderInfoLog(l));var i=u.createShader(u.FRAGMENT_SHADER);if(u.shaderSource(i,r),u.compileShader(i),!u.getShaderParameter(i,u.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+u.getShaderInfoLog(i));var s=u.createProgram();if(u.attachShader(s,l),u.attachShader(s,i),u.linkProgram(s),!u.getProgramParameter(s,u.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+u.getProgramInfoLog(s));var e=this.getAttributeLocations(u,s),o=this.getUniformLocations(u,s)||{};return o.uStepW=u.getUniformLocation(s,"uStepW"),o.uStepH=u.getUniformLocation(s,"uStepH"),{program:s,attributeLocations:e,uniformLocations:o}},getAttributeLocations:function(u,r){return{aPosition:u.getAttribLocation(r,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(u,r,a){var l=r.aPosition,i=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,i),u.enableVertexAttribArray(l),u.vertexAttribPointer(l,2,u.FLOAT,!1,0,0),u.bufferData(u.ARRAY_BUFFER,a,u.STATIC_DRAW)},_setupFrameBuffer:function(u){var r=u.context,a,l;u.passes>1?(a=u.destinationWidth,l=u.destinationHeight,(u.sourceWidth!==a||u.sourceHeight!==l)&&(r.deleteTexture(u.targetTexture),u.targetTexture=u.filterBackend.createTexture(r,a,l)),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,u.targetTexture,0)):(r.bindFramebuffer(r.FRAMEBUFFER,null),r.finish())},_swapTextures:function(u){u.passes--,u.pass++;var r=u.targetTexture;u.targetTexture=u.sourceTexture,u.sourceTexture=r},isNeutralState:function(){var u=this.mainParameter,r=t.Image.filters[this.type].prototype;if(u)if(Array.isArray(r[u])){for(var a=r[u].length;a--;)if(this[u][a]!==r[u][a])return!1;return!0}else return r[u]===this[u];else return!1},applyTo:function(u){u.webgl?(this._setupFrameBuffer(u),this.applyToWebGL(u),this._swapTextures(u)):this.applyTo2d(u)},retrieveShader:function(u){return u.programCache.hasOwnProperty(this.type)||(u.programCache[this.type]=this.createProgram(u.context)),u.programCache[this.type]},applyToWebGL:function(u){var r=u.context,a=this.retrieveShader(u);u.pass===0&&u.originalTexture?r.bindTexture(r.TEXTURE_2D,u.originalTexture):r.bindTexture(r.TEXTURE_2D,u.sourceTexture),r.useProgram(a.program),this.sendAttributeData(r,a.attributeLocations,u.aPosition),r.uniform1f(a.uniformLocations.uStepW,1/u.sourceWidth),r.uniform1f(a.uniformLocations.uStepH,1/u.sourceHeight),this.sendUniformData(r,a.uniformLocations),r.viewport(0,0,u.destinationWidth,u.destinationHeight),r.drawArrays(r.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(u,r,a){u.activeTexture(a),u.bindTexture(u.TEXTURE_2D,r),u.activeTexture(u.TEXTURE0)},unbindAdditionalTexture:function(u,r){u.activeTexture(r),u.bindTexture(u.TEXTURE_2D,null),u.activeTexture(u.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(u){this[this.mainParameter]=u},sendUniformData:function(){},createHelpLayer:function(u){if(!u.helpLayer){var r=document.createElement("canvas");r.width=u.sourceWidth,r.height=u.sourceHeight,u.helpLayer=r}},toObject:function(){var u={type:this.type},r=this.mainParameter;return r&&(u[r]=this[r]),u},toJSON:function(){return this.toObject()}}),t.Image.filters.BaseFilter.fromObject=function(u,r){var a=new t.Image.filters[u.type](u);return r&&r(a),a},function(u){var r=u.fabric||(u.fabric={}),a=r.Image.filters,l=r.util.createClass;a.ColorMatrix=l(a.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(i){this.callSuper("initialize",i),this.matrix=this.matrix.slice(0)},applyTo2d:function(i){var s=i.imageData,e=s.data,o=e.length,h=this.matrix,n,d,g,v,_,b=this.colorsOnly;for(_=0;_<o;_+=4)n=e[_],d=e[_+1],g=e[_+2],b?(e[_]=n*h[0]+d*h[1]+g*h[2]+h[4]*255,e[_+1]=n*h[5]+d*h[6]+g*h[7]+h[9]*255,e[_+2]=n*h[10]+d*h[11]+g*h[12]+h[14]*255):(v=e[_+3],e[_]=n*h[0]+d*h[1]+g*h[2]+v*h[3]+h[4]*255,e[_+1]=n*h[5]+d*h[6]+g*h[7]+v*h[8]+h[9]*255,e[_+2]=n*h[10]+d*h[11]+g*h[12]+v*h[13]+h[14]*255,e[_+3]=n*h[15]+d*h[16]+g*h[17]+v*h[18]+h[19]*255)},getUniformLocations:function(i,s){return{uColorMatrix:i.getUniformLocation(s,"uColorMatrix"),uConstants:i.getUniformLocation(s,"uConstants")}},sendUniformData:function(i,s){var e=this.matrix,o=[e[0],e[1],e[2],e[3],e[5],e[6],e[7],e[8],e[10],e[11],e[12],e[13],e[15],e[16],e[17],e[18]],h=[e[4],e[9],e[14],e[19]];i.uniformMatrix4fv(s.uColorMatrix,!1,o),i.uniform4fv(s.uConstants,h)}}),r.Image.filters.ColorMatrix.fromObject=r.Image.filters.BaseFilter.fromObject}(c),function(u){var r=u.fabric||(u.fabric={}),a=r.Image.filters,l=r.util.createClass;a.Brightness=l(a.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(i){if(this.brightness!==0){var s=i.imageData,e=s.data,o,h=e.length,n=Math.round(this.brightness*255);for(o=0;o<h;o+=4)e[o]=e[o]+n,e[o+1]=e[o+1]+n,e[o+2]=e[o+2]+n}},getUniformLocations:function(i,s){return{uBrightness:i.getUniformLocation(s,"uBrightness")}},sendUniformData:function(i,s){i.uniform1f(s.uBrightness,this.brightness)}}),r.Image.filters.Brightness.fromObject=r.Image.filters.BaseFilter.fromObject}(c),function(u){var r=u.fabric||(u.fabric={}),a=r.util.object.extend,l=r.Image.filters,i=r.util.createClass;l.Convolute=i(l.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(s){var e=Math.sqrt(this.matrix.length),o=this.type+"_"+e+"_"+(this.opaque?1:0),h=this.fragmentSource[o];return s.programCache.hasOwnProperty(o)||(s.programCache[o]=this.createProgram(s.context,h)),s.programCache[o]},applyTo2d:function(s){var e=s.imageData,o=e.data,h=this.matrix,n=Math.round(Math.sqrt(h.length)),d=Math.floor(n/2),g=e.width,v=e.height,_=s.ctx.createImageData(g,v),b=_.data,C=this.opaque?1:0,S,E,z,V,W,L,A,X,B,st,ht,ft,O;for(ht=0;ht<v;ht++)for(st=0;st<g;st++){for(W=(ht*g+st)*4,S=0,E=0,z=0,V=0,O=0;O<n;O++)for(ft=0;ft<n;ft++)A=ht+O-d,L=st+ft-d,!(A<0||A>=v||L<0||L>=g)&&(X=(A*g+L)*4,B=h[O*n+ft],S+=o[X]*B,E+=o[X+1]*B,z+=o[X+2]*B,C||(V+=o[X+3]*B));b[W]=S,b[W+1]=E,b[W+2]=z,C?b[W+3]=o[W+3]:b[W+3]=V}s.imageData=_},getUniformLocations:function(s,e){return{uMatrix:s.getUniformLocation(e,"uMatrix"),uOpaque:s.getUniformLocation(e,"uOpaque"),uHalfSize:s.getUniformLocation(e,"uHalfSize"),uSize:s.getUniformLocation(e,"uSize")}},sendUniformData:function(s,e){s.uniform1fv(e.uMatrix,this.matrix)},toObject:function(){return a(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),r.Image.filters.Convolute.fromObject=r.Image.filters.BaseFilter.fromObject}(c),function(u){var r=u.fabric||(u.fabric={}),a=r.Image.filters,l=r.util.createClass;a.Grayscale=l(a.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(i){var s=i.imageData,e=s.data,o,h=e.length,n,d=this.mode;for(o=0;o<h;o+=4)d==="average"?n=(e[o]+e[o+1]+e[o+2])/3:d==="lightness"?n=(Math.min(e[o],e[o+1],e[o+2])+Math.max(e[o],e[o+1],e[o+2]))/2:d==="luminosity"&&(n=.21*e[o]+.72*e[o+1]+.07*e[o+2]),e[o]=n,e[o+1]=n,e[o+2]=n},retrieveShader:function(i){var s=this.type+"_"+this.mode;if(!i.programCache.hasOwnProperty(s)){var e=this.fragmentSource[this.mode];i.programCache[s]=this.createProgram(i.context,e)}return i.programCache[s]},getUniformLocations:function(i,s){return{uMode:i.getUniformLocation(s,"uMode")}},sendUniformData:function(i,s){var e=1;i.uniform1i(s.uMode,e)},isNeutralState:function(){return!1}}),r.Image.filters.Grayscale.fromObject=r.Image.filters.BaseFilter.fromObject}(c),function(u){var r=u.fabric||(u.fabric={}),a=r.Image.filters,l=r.util.createClass;a.Invert=l(a.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(i){var s=i.imageData,e=s.data,o,h=e.length;for(o=0;o<h;o+=4)e[o]=255-e[o],e[o+1]=255-e[o+1],e[o+2]=255-e[o+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(i,s){return{uInvert:i.getUniformLocation(s,"uInvert")}},sendUniformData:function(i,s){i.uniform1i(s.uInvert,this.invert)}}),r.Image.filters.Invert.fromObject=r.Image.filters.BaseFilter.fromObject}(c),function(u){var r=u.fabric||(u.fabric={}),a=r.util.object.extend,l=r.Image.filters,i=r.util.createClass;l.Noise=i(l.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(s){if(this.noise!==0){var e=s.imageData,o=e.data,h,n=o.length,d=this.noise,g;for(h=0,n=o.length;h<n;h+=4)g=(.5-Math.random())*d,o[h]+=g,o[h+1]+=g,o[h+2]+=g}},getUniformLocations:function(s,e){return{uNoise:s.getUniformLocation(e,"uNoise"),uSeed:s.getUniformLocation(e,"uSeed")}},sendUniformData:function(s,e){s.uniform1f(e.uNoise,this.noise/255),s.uniform1f(e.uSeed,Math.random())},toObject:function(){return a(this.callSuper("toObject"),{noise:this.noise})}}),r.Image.filters.Noise.fromObject=r.Image.filters.BaseFilter.fromObject}(c),function(u){var r=u.fabric||(u.fabric={}),a=r.Image.filters,l=r.util.createClass;a.Pixelate=l(a.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(i){var s=i.imageData,e=s.data,o=s.height,h=s.width,n,d,g,v,_,b,C,S,E,z,V;for(d=0;d<o;d+=this.blocksize)for(g=0;g<h;g+=this.blocksize)for(n=d*4*h+g*4,v=e[n],_=e[n+1],b=e[n+2],C=e[n+3],z=Math.min(d+this.blocksize,o),V=Math.min(g+this.blocksize,h),S=d;S<z;S++)for(E=g;E<V;E++)n=S*4*h+E*4,e[n]=v,e[n+1]=_,e[n+2]=b,e[n+3]=C},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(i,s){return{uBlocksize:i.getUniformLocation(s,"uBlocksize"),uStepW:i.getUniformLocation(s,"uStepW"),uStepH:i.getUniformLocation(s,"uStepH")}},sendUniformData:function(i,s){i.uniform1f(s.uBlocksize,this.blocksize)}}),r.Image.filters.Pixelate.fromObject=r.Image.filters.BaseFilter.fromObject}(c),function(u){var r=u.fabric||(u.fabric={}),a=r.util.object.extend,l=r.Image.filters,i=r.util.createClass;l.RemoveColor=i(l.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(s){var e=s.imageData,o=e.data,h,n=this.distance*255,d,g,v,_=new r.Color(this.color).getSource(),b=[_[0]-n,_[1]-n,_[2]-n],C=[_[0]+n,_[1]+n,_[2]+n];for(h=0;h<o.length;h+=4)d=o[h],g=o[h+1],v=o[h+2],d>b[0]&&g>b[1]&&v>b[2]&&d<C[0]&&g<C[1]&&v<C[2]&&(o[h+3]=0)},getUniformLocations:function(s,e){return{uLow:s.getUniformLocation(e,"uLow"),uHigh:s.getUniformLocation(e,"uHigh")}},sendUniformData:function(s,e){var o=new r.Color(this.color).getSource(),h=parseFloat(this.distance),n=[0+o[0]/255-h,0+o[1]/255-h,0+o[2]/255-h,1],d=[o[0]/255+h,o[1]/255+h,o[2]/255+h,1];s.uniform4fv(e.uLow,n),s.uniform4fv(e.uHigh,d)},toObject:function(){return a(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),r.Image.filters.RemoveColor.fromObject=r.Image.filters.BaseFilter.fromObject}(c),function(u){var r=u.fabric||(u.fabric={}),a=r.Image.filters,l=r.util.createClass,i={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var s in i)a[s]=l(a.ColorMatrix,{type:s,matrix:i[s],mainParameter:!1,colorsOnly:!0}),r.Image.filters[s].fromObject=r.Image.filters.BaseFilter.fromObject}(c),function(u){var r=u.fabric,a=r.Image.filters,l=r.util.createClass;a.BlendColor=l(a.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(i){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[i]+`}
}`},retrieveShader:function(i){var s=this.type+"_"+this.mode,e;return i.programCache.hasOwnProperty(s)||(e=this.buildSource(this.mode),i.programCache[s]=this.createProgram(i.context,e)),i.programCache[s]},applyTo2d:function(i){var s=i.imageData,e=s.data,o=e.length,h,n,d,g,v,_,b,C=1-this.alpha;b=new r.Color(this.color).getSource(),h=b[0]*this.alpha,n=b[1]*this.alpha,d=b[2]*this.alpha;for(var S=0;S<o;S+=4)switch(g=e[S],v=e[S+1],_=e[S+2],this.mode){case"multiply":e[S]=g*h/255,e[S+1]=v*n/255,e[S+2]=_*d/255;break;case"screen":e[S]=255-(255-g)*(255-h)/255,e[S+1]=255-(255-v)*(255-n)/255,e[S+2]=255-(255-_)*(255-d)/255;break;case"add":e[S]=g+h,e[S+1]=v+n,e[S+2]=_+d;break;case"diff":case"difference":e[S]=Math.abs(g-h),e[S+1]=Math.abs(v-n),e[S+2]=Math.abs(_-d);break;case"subtract":e[S]=g-h,e[S+1]=v-n,e[S+2]=_-d;break;case"darken":e[S]=Math.min(g,h),e[S+1]=Math.min(v,n),e[S+2]=Math.min(_,d);break;case"lighten":e[S]=Math.max(g,h),e[S+1]=Math.max(v,n),e[S+2]=Math.max(_,d);break;case"overlay":e[S]=h<128?2*g*h/255:255-2*(255-g)*(255-h)/255,e[S+1]=n<128?2*v*n/255:255-2*(255-v)*(255-n)/255,e[S+2]=d<128?2*_*d/255:255-2*(255-_)*(255-d)/255;break;case"exclusion":e[S]=h+g-2*h*g/255,e[S+1]=n+v-2*n*v/255,e[S+2]=d+_-2*d*_/255;break;case"tint":e[S]=h+g*C,e[S+1]=n+v*C,e[S+2]=d+_*C}},getUniformLocations:function(i,s){return{uColor:i.getUniformLocation(s,"uColor")}},sendUniformData:function(i,s){var e=new r.Color(this.color).getSource();e[0]=this.alpha*e[0]/255,e[1]=this.alpha*e[1]/255,e[2]=this.alpha*e[2]/255,e[3]=this.alpha,i.uniform4fv(s.uColor,e)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),r.Image.filters.BlendColor.fromObject=r.Image.filters.BaseFilter.fromObject}(c),function(u){var r=u.fabric,a=r.Image.filters,l=r.util.createClass;a.BlendImage=l(a.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(i){var s=this.type+"_"+this.mode,e=this.fragmentSource[this.mode];return i.programCache.hasOwnProperty(s)||(i.programCache[s]=this.createProgram(i.context,e)),i.programCache[s]},applyToWebGL:function(i){var s=i.context,e=this.createTexture(i.filterBackend,this.image);this.bindAdditionalTexture(s,e,s.TEXTURE1),this.callSuper("applyToWebGL",i),this.unbindAdditionalTexture(s,s.TEXTURE1)},createTexture:function(i,s){return i.getCachedTexture(s.cacheKey,s._element)},calculateMatrix:function(){var i=this.image,s=i._element.width,e=i._element.height;return[1/i.scaleX,0,0,0,1/i.scaleY,0,-i.left/s,-i.top/e,1]},applyTo2d:function(i){var s=i.imageData,e=i.filterBackend.resources,o=s.data,h=o.length,n=s.width,d=s.height,g,v,_,b,C,S,E,z,V,W,L=this.image,A;e.blendImage||(e.blendImage=r.util.createCanvasElement()),V=e.blendImage,W=V.getContext("2d"),V.width!==n||V.height!==d?(V.width=n,V.height=d):W.clearRect(0,0,n,d),W.setTransform(L.scaleX,0,0,L.scaleY,L.left,L.top),W.drawImage(L._element,0,0,n,d),A=W.getImageData(0,0,n,d).data;for(var X=0;X<h;X+=4)switch(C=o[X],S=o[X+1],E=o[X+2],z=o[X+3],g=A[X],v=A[X+1],_=A[X+2],b=A[X+3],this.mode){case"multiply":o[X]=C*g/255,o[X+1]=S*v/255,o[X+2]=E*_/255,o[X+3]=z*b/255;break;case"mask":o[X+3]=b;break}},getUniformLocations:function(i,s){return{uTransformMatrix:i.getUniformLocation(s,"uTransformMatrix"),uImage:i.getUniformLocation(s,"uImage")}},sendUniformData:function(i,s){var e=this.calculateMatrix();i.uniform1i(s.uImage,1),i.uniformMatrix3fv(s.uTransformMatrix,!1,e)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),r.Image.filters.BlendImage.fromObject=function(i,s){r.Image.fromObject(i.image,function(e){var o=r.util.object.clone(i);o.image=e,s(new r.Image.filters.BlendImage(o))})}}(c),function(u){var r=u.fabric||(u.fabric={}),a=Math.pow,l=Math.floor,i=Math.sqrt,s=Math.abs,e=Math.round,o=Math.sin,h=Math.ceil,n=r.Image.filters,d=r.util.createClass;n.Resize=d(n.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(g,v){return{uDelta:g.getUniformLocation(v,"uDelta"),uTaps:g.getUniformLocation(v,"uTaps")}},sendUniformData:function(g,v){g.uniform2fv(v.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),g.uniform1fv(v.uTaps,this.taps)},retrieveShader:function(g){var v=this.getFilterWindow(),_=this.type+"_"+v;if(!g.programCache.hasOwnProperty(_)){var b=this.generateShader(v);g.programCache[_]=this.createProgram(g.context,b)}return g.programCache[_]},getFilterWindow:function(){var g=this.tempScale;return Math.ceil(this.lanczosLobes/g)},getTaps:function(){for(var g=this.lanczosCreate(this.lanczosLobes),v=this.tempScale,_=this.getFilterWindow(),b=new Array(_),C=1;C<=_;C++)b[C-1]=g(C*v);return b},generateShader:function(b){for(var v=new Array(b),_=this.fragmentSourceTOP,b,C=1;C<=b;C++)v[C-1]=C+".0 * uDelta";return _+="uniform float uTaps["+b+`];
`,_+=`void main() {
`,_+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,_+=`  float sum = 1.0;
`,v.forEach(function(S,E){_+="  color += texture2D(uTexture, vTexCoord + "+S+") * uTaps["+E+`];
`,_+="  color += texture2D(uTexture, vTexCoord - "+S+") * uTaps["+E+`];
`,_+="  sum += 2.0 * uTaps["+E+`];
`}),_+=`  gl_FragColor = color / sum;
`,_+="}",_},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(g){g.webgl?(g.passes++,this.width=g.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=g.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),g.destinationWidth=this.dW,this._setupFrameBuffer(g),this.applyToWebGL(g),this._swapTextures(g),g.sourceWidth=g.destinationWidth,this.height=g.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),g.destinationHeight=this.dH,this._setupFrameBuffer(g),this.applyToWebGL(g),this._swapTextures(g),g.sourceHeight=g.destinationHeight):this.applyTo2d(g)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(g){return function(v){if(v>=g||v<=-g)return 0;if(v<11920929e-14&&v>-11920929e-14)return 1;v*=Math.PI;var _=v/g;return o(v)/v*o(_)/_}},applyTo2d:function(g){var v=g.imageData,_=this.scaleX,b=this.scaleY;this.rcpScaleX=1/_,this.rcpScaleY=1/b;var C=v.width,S=v.height,E=e(C*_),z=e(S*b),V;this.resizeType==="sliceHack"?V=this.sliceByTwo(g,C,S,E,z):this.resizeType==="hermite"?V=this.hermiteFastResize(g,C,S,E,z):this.resizeType==="bilinear"?V=this.bilinearFiltering(g,C,S,E,z):this.resizeType==="lanczos"&&(V=this.lanczosResize(g,C,S,E,z)),g.imageData=V},sliceByTwo:function(g,v,_,b,C){var S=g.imageData,E=.5,z=!1,V=!1,W=v*E,L=_*E,A=r.filterBackend.resources,X,B,st=0,ht=0,ft=v,O=0;for(A.sliceByTwo||(A.sliceByTwo=document.createElement("canvas")),X=A.sliceByTwo,(X.width<v*1.5||X.height<_)&&(X.width=v*1.5,X.height=_),B=X.getContext("2d"),B.clearRect(0,0,v*1.5,_),B.putImageData(S,0,0),b=l(b),C=l(C);!z||!V;)v=W,_=L,b<l(W*E)?W=l(W*E):(W=b,z=!0),C<l(L*E)?L=l(L*E):(L=C,V=!0),B.drawImage(X,st,ht,v,_,ft,O,W,L),st=ft,ht=O,O+=L;return B.getImageData(st,ht,b,C)},lanczosResize:function(g,v,_,b,C){function S(j){var P,U,T,x,k,R,q,N,nt,ot,lt;for(O.x=(j+.5)*L,F.x=l(O.x),P=0;P<C;P++){for(O.y=(P+.5)*A,F.y=l(O.y),k=0,R=0,q=0,N=0,nt=0,U=F.x-st;U<=F.x+st;U++)if(!(U<0||U>=v)){ot=l(1e3*s(U-O.x)),ft[ot]||(ft[ot]={});for(var Y=F.y-ht;Y<=F.y+ht;Y++)Y<0||Y>=_||(lt=l(1e3*s(Y-O.y)),ft[ot][lt]||(ft[ot][lt]=W(i(a(ot*X,2)+a(lt*B,2))/1e3)),T=ft[ot][lt],T>0&&(x=(Y*v+U)*4,k+=T,R+=T*E[x],q+=T*E[x+1],N+=T*E[x+2],nt+=T*E[x+3]))}x=(P*b+j)*4,V[x]=R/k,V[x+1]=q/k,V[x+2]=N/k,V[x+3]=nt/k}return++j<b?S(j):z}var E=g.imageData.data,z=g.ctx.createImageData(b,C),V=z.data,W=this.lanczosCreate(this.lanczosLobes),L=this.rcpScaleX,A=this.rcpScaleY,X=2/this.rcpScaleX,B=2/this.rcpScaleY,st=h(L*this.lanczosLobes/2),ht=h(A*this.lanczosLobes/2),ft={},O={},F={};return S(0)},bilinearFiltering:function(g,v,_,b,C){var S,E,z,V,W,L,A,X,B,st,ht,ft,O=0,F,j=this.rcpScaleX,P=this.rcpScaleY,U=4*(v-1),T=g.imageData,x=T.data,k=g.ctx.createImageData(b,C),R=k.data;for(A=0;A<C;A++)for(X=0;X<b;X++)for(W=l(j*X),L=l(P*A),B=j*X-W,st=P*A-L,F=4*(L*v+W),ht=0;ht<4;ht++)S=x[F+ht],E=x[F+4+ht],z=x[F+U+ht],V=x[F+U+4+ht],ft=S*(1-B)*(1-st)+E*B*(1-st)+z*st*(1-B)+V*B*st,R[O++]=ft;return k},hermiteFastResize:function(g,v,_,b,C){for(var S=this.rcpScaleX,E=this.rcpScaleY,z=h(S/2),V=h(E/2),W=g.imageData,L=W.data,A=g.ctx.createImageData(b,C),X=A.data,B=0;B<C;B++)for(var st=0;st<b;st++){for(var ht=(st+B*b)*4,ft=0,O=0,F=0,j=0,P=0,U=0,T=0,x=(B+.5)*E,k=l(B*E);k<(B+1)*E;k++)for(var R=s(x-(k+.5))/V,q=(st+.5)*S,N=R*R,nt=l(st*S);nt<(st+1)*S;nt++){var ot=s(q-(nt+.5))/z,lt=i(N+ot*ot);lt>1&&lt<-1||(ft=2*lt*lt*lt-3*lt*lt+1,ft>0&&(ot=4*(nt+k*v),T+=ft*L[ot+3],F+=ft,L[ot+3]<255&&(ft=ft*L[ot+3]/250),j+=ft*L[ot],P+=ft*L[ot+1],U+=ft*L[ot+2],O+=ft))}X[ht]=j/O,X[ht+1]=P/O,X[ht+2]=U/O,X[ht+3]=T/F}return A},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),r.Image.filters.Resize.fromObject=r.Image.filters.BaseFilter.fromObject}(c),function(u){var r=u.fabric||(u.fabric={}),a=r.Image.filters,l=r.util.createClass;a.Contrast=l(a.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(i){if(this.contrast!==0){var s=i.imageData,e,h,o=s.data,h=o.length,n=Math.floor(this.contrast*255),d=259*(n+255)/(255*(259-n));for(e=0;e<h;e+=4)o[e]=d*(o[e]-128)+128,o[e+1]=d*(o[e+1]-128)+128,o[e+2]=d*(o[e+2]-128)+128}},getUniformLocations:function(i,s){return{uContrast:i.getUniformLocation(s,"uContrast")}},sendUniformData:function(i,s){i.uniform1f(s.uContrast,this.contrast)}}),r.Image.filters.Contrast.fromObject=r.Image.filters.BaseFilter.fromObject}(c),function(u){var r=u.fabric||(u.fabric={}),a=r.Image.filters,l=r.util.createClass;a.Saturation=l(a.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(i){if(this.saturation!==0){var s=i.imageData,e=s.data,o=e.length,h=-this.saturation,n,d;for(n=0;n<o;n+=4)d=Math.max(e[n],e[n+1],e[n+2]),e[n]+=d!==e[n]?(d-e[n])*h:0,e[n+1]+=d!==e[n+1]?(d-e[n+1])*h:0,e[n+2]+=d!==e[n+2]?(d-e[n+2])*h:0}},getUniformLocations:function(i,s){return{uSaturation:i.getUniformLocation(s,"uSaturation")}},sendUniformData:function(i,s){i.uniform1f(s.uSaturation,-this.saturation)}}),r.Image.filters.Saturation.fromObject=r.Image.filters.BaseFilter.fromObject}(c),function(u){var r=u.fabric||(u.fabric={}),a=r.Image.filters,l=r.util.createClass;a.Vibrance=l(a.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(i){if(this.vibrance!==0){var s=i.imageData,e=s.data,o=e.length,h=-this.vibrance,n,d,g,v;for(n=0;n<o;n+=4)d=Math.max(e[n],e[n+1],e[n+2]),g=(e[n]+e[n+1]+e[n+2])/3,v=Math.abs(d-g)*2/255*h,e[n]+=d!==e[n]?(d-e[n])*v:0,e[n+1]+=d!==e[n+1]?(d-e[n+1])*v:0,e[n+2]+=d!==e[n+2]?(d-e[n+2])*v:0}},getUniformLocations:function(i,s){return{uVibrance:i.getUniformLocation(s,"uVibrance")}},sendUniformData:function(i,s){i.uniform1f(s.uVibrance,-this.vibrance)}}),r.Image.filters.Vibrance.fromObject=r.Image.filters.BaseFilter.fromObject}(c),function(u){var r=u.fabric||(u.fabric={}),a=r.Image.filters,l=r.util.createClass;a.Blur=l(a.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(i){i.webgl?(this.aspectRatio=i.sourceWidth/i.sourceHeight,i.passes++,this._setupFrameBuffer(i),this.horizontal=!0,this.applyToWebGL(i),this._swapTextures(i),this._setupFrameBuffer(i),this.horizontal=!1,this.applyToWebGL(i),this._swapTextures(i)):this.applyTo2d(i)},applyTo2d:function(i){i.imageData=this.simpleBlur(i)},simpleBlur:function(i){var s=i.filterBackend.resources,e,o,h=i.imageData.width,n=i.imageData.height;s.blurLayer1||(s.blurLayer1=r.util.createCanvasElement(),s.blurLayer2=r.util.createCanvasElement()),e=s.blurLayer1,o=s.blurLayer2,(e.width!==h||e.height!==n)&&(o.width=e.width=h,o.height=e.height=n);var d=e.getContext("2d"),g=o.getContext("2d"),v=15,_,b,C,S,E=this.blur*.06*.5;for(d.putImageData(i.imageData,0,0),g.clearRect(0,0,h,n),S=-v;S<=v;S++)_=(Math.random()-.5)/4,b=S/v,C=E*b*h+_,g.globalAlpha=1-Math.abs(b),g.drawImage(e,C,_),d.drawImage(o,0,0),g.globalAlpha=1,g.clearRect(0,0,o.width,o.height);for(S=-v;S<=v;S++)_=(Math.random()-.5)/4,b=S/v,C=E*b*n+_,g.globalAlpha=1-Math.abs(b),g.drawImage(e,_,C),d.drawImage(o,0,0),g.globalAlpha=1,g.clearRect(0,0,o.width,o.height);i.ctx.drawImage(e,0,0);var z=i.ctx.getImageData(0,0,e.width,e.height);return d.globalAlpha=1,d.clearRect(0,0,e.width,e.height),z},getUniformLocations:function(i,s){return{delta:i.getUniformLocation(s,"uDelta")}},sendUniformData:function(i,s){var e=this.chooseRightDelta();i.uniform2fv(s.delta,e)},chooseRightDelta:function(){var i=1,s=[0,0],e;return this.horizontal?this.aspectRatio>1&&(i=1/this.aspectRatio):this.aspectRatio<1&&(i=this.aspectRatio),e=i*this.blur*.12,this.horizontal?s[0]=e:s[1]=e,s}}),a.Blur.fromObject=r.Image.filters.BaseFilter.fromObject}(c),function(u){var r=u.fabric||(u.fabric={}),a=r.Image.filters,l=r.util.createClass;a.Gamma=l(a.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(i){this.gamma=[1,1,1],a.BaseFilter.prototype.initialize.call(this,i)},applyTo2d:function(i){var s=i.imageData,e=s.data,o=this.gamma,h=e.length,n=1/o[0],d=1/o[1],g=1/o[2],v;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),v=0,h=256;v<h;v++)this.rVals[v]=Math.pow(v/255,n)*255,this.gVals[v]=Math.pow(v/255,d)*255,this.bVals[v]=Math.pow(v/255,g)*255;for(v=0,h=e.length;v<h;v+=4)e[v]=this.rVals[e[v]],e[v+1]=this.gVals[e[v+1]],e[v+2]=this.bVals[e[v+2]]},getUniformLocations:function(i,s){return{uGamma:i.getUniformLocation(s,"uGamma")}},sendUniformData:function(i,s){i.uniform3fv(s.uGamma,this.gamma)}}),r.Image.filters.Gamma.fromObject=r.Image.filters.BaseFilter.fromObject}(c),function(u){var r=u.fabric||(u.fabric={}),a=r.Image.filters,l=r.util.createClass;a.Composed=l(a.BaseFilter,{type:"Composed",subFilters:[],initialize:function(i){this.callSuper("initialize",i),this.subFilters=this.subFilters.slice(0)},applyTo:function(i){i.passes+=this.subFilters.length-1,this.subFilters.forEach(function(s){s.applyTo(i)})},toObject:function(){return r.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(i){return i.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(i){return!i.isNeutralState()})}}),r.Image.filters.Composed.fromObject=function(i,s){var e=i.subFilters||[],o=e.map(function(n){return new r.Image.filters[n.type](n)}),h=new r.Image.filters.Composed({subFilters:o});return s&&s(h),h}}(c),function(u){var r=u.fabric||(u.fabric={}),a=r.Image.filters,l=r.util.createClass;a.HueRotation=l(a.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var i=this.rotation*Math.PI,s=r.util.cos(i),e=r.util.sin(i),o=1/3,h=Math.sqrt(o)*e,n=1-s;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=s+n/3,this.matrix[1]=o*n-h,this.matrix[2]=o*n+h,this.matrix[5]=o*n+h,this.matrix[6]=s+o*n,this.matrix[7]=o*n-h,this.matrix[10]=o*n-h,this.matrix[11]=o*n+h,this.matrix[12]=s+o*n},isNeutralState:function(i){return this.calculateMatrix(),a.BaseFilter.prototype.isNeutralState.call(this,i)},applyTo:function(i){this.calculateMatrix(),a.BaseFilter.prototype.applyTo.call(this,i)}}),r.Image.filters.HueRotation.fromObject=r.Image.filters.BaseFilter.fromObject}(c),function(u){var r=u.fabric||(u.fabric={}),a=r.util.object.clone;if(r.Text){r.warn("fabric.Text is already defined");return}var l="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");r.Text=r.util.createClass(r.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:r.Object.prototype.stateProperties.concat(l),cacheProperties:r.Object.prototype.cacheProperties.concat(l),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(i,s){this.styles=s?s.styles||{}:{},this.text=i,this.__skipDimension=!0,this.callSuper("initialize",s),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var i=this.path;i&&(i.segmentsInfo=r.util.getPathSegmentsInfo(i.path))},getMeasuringContext:function(){return r._measuringContext||(r._measuringContext=this.canvas&&this.canvas.contextCache||r.util.createCanvasElement().getContext("2d")),r._measuringContext},_splitText:function(){var i=this._splitTextIntoLines(this.text);return this.textLines=i.lines,this._textLines=i.graphemeLines,this._unwrappedTextLines=i._unwrappedLines,this._text=i.graphemeText,i},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var i,s,e,o,h,n,d,g=0,v=this._textLines.length;g<v;g++)if(!(this.textAlign!=="justify"&&(g===v-1||this.isEndOfWrapping(g)))&&(o=0,h=this._textLines[g],s=this.getLineWidth(g),s<this.width&&(d=this.textLines[g].match(this._reSpacesAndTabs)))){e=d.length,i=(this.width-s)/e;for(var _=0,b=h.length;_<=b;_++)n=this.__charBounds[g][_],this._reSpaceAndTab.test(h[_])?(n.width+=i,n.kernedWidth+=i,n.left+=o,o+=i):n.left+=o}},isEndOfWrapping:function(i){return i===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var i=this.callSuper("_getCacheCanvasDimensions"),s=this.fontSize;return i.width+=s*i.zoomX,i.height+=s*i.zoomY,i},_render:function(i){var s=this.path;s&&!s.isNotVisible()&&s._render(i),this._setTextStyles(i),this._renderTextLinesBackground(i),this._renderTextDecoration(i,"underline"),this._renderText(i),this._renderTextDecoration(i,"overline"),this._renderTextDecoration(i,"linethrough")},_renderText:function(i){this.paintFirst==="stroke"?(this._renderTextStroke(i),this._renderTextFill(i)):(this._renderTextFill(i),this._renderTextStroke(i))},_setTextStyles:function(i,s,e){if(i.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":i.textBaseline="middle";break;case"ascender":i.textBaseline="top";break;case"descender":i.textBaseline="bottom";break}i.font=this._getFontDeclaration(s,e)},calcTextWidth:function(){for(var i=this.getLineWidth(0),s=1,e=this._textLines.length;s<e;s++){var o=this.getLineWidth(s);o>i&&(i=o)}return i},_renderTextLine:function(i,s,e,o,h,n){this._renderChars(i,s,e,o,h,n)},_renderTextLinesBackground:function(i){if(!(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))){for(var s,e,o=i.fillStyle,h,n,d=this._getLeftOffset(),g=this._getTopOffset(),v=0,_=0,b,C,S=this.path,E,z=0,V=this._textLines.length;z<V;z++){if(s=this.getHeightOfLine(z),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",z)){g+=s;continue}h=this._textLines[z],e=this._getLineLeftOffset(z),_=0,v=0,n=this.getValueOfPropertyAt(z,0,"textBackgroundColor");for(var W=0,L=h.length;W<L;W++)b=this.__charBounds[z][W],C=this.getValueOfPropertyAt(z,W,"textBackgroundColor"),S?(i.save(),i.translate(b.renderLeft,b.renderTop),i.rotate(b.angle),i.fillStyle=C,C&&i.fillRect(-b.width/2,-s/this.lineHeight*(1-this._fontSizeFraction),b.width,s/this.lineHeight),i.restore()):C!==n?(E=d+e+v,this.direction==="rtl"&&(E=this.width-E-_),i.fillStyle=n,n&&i.fillRect(E,g,_,s/this.lineHeight),v=b.left,_=b.width,n=C):_+=b.kernedWidth;C&&!S&&(E=d+e+v,this.direction==="rtl"&&(E=this.width-E-_),i.fillStyle=C,i.fillRect(E,g,_,s/this.lineHeight)),g+=s}i.fillStyle=o,this._removeShadow(i)}},getFontCache:function(i){var s=i.fontFamily.toLowerCase();r.charWidthsCache[s]||(r.charWidthsCache[s]={});var e=r.charWidthsCache[s],o=i.fontStyle.toLowerCase()+"_"+(i.fontWeight+"").toLowerCase();return e[o]||(e[o]={}),e[o]},_measureChar:function(i,s,e,o){var h=this.getFontCache(s),n=this._getFontDeclaration(s),d=this._getFontDeclaration(o),g=e+i,v=n===d,_,b,C,S=s.fontSize/this.CACHE_FONT_SIZE,E;if(e&&h[e]!==void 0&&(C=h[e]),h[i]!==void 0&&(E=_=h[i]),v&&h[g]!==void 0&&(b=h[g],E=b-C),_===void 0||C===void 0||b===void 0){var z=this.getMeasuringContext();this._setTextStyles(z,s,!0)}return _===void 0&&(E=_=z.measureText(i).width,h[i]=_),C===void 0&&v&&e&&(C=z.measureText(e).width,h[e]=C),v&&b===void 0&&(b=z.measureText(g).width,h[g]=b,E=b-C),{width:_*S,kernedWidth:E*S}},getHeightOfChar:function(i,s){return this.getValueOfPropertyAt(i,s,"fontSize")},measureLine:function(i){var s=this._measureLine(i);return this.charSpacing!==0&&(s.width-=this._getWidthOfCharSpacing()),s.width<0&&(s.width=0),s},_measureLine:function(i){var s=0,e,o,h=this._textLines[i],n,d,g=0,v=new Array(h.length),_=0,b,C,S=this.path,E=this.pathSide==="right";for(this.__charBounds[i]=v,e=0;e<h.length;e++)o=h[e],d=this._getGraphemeBox(o,i,e,n),v[e]=d,s+=d.kernedWidth,n=o;if(v[e]={left:d?d.left+d.width:0,width:0,kernedWidth:0,height:this.fontSize},S){switch(C=S.segmentsInfo[S.segmentsInfo.length-1].length,b=r.util.getPointOnPath(S.path,0,S.segmentsInfo),b.x+=S.pathOffset.x,b.y+=S.pathOffset.y,this.textAlign){case"left":_=E?C-s:0;break;case"center":_=(C-s)/2;break;case"right":_=E?0:C-s;break}for(_+=this.pathStartOffset*(E?-1:1),e=E?h.length-1:0;E?e>=0:e<h.length;E?e--:e++)d=v[e],_>C?_%=C:_<0&&(_+=C),this._setGraphemeOnPath(_,d,b),_+=d.kernedWidth}return{width:s,numOfSpaces:g}},_setGraphemeOnPath:function(i,s,e){var o=i+s.kernedWidth/2,h=this.path,n=r.util.getPointOnPath(h.path,o,h.segmentsInfo);s.renderLeft=n.x-e.x,s.renderTop=n.y-e.y,s.angle=n.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(i,s,e,o,h){var n=this.getCompleteStyleDeclaration(s,e),d=o?this.getCompleteStyleDeclaration(s,e-1):{},g=this._measureChar(i,n,o,d),v=g.kernedWidth,_=g.width,b;this.charSpacing!==0&&(b=this._getWidthOfCharSpacing(),_+=b,v+=b);var C={width:_,left:0,height:n.fontSize,kernedWidth:v,deltaY:n.deltaY};if(e>0&&!h){var S=this.__charBounds[s][e-1];C.left=S.left+S.width+g.kernedWidth-g.width}return C},getHeightOfLine:function(i){if(this.__lineHeights[i])return this.__lineHeights[i];for(var s=this._textLines[i],e=this.getHeightOfChar(i,0),o=1,h=s.length;o<h;o++)e=Math.max(this.getHeightOfChar(i,o),e);return this.__lineHeights[i]=e*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var i,s=0,e=0,o=this._textLines.length;e<o;e++)i=this.getHeightOfLine(e),s+=e===o-1?i/this.lineHeight:i;return s},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(i,s){i.save();for(var e=0,o=this._getLeftOffset(),h=this._getTopOffset(),n=0,d=this._textLines.length;n<d;n++){var g=this.getHeightOfLine(n),v=g/this.lineHeight,_=this._getLineLeftOffset(n);this._renderTextLine(s,i,this._textLines[n],o+_,h+e+v,n),e+=g}i.restore()},_renderTextFill:function(i){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(i,"fillText")},_renderTextStroke:function(i){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(i),i.save(),this._setLineDash(i,this.strokeDashArray),i.beginPath(),this._renderTextCommon(i,"strokeText"),i.closePath(),i.restore())},_renderChars:function(i,s,e,o,h,n){var d=this.getHeightOfLine(n),g=this.textAlign.indexOf("justify")!==-1,v,_,b="",C,S=0,E,z=this.path,V=!g&&this.charSpacing===0&&this.isEmptyStyles(n)&&!z,W=this.direction==="ltr",L=this.direction==="ltr"?1:-1,A,X=s.canvas.getAttribute("dir");if(s.save(),X!==this.direction&&(s.canvas.setAttribute("dir",W?"ltr":"rtl"),s.direction=W?"ltr":"rtl",s.textAlign=W?"left":"right"),h-=d*this._fontSizeFraction/this.lineHeight,V){this._renderChar(i,s,n,0,e.join(""),o,h,d),s.restore();return}for(var B=0,st=e.length-1;B<=st;B++)E=B===st||this.charSpacing||z,b+=e[B],C=this.__charBounds[n][B],S===0?(o+=L*(C.kernedWidth-C.width),S+=C.width):S+=C.kernedWidth,g&&!E&&this._reSpaceAndTab.test(e[B])&&(E=!0),E||(v=v||this.getCompleteStyleDeclaration(n,B),_=this.getCompleteStyleDeclaration(n,B+1),E=r.util.hasStyleChanged(v,_,!1)),E&&(z?(s.save(),s.translate(C.renderLeft,C.renderTop),s.rotate(C.angle),this._renderChar(i,s,n,B,b,-S/2,0,d),s.restore()):(A=o,this._renderChar(i,s,n,B,b,A,h,d)),b="",v=_,o+=L*S,S=0);s.restore()},_applyPatternGradientTransformText:function(i){var s=r.util.createCanvasElement(),e,o=this.width+this.strokeWidth,h=this.height+this.strokeWidth;return s.width=o,s.height=h,e=s.getContext("2d"),e.beginPath(),e.moveTo(0,0),e.lineTo(o,0),e.lineTo(o,h),e.lineTo(0,h),e.closePath(),e.translate(o/2,h/2),e.fillStyle=i.toLive(e),this._applyPatternGradientTransform(e,i),e.fill(),e.createPattern(s,"no-repeat")},handleFiller:function(i,s,e){var o,h;return e.toLive?e.gradientUnits==="percentage"||e.gradientTransform||e.patternTransform?(o=-this.width/2,h=-this.height/2,i.translate(o,h),i[s]=this._applyPatternGradientTransformText(e),{offsetX:o,offsetY:h}):(i[s]=e.toLive(i,this),this._applyPatternGradientTransform(i,e)):(i[s]=e,{offsetX:0,offsetY:0})},_setStrokeStyles:function(i,s){return i.lineWidth=s.strokeWidth,i.lineCap=this.strokeLineCap,i.lineDashOffset=this.strokeDashOffset,i.lineJoin=this.strokeLineJoin,i.miterLimit=this.strokeMiterLimit,this.handleFiller(i,"strokeStyle",s.stroke)},_setFillStyles:function(i,s){return this.handleFiller(i,"fillStyle",s.fill)},_renderChar:function(i,s,e,o,h,n,d){var g=this._getStyleDeclaration(e,o),v=this.getCompleteStyleDeclaration(e,o),_=i==="fillText"&&v.fill,b=i==="strokeText"&&v.stroke&&v.strokeWidth,C,S;!b&&!_||(s.save(),_&&(C=this._setFillStyles(s,v)),b&&(S=this._setStrokeStyles(s,v)),s.font=this._getFontDeclaration(v),g&&g.textBackgroundColor&&this._removeShadow(s),g&&g.deltaY&&(d+=g.deltaY),_&&s.fillText(h,n-C.offsetX,d-C.offsetY),b&&s.strokeText(h,n-S.offsetX,d-S.offsetY),s.restore())},setSuperscript:function(i,s){return this._setScript(i,s,this.superscript)},setSubscript:function(i,s){return this._setScript(i,s,this.subscript)},_setScript:function(i,s,e){var o=this.get2DCursorLocation(i,!0),h=this.getValueOfPropertyAt(o.lineIndex,o.charIndex,"fontSize"),n=this.getValueOfPropertyAt(o.lineIndex,o.charIndex,"deltaY"),d={fontSize:h*e.size,deltaY:n+h*e.baseline};return this.setSelectionStyles(d,i,s),this},_getLineLeftOffset:function(i){var s=this.getLineWidth(i),e=this.width-s,o=this.textAlign,h=this.direction,d,n=0,d=this.isEndOfWrapping(i);return o==="justify"||o==="justify-center"&&!d||o==="justify-right"&&!d||o==="justify-left"&&!d?0:(o==="center"&&(n=e/2),o==="right"&&(n=e),o==="justify-center"&&(n=e/2),o==="justify-right"&&(n=e),h==="rtl"&&(n-=e),n)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var i=this._forceClearCache;return i||(i=this.hasStateChanged("_dimensionAffectingProps")),i&&(this.dirty=!0,this._forceClearCache=!1),i},getLineWidth:function(i){if(this.__lineWidths[i]!==void 0)return this.__lineWidths[i];var s=this.measureLine(i),e=s.width;return this.__lineWidths[i]=e,e},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(i,s,e){var o=this._getStyleDeclaration(i,s);return o&&typeof o[e]!="undefined"?o[e]:this[e]},_renderTextDecoration:function(i,s){if(!(!this[s]&&!this.styleHas(s))){for(var e,o,h,n,d,g,v,_,b=this._getLeftOffset(),C=this._getTopOffset(),S,E,z,V,W,L,A,X,B=this.path,st=this._getWidthOfCharSpacing(),ht=this.offsets[s],ft=0,O=this._textLines.length;ft<O;ft++){if(e=this.getHeightOfLine(ft),!this[s]&&!this.styleHas(s,ft)){C+=e;continue}v=this._textLines[ft],L=e/this.lineHeight,n=this._getLineLeftOffset(ft),E=0,z=0,_=this.getValueOfPropertyAt(ft,0,s),X=this.getValueOfPropertyAt(ft,0,"fill"),S=C+L*(1-this._fontSizeFraction),o=this.getHeightOfChar(ft,0),d=this.getValueOfPropertyAt(ft,0,"deltaY");for(var F=0,j=v.length;F<j;F++)if(V=this.__charBounds[ft][F],W=this.getValueOfPropertyAt(ft,F,s),A=this.getValueOfPropertyAt(ft,F,"fill"),h=this.getHeightOfChar(ft,F),g=this.getValueOfPropertyAt(ft,F,"deltaY"),B&&W&&A)i.save(),i.fillStyle=X,i.translate(V.renderLeft,V.renderTop),i.rotate(V.angle),i.fillRect(-V.kernedWidth/2,ht*h+g,V.kernedWidth,this.fontSize/15),i.restore();else if((W!==_||A!==X||h!==o||g!==d)&&z>0){var P=b+n+E;this.direction==="rtl"&&(P=this.width-P-z),_&&X&&(i.fillStyle=X,i.fillRect(P,S+ht*o+d,z,this.fontSize/15)),E=V.left,z=V.width,_=W,X=A,o=h,d=g}else z+=V.kernedWidth;var P=b+n+E;this.direction==="rtl"&&(P=this.width-P-z),i.fillStyle=A,W&&A&&i.fillRect(P,S+ht*o+d,z-st,this.fontSize/15),C+=e}this._removeShadow(i)}},_getFontDeclaration:function(i,s){var e=i||this,o=this.fontFamily,h=r.Text.genericFonts.indexOf(o.toLowerCase())>-1,n=o===void 0||o.indexOf("'")>-1||o.indexOf(",")>-1||o.indexOf('"')>-1||h?e.fontFamily:'"'+e.fontFamily+'"';return[r.isLikelyNode?e.fontWeight:e.fontStyle,r.isLikelyNode?e.fontStyle:e.fontWeight,s?this.CACHE_FONT_SIZE+"px":e.fontSize+"px",n].join(" ")},render:function(i){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",i)))},_splitTextIntoLines:function(i){for(var s=i.split(this._reNewline),e=new Array(s.length),o=[`
`],h=[],n=0;n<s.length;n++)e[n]=r.util.string.graphemeSplit(s[n]),h=h.concat(e[n],o);return h.pop(),{_unwrappedLines:e,lines:s,graphemeText:h,graphemeLines:e}},toObject:function(i){var s=l.concat(i),e=this.callSuper("toObject",s);return e.styles=r.util.stylesToArray(this.styles,this.text),e.path&&(e.path=this.path.toObject()),e},set:function(i,s){this.callSuper("set",i,s);var e=!1,o=!1;if(typeof i=="object")for(var h in i)h==="path"&&this.setPathInfo(),e=e||this._dimensionAffectingProps.indexOf(h)!==-1,o=o||h==="path";else e=this._dimensionAffectingProps.indexOf(i)!==-1,o=i==="path";return o&&this.setPathInfo(),e&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),r.Text.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),r.Text.DEFAULT_SVG_FONT_SIZE=16,r.Text.fromElement=function(i,s,e){if(!i)return s(null);var o=r.parseAttributes(i,r.Text.ATTRIBUTE_NAMES),h=o.textAnchor||"left";if(e=r.util.object.extend(e?a(e):{},o),e.top=e.top||0,e.left=e.left||0,o.textDecoration){var n=o.textDecoration;n.indexOf("underline")!==-1&&(e.underline=!0),n.indexOf("overline")!==-1&&(e.overline=!0),n.indexOf("line-through")!==-1&&(e.linethrough=!0),delete e.textDecoration}"dx"in o&&(e.left+=o.dx),"dy"in o&&(e.top+=o.dy),"fontSize"in e||(e.fontSize=r.Text.DEFAULT_SVG_FONT_SIZE);var d="";"textContent"in i?d=i.textContent:"firstChild"in i&&i.firstChild!==null&&"data"in i.firstChild&&i.firstChild.data!==null&&(d=i.firstChild.data),d=d.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var g=e.strokeWidth;e.strokeWidth=0;var v=new r.Text(d,e),_=v.getScaledHeight()/v.height,b=(v.height+v.strokeWidth)*v.lineHeight-v.height,C=b*_,S=v.getScaledHeight()+C,E=0;h==="center"&&(E=v.getScaledWidth()/2),h==="right"&&(E=v.getScaledWidth()),v.set({left:v.left-E,top:v.top-(S-v.fontSize*(.07+v._fontSizeFraction))/v.lineHeight,strokeWidth:typeof g!="undefined"?g:1}),s(v)},r.Text.fromObject=function(i,s){var e=a(i),o=i.path;return delete e.path,r.Object._fromObject("Text",e,function(h){h.styles=r.util.stylesFromArray(i.styles,i.text),o?r.Object._fromObject("Path",o,function(n){h.set("path",n),s(h)},"path"):s(h)},"text")},r.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],r.util.createAccessors&&r.util.createAccessors(r.Text)}(c),function(){t.util.object.extend(t.Text.prototype,{isEmptyStyles:function(u){if(!this.styles||typeof u!="undefined"&&!this.styles[u])return!0;var r=typeof u=="undefined"?this.styles:{line:this.styles[u]};for(var a in r)for(var l in r[a])for(var i in r[a][l])return!1;return!0},styleHas:function(u,r){if(!this.styles||!u||u===""||typeof r!="undefined"&&!this.styles[r])return!1;var a=typeof r=="undefined"?this.styles:{0:this.styles[r]};for(var l in a)for(var i in a[l])if(typeof a[l][i][u]!="undefined")return!0;return!1},cleanStyle:function(u){if(!this.styles||!u||u==="")return!1;var r=this.styles,a=0,l,i,s=!0,e=0,o;for(var h in r){l=0;for(var n in r[h]){var o=r[h][n],d=o.hasOwnProperty(u);a++,d?(i?o[u]!==i&&(s=!1):i=o[u],o[u]===this[u]&&delete o[u]):s=!1,Object.keys(o).length!==0?l++:delete r[h][n]}l===0&&delete r[h]}for(var g=0;g<this._textLines.length;g++)e+=this._textLines[g].length;s&&a===e&&(this[u]=i,this.removeStyle(u))},removeStyle:function(u){if(!(!this.styles||!u||u==="")){var r=this.styles,a,l,i;for(l in r){a=r[l];for(i in a)delete a[i][u],Object.keys(a[i]).length===0&&delete a[i];Object.keys(a).length===0&&delete r[l]}}},_extendStyles:function(u,r){var a=this.get2DCursorLocation(u);this._getLineStyle(a.lineIndex)||this._setLineStyle(a.lineIndex),this._getStyleDeclaration(a.lineIndex,a.charIndex)||this._setStyleDeclaration(a.lineIndex,a.charIndex,{}),t.util.object.extend(this._getStyleDeclaration(a.lineIndex,a.charIndex),r)},get2DCursorLocation:function(u,r){typeof u=="undefined"&&(u=this.selectionStart);for(var a=r?this._unwrappedTextLines:this._textLines,l=a.length,i=0;i<l;i++){if(u<=a[i].length)return{lineIndex:i,charIndex:u};u-=a[i].length+this.missingNewlineOffset(i)}return{lineIndex:i-1,charIndex:a[i-1].length<u?a[i-1].length:u}},getSelectionStyles:function(u,r,a){typeof u=="undefined"&&(u=this.selectionStart||0),typeof r=="undefined"&&(r=this.selectionEnd||u);for(var l=[],i=u;i<r;i++)l.push(this.getStyleAtPosition(i,a));return l},getStyleAtPosition:function(u,r){var a=this.get2DCursorLocation(u),l=r?this.getCompleteStyleDeclaration(a.lineIndex,a.charIndex):this._getStyleDeclaration(a.lineIndex,a.charIndex);return l||{}},setSelectionStyles:function(u,r,a){typeof r=="undefined"&&(r=this.selectionStart||0),typeof a=="undefined"&&(a=this.selectionEnd||r);for(var l=r;l<a;l++)this._extendStyles(l,u);return this._forceClearCache=!0,this},_getStyleDeclaration:function(u,r){var a=this.styles&&this.styles[u];return a?a[r]:null},getCompleteStyleDeclaration:function(u,r){for(var a=this._getStyleDeclaration(u,r)||{},l={},i,s=0;s<this._styleProperties.length;s++)i=this._styleProperties[s],l[i]=typeof a[i]=="undefined"?this[i]:a[i];return l},_setStyleDeclaration:function(u,r,a){this.styles[u][r]=a},_deleteStyleDeclaration:function(u,r){delete this.styles[u][r]},_getLineStyle:function(u){return!!this.styles[u]},_setLineStyle:function(u){this.styles[u]={}},_deleteLineStyle:function(u){delete this.styles[u]}})}(),function(){function u(r){r.textDecoration&&(r.textDecoration.indexOf("underline")>-1&&(r.underline=!0),r.textDecoration.indexOf("line-through")>-1&&(r.linethrough=!0),r.textDecoration.indexOf("overline")>-1&&(r.overline=!0),delete r.textDecoration)}t.IText=t.util.createClass(t.Text,t.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(r,a){this.callSuper("initialize",r,a),this.initBehavior()},setSelectionStart:function(r){r=Math.max(r,0),this._updateAndFire("selectionStart",r)},setSelectionEnd:function(r){r=Math.min(r,this.text.length),this._updateAndFire("selectionEnd",r)},_updateAndFire:function(r,a){this[r]!==a&&(this._fireSelectionChanged(),this[r]=a),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(r){this.clearContextTop(),this.callSuper("render",r),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(r){this.callSuper("_render",r)},clearContextTop:function(r){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var a=this.canvas.contextTop,l=this.canvas.viewportTransform;a.save(),a.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this.transform(a),this._clearTextArea(a),r||a.restore()}},renderCursorOrSelection:function(){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var r=this._getCursorBoundaries(),a=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(r,a):this.renderSelection(r,a),a.restore()}},_clearTextArea:function(r){var a=this.width+4,l=this.height+4;r.clearRect(-a/2,-l/2,a,l)},_getCursorBoundaries:function(r){typeof r=="undefined"&&(r=this.selectionStart);var a=this._getLeftOffset(),l=this._getTopOffset(),i=this._getCursorBoundariesOffsets(r);return{left:a,top:l,leftOffset:i.left,topOffset:i.top}},_getCursorBoundariesOffsets:function(r){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var a,l,i,s=0,e=0,o,h=this.get2DCursorLocation(r);i=h.charIndex,l=h.lineIndex;for(var n=0;n<l;n++)s+=this.getHeightOfLine(n);a=this._getLineLeftOffset(l);var d=this.__charBounds[l][i];return d&&(e=d.left),this.charSpacing!==0&&i===this._textLines[l].length&&(e-=this._getWidthOfCharSpacing()),o={top:s,left:a+(e>0?e:0)},this.direction==="rtl"&&(o.left*=-1),this.cursorOffsetCache=o,this.cursorOffsetCache},renderCursor:function(r,a){var l=this.get2DCursorLocation(),i=l.lineIndex,s=l.charIndex>0?l.charIndex-1:0,e=this.getValueOfPropertyAt(i,s,"fontSize"),o=this.scaleX*this.canvas.getZoom(),h=this.cursorWidth/o,n=r.topOffset,d=this.getValueOfPropertyAt(i,s,"deltaY");n+=(1-this._fontSizeFraction)*this.getHeightOfLine(i)/this.lineHeight-e*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(r,a),a.fillStyle=this.cursorColor||this.getValueOfPropertyAt(i,s,"fill"),a.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,a.fillRect(r.left+r.leftOffset-h/2,n+r.top+d,h,e)},renderSelection:function(r,a){for(var l=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,i=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,s=this.textAlign.indexOf("justify")!==-1,e=this.get2DCursorLocation(l),o=this.get2DCursorLocation(i),h=e.lineIndex,n=o.lineIndex,d=e.charIndex<0?0:e.charIndex,g=o.charIndex<0?0:o.charIndex,v=h;v<=n;v++){var _=this._getLineLeftOffset(v)||0,b=this.getHeightOfLine(v),C=0,S=0,E=0;if(v===h&&(S=this.__charBounds[h][d].left),v>=h&&v<n)E=s&&!this.isEndOfWrapping(v)?this.width:this.getLineWidth(v)||5;else if(v===n)if(g===0)E=this.__charBounds[n][g].left;else{var z=this._getWidthOfCharSpacing();E=this.__charBounds[n][g-1].left+this.__charBounds[n][g-1].width-z}C=b,(this.lineHeight<1||v===n&&this.lineHeight>1)&&(b/=this.lineHeight);var V=r.left+_+S,W=E-S,L=b,A=0;this.inCompositionMode?(a.fillStyle=this.compositionColor||"black",L=1,A=b):a.fillStyle=this.selectionColor,this.direction==="rtl"&&(V=this.width-V-W),a.fillRect(V,r.top+r.topOffset+A,W,L),r.topOffset+=C}},getCurrentCharFontSize:function(){var r=this._getCurrentCharIndex();return this.getValueOfPropertyAt(r.l,r.c,"fontSize")},getCurrentCharColor:function(){var r=this._getCurrentCharIndex();return this.getValueOfPropertyAt(r.l,r.c,"fill")},_getCurrentCharIndex:function(){var r=this.get2DCursorLocation(this.selectionStart,!0),a=r.charIndex>0?r.charIndex-1:0;return{l:r.lineIndex,c:a}}}),t.IText.fromObject=function(r,a){var l=t.util.stylesFromArray(r.styles,r.text),i=Object.assign({},r,{styles:l});if(u(i),i.styles)for(var s in i.styles)for(var e in i.styles[s])u(i.styles[s][e]);t.Object._fromObject("IText",i,a,"text")}}(),function(){var u=t.util.object.clone;t.util.object.extend(t.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var r=this;this.on("added",function(){var a=r.canvas;a&&(a._hasITextHandlers||(a._hasITextHandlers=!0,r._initCanvasHandlers(a)),a._iTextInstances=a._iTextInstances||[],a._iTextInstances.push(r))})},initRemovedHandler:function(){var r=this;this.on("removed",function(){var a=r.canvas;a&&(a._iTextInstances=a._iTextInstances||[],t.util.removeFromArray(a._iTextInstances,r),a._iTextInstances.length===0&&(a._hasITextHandlers=!1,r._removeCanvasHandlers(a)))})},_initCanvasHandlers:function(r){r._mouseUpITextHandler=function(){r._iTextInstances&&r._iTextInstances.forEach(function(a){a.__isMousedown=!1})},r.on("mouse:up",r._mouseUpITextHandler)},_removeCanvasHandlers:function(r){r.off("mouse:up",r._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(r,a,l,i){var s;return s={isAborted:!1,abort:function(){this.isAborted=!0}},r.animate("_currentCursorOpacity",a,{duration:l,onComplete:function(){s.isAborted||r[i]()},onChange:function(){r.canvas&&r.selectionStart===r.selectionEnd&&r.renderCursorOrSelection()},abort:function(){return s.isAborted}}),s},_onTickComplete:function(){var r=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){r._currentTickCompleteState=r._animateCursor(r,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(r){var a=this,l=r?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){a._tick()},l)},abortCursorAnimation:function(){var r=this._currentTickState||this._currentTickCompleteState,a=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,r&&a&&a.clearContext(a.contextTop||a.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(r){var a=0,l=r-1;if(this._reSpace.test(this._text[l]))for(;this._reSpace.test(this._text[l]);)a++,l--;for(;/\S/.test(this._text[l])&&l>-1;)a++,l--;return r-a},findWordBoundaryRight:function(r){var a=0,l=r;if(this._reSpace.test(this._text[l]))for(;this._reSpace.test(this._text[l]);)a++,l++;for(;/\S/.test(this._text[l])&&l<this._text.length;)a++,l++;return r+a},findLineBoundaryLeft:function(r){for(var a=0,l=r-1;!/\n/.test(this._text[l])&&l>-1;)a++,l--;return r-a},findLineBoundaryRight:function(r){for(var a=0,l=r;!/\n/.test(this._text[l])&&l<this._text.length;)a++,l++;return r+a},searchWordBoundary:function(r,a){for(var l=this._text,i=this._reSpace.test(l[r])?r-1:r,s=l[i],e=t.reNonWord;!e.test(s)&&i>0&&i<l.length;)i+=a,s=l[i];return e.test(s)&&(i+=a===1?0:1),i},selectWord:function(r){r=r||this.selectionStart;var a=this.searchWordBoundary(r,-1),l=this.searchWordBoundary(r,1);this.selectionStart=a,this.selectionEnd=l,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(r){r=r||this.selectionStart;var a=this.findLineBoundaryLeft(r),l=this.findLineBoundaryRight(r);return this.selectionStart=a,this.selectionEnd=l,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(r){if(!(this.isEditing||!this.editable))return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(r),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(r){r._iTextInstances&&r._iTextInstances.forEach(function(a){a.selected=!1,a.isEditing&&a.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(r){if(!(!this.__isMousedown||!this.isEditing)){document.activeElement!==this.hiddenTextarea&&this.hiddenTextarea.focus();var a=this.getSelectionStartFromPointer(r.e),l=this.selectionStart,i=this.selectionEnd;(a!==this.__selectionStartOnMouseDown||l===i)&&(l===a||i===a)||(a>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=a):(this.selectionStart=a,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==l||this.selectionEnd!==i)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(r,a,l){var i=l.slice(0,r),s=t.util.string.graphemeSplit(i).length;if(r===a)return{selectionStart:s,selectionEnd:s};var e=l.slice(r,a),o=t.util.string.graphemeSplit(e).length;return{selectionStart:s,selectionEnd:s+o}},fromGraphemeToStringSelection:function(r,a,l){var i=l.slice(0,r),s=i.join("").length;if(r===a)return{selectionStart:s,selectionEnd:s};var e=l.slice(r,a),o=e.join("").length;return{selectionStart:s,selectionEnd:s+o}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var r=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=r.selectionStart,this.hiddenTextarea.selectionEnd=r.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var r=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=r.selectionEnd,this.inCompositionMode||(this.selectionStart=r.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var r=this._calcTextareaPosition();this.hiddenTextarea.style.left=r.left,this.hiddenTextarea.style.top=r.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var r=this.inCompositionMode?this.compositionStart:this.selectionStart,a=this._getCursorBoundaries(r),l=this.get2DCursorLocation(r),i=l.lineIndex,s=l.charIndex,e=this.getValueOfPropertyAt(i,s,"fontSize")*this.lineHeight,o=a.leftOffset,h=this.calcTransformMatrix(),n={x:a.left+o,y:a.top+a.topOffset+e},d=this.canvas.getRetinaScaling(),g=this.canvas.upperCanvasEl,v=g.width/d,_=g.height/d,b=v-e,C=_-e,S=g.clientWidth/v,E=g.clientHeight/_;return n=t.util.transformPoint(n,h),n=t.util.transformPoint(n,this.canvas.viewportTransform),n.x*=S,n.y*=E,n.x<0&&(n.x=0),n.x>b&&(n.x=b),n.y<0&&(n.y=0),n.y>C&&(n.y=C),n.x+=this.canvas._offset.left,n.y+=this.canvas._offset.top,{left:n.x+"px",top:n.y+"px",fontSize:e+"px",charHeight:e}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var r=this._textBeforeEdit!==this.text,a=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,a&&(a.blur&&a.blur(),a.parentNode&&a.parentNode.removeChild(a)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),r&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),r&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var r in this.styles)this._textLines[r]||delete this.styles[r]},removeStyleFromTo:function(r,a){var l=this.get2DCursorLocation(r,!0),i=this.get2DCursorLocation(a,!0),s=l.lineIndex,e=l.charIndex,o=i.lineIndex,h=i.charIndex,n,d;if(s!==o){if(this.styles[s])for(n=e;n<this._unwrappedTextLines[s].length;n++)delete this.styles[s][n];if(this.styles[o])for(n=h;n<this._unwrappedTextLines[o].length;n++)d=this.styles[o][n],d&&(this.styles[s]||(this.styles[s]={}),this.styles[s][e+n-h]=d);for(n=s+1;n<=o;n++)delete this.styles[n];this.shiftLineStyles(o,s-o)}else if(this.styles[s]){d=this.styles[s];var g=h-e,v,_;for(n=e;n<h;n++)delete d[n];for(_ in this.styles[s])v=parseInt(_,10),v>=h&&(d[v-g]=d[_],delete d[_])}},shiftLineStyles:function(r,a){var l=u(this.styles);for(var i in this.styles){var s=parseInt(i,10);s>r&&(this.styles[s+a]=l[s],l[s-a]||delete this.styles[s])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(r,a,l,i){var s,e={},o=!1,h=this._unwrappedTextLines[r].length===a;l||(l=1),this.shiftLineStyles(r,l),this.styles[r]&&(s=this.styles[r][a===0?a:a-1]);for(var n in this.styles[r]){var d=parseInt(n,10);d>=a&&(o=!0,e[d-a]=this.styles[r][n],h&&a===0||delete this.styles[r][n])}var g=!1;for(o&&!h&&(this.styles[r+l]=e,g=!0),g&&l--;l>0;)i&&i[l-1]?this.styles[r+l]={0:u(i[l-1])}:s?this.styles[r+l]={0:u(s)}:delete this.styles[r+l],l--;this._forceClearCache=!0},insertCharStyleObject:function(r,a,l,i){this.styles||(this.styles={});var s=this.styles[r],e=s?u(s):{};l||(l=1);for(var o in e){var h=parseInt(o,10);h>=a&&(s[h+l]=e[h],e[h-l]||delete s[h])}if(this._forceClearCache=!0,i){for(;l--;)Object.keys(i[l]).length&&(this.styles[r]||(this.styles[r]={}),this.styles[r][a+l]=u(i[l]));return}if(s)for(var n=s[a?a-1:1];n&&l--;)this.styles[r][a+l]=u(n)},insertNewStyleBlock:function(r,a,l){for(var i=this.get2DCursorLocation(a,!0),s=[0],e=0,o=0;o<r.length;o++)r[o]===`
`?(e++,s[e]=0):s[e]++;s[0]>0&&(this.insertCharStyleObject(i.lineIndex,i.charIndex,s[0],l),l=l&&l.slice(s[0]+1)),e&&this.insertNewlineStyleObject(i.lineIndex,i.charIndex+s[0],e);for(var o=1;o<e;o++)s[o]>0?this.insertCharStyleObject(i.lineIndex+o,0,s[o],l):l&&this.styles[i.lineIndex+o]&&l[0]&&(this.styles[i.lineIndex+o][0]=l[0]),l=l&&l.slice(s[o]+1);s[o]>0&&this.insertCharStyleObject(i.lineIndex+o,0,s[o],l)},setSelectionStartEndWithShift:function(r,a,l){l<=r?(a===r?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=r),this.selectionStart=l):l>r&&l<a?this._selectionDirection==="right"?this.selectionEnd=l:this.selectionStart=l:(a===r?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=a),this.selectionEnd=l)},setSelectionInBoundaries:function(){var r=this.text.length;this.selectionStart>r?this.selectionStart=r:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>r?this.selectionEnd=r:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),t.util.object.extend(t.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(u){if(this.canvas){this.__newClickTime=+new Date;var r=u.pointer;this.isTripleClick(r)&&(this.fire("tripleclick",u),this._stopEvent(u.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=r,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(u){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===u.x&&this.__lastPointer.y===u.y},_stopEvent:function(u){u.preventDefault&&u.preventDefault(),u.stopPropagation&&u.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(u){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(u.e))},tripleClickHandler:function(u){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(u.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(u){!this.canvas||!this.editable||u.e.button&&u.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(u.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(u){!this.canvas||!this.editable||u.e.button&&u.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(u){if(this.__isMousedown=!1,!(!this.editable||this.group||u.transform&&u.transform.actionPerformed||u.e.button&&u.e.button!==1)){if(this.canvas){var r=this.canvas._activeObject;if(r&&r!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(u.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(u){var r=this.getSelectionStartFromPointer(u),a=this.selectionStart,l=this.selectionEnd;u.shiftKey?this.setSelectionStartEndWithShift(a,l,r):(this.selectionStart=r,this.selectionEnd=r),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(u){for(var r=this.getLocalPointer(u),a=0,l=0,i=0,s=0,e=0,o,h,n=0,d=this._textLines.length;n<d&&i<=r.y;n++)i+=this.getHeightOfLine(n)*this.scaleY,e=n,n>0&&(s+=this._textLines[n-1].length+this.missingNewlineOffset(n-1));o=this._getLineLeftOffset(e),l=o*this.scaleX,h=this._textLines[e],this.direction==="rtl"&&(r.x=this.width*this.scaleX-r.x+l);for(var g=0,v=h.length;g<v&&(a=l,l+=this.__charBounds[e][g].kernedWidth*this.scaleX,l<=r.x);g++)s++;return this._getNewSelectionStartFromOffset(r,a,l,s,v)},_getNewSelectionStartFromOffset:function(u,r,a,l,i){var s=u.x-r,e=a-u.x,o=e>s||e<0?0:1,h=l+o;return this.flipX&&(h=i-h),h>this._text.length&&(h=this._text.length),h}}),t.util.object.extend(t.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=t.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var u=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+u.top+"; left: "+u.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: "+u.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):t.document.body.appendChild(this.hiddenTextarea),t.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),t.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),t.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),t.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(t.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(u){if(this.isEditing){var r=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(u.keyCode in r)this[r[u.keyCode]](u);else if(u.keyCode in this.ctrlKeysMapDown&&(u.ctrlKey||u.metaKey))this[this.ctrlKeysMapDown[u.keyCode]](u);else return;u.stopImmediatePropagation(),u.preventDefault(),u.keyCode>=33&&u.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(u){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(u.keyCode in this.ctrlKeysMapUp&&(u.ctrlKey||u.metaKey))this[this.ctrlKeysMapUp[u.keyCode]](u);else return;u.stopImmediatePropagation(),u.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(u){var r=this.fromPaste;if(this.fromPaste=!1,u&&u.stopPropagation(),!!this.isEditing){var a=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,l=this._text.length,i=a.length,s,e,o=i-l,h=this.selectionStart,n=this.selectionEnd,d=h!==n,g,v,_;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var b=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),C=h>b.selectionStart;d?(s=this._text.slice(h,n),o+=n-h):i<l&&(C?s=this._text.slice(n+o,n):s=this._text.slice(h,h-o)),e=a.slice(b.selectionEnd-o,b.selectionEnd),s&&s.length&&(e.length&&(g=this.getSelectionStyles(h,h+1,!1),g=e.map(function(){return g[0]})),d?(v=h,_=n):C?(v=n-s.length,_=n):(v=n,_=n+s.length),this.removeStyleFromTo(v,_)),e.length&&(r&&e.join("")===t.copiedText&&!t.disableStyleCopyPaste&&(g=t.copiedTextStyle),this.insertNewStyleBlock(e,h,g)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(u){this.compositionStart=u.target.selectionStart,this.compositionEnd=u.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(t.copiedText=this.getSelectedText(),t.disableStyleCopyPaste?t.copiedTextStyle=null:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(u){return u&&u.clipboardData||t.window.clipboardData},_getWidthBeforeCursor:function(u,r){var a=this._getLineLeftOffset(u),l;return r>0&&(l=this.__charBounds[u][r-1],a+=l.left+l.width),a},getDownCursorOffset:function(u,r){var a=this._getSelectionForOffset(u,r),l=this.get2DCursorLocation(a),i=l.lineIndex;if(i===this._textLines.length-1||u.metaKey||u.keyCode===34)return this._text.length-a;var s=l.charIndex,e=this._getWidthBeforeCursor(i,s),o=this._getIndexOnLine(i+1,e),h=this._textLines[i].slice(s);return h.length+o+1+this.missingNewlineOffset(i)},_getSelectionForOffset:function(u,r){return u.shiftKey&&this.selectionStart!==this.selectionEnd&&r?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(u,r){var a=this._getSelectionForOffset(u,r),l=this.get2DCursorLocation(a),i=l.lineIndex;if(i===0||u.metaKey||u.keyCode===33)return-a;var s=l.charIndex,e=this._getWidthBeforeCursor(i,s),o=this._getIndexOnLine(i-1,e),h=this._textLines[i].slice(0,s),n=this.missingNewlineOffset(i-1);return-this._textLines[i-1].length+o-h.length+(1-n)},_getIndexOnLine:function(u,r){for(var a=this._textLines[u],l=this._getLineLeftOffset(u),i=l,s=0,e,o,h=0,n=a.length;h<n;h++)if(e=this.__charBounds[u][h].width,i+=e,i>r){o=!0;var d=i-e,g=i,v=Math.abs(d-r),_=Math.abs(g-r);s=_<v?h:h-1;break}return o||(s=a.length-1),s},moveCursorDown:function(u){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",u)},moveCursorUp:function(u){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",u)},_moveCursorUpOrDown:function(u,r){var a="get"+u+"CursorOffset",l=this[a](r,this._selectionDirection==="right");r.shiftKey?this.moveCursorWithShift(l):this.moveCursorWithoutShift(l),l!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(u){var r=this._selectionDirection==="left"?this.selectionStart+u:this.selectionEnd+u;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,r),u!==0},moveCursorWithoutShift:function(u){return u<0?(this.selectionStart+=u,this.selectionEnd=this.selectionStart):(this.selectionEnd+=u,this.selectionStart=this.selectionEnd),u!==0},moveCursorLeft:function(u){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",u)},_move:function(u,r,a){var l;if(u.altKey)l=this["findWordBoundary"+a](this[r]);else if(u.metaKey||u.keyCode===35||u.keyCode===36)l=this["findLineBoundary"+a](this[r]);else return this[r]+=a==="Left"?-1:1,!0;if(typeof l!="undefined"&&this[r]!==l)return this[r]=l,!0},_moveLeft:function(u,r){return this._move(u,r,"Left")},_moveRight:function(u,r){return this._move(u,r,"Right")},moveCursorLeftWithoutShift:function(u){var r=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(r=this._moveLeft(u,"selectionStart")),this.selectionEnd=this.selectionStart,r},moveCursorLeftWithShift:function(u){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(u,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(u,"selectionStart")},moveCursorRight:function(u){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",u)},_moveCursorLeftOrRight:function(u,r){var a="moveCursor"+u+"With";this._currentCursorOpacity=1,r.shiftKey?a+="Shift":a+="outShift",this[a](r)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(u){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(u,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(u,"selectionEnd")},moveCursorRightWithoutShift:function(u){var r=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(r=this._moveRight(u,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,r},removeChars:function(u,r){typeof r=="undefined"&&(r=u+1),this.removeStyleFromTo(u,r),this._text.splice(u,r-u),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(u,r,a,l){typeof l=="undefined"&&(l=a),l>a&&this.removeStyleFromTo(a,l);var i=t.util.string.graphemeSplit(u);this.insertNewStyleBlock(i,a,r),this._text=[].concat(this._text.slice(0,a),i,this._text.slice(l)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var u=t.util.toFixed,r=/  +/g;t.util.object.extend(t.Text.prototype,{_toSVG:function(){var a=this._getSVGLeftTopOffsets(),l=this._getSVGTextAndBg(a.textTop,a.textLeft);return this._wrapSVGTextAndBg(l)},toSVG:function(a){return this._createBaseSVGMarkup(this._toSVG(),{reviver:a,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(a){var l=!0,i=this.getSvgTextDecoration(this);return[a.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",i?'text-decoration="'+i+'" ':"",'style="',this.getSvgStyles(l),'"',this.addPaintOrder()," >",a.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(a,l){var i=[],s=[],e=a,o;this._setSVGBg(s);for(var h=0,n=this._textLines.length;h<n;h++)o=this._getLineLeftOffset(h),(this.textBackgroundColor||this.styleHas("textBackgroundColor",h))&&this._setSVGTextLineBg(s,h,l+o,e),this._setSVGTextLineText(i,h,l+o,e),e+=this.getHeightOfLine(h);return{textSpans:i,textBgRects:s}},_createTextCharSpan:function(a,l,i,s){var e=a!==a.trim()||a.match(r),o=this.getSvgSpanStyles(l,e),h=o?'style="'+o+'"':"",n=l.deltaY,d="",g=t.Object.NUM_FRACTION_DIGITS;return n&&(d=' dy="'+u(n,g)+'" '),['<tspan x="',u(i,g),'" y="',u(s,g),'" ',d,h,">",t.util.string.escapeXml(a),"</tspan>"].join("")},_setSVGTextLineText:function(a,l,i,s){var e=this.getHeightOfLine(l),o=this.textAlign.indexOf("justify")!==-1,h,n,d="",g,v,_=0,b=this._textLines[l],C;s+=e*(1-this._fontSizeFraction)/this.lineHeight;for(var S=0,E=b.length-1;S<=E;S++)C=S===E||this.charSpacing,d+=b[S],g=this.__charBounds[l][S],_===0?(i+=g.kernedWidth-g.width,_+=g.width):_+=g.kernedWidth,o&&!C&&this._reSpaceAndTab.test(b[S])&&(C=!0),C||(h=h||this.getCompleteStyleDeclaration(l,S),n=this.getCompleteStyleDeclaration(l,S+1),C=t.util.hasStyleChanged(h,n,!0)),C&&(v=this._getStyleDeclaration(l,S)||{},a.push(this._createTextCharSpan(d,v,i,s)),d="",h=n,i+=_,_=0)},_pushTextBgRect:function(a,l,i,s,e,o){var h=t.Object.NUM_FRACTION_DIGITS;a.push("		<rect ",this._getFillAttributes(l),' x="',u(i,h),'" y="',u(s,h),'" width="',u(e,h),'" height="',u(o,h),`"></rect>
`)},_setSVGTextLineBg:function(a,l,i,s){for(var e=this._textLines[l],o=this.getHeightOfLine(l)/this.lineHeight,h=0,n=0,d,g,v=this.getValueOfPropertyAt(l,0,"textBackgroundColor"),_=0,b=e.length;_<b;_++)d=this.__charBounds[l][_],g=this.getValueOfPropertyAt(l,_,"textBackgroundColor"),g!==v?(v&&this._pushTextBgRect(a,v,i+n,s,h,o),n=d.left,h=d.width,v=g):h+=d.kernedWidth;g&&this._pushTextBgRect(a,g,i+n,s,h,o)},_getFillAttributes:function(a){var l=a&&typeof a=="string"?new t.Color(a):"";return!l||!l.getSource()||l.getAlpha()===1?'fill="'+a+'"':'opacity="'+l.getAlpha()+'" fill="'+l.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(a){for(var l=0,i=0,s=0;s<a;s++)l+=this.getHeightOfLine(s);return i=this.getHeightOfLine(s),{lineTop:l,offset:(this._fontSizeMult-this._fontSizeFraction)*i/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(a){var l=t.Object.prototype.getSvgStyles.call(this,a);return l+" white-space: pre;"}})}(),function(u){var r=u.fabric||(u.fabric={});r.Textbox=r.util.createClass(r.IText,r.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:r.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(a){for(var l=0,i=0,s=0,e={},o=0;o<a.graphemeLines.length;o++)a.graphemeText[s]===`
`&&o>0?(i=0,s++,l++):!this.splitByGrapheme&&this._reSpaceAndTab.test(a.graphemeText[s])&&o>0&&(i++,s++),e[o]={line:l,offset:i},s+=a.graphemeLines[o].length,i+=a.graphemeLines[o].length;return e},styleHas:function(a,l){if(this._styleMap&&!this.isWrapping){var i=this._styleMap[l];i&&(l=i.line)}return r.Text.prototype.styleHas.call(this,a,l)},isEmptyStyles:function(a){if(!this.styles)return!0;var l=0,i=a+1,s,e,o=!1,h=this._styleMap[a],n=this._styleMap[a+1];h&&(a=h.line,l=h.offset),n&&(i=n.line,o=i===a,s=n.offset),e=typeof a=="undefined"?this.styles:{line:this.styles[a]};for(var d in e)for(var g in e[d])if(g>=l&&(!o||g<s))for(var v in e[d][g])return!1;return!0},_getStyleDeclaration:function(a,l){if(this._styleMap&&!this.isWrapping){var i=this._styleMap[a];if(!i)return null;a=i.line,l=i.offset+l}return this.callSuper("_getStyleDeclaration",a,l)},_setStyleDeclaration:function(a,l,i){var s=this._styleMap[a];a=s.line,l=s.offset+l,this.styles[a][l]=i},_deleteStyleDeclaration:function(a,l){var i=this._styleMap[a];a=i.line,l=i.offset+l,delete this.styles[a][l]},_getLineStyle:function(a){var l=this._styleMap[a];return!!this.styles[l.line]},_setLineStyle:function(a){var l=this._styleMap[a];this.styles[l.line]={}},_wrapText:function(a,l){var i=[],s;for(this.isWrapping=!0,s=0;s<a.length;s++)i=i.concat(this._wrapLine(a[s],s,l));return this.isWrapping=!1,i},_measureWord:function(a,l,i){var s=0,e,o=!0;i=i||0;for(var h=0,n=a.length;h<n;h++){var d=this._getGraphemeBox(a[h],l,h+i,e,o);s+=d.kernedWidth,e=a[h]}return s},_wrapLine:function(a,l,i,V){var e=0,o=this.splitByGrapheme,h=[],n=[],d=o?r.util.string.graphemeSplit(a):a.split(this._wordJoiners),g="",v=0,_=o?"":" ",b=0,C=0,S=0,E=!0,z=this._getWidthOfCharSpacing(),V=V||0;d.length===0&&d.push([]),i-=V;for(var W=0;W<d.length;W++)g=o?d[W]:r.util.string.graphemeSplit(d[W]),b=this._measureWord(g,l,v),v+=g.length,e+=C+b-z,e>i&&!E?(h.push(n),n=[],e=b,E=!0):e+=z,!E&&!o&&n.push(_),n=n.concat(g),C=o?0:this._measureWord([_],l,v),v++,E=!1,b>S&&(S=b);return W&&h.push(n),S+V>this.dynamicMinWidth&&(this.dynamicMinWidth=S-z+V),h},isEndOfWrapping:function(a){return!this._styleMap[a+1]||this._styleMap[a+1].line!==this._styleMap[a].line},missingNewlineOffset:function(a){return this.splitByGrapheme?this.isEndOfWrapping(a)?1:0:1},_splitTextIntoLines:function(a){for(var l=r.Text.prototype._splitTextIntoLines.call(this,a),i=this._wrapText(l.lines,this.width),s=new Array(i.length),e=0;e<i.length;e++)s[e]=i[e].join("");return l.lines=s,l.graphemeLines=i,l},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var a={};for(var l in this._styleMap)this._textLines[l]&&(a[this._styleMap[l].line]=1);for(var l in this.styles)a[l]||delete this.styles[l]},toObject:function(a){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(a))}}),r.Textbox.fromObject=function(a,l){var i=r.util.stylesFromArray(a.styles,a.text),s=Object.assign({},a,{styles:i});return r.Object._fromObject("Textbox",s,l,"text")}}(c),function(){var u=t.controlsUtils,r=u.scaleSkewCursorStyleHandler,a=u.scaleCursorStyleHandler,l=u.scalingEqually,i=u.scalingYOrSkewingX,s=u.scalingXOrSkewingY,e=u.scaleOrSkewActionName,o=t.Object.prototype.controls;if(o.ml=new t.Control({x:-.5,y:0,cursorStyleHandler:r,actionHandler:s,getActionName:e}),o.mr=new t.Control({x:.5,y:0,cursorStyleHandler:r,actionHandler:s,getActionName:e}),o.mb=new t.Control({x:0,y:.5,cursorStyleHandler:r,actionHandler:i,getActionName:e}),o.mt=new t.Control({x:0,y:-.5,cursorStyleHandler:r,actionHandler:i,getActionName:e}),o.tl=new t.Control({x:-.5,y:-.5,cursorStyleHandler:a,actionHandler:l}),o.tr=new t.Control({x:.5,y:-.5,cursorStyleHandler:a,actionHandler:l}),o.bl=new t.Control({x:-.5,y:.5,cursorStyleHandler:a,actionHandler:l}),o.br=new t.Control({x:.5,y:.5,cursorStyleHandler:a,actionHandler:l}),o.mtr=new t.Control({x:0,y:-.5,actionHandler:u.rotationWithSnapping,cursorStyleHandler:u.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),t.Textbox){var h=t.Textbox.prototype.controls={};h.mtr=o.mtr,h.tr=o.tr,h.br=o.br,h.tl=o.tl,h.bl=o.bl,h.mt=o.mt,h.mb=o.mb,h.mr=new t.Control({x:.5,y:0,actionHandler:u.changeWidth,cursorStyleHandler:r,actionName:"resizing"}),h.ml=new t.Control({x:-.5,y:0,actionHandler:u.changeWidth,cursorStyleHandler:r,actionName:"resizing"})}}()})(K);const tu={key:0},eu=I("p",{style:{"font-weight":"bold","font-size":"medium","margin-top":"3px"}},"AI矢量素材",-1),iu=I("p",null,"获取素材更轻松",-1),nu=I("p",{style:{"font-weight":"bold","font-size":"medium","margin-top":"3px"}},"AI矢量海报",-1),ru=I("p",null,"让你的创意具体可见",-1),su=I("p",{style:{"font-weight":"bold","font-size":"medium","margin-top":"3px"}},"AI艺术字生成",-1),ou=I("p",null,"创意设计不发愁",-1),au={key:1},lu=I("p",{style:{"font-size":"20px","font-weight":"bold",margin:"15px"}},"AI素材生成",-1),cu={key:1,style:{"font-size":"24px"}},hu=["src"],uu=I("div",{style:{display:"flex","font-size":"15px","font-weight":"500","margin-bottom":"10px"}},[I("p",{style:{color:"red"}},"*"),I("p",{style:{}},"画面描述")],-1),fu=I("p",{style:{color:"grey"}},"示范：",-1),du=I("div",{style:{display:"flex","font-size":"15px","font-weight":"500","margin-bottom":"10px"}},[I("p",{style:{color:"red"}},"*"),I("p",{style:{}},"风格")],-1),gu={style:{display:"flex","flex-wrap":"wrap"}},pu=["alt","onClick"],vu={style:{display:"flex","justify-content":"center"}},mu=I("p",{style:{"font-weight":"bold"}},"立即生成",-1),_u={key:2},yu=I("p",{style:{"font-size":"20px","font-weight":"bold",margin:"15px"}},"AI海报生成",-1),bu={key:1,style:{"font-size":"24px"}},wu={key:1},Cu=["src"],xu={style:{display:"flex","justify-content":"center"}},Su=["src"],Tu=["src"],Ou=I("div",{style:{display:"flex","font-size":"15px","font-weight":"500","margin-bottom":"10px"}},[I("p",{style:{color:"red"}},"*"),I("p",{style:{}},"画面描述")],-1),ku=I("p",{style:{color:"grey"}},"示范：",-1),Au=I("div",{style:{display:"flex","font-size":"15px","font-weight":"500","margin-bottom":"10px"}},[I("p",{style:{color:"red"}},"*"),I("p",{style:{}},"风格")],-1),Eu={style:{display:"flex","flex-wrap":"wrap"}},Mu=["alt","onClick"],Pu={style:{display:"flex","justify-content":"center"}},Du=I("p",{style:{"font-weight":"bold"}},"立即生成",-1),ju={key:3},Lu=I("p",{style:{"font-size":"20px","font-weight":"bold",margin:"15px"}},"AI艺术字生成",-1),Fu={key:1,style:{"font-size":"24px"}},Iu={key:1},$u=["src"],Bu=I("div",{style:{display:"flex","font-size":"15px","font-weight":"500","margin-bottom":"10px"}},[I("p",{style:{color:"red"}},"*"),I("p",{style:{}},"文本")],-1),Ru=I("p",{style:{color:"grey"}},"示范：",-1),zu=I("div",{style:{display:"flex","font-size":"15px","font-weight":"500","margin-bottom":"10px"}},[I("p",{style:{color:"red"}},"*"),I("p",{style:{}},"字体")],-1),Hu={style:{display:"flex","flex-wrap":"wrap"}},Vu=["alt","onClick"],Uu={style:{display:"flex","justify-content":"center"}},Nu=I("p",{style:{"font-weight":"bold"}},"立即生成",-1),Wu=Ct({name:"ImportAI"}),Xu=Ct(Ot(yt({},Wu),{setup(c){const{canvasEditor:t}=Pt(),f={left:100,top:100,shadow:"",fontFamily:"1-1"},p=Rt({mode:"1"}),m=Rt({prompt:"",style:" ",genState:!1,materialTypelist:[],materialist:[]}),y=Rt({isTemplate:!1,percent:0,display:!1,color:"#2db7f5",output:"",fg:"",bg:""}),w=[{label:"1",text:"现实",src:"https://zzq-typora-picgo.oss-cn-beijing.aliyuncs.com/2024-fengru/style-iconography.png"},{label:"2",text:"绘画",src:"https://zzq-typora-picgo.oss-cn-beijing.aliyuncs.com/2024-fengru/style-painting.png"},{label:"3",text:"像素",src:"https://zzq-typora-picgo.oss-cn-beijing.aliyuncs.com/2024-fengru/style-pixelart.png"},{label:"4",text:"低多边形",src:"https://zzq-typora-picgo.oss-cn-beijing.aliyuncs.com/2024-fengru/style-lowpoly.png"},{label:"5",text:"素描",src:"https://zzq-typora-picgo.oss-cn-beijing.aliyuncs.com/2024-fengru/style-sketch.png"},{label:"6",text:"水墨",src:"https://zzq-typora-picgo.oss-cn-beijing.aliyuncs.com/2024-fengru/style-ink.png"}],u=[{label:"1",text:"Kaushan Script",src:"https://zzq-typora-picgo.oss-cn-beijing.aliyuncs.com/2024-fengru/Kaushan%20Script%20.png"}];t.getMaterialType("ai").then(d=>{m.materialTypelist=[...d],m.materialist=d,console.log(d)});let r;const a=d=>{if(d=="1"){y.display==!0||y.percent>0?Ft.Modal.confirm({title:"提示",content:"退出后已经生成的素材将丢失。",onOk:()=>{p.mode="1",clearInterval(r),m.genState=!1,y.percent=0,y.display=!1,y.color="#2db7f5",y.output=""}}):p.mode="1",m.prompt="",m.style="";return}else d=="3"||d=="2"||d=="4"?p.mode=d:Ft.Modal.info({title:"提示",content:"此功能尚未开通，请耐心等待～"})},l=d=>{i(),m.style=d},i=()=>{y.isTemplate=!1},s=d=>{m.prompt=d.prompt,m.style=d.style,y.output=d.src,y.fg=d.fore,y.bg=d.back,y.isTemplate=!0,console.log(d)},e=()=>{if(m.style==""||m.prompt==""){Ft.Modal.warning({title:"提示",content:"请填写文字描述，选择风格。"});return}if(y.isTemplate==!1){Ft.Modal.info({title:"提示",content:"由于算力资源紧张，暂不支持自定义，请选择示范模板！"});return}else m.genState==!0?Ft.Modal.confirm({title:"确认",content:"您确定重新生成吗？已生成的图片将不会保存。",onOk:()=>{y.percent=0,y.display=!1}}):m.genState=!0;let d=Math.floor(Math.random()*200)+100;r=setInterval(()=>{y.percent+=1,y.percent>=100&&(y.color="#5cb85c",clearInterval(r),o())},d)},o=()=>{const d=setInterval(()=>{y.display=!0,y.percent=0,y.color="#2db7f5",clearInterval(d)},400)},h=d=>{const v=d.target.src;K.fabric.loadSVGFromURL(v,_=>{const b=K.fabric.util.groupSVGElements(_,{shadow:"",fontFamily:"arial",id:Lt(),name:"svg元素"});t.dragAddItem(d,b)})},n=d=>{const v=d.target.src;K.fabric.loadSVGFromURL(v,(_,b)=>{const C=K.fabric.util.groupSVGElements(_,Ot(yt(yt({},b),f),{id:Lt(),name:"svg元素"}));t.canvas.add(C),t.canvas.setActiveObject(C),t.canvas.requestRenderAll()})};return(d,g)=>{const v=it("Avatar"),_=it("Col"),b=it("Row"),C=it("Card"),S=it("Icon"),E=it("Button"),z=it("Circle"),V=it("Space"),W=it("Radio"),L=it("RadioGroup"),A=it("Divider"),X=Si("lazy");return Z(),at(kt,null,[D(p).mode=="1"?(Z(),at("div",tu,[M(C,{style:{width:"250px","margin-top":"20px"},onClick:g[0]||(g[0]=B=>a("2"))},{default:$(()=>[M(b,null,{default:$(()=>[M(_,{span:"8"},{default:$(()=>[M(v,{shape:"square",src:"https://zzq-typora-picgo.oss-cn-beijing.aliyuncs.com/Image/WX20240305-115841%402x.png",size:"50"})]),_:1}),M(_,{span:"16"},{default:$(()=>[eu,iu]),_:1})]),_:1})]),_:1}),M(C,{style:{width:"250px","margin-top":"20px"},onClick:g[1]||(g[1]=B=>a("3"))},{default:$(()=>[M(b,null,{default:$(()=>[M(_,{span:"8"},{default:$(()=>[M(v,{shape:"square",src:"https://zzq-typora-picgo.oss-cn-beijing.aliyuncs.com/2024-fengru/asto-poster.jpg",size:"50"})]),_:1}),M(_,{span:"16"},{default:$(()=>[nu,ru]),_:1})]),_:1})]),_:1}),M(C,{style:{width:"250px","margin-top":"20px"},onClick:g[2]||(g[2]=B=>a("4"))},{default:$(()=>[M(b,null,{default:$(()=>[M(_,{span:"8"},{default:$(()=>[M(v,{shape:"square",src:"https://zzq-typora-picgo.oss-cn-beijing.aliyuncs.com/2024-fengru/frog.png",size:"50"})]),_:1}),M(_,{span:"16"},{default:$(()=>[su,ou]),_:1})]),_:1})]),_:1})])):bt("",!0),D(p).mode=="2"?(Z(),at("div",au,[I("div",null,[M(E,{type:"text",style:{"margin-top":"10px"},onClick:g[3]||(g[3]=B=>a("1"))},{default:$(()=>[M(S,{type:"ios-arrow-back"}),dt(" 返回 ")]),_:1}),lu]),D(m).genState?(Z(),wt(C,{key:0,style:{margin:"10px",display:"flex","justify-content":"center"}},{default:$(()=>[D(y).display?(Z(),at("img",{key:1,src:D(y).output,style:{"max-width":"100%",height:"auto",cursor:"pointer"},onClick:n,onDragend:h},null,40,hu)):(Z(),wt(z,{key:0,percent:D(y).percent,"stroke-color":D(y).color},{default:$(()=>[D(y).percent==100?(Z(),wt(S,{key:0,type:"ios-checkmark",size:"60",style:{color:"#5cb85c"}})):(Z(),at("span",cu,ct(D(y).percent)+"%",1))]),_:1},8,["percent","stroke-color"]))]),_:1})):bt("",!0),M(C,{style:{margin:"10px"}},{default:$(()=>[uu,M(D(Ft.Input),{modelValue:D(m).prompt,"onUpdate:modelValue":g[4]||(g[4]=B=>D(m).prompt=B),type:"textarea",maxlength:"250","show-word-limit":"",onOnChange:i,rows:4,placeholder:"输入文本内容，引导图片生成方向，支持中英文"},null,8,["modelValue"]),M(V,{wrap:"",style:{"margin-top":"10px"}},{default:$(()=>[fu,(Z(!0),at(kt,null,It(D(m).materialist[0].list,(B,st)=>(Z(),wt(E,{size:"small",key:`${st}-template`,onClick:ht=>s(B)},{default:$(()=>[dt(ct(B.label),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),M(C,{style:{margin:"10px"}},{default:$(()=>[du,M(L,{modelValue:D(m).style,"onUpdate:modelValue":g[5]||(g[5]=B=>D(m).style=B)},{default:$(()=>[I("div",gu,[(Z(),at(kt,null,It(w,(B,st)=>I("div",{key:`${st}-button`,style:{flex:"1 0 0",display:"flex","flex-direction":"column","margin-bottom":"5px"}},[Ut(I("img",{alt:B.text,onClick:ht=>l(B.label),style:{height:"50px",width:"50px"}},null,8,pu),[[X,B.src]]),M(W,{label:B.label},{default:$(()=>[dt(ct(B.text),1)]),_:2},1032,["label"])])),64))])]),_:1},8,["modelValue"])]),_:1}),M(A),I("div",vu,[M(E,{type:"primary",shape:"circle",size:"large",onClick:e},{default:$(()=>[mu]),_:1})])])):bt("",!0),D(p).mode=="3"?(Z(),at("div",_u,[I("div",null,[M(E,{type:"text",style:{"margin-top":"10px"},onClick:g[6]||(g[6]=B=>a("1"))},{default:$(()=>[M(S,{type:"ios-arrow-back"}),dt(" 返回 ")]),_:1}),yu]),D(m).genState?(Z(),wt(C,{key:0,style:{margin:"10px",display:"flex","justify-content":"center"}},{default:$(()=>[D(y).display?(Z(),at("div",wu,[I("img",{src:D(y).output,style:{"max-width":"100%",height:"auto",cursor:"pointer"},onClick:n,onDragend:h},null,40,Cu),I("div",xu,[I("img",{src:D(y).fg,style:{"max-width":"40%",height:"auto",cursor:"pointer","margin-right":"auto"},onClick:n,onDragend:h},null,40,Su),I("img",{src:D(y).bg,style:{"max-width":"40%",height:"auto",cursor:"pointer"},onClick:n,onDragend:h},null,40,Tu)])])):(Z(),wt(z,{key:0,percent:D(y).percent,"stroke-color":D(y).color},{default:$(()=>[D(y).percent==100?(Z(),wt(S,{key:0,type:"ios-checkmark",size:"60",style:{color:"#5cb85c"}})):(Z(),at("span",bu,ct(D(y).percent)+"%",1))]),_:1},8,["percent","stroke-color"]))]),_:1})):bt("",!0),M(C,{style:{margin:"10px"}},{default:$(()=>[Ou,M(D(Ft.Input),{modelValue:D(m).prompt,"onUpdate:modelValue":g[7]||(g[7]=B=>D(m).prompt=B),type:"textarea",maxlength:"250","show-word-limit":"",onOnChange:i,rows:4,placeholder:"输入文本内容，引导图片生成方向，支持中英文"},null,8,["modelValue"]),M(V,{wrap:"",style:{"margin-top":"10px"}},{default:$(()=>[ku,(Z(!0),at(kt,null,It(D(m).materialist[1].list,(B,st)=>(Z(),wt(E,{size:"small",key:`${st}-template`,onClick:ht=>s(B)},{default:$(()=>[dt(ct(B.label),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),M(C,{style:{margin:"10px"}},{default:$(()=>[Au,M(L,{modelValue:D(m).style,"onUpdate:modelValue":g[8]||(g[8]=B=>D(m).style=B)},{default:$(()=>[I("div",Eu,[(Z(),at(kt,null,It(w,(B,st)=>I("div",{key:`${st}-button`,style:{flex:"1 0 0",display:"flex","flex-direction":"column","margin-bottom":"5px"}},[Ut(I("img",{alt:B.text,onClick:ht=>l(B.label),style:{height:"50px",width:"50px"}},null,8,Mu),[[X,B.src]]),M(W,{label:B.label},{default:$(()=>[dt(ct(B.text),1)]),_:2},1032,["label"])])),64))])]),_:1},8,["modelValue"])]),_:1}),M(A),I("div",Pu,[M(E,{type:"primary",shape:"circle",size:"large",onClick:e},{default:$(()=>[Du]),_:1})])])):bt("",!0),D(p).mode=="4"?(Z(),at("div",ju,[I("div",null,[M(E,{type:"text",style:{"margin-top":"10px"},onClick:g[9]||(g[9]=B=>a("1"))},{default:$(()=>[M(S,{type:"ios-arrow-back"}),dt(" 返回 ")]),_:1}),Lu]),D(m).genState?(Z(),wt(C,{key:0,style:{margin:"10px",display:"flex","justify-content":"center"}},{default:$(()=>[D(y).display?(Z(),at("div",Iu,[I("img",{src:D(y).output,style:{"max-width":"100%",height:"auto",cursor:"pointer"},onClick:n,onDragend:h},null,40,$u)])):(Z(),wt(z,{key:0,percent:D(y).percent,"stroke-color":D(y).color},{default:$(()=>[D(y).percent==100?(Z(),wt(S,{key:0,type:"ios-checkmark",size:"60",style:{color:"#5cb85c"}})):(Z(),at("span",Fu,ct(D(y).percent)+"%",1))]),_:1},8,["percent","stroke-color"]))]),_:1})):bt("",!0),M(C,{style:{margin:"10px"}},{default:$(()=>[Bu,M(D(Ft.Input),{modelValue:D(m).prompt,"onUpdate:modelValue":g[10]||(g[10]=B=>D(m).prompt=B),type:"textarea",maxlength:"10","show-word-limit":"",onOnChange:i,rows:4,placeholder:"输入想要进行设计的文本"},null,8,["modelValue"]),M(V,{wrap:"",style:{"margin-top":"10px"}},{default:$(()=>[Ru,(Z(!0),at(kt,null,It(D(m).materialist[2].list,(B,st)=>(Z(),wt(E,{size:"small",key:`${st}-template`,onClick:ht=>s(B)},{default:$(()=>[dt(ct(B.label),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),M(C,{style:{margin:"10px"}},{default:$(()=>[zu,M(L,{modelValue:D(m).style,"onUpdate:modelValue":g[11]||(g[11]=B=>D(m).style=B)},{default:$(()=>[I("div",Hu,[(Z(),at(kt,null,It(u,(B,st)=>I("div",{key:`${st}-button`,style:{flex:"1 0 0",display:"flex","flex-direction":"column","margin-bottom":"5px"}},[Ut(I("img",{alt:B.text,onClick:ht=>l(B.label),style:{height:"50px",width:"auto"}},null,8,Vu),[[X,B.src]]),M(W,{label:B.label},{default:$(()=>[dt(ct(B.text),1)]),_:2},1032,["label"])])),64))])]),_:1},8,["modelValue"])]),_:1}),M(A),I("div",Uu,[M(E,{type:"primary",shape:"circle",size:"large",onClick:e},{default:$(()=>[Nu]),_:1})])])):bt("",!0)],64)}}})),us=(c,t)=>{const f=[],p=Math.PI*2/c;let m=-Math.PI/2;c%2===0&&(m+=p/2);for(let y=0;y<c;y++){const w=y*p+m;f.push({x:Math.cos(w)*t,y:Math.sin(w)*t})}return f};const we=c=>(ae("data-v-713d204f"),c=c(),le(),c),Yu={class:"tool-box"},Gu=we(()=>I("svg",{t:"1650875455324",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5401",width:"26",height:"26"},[I("path",{d:"M213.333333 209.92v128h85.333334v-42.666667h170.666666v433.493334H384.853333v85.333333h256v-85.333333H554.666667V295.253333h170.666666v42.666667h85.333334v-128H213.333333z","p-id":"5402"})],-1)),qu=[Gu],Ku=we(()=>I("svg",{t:"1650854954008",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"14038",width:"26",height:"26"},[I("path",{d:"M720.832 692.352h-12.64L530.208 260.448a19.968 19.968 0 0 0-36.416 0L316.608 692.352h-13.44c-7.904 0-15.04 3.968-17.408 11.072a19.872 19.872 0 0 0 18.208 27.68h56.96c9.504 0 18.208-6.336 19.776-15.808a18.752 18.752 0 0 0-15.808-21.344l36.384-87.808h159.776l34.816 87.808a18.88 18.88 0 0 0-15.808 21.344c1.568 9.504 10.272 15.808 19.776 15.808h121.024c7.904 0 15.04-3.968 17.408-11.072a19.2 19.2 0 0 0-17.408-27.68z m-306.112-125.76l64.864-158.208 64.864 158.208H414.72z m-246.816-80.704c0 6.336 5.536 11.872 11.872 11.872s11.872-5.536 11.872-11.872v-23.744c0-6.336-5.536-11.872-11.872-11.872s-11.872 5.536-11.872 11.872v23.744z m0-75.936c0 6.336 5.536 11.872 11.872 11.872s11.872-5.536 11.872-11.872v-23.744c0-6.336-5.536-11.872-11.872-11.872s-11.872 5.536-11.872 11.872v23.744z m0 151.872c0 6.336 5.536 11.872 11.872 11.872s11.872-5.536 11.872-11.872v-23.744c0-6.336-5.536-11.872-11.872-11.872s-11.872 5.536-11.872 11.872v23.744z m11.872-216.736a12.16 12.16 0 0 0 11.872-11.872v-23.744c-0.8-6.336-5.536-11.072-11.872-11.072s-11.872 5.536-11.872 11.872v23.744c0 6.336 4.736 11.072 11.872 11.072z m-11.872 292.672c0 6.336 5.536 11.872 11.872 11.872s11.872-5.536 11.872-11.872v-23.744c0-6.336-5.536-11.872-11.872-11.872s-11.872 5.536-11.872 11.872v23.744z m0 75.936c0 7.104 4.736 11.872 11.872 11.872a12.16 12.16 0 0 0 11.872-11.872v-23.744c0-6.336-5.536-11.872-11.872-11.872s-11.872 5.536-11.872 11.872v23.744z m665.248-227.808c0 6.336 5.536 11.872 11.872 11.872s11.872-5.536 11.872-11.872v-23.744c0-6.336-5.536-11.872-11.872-11.872s-11.872 5.536-11.872 11.872v23.744z m0-75.936c0 6.336 5.536 11.872 11.872 11.872s11.872-5.536 11.872-11.872v-23.744c0-6.336-5.536-11.872-11.872-11.872s-11.872 5.536-11.872 11.872v23.744z m0 151.872c0 6.336 5.536 11.872 11.872 11.872s11.872-5.536 11.872-11.872v-23.744c0-6.336-5.536-11.872-11.872-11.872s-11.872 5.536-11.872 11.872v23.744z m11.072-216.736a12.16 12.16 0 0 0 11.872-11.872v-23.744c0-6.336-5.536-11.872-11.872-11.872s-11.872 5.536-11.872 11.872v23.744c0.8 7.104 5.536 11.872 11.872 11.872z m-11.072 292.672c0 6.336 5.536 11.872 11.872 11.872s11.872-5.536 11.872-11.872v-23.744c0-6.336-5.536-11.872-11.872-11.872s-11.872 5.536-11.872 11.872v23.744z m0 75.936c0 6.336 5.536 11.872 11.872 11.872s11.872-5.536 11.872-11.872v-23.744c0-6.336-5.536-11.872-11.872-11.872s-11.872 5.536-11.872 11.872v23.744z m-347.264 119.456h-23.744c-6.336 0-11.872 5.536-11.872 11.872s5.536 11.872 11.872 11.872h23.744c6.336 0 11.872-5.536 11.872-11.872s-5.536-11.872-11.872-11.872z m-75.936 0h-23.744c-6.336 0-11.872 5.536-11.872 11.872s5.536 11.872 11.872 11.872h23.744c6.336 0 11.872-5.536 11.872-11.872s-5.536-11.872-11.872-11.872z m151.872 0h-23.744c-6.336 0-11.872 5.536-11.872 11.872s5.536 11.872 11.872 11.872h23.744c6.336 0 11.872-5.536 11.872-11.872s-5.536-11.872-11.872-11.872z m-228.608 0h-23.744c-6.336 0-11.872 5.536-11.872 11.872s5.536 11.872 11.872 11.872h23.744c6.336 0 11.872-5.536 11.872-11.872s-4.736-11.872-11.872-11.872z m-75.136-7.904H222.496v-11.072a12.48 12.48 0 0 0-12.672-12.64h-18.976v-37.984c0-7.104-5.536-12.64-11.872-12.64s-11.872 5.536-11.872 12.64v37.984h-10.272a12.512 12.512 0 0 0-12.672 12.64v52.992a12.48 12.48 0 0 0 12.672 12.64h52.992a12.512 12.512 0 0 0 12.672-12.64v-11.072h35.584c7.104-1.568 12.672-7.904 12.672-14.24 0-7.104-12.672-16.608-12.672-16.608z m379.68 7.904h-23.744c-6.336 0-11.872 5.536-11.872 11.872s5.536 11.872 11.872 11.872h23.744c6.336 0 11.872-5.536 11.872-11.872s-5.536-11.872-11.872-11.872z m75.936 0h-23.744c-6.336 0-11.872 5.536-11.872 11.872s5.536 11.872 11.872 11.872h23.744c6.336 0 11.872-5.536 11.872-11.872s-4.736-11.872-11.872-11.872z m-251.52-642.304h23.744c6.336 0 11.872-5.536 11.872-11.872s-5.536-11.872-11.872-11.872h-23.744c-6.336 0-11.872 5.536-11.872 11.872s5.536 11.872 11.872 11.872z m-75.936 0h23.744c6.336 0 11.872-5.536 11.872-11.872s-5.536-11.872-11.872-11.872h-23.744c-6.336 0-11.872 5.536-11.872 11.872s5.536 11.872 11.872 11.872z m151.872 0h23.744c6.336 0 11.872-5.536 11.872-11.872s-5.536-11.872-11.872-11.872h-23.744c-6.336 0-11.872 5.536-11.872 11.872s5.536 11.872 11.872 11.872z m-227.808 0h23.744c6.336 0 11.872-5.536 11.872-11.872s-5.536-11.872-11.872-11.872h-23.744c-7.104 0.8-11.872 5.536-11.872 12.672s4.736 11.072 11.872 11.072zM257.28 167.904H221.696v-11.072a12.512 12.512 0 0 0-12.672-12.672H156.832a12.512 12.512 0 0 0-12.672 12.672v52.992c0 7.104 5.536 12.672 12.672 12.672h11.072v35.584c1.568 7.104 7.904 12.672 14.24 12.672s16.608-12.672 16.608-12.672V222.496h11.072a12.512 12.512 0 0 0 12.672-12.672v-18.976h35.584a12.16 12.16 0 0 0 11.872-11.872 12.224 12.224 0 0 0-12.672-11.072z m356.768 22.944h23.744c6.336 0 11.872-5.536 11.872-11.872s-5.536-11.872-11.872-11.872h-23.744c-6.336 0-11.872 5.536-11.872 11.872s5.536 11.872 11.872 11.872z m76.736 0h23.744c6.336 0 11.072-4.736 11.072-11.072s-5.536-11.872-11.872-11.872h-23.744c-6.336 0-11.872 5.536-11.872 11.872s5.536 11.072 12.64 11.072z m176.384-46.656h-52.992a12.48 12.48 0 0 0-12.64 12.672v11.072h-35.584c-7.104 1.568-12.64 7.904-12.64 14.24s12.64 16.608 12.64 16.608h35.584v11.072c0 7.104 5.536 12.672 12.64 12.672h18.976v37.984c0 7.104 5.536 12.672 11.872 12.672s11.872-5.536 11.872-12.672V222.528h11.072a12.48 12.48 0 0 0 12.64-12.672V156.864a13.76 13.76 0 0 0-13.44-12.672z m0 657.312h-11.072v-35.584c-1.568-7.104-7.904-12.64-14.24-12.64-7.104 0-16.608 12.64-16.608 12.64v35.584h-11.072a12.48 12.48 0 0 0-12.64 12.64v18.976h-35.584c-6.336 0-11.872 5.536-11.872 11.872s5.536 11.872 11.872 11.872h35.584v11.072a12.48 12.48 0 0 0 12.64 12.64h52.992a12.48 12.48 0 0 0 12.64-12.64v-52.992c0-7.904-5.536-13.44-12.64-13.44z","p-id":"14039"})],-1)),Ju=[Ku],Zu=we(()=>I("svg",{t:"1650855811131",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"18499",width:"26",height:"26"},[I("path",{d:"M864 896H160a32 32 0 0 1-32-32V160a32 32 0 0 1 32-32h704a32 32 0 0 1 32 32v704a32 32 0 0 1-32 32zM192 832h640V192H192v640z","p-id":"18500"})],-1)),Qu=[Zu],tf=we(()=>I("svg",{t:"1650855860236",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"19440",width:"26",height:"26"},[I("path",{d:"M512 928C282.624 928 96 741.376 96 512S282.624 96 512 96s416 186.624 416 416-186.624 416-416 416z m0-768C317.92 160 160 317.92 160 512s157.92 352 352 352 352-157.92 352-352S706.08 160 512 160z","p-id":"19441"})],-1)),ef=[tf],nf=we(()=>I("svg",{t:"1650874633978",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2032",width:"26",height:"26"},[I("path",{d:"M928.64 896a2.144 2.144 0 0 1-0.64 0H96a32.032 32.032 0 0 1-27.552-48.288l416-704c11.488-19.456 43.552-19.456 55.104 0l413.152 699.2A31.936 31.936 0 0 1 928.64 896zM152.064 832h719.84L512 222.912 152.064 832z","p-id":"2033"})],-1)),rf=[nf],sf=we(()=>I("svg",{t:"1650874633978",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2032",width:"26",height:"26"},[I("path",{d:"M161.152 398.016l134.016 412.416h433.664l134.016-412.416L512 143.104 161.152 398.08zM512 64l426.048 309.568-162.752 500.864H248.704L85.952 373.568 512 64z","p-id":"2033"})],-1)),of=[sf],af={class:"tool-box"},lf=we(()=>I("svg",{t:"1673022047861",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4206",width:"20",height:"20"},[I("path",{d:"M187.733333 1024h-170.666666c-10.24 0-17.066667-6.826667-17.066667-17.066667v-170.666666c0-10.24 6.826667-17.066667 17.066667-17.066667h170.666666c10.24 0 17.066667 6.826667 17.066667 17.066667v170.666666c0 10.24-6.826667 17.066667-17.066667 17.066667zM34.133333 989.866667h136.533334v-136.533334H34.133333v136.533334zM1006.933333 204.8h-170.666666c-10.24 0-17.066667-6.826667-17.066667-17.066667v-170.666666c0-10.24 6.826667-17.066667 17.066667-17.066667h170.666666c10.24 0 17.066667 6.826667 17.066667 17.066667v170.666666c0 10.24-6.826667 17.066667-17.066667 17.066667zM853.333333 170.666667h136.533334V34.133333h-136.533334v136.533334z",fill:"","p-id":"4207"}),I("path",{d:"M187.733333 853.333333c-3.413333 0-10.24 0-13.653333-3.413333-6.826667-6.826667-6.826667-17.066667 0-23.893333l648.533333-648.533334c6.826667-6.826667 17.066667-6.826667 23.893334 0s6.826667 17.066667 0 23.893334l-648.533334 648.533333c0 3.413333-6.826667 3.413333-10.24 3.413333z",fill:"","p-id":"4208"})],-1)),cf=[lf],hf=we(()=>I("svg",{t:"1673026778912",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2659",width:"20",height:"20"},[I("path",{d:"M320 738.133333L827.733333 230.4l-29.866666-29.866667L290.133333 708.266667v-268.8h-42.666666v341.333333h341.333333v-42.666667H320z",fill:"#444444","p-id":"2660"})],-1)),uf=[hf],ff=Ct({name:"Tools"}),df=Object.assign(ff,{setup(c){const t={shadow:"",fontFamily:"arial"},f={left:0,top:0},{t:p}=ke(),{fabric:m,canvasEditor:y}=Pt(),w=Rt({isDrawingLineMode:!1,isArrow:!1}),u=h=>{const n=new m.IText(p("everything_is_fine"),Ot(yt(yt({},t),h),{fontSize:80,id:Lt()}));y.canvas.add(n),h||n.center(),y.canvas.setActiveObject(n)},r=h=>{const n=new m.Textbox(p("everything_goes_well"),Ot(yt(yt({},t),h),{splitByGrapheme:!0,width:400,fontSize:80,id:Lt()}));y.canvas.add(n),h||n.center(),y.canvas.setActiveObject(n)},a=h=>{const n=new m.Triangle(Ot(yt(yt({},t),h),{width:400,height:400,fill:"#92706B",id:Lt(),name:"三角形"}));y.canvas.add(n),h||n.center(),y.canvas.setActiveObject(n)},l=h=>{const n=new m.Polygon(us(5,200),Ot(yt(yt({},t),h),{fill:"#ccc",id:Lt(),name:"多边形"}));n.set({width:400,height:400,pathOffset:{x:0,y:0}}),y.canvas.add(n),h||n.center(),y.canvas.setActiveObject(n)},i=h=>{const n=new m.Circle(Ot(yt(yt({},t),h),{radius:150,fill:"#57606B",id:Lt(),name:"圆形"}));y.canvas.add(n),h||n.center(),y.canvas.setActiveObject(n)},s=h=>{const n=new m.Rect(Ot(yt(yt({},t),h),{fill:"#F57274",width:400,height:400,id:Lt(),name:"矩形"}));y.canvas.add(n),h||n.center(),y.canvas.setActiveObject(n)},e=h=>{w.isArrow=h,w.isDrawingLineMode=!w.isDrawingLineMode,y.setMode(w.isDrawingLineMode),y.setArrow(h),y.canvas.forEachObject(n=>{n.id!=="workspace"&&(n.selectable=!w.isDrawingLineMode,n.evented=!w.isDrawingLineMode)})},o=h=>{switch(h){case"text":u(f);break;case"textBox":r(f);break;case"rect":s(f);break;case"circle":i(f);break;case"triangle":a(f);break;case"polygon":l(f);break}};return Jt(()=>{mn(()=>{y.canvas.on("drop",h=>{const n={left:y.canvas.getSelectionElement().getBoundingClientRect().left,top:y.canvas.getSelectionElement().getBoundingClientRect().top},d={x:h.e.x-n.left,y:h.e.y-n.top},g=y.canvas.restorePointerVpt(d);f.left=g.x,f.top=g.y})})}),(h,n)=>{const d=it("Divider");return Z(),at("div",null,[M(d,{plain:"",orientation:"left"},{default:$(()=>[dt(ct(h.$t("common_elements")),1)]),_:1}),I("div",Yu,[I("span",{onClick:n[0]||(n[0]=()=>u()),draggable:!0,onDragend:n[1]||(n[1]=g=>o("text"))},qu,32),I("span",{onClick:n[2]||(n[2]=()=>r()),draggable:!0,onDragend:n[3]||(n[3]=g=>o("textBox"))},Ju,32),I("span",{onClick:n[4]||(n[4]=()=>s()),draggable:!0,onDragend:n[5]||(n[5]=g=>o("rect"))},Qu,32),I("span",{onClick:n[6]||(n[6]=()=>i()),draggable:!0,onDragend:n[7]||(n[7]=g=>o("circle"))},ef,32),I("span",{onClick:n[8]||(n[8]=()=>a()),draggable:!0,onDragend:n[9]||(n[9]=g=>o("triangle"))},rf,32),I("span",{onClick:n[10]||(n[10]=()=>l()),draggable:!0,onDragend:n[11]||(n[11]=g=>o("polygon"))},of,32)]),M(d,{plain:"",orientation:"left"},{default:$(()=>[dt(ct(h.$t("draw_elements")),1)]),_:1}),I("div",af,[I("span",{onClick:n[12]||(n[12]=g=>e(!1)),class:qt(D(w).isDrawingLineMode&&!D(w).isArrow&&"bg")},cf,2),I("span",{onClick:n[13]||(n[13]=g=>e(!0)),class:qt(D(w).isDrawingLineMode&&D(w).isArrow&&"bg")},uf,2)])])}}}),gf=Bt(df,[["__scopeId","data-v-713d204f"]]),pf={class:"search-box"},vf=["alt"],mf=Ct({name:"ImportSvg"}),_f=Ct(Ot(yt({},mf),{setup(c){const{canvasEditor:t}=Pt(),f={left:100,top:100,shadow:"",fontFamily:"1-1"},p={value:"",label:"全部"},m=Rt({search:"",placeholder:"",jsonFile:null,materialType:[""],materialTypelist:[],materialist:[]});t.getMaterialType("svg").then(l=>{m.materialTypelist=[...l],m.materialist=l});const y=(l,i)=>{const{label:s,value:e}=i[0];m.placeholder=s,m.search="",w(e)},w=l=>{if(!l)m.materialist=bi(m.materialTypelist);else{const i=m.materialTypelist.filter(s=>s.value===l)||[];m.materialist=i}if(m.search){const i=bi(m.materialist);m.materialist=i.map(s=>(s.list&&(s.list=s.list.filter(e=>e.label.includes(m.search))),s))}},u=()=>{const[l]=m.materialType;w(l)},r=l=>{const s=l.target.src;K.fabric.loadSVGFromURL(s,e=>{const o=K.fabric.util.groupSVGElements(e,{shadow:"",fontFamily:"arial",id:Lt(),name:"svg元素"});t.dragAddItem(l,o)})},a=l=>{const s=l.target.src;K.fabric.loadSVGFromURL(s,(e,o)=>{const h=K.fabric.util.groupSVGElements(e,Ot(yt(yt({},o),f),{id:Lt(),name:"svg元素"}));t.canvas.add(h),t.canvas.setActiveObject(h),t.canvas.requestRenderAll()})};return(l,i)=>{const s=it("Button"),e=it("Cascader"),o=it("Input"),h=it("Divider"),n=it("Tooltip"),d=Si("lazy");return Z(),at("div",null,[I("div",pf,[M(e,{data:[p,...D(m).materialTypelist],modelValue:D(m).materialType,"onUpdate:modelValue":i[0]||(i[0]=g=>D(m).materialType=g),onOnChange:y},{default:$(()=>[M(s,{icon:"ios-menu"})]),_:1},8,["data","modelValue"]),M(o,{class:"input",placeholder:D(m).placeholder,modelValue:D(m).search,"onUpdate:modelValue":i[1]||(i[1]=g=>D(m).search=g),search:"",onOnChange:u},null,8,["placeholder","modelValue"])]),(Z(!0),at(kt,null,It(D(m).materialist,g=>(Z(),at("div",{key:g.value},[M(h,{plain:"",orientation:"left"},{default:$(()=>[dt(ct(g.label),1)]),_:2},1024),(Z(!0),at(kt,null,It(g.list,(v,_)=>(Z(),wt(n,{content:v.label,key:`${_}-bai1-button`,placement:"top"},{default:$(()=>[Ut(I("img",{class:"tmpl-img",alt:v.label,onClick:a,onDragend:r},null,40,vf),[[d,v.src]])]),_:2},1032,["content"]))),128))]))),128))])}}}));const yf=Bt(_f,[["__scopeId","data-v-df52cb5d"]]);const bf={key:0},wf={class:"color-list"},Cf=["onClick"],xf=Ct({name:"BgBar"}),Sf=Object.assign(xf,{setup(c){const{t}=ke(),{mixinState:f,canvasEditor:p}=Pt(),m=[{label:t("scenary_x",{number:1}),color:["#5F2B63","#B23554","#F27E56","#FCE766"]},{label:t("scenary_x",{number:2}),color:["#86DCCD","#E7FDCB","#FFDC84","#F57677"]},{label:t("scenary_x",{number:3}),color:["#5FC2C7","#98DFE5","#C2EFF3","#DDFDFD"]},{label:t("scenary_x",{number:4}),color:["#9EE9D3","#2FC6C8","#2D7A9D","#48466d"]},{label:t("scenary_x",{number:5}),color:["#61c0bf","#bbded6","#fae3d9","#ffb6b9"]},{label:t("scenary_x",{number:6}),color:["#ffaaa5","#ffd3b6","#dcedc1","#a8e6cf"]}],y=vt(""),w=()=>{u(y.value)};function u(r){p.canvas.getObjects().find(l=>l.id==="workspace").set("fill",r),p.canvas.renderAll()}return(r,a)=>{const l=it("Divider"),i=it("ColorPicker"),s=it("FormItem"),e=it("Form");return D(f).mSelectMode?bt("",!0):(Z(),at("div",bf,[M(l,{orientation:"left",plain:""},{default:$(()=>[dt(ct(r.$t("color")),1)]),_:1}),M(e,{"label-width":40},{default:$(()=>[M(s,{label:r.$t("color"),prop:"name"},{default:$(()=>[M(i,{modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=o=>y.value=o),onOnChange:w,alpha:"",size:"small",transfer:""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),M(l,{orientation:"left",plain:""},{default:$(()=>[dt(ct(r.$t("color_macthing")),1)]),_:1}),I("div",wf,[(Z(),at(kt,null,It(m,(o,h)=>I("div",{key:o.label+h,class:"item"},[dt(ct(o.label)+": ",1),(Z(!0),at(kt,null,It(o.color,n=>(Z(),at("span",{key:n,style:Xe(`background:${n}`),onClick:d=>u(n)},null,12,Cf))),128))])),64))])]))}}}),Tf=Bt(Sf,[["__scopeId","data-v-9ad34183"]]),fs=Ko("canvas",()=>{const c=vt(600),t=vt(800),f=Ht(()=>c.value),p=Ht(()=>t.value);function m(u){c.value=u}function y(u){t.value=u}function w(u,r){t.value=u,c.value=r,console.log("useCanvasStore set size:"+t.value+c.value)}return{height:c,width:t,getHeight:f,getWidth:p,setHeight:m,setWidth:y,setSize:w}});const Of={key:0},kf=Ct({name:"CanvasSize"}),Af=Object.assign(kf,{setup(c){const{mixinState:t,canvasEditor:f}=Pt(),{t:p}=ke(),m=fs(),y={width:900,height:1200},w=vt(!1),u=Rt({width:y.width,height:y.height});let r=Rt([{label:p("red_book_vertical"),width:900,height:1200},{label:p("red_book_horizontal"),width:1200,height:900},{label:p("phone_wallpaper"),width:1080,height:1920},{label:"kindle",width:1200,height:860},{label:"kindle-resize",width:860,height:1200}]);Jt(()=>{f.on("sizeChange",(e,o)=>{m.setHeight(o),m.setWidth(e)})});const a=(e,o)=>{u.width=e,u.height=o},l=()=>{console.log("setSize",width.value,height.value),f.setSize(width.value,height.value)},i=()=>{w.value=!1},s=()=>{m.setHeight(u.height),m.setWidth(u.width),l(),i()};return(e,o)=>{const h=it("Divider"),n=it("InputNumber"),d=it("FormItem"),g=it("Form"),v=it("Button"),_=it("ButtonGroup");return D(t).mSelectMode?bt("",!0):(Z(),at("div",Of,[M(h,{plain:"",orientation:"left"},{default:$(()=>[dt(ct(e.$t("size")),1)]),_:1}),M(g,{"label-width":40,class:"form-wrap"},{default:$(()=>[M(d,{label:e.$t("width"),prop:"name"},{default:$(()=>[M(n,{disabled:"",modelValue:D(m).getWidth,"onUpdate:modelValue":o[0]||(o[0]=b=>D(m).getWidth=b),onOnChange:l},null,8,["modelValue"])]),_:1},8,["label"]),M(d,{label:e.$t("height"),prop:"name"},{default:$(()=>[M(n,{disabled:"",modelValue:D(m).getHeight,"onUpdate:modelValue":o[1]||(o[1]=b=>D(m).getHeight=b),onOnChange:l},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),M(v,{type:"primary",onClick:o[2]||(o[2]=()=>w.value=!0)},{default:$(()=>[dt("调整尺寸")]),_:1}),M(D(Ft.Modal),{modelValue:D(w),"onUpdate:modelValue":o[5]||(o[5]=b=>Pe(w)?w.value=b:null),title:e.$t("setSizeTip"),onOnOk:s,onOnCancel:i},{default:$(()=>[I("p",null,ct(e.$t("default_size")),1),M(_,{vertical:"",style:{margin:"10px 0"}},{default:$(()=>[(Z(!0),at(kt,null,It(D(r),(b,C)=>(Z(),wt(v,{key:`${C}presetSize`,size:"small",style:{"text-align":"left"},onClick:S=>a(b.width,b.height)},{default:$(()=>[dt(ct(b.label)+":"+ct(b.width)+"x"+ct(b.height),1)]),_:2},1032,["onClick"]))),128))]),_:1}),M(g,{"label-width":40,class:"form-wrap",style:{"justify-content":"flex-start"}},{default:$(()=>[M(d,{label:e.$t("width"),prop:"name",style:{"margin-right":"10px"}},{default:$(()=>[M(n,{min:1,max:5e3,modelValue:D(u).width,"onUpdate:modelValue":o[3]||(o[3]=b=>D(u).width=b)},null,8,["modelValue"])]),_:1},8,["label"]),M(d,{label:e.$t("height"),prop:"name"},{default:$(()=>[M(n,{min:1,max:5e3,modelValue:D(u).height,"onUpdate:modelValue":o[4]||(o[4]=b=>D(u).height=b)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])]))}}}),Ef=Bt(Af,[["__scopeId","data-v-b76b5034"]]),Mf={key:0,class:"box attr-item"},Pf=Ct({name:"ReplaceImg"}),Df=Object.assign(Pf,{setup(c){const t=Qe(),f=_e("event"),{mixinState:p,canvasEditor:m}=Pt(),y=vt(""),w=()=>ie(this,null,function*(){const r=m.canvas.getActiveObjects()[0];if(r&&r.type==="image"){const[a]=yield wi({accept:"image/*",multiple:!1}),l=yield Yi(a),i=yield _c(l),s=r.get("width"),e=r.get("height"),o=r.get("scaleX"),h=r.get("scaleY");r.setSrc(i.src,()=>{r.set("scaleX",s*o/i.width),r.set("scaleY",e*h/i.height),m.canvas.renderAll()}),i.remove()}}),u=()=>{var a;const r=m.canvas.getActiveObjects()[0];r&&(y.value=r.type,(a=t==null?void 0:t.proxy)==null||a.$forceUpdate())};return Jt(()=>{f.on("selectOne",u)}),ei(()=>{f.off("selectOne",u)}),(r,a)=>{const l=it("Button");return D(p).mSelectMode==="one"&&D(y)==="image"?(Z(),at("div",Mf,[M(l,{onClick:w,type:"text",long:""},{default:$(()=>[dt(ct(r.$t("repleaceImg")),1)]),_:1})])):bt("",!0)}}}),jf=""+new URL("../assets/BlackWhite-f7b682f8.png",import.meta.url).href,Lf=""+new URL("../assets/Brownie-e1fd7075.png",import.meta.url).href,Ff=""+new URL("../assets/Invert-5af1c3a4.png",import.meta.url).href,If=""+new URL("../assets/Kodachrome-2b49b22c.png",import.meta.url).href,$f=""+new URL("../assets/Polaroid-9023c2a3.png",import.meta.url).href,Bf=""+new URL("../assets/Sepia-2ff95c35.png",import.meta.url).href,Rf=""+new URL("../assets/Vintage-f02e23f3.png",import.meta.url).href,zf=""+new URL("../assets/technicolor-48049f1e.png",import.meta.url).href,Vt={SELECT:"select",COLOR:"color",NUMBER:"number"},Kn=[{type:"Brightness",status:!1,params:[{key:"brightness",value:0,uiType:Vt.NUMBER,min:-1,max:1,step:.01}]},{type:"Contrast",status:!1,params:[{key:"contrast",value:0,uiType:Vt.NUMBER,min:-1,max:1,step:.01}]},{type:"Saturation",status:!1,params:[{key:"saturation",value:0,uiType:Vt.NUMBER,min:-1,max:1,step:.01}]},{type:"Vibrance",status:!1,params:[{key:"vibrance",value:0,uiType:Vt.NUMBER,min:-1,max:1,step:.01}]},{type:"HueRotation",status:!1,params:[{key:"rotation",value:0,uiType:Vt.NUMBER,min:-1,max:1,step:.01}]},{type:"Noise",status:!1,params:[{key:"noise",value:0,uiType:Vt.NUMBER,min:-1,max:1e3,step:.1}]},{type:"Pixelate",status:!1,params:[{key:"blocksize",value:.01,uiType:Vt.NUMBER,min:.01,max:100,step:.01}]},{type:"Blur",status:!1,params:[{key:"blur",value:0,uiType:Vt.NUMBER,min:0,max:1,step:.01}]},{type:"Grayscale",status:!1,params:[{key:"mode",value:"average",uiType:Vt.SELECT,list:["average","lightness","luminosity"]}]},{type:"RemoveColor",status:!1,params:[{key:"color",value:"",uiType:Vt.COLOR},{key:"distance",value:0,uiType:Vt.NUMBER,min:0,max:1,step:.01}]}],Jn=[{type:"Gamma",status:!1,params:[{key:"red",value:0,uiType:Vt.NUMBER,min:.01,max:2.2,step:.01},{key:"green",value:0,uiType:Vt.NUMBER,min:.01,max:2.2,step:.01},{key:"blue",value:0,uiType:Vt.NUMBER,min:.01,max:2.2,step:.01}],handler(c,t,f){return{gamma:[c,t,f]}}}];const Hf={key:0,class:"box"},Vf={class:"filter-box"},Uf=["src","onClick"],Nf={key:0,class:"content"},Wf={key:0},Xf={key:1},Yf={key:2},Gf=Ct({name:"Filter"}),qf=Object.assign(Gf,{setup(c){const{fabric:t,mixinState:f,canvasEditor:p}=Pt(),m=_e("event"),y=Qe(),w={BlackWhite:!1,Brownie:!1,Vintage:!1,Kodachrome:!1,technicolor:!1,Polaroid:!1,Invert:!1,Sepia:!1},u=Rt({uiType:Vt,noParamsFilters:w,paramsFilters:[...Kn],combinationFilters:[...Jn],type:""}),r=(g,v)=>{const _=p.canvas.getActiveObjects()[0];u.noParamsFilters[g]=v,v?h(_,g)||o(_,g):n(_,g)},a=g=>{const v=p.canvas.getActiveObjects()[0],b=[...u.paramsFilters,...u.combinationFilters].find(C=>C.type===g);b.status?b.handler?e(b):b.params.forEach(C=>{s(g,C.key,C.value)}):n(v,g)},l=()=>{var v;const g=p.canvas.getActiveObjects()[0];g&&(u.type=g.type,u.type==="image"&&(Object.keys(w).forEach(_=>{var b;u.noParamsFilters[_]=!!h(g,_),(b=y==null?void 0:y.proxy)==null||b.$forceUpdate()}),Kn.forEach(_=>{const b=u.paramsFilters.find(S=>S.type===_.type),C=h(g,_.type);b.status=!!C,b.params.forEach(S=>{S.value=C?C[S.key]:S.value})}),Jn.forEach(_=>{const b=u.combinationFilters.find(S=>S.type===_.type),C=h(g,_.type);b.status=!!C})),(v=y==null?void 0:y.proxy)==null||v.$forceUpdate())};Jt(()=>{m.on("selectOne",l)}),ei(()=>{m.off("selectOne",l)});function i(g){return new URL(Object.assign({"../assets/filters/BlackWhite.png":jf,"../assets/filters/Brownie.png":Lf,"../assets/filters/Invert.png":Ff,"../assets/filters/Kodachrome.png":If,"../assets/filters/Polaroid.png":$f,"../assets/filters/Sepia.png":Bf,"../assets/filters/Vintage.png":Rf,"../assets/filters/technicolor.png":zf})[`../assets/filters/${g}.png`],self.location).href}function s(g,v,_){const b=p.canvas.getActiveObjects()[0],C=h(b,g);if(C)C[v]=_;else{const S=o(b,g);S[v]=_}b.applyFilters(),p.canvas.renderAll()}function e(g){const v=p.canvas.getActiveObjects()[0];n(v,g.type);const _=g.params.map(b=>b.value);o(v,g.type,g.handler(..._))}function o(g,v,_=null){let b;const C=d(v),S=t.Image.filters[C];return S&&(b=new S(_),b.options=_,g.filters.push(b)),g.applyFilters(),p.canvas.renderAll(),b}function h(g,v){let _=null;if(g){const b=d(v),{length:C}=g.filters;let S,E;for(E=0;E<C;E+=1)if(S=g.filters[E],S.type===b){_=S;break}}return _}function n(g,v){const _=d(v);g.filters=g.filters.filter(b=>b.type!==_),g.applyFilters(),p.canvas.renderAll()}function d(g){return g.charAt(0).toUpperCase()+g.slice(1)}return(g,v)=>{const _=it("Checkbox"),b=it("Panel"),C=it("Radio"),S=it("RadioGroup"),E=it("Slider"),z=it("ColorPicker"),V=it("Collapse");return D(f).mSelectMode==="one"&&D(u).type==="image"?(Z(),at("div",Hf,[M(V,null,{default:$(()=>[M(b,{name:"1"},{content:$(()=>[I("div",Vf,[(Z(!0),at(kt,null,It(D(u).noParamsFilters,(W,L)=>(Z(),at("div",{class:"filter-item",key:L},[I("img",{src:i(L),alt:"",onClick:A=>r(L,!w[L])},null,8,Uf),M(_,{modelValue:D(u).noParamsFilters[L],"onUpdate:modelValue":A=>D(u).noParamsFilters[L]=A,onOnChange:A=>r(L,A)},{default:$(()=>[dt(ct(g.$t("filters."+L)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onOnChange"])]))),128))])]),default:$(()=>[dt(ct(g.$t("filters.simple"))+" ",1)]),_:1}),M(b,{name:"2"},{content:$(()=>[I("div",null,[(Z(!0),at(kt,null,It([...D(u).paramsFilters,...D(u).combinationFilters],W=>(Z(),at("div",{class:"filter-item has-params",key:W.type},[M(_,{modelValue:W.status,"onUpdate:modelValue":L=>W.status=L,onOnChange:L=>a(W.type)},{default:$(()=>[dt(ct(g.$t("filters."+W.type)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onOnChange"]),W.status?(Z(),at("div",Nf,[(Z(!0),at(kt,null,It(W.params,L=>(Z(),at("div",{class:"content slider-box",key:L},[L.uiType===D(Vt).SELECT?(Z(),at("div",Wf,[M(S,{modelValue:L.value,"onUpdate:modelValue":A=>L.value=A,onOnChange:A=>a(W.type)},{default:$(()=>[(Z(!0),at(kt,null,It(L.list,A=>(Z(),wt(C,{label:A,key:A},{default:$(()=>[dt(ct(g.$t("filters."+W.type+"List."+A)),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onOnChange"])])):bt("",!0),L.uiType===D(Vt).NUMBER?(Z(),at("div",Xf,[M(E,{modelValue:L.value,"onUpdate:modelValue":A=>L.value=A,max:L.max,min:L.min,step:L.step,onOnInput:A=>a(W.type)},null,8,["modelValue","onUpdate:modelValue","max","min","step","onOnInput"])])):bt("",!0),L.uiType===D(Vt).COLOR?(Z(),at("div",Yf,[M(z,{modelValue:L.value,"onUpdate:modelValue":A=>L.value=A,alpha:"",size:"small",onOnChange:A=>a(W.type)},null,8,["modelValue","onUpdate:modelValue","onOnChange"])])):bt("",!0)]))),128))])):bt("",!0)]))),128))])]),default:$(()=>[dt(ct(g.$t("filters.complex"))+" ",1)]),_:1})]),_:1})])):bt("",!0)}}}),Kf=Bt(qf,[["__scopeId","data-v-5789dc8f"]]),Jf={style:{display:"inline-block"}},Zf={key:0,class:"time"},Qf={name:"ToolBar"},td=Ct(Ot(yt({},Qf),{setup(c){const{canvasEditor:t}=Pt(),{history:f,redoStack:p,undoStack:m}=Rt(t.getHistory()),y=()=>{t.undo()},w=()=>{t.redo()};return(u,r)=>{const a=it("Icon"),l=it("Button"),i=it("Tooltip");return Z(),at("div",Jf,[M(i,{content:u.$t("history.revocation")+`(${D(m).length})`},{default:$(()=>[M(l,{onClick:y,type:"text",size:"small",disabled:D(m).length===0},{default:$(()=>[M(a,{type:"ios-undo",size:"20"})]),_:1},8,["disabled"])]),_:1},8,["content"]),M(i,{content:u.$t("history.redo")+`(${D(p).length})`},{default:$(()=>[M(l,{onClick:w,type:"text",size:"small",disabled:D(p).length===0},{default:$(()=>[M(a,{type:"ios-redo",size:"20"})]),_:1},8,["disabled"])]),_:1},8,["content"]),D(f).length?(Z(),at("span",Zf,ct(D(Zl)(D(f)[0].timestamp,"HH:mm:ss").value),1)):bt("",!0)])}}}));const ed=Bt(td,[["__scopeId","data-v-4ec31952"]]);const id={class:"box"},nd={class:"layer-box"},rd=["onClick"],sd={class:"ellipsis"},od=["innerHTML"],ad={class:"btn-box"},ld=["innerHTML"],cd=["innerHTML"],hd=["innerHTML"],ud=["innerHTML"],fd={key:1,class:"empty-text"},dd=Ct({name:"Layer"}),gd=Object.assign(dd,{setup(c){const{canvasEditor:t,fabric:f,mixinState:p}=Pt(),m=vt([]),y=h=>h.id===p.mSelectId||p.mSelectIds.includes(h.id),w=h=>{const n={group:'<svg t="1650855307397" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2503" width="16" height="16"><path d="M839.036 130.458h-654.072c-30.102 0-54.506 24.404-54.506 54.506v654.072c0 30.102 24.404 54.506 54.506 54.506h654.072c30.102 0 54.506-24.404 54.506-54.506v-654.072c0-30.102-24.404-54.506-54.506-54.506zM839.036 811.786c0 15.050-12.196 27.249-27.249 27.249h-598.721c-15.050 0-27.249-12.196-27.249-27.249v-598.721c0-15.050 12.196-27.249 27.249-27.249h598.721c15.049 0 27.249 12.196 27.249 27.249v598.721zM730.028 421.639h-127.324v-126.817c0-30.091-24.402-54.499-54.501-54.499h-252.755c-30.098 0-54.501 24.401-54.501 54.499v253.89c0 30.091 24.402 54.499 54.501 54.499h127.324v126.817c0 30.091 24.402 54.499 54.501 54.499h252.755c30.098 0 54.501-24.401 54.501-54.499v-253.89c0-30.091-24.402-54.499-54.501-54.499zM323.36 548.137c-15.050 0-27.251-12.207-27.251-27.26v-197.694c0-15.055 12.201-27.26 27.251-27.26h196.928c15.051 0 27.251 12.207 27.251 27.26v98.458h-70.267c-30.098 0-54.501 24.401-54.501 54.499v71.998h-99.411zM547.539 477.24v43.638c0 15.055-12.202 27.26-27.251 27.26h-42.353v-43.638c0-15.055 12.202-27.26 27.251-27.26h42.353zM729.365 702.193c0 15.055-12.201 27.26-27.251 27.26h-196.928c-15.050 0-27.251-12.207-27.251-27.26v-98.981h70.267c30.098 0 54.501-24.401 54.501-54.499v-71.474h99.411c15.050 0 27.251 12.207 27.251 27.26v197.693z" p-id="2504"></path></svg>',textbox:'<svg t="1650854954008" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="14038" width="16" height="16"><path d="M720.832 692.352h-12.64L530.208 260.448a19.968 19.968 0 0 0-36.416 0L316.608 692.352h-13.44c-7.904 0-15.04 3.968-17.408 11.072a19.872 19.872 0 0 0 18.208 27.68h56.96c9.504 0 18.208-6.336 19.776-15.808a18.752 18.752 0 0 0-15.808-21.344l36.384-87.808h159.776l34.816 87.808a18.88 18.88 0 0 0-15.808 21.344c1.568 9.504 10.272 15.808 19.776 15.808h121.024c7.904 0 15.04-3.968 17.408-11.072a19.2 19.2 0 0 0-17.408-27.68z m-306.112-125.76l64.864-158.208 64.864 158.208H414.72z m-246.816-80.704c0 6.336 5.536 11.872 11.872 11.872s11.872-5.536 11.872-11.872v-23.744c0-6.336-5.536-11.872-11.872-11.872s-11.872 5.536-11.872 11.872v23.744z m0-75.936c0 6.336 5.536 11.872 11.872 11.872s11.872-5.536 11.872-11.872v-23.744c0-6.336-5.536-11.872-11.872-11.872s-11.872 5.536-11.872 11.872v23.744z m0 151.872c0 6.336 5.536 11.872 11.872 11.872s11.872-5.536 11.872-11.872v-23.744c0-6.336-5.536-11.872-11.872-11.872s-11.872 5.536-11.872 11.872v23.744z m11.872-216.736a12.16 12.16 0 0 0 11.872-11.872v-23.744c-0.8-6.336-5.536-11.072-11.872-11.072s-11.872 5.536-11.872 11.872v23.744c0 6.336 4.736 11.072 11.872 11.072z m-11.872 292.672c0 6.336 5.536 11.872 11.872 11.872s11.872-5.536 11.872-11.872v-23.744c0-6.336-5.536-11.872-11.872-11.872s-11.872 5.536-11.872 11.872v23.744z m0 75.936c0 7.104 4.736 11.872 11.872 11.872a12.16 12.16 0 0 0 11.872-11.872v-23.744c0-6.336-5.536-11.872-11.872-11.872s-11.872 5.536-11.872 11.872v23.744z m665.248-227.808c0 6.336 5.536 11.872 11.872 11.872s11.872-5.536 11.872-11.872v-23.744c0-6.336-5.536-11.872-11.872-11.872s-11.872 5.536-11.872 11.872v23.744z m0-75.936c0 6.336 5.536 11.872 11.872 11.872s11.872-5.536 11.872-11.872v-23.744c0-6.336-5.536-11.872-11.872-11.872s-11.872 5.536-11.872 11.872v23.744z m0 151.872c0 6.336 5.536 11.872 11.872 11.872s11.872-5.536 11.872-11.872v-23.744c0-6.336-5.536-11.872-11.872-11.872s-11.872 5.536-11.872 11.872v23.744z m11.072-216.736a12.16 12.16 0 0 0 11.872-11.872v-23.744c0-6.336-5.536-11.872-11.872-11.872s-11.872 5.536-11.872 11.872v23.744c0.8 7.104 5.536 11.872 11.872 11.872z m-11.072 292.672c0 6.336 5.536 11.872 11.872 11.872s11.872-5.536 11.872-11.872v-23.744c0-6.336-5.536-11.872-11.872-11.872s-11.872 5.536-11.872 11.872v23.744z m0 75.936c0 6.336 5.536 11.872 11.872 11.872s11.872-5.536 11.872-11.872v-23.744c0-6.336-5.536-11.872-11.872-11.872s-11.872 5.536-11.872 11.872v23.744z m-347.264 119.456h-23.744c-6.336 0-11.872 5.536-11.872 11.872s5.536 11.872 11.872 11.872h23.744c6.336 0 11.872-5.536 11.872-11.872s-5.536-11.872-11.872-11.872z m-75.936 0h-23.744c-6.336 0-11.872 5.536-11.872 11.872s5.536 11.872 11.872 11.872h23.744c6.336 0 11.872-5.536 11.872-11.872s-5.536-11.872-11.872-11.872z m151.872 0h-23.744c-6.336 0-11.872 5.536-11.872 11.872s5.536 11.872 11.872 11.872h23.744c6.336 0 11.872-5.536 11.872-11.872s-5.536-11.872-11.872-11.872z m-228.608 0h-23.744c-6.336 0-11.872 5.536-11.872 11.872s5.536 11.872 11.872 11.872h23.744c6.336 0 11.872-5.536 11.872-11.872s-4.736-11.872-11.872-11.872z m-75.136-7.904H222.496v-11.072a12.48 12.48 0 0 0-12.672-12.64h-18.976v-37.984c0-7.104-5.536-12.64-11.872-12.64s-11.872 5.536-11.872 12.64v37.984h-10.272a12.512 12.512 0 0 0-12.672 12.64v52.992a12.48 12.48 0 0 0 12.672 12.64h52.992a12.512 12.512 0 0 0 12.672-12.64v-11.072h35.584c7.104-1.568 12.672-7.904 12.672-14.24 0-7.104-12.672-16.608-12.672-16.608z m379.68 7.904h-23.744c-6.336 0-11.872 5.536-11.872 11.872s5.536 11.872 11.872 11.872h23.744c6.336 0 11.872-5.536 11.872-11.872s-5.536-11.872-11.872-11.872z m75.936 0h-23.744c-6.336 0-11.872 5.536-11.872 11.872s5.536 11.872 11.872 11.872h23.744c6.336 0 11.872-5.536 11.872-11.872s-4.736-11.872-11.872-11.872z m-251.52-642.304h23.744c6.336 0 11.872-5.536 11.872-11.872s-5.536-11.872-11.872-11.872h-23.744c-6.336 0-11.872 5.536-11.872 11.872s5.536 11.872 11.872 11.872z m-75.936 0h23.744c6.336 0 11.872-5.536 11.872-11.872s-5.536-11.872-11.872-11.872h-23.744c-6.336 0-11.872 5.536-11.872 11.872s5.536 11.872 11.872 11.872z m151.872 0h23.744c6.336 0 11.872-5.536 11.872-11.872s-5.536-11.872-11.872-11.872h-23.744c-6.336 0-11.872 5.536-11.872 11.872s5.536 11.872 11.872 11.872z m-227.808 0h23.744c6.336 0 11.872-5.536 11.872-11.872s-5.536-11.872-11.872-11.872h-23.744c-7.104 0.8-11.872 5.536-11.872 12.672s4.736 11.072 11.872 11.072zM257.28 167.904H221.696v-11.072a12.512 12.512 0 0 0-12.672-12.672H156.832a12.512 12.512 0 0 0-12.672 12.672v52.992c0 7.104 5.536 12.672 12.672 12.672h11.072v35.584c1.568 7.104 7.904 12.672 14.24 12.672s16.608-12.672 16.608-12.672V222.496h11.072a12.512 12.512 0 0 0 12.672-12.672v-18.976h35.584a12.16 12.16 0 0 0 11.872-11.872 12.224 12.224 0 0 0-12.672-11.072z m356.768 22.944h23.744c6.336 0 11.872-5.536 11.872-11.872s-5.536-11.872-11.872-11.872h-23.744c-6.336 0-11.872 5.536-11.872 11.872s5.536 11.872 11.872 11.872z m76.736 0h23.744c6.336 0 11.072-4.736 11.072-11.072s-5.536-11.872-11.872-11.872h-23.744c-6.336 0-11.872 5.536-11.872 11.872s5.536 11.072 12.64 11.072z m176.384-46.656h-52.992a12.48 12.48 0 0 0-12.64 12.672v11.072h-35.584c-7.104 1.568-12.64 7.904-12.64 14.24s12.64 16.608 12.64 16.608h35.584v11.072c0 7.104 5.536 12.672 12.64 12.672h18.976v37.984c0 7.104 5.536 12.672 11.872 12.672s11.872-5.536 11.872-12.672V222.528h11.072a12.48 12.48 0 0 0 12.64-12.672V156.864a13.76 13.76 0 0 0-13.44-12.672z m0 657.312h-11.072v-35.584c-1.568-7.104-7.904-12.64-14.24-12.64-7.104 0-16.608 12.64-16.608 12.64v35.584h-11.072a12.48 12.48 0 0 0-12.64 12.64v18.976h-35.584c-6.336 0-11.872 5.536-11.872 11.872s5.536 11.872 11.872 11.872h35.584v11.072a12.48 12.48 0 0 0 12.64 12.64h52.992a12.48 12.48 0 0 0 12.64-12.64v-52.992c0-7.904-5.536-13.44-12.64-13.44z" p-id="14039"></path></svg>',"i-text":'<svg t="1650875455324" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5401" width="16" height="16"><path d="M213.333333 209.92v128h85.333334v-42.666667h170.666666v433.493334H384.853333v85.333333h256v-85.333333H554.666667V295.253333h170.666666v42.666667h85.333334v-128H213.333333z" p-id="5402"></path></svg>',image:'<svg t="1650855321307" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2701" width="16" height="16"><path d="M813.752 223.168H209.584a25.168 25.168 0 0 0-25.168 25.176v528.648a25.16 25.16 0 0 0 25.168 25.168h604.168a25.152 25.152 0 0 0 25.168-25.168V248.344a25.168 25.168 0 0 0-25.168-25.176z m-8.08 544.168H217.664V258h588.008v509.336z" p-id="2702"></path><path d="M406.752 454.168a44.24 44.24 0 1 0-0.008-88.48 44.24 44.24 0 0 0 0.008 88.48zM474.72 611.368l-67.968-94.376-110.584 158.336h442.328L605.8 426.52z" p-id="2703"></path></svg>',rect:'<svg t="1650855811131" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="18499" width="16" height="16"><path d="M864 896H160a32 32 0 0 1-32-32V160a32 32 0 0 1 32-32h704a32 32 0 0 1 32 32v704a32 32 0 0 1-32 32zM192 832h640V192H192v640z" p-id="18500"></path></svg>',circle:'<svg t="1650855860236" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="19440" width="16" height="16"><path d="M512 928C282.624 928 96 741.376 96 512S282.624 96 512 96s416 186.624 416 416-186.624 416-416 416z m0-768C317.92 160 160 317.92 160 512s157.92 352 352 352 352-157.92 352-352S706.08 160 512 160z" p-id="19441"></path></svg>',triangle:'<svg t="1650874633978" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2032" width="16" height="16"><path d="M928.64 896a2.144 2.144 0 0 1-0.64 0H96a32.032 32.032 0 0 1-27.552-48.288l416-704c11.488-19.456 43.552-19.456 55.104 0l413.152 699.2A31.936 31.936 0 0 1 928.64 896zM152.064 832h719.84L512 222.912 152.064 832z" p-id="2033"></path></svg>',polygon:'<svg t="1650874633978" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2032" width="16" height="16"><path d="M161.152 398.016l134.016 412.416h433.664l134.016-412.416L512 143.104 161.152 398.08zM512 64l426.048 309.568-162.752 500.864H248.704L85.952 373.568 512 64z" p-id="2033"></path></svg>'},d='<svg t="1650855578257" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="17630" width="16" height="16"><path d="M620.606061 0a62.060606 62.060606 0 0 1 62.060606 62.060606v188.943515C874.945939 273.997576 1024 437.651394 1024 636.121212c0 214.217697-173.661091 387.878788-387.878788 387.878788-198.469818 0-362.123636-149.054061-385.117091-341.333333H62.060606a62.060606 62.060606 0 0 1-62.060606-62.060606V62.060606a62.060606 62.060606 0 0 1 62.060606-62.060606h558.545455z m62.060606 297.937455V620.606061a62.060606 62.060606 0 0 1-62.060606 62.060606H297.937455C320.636121 849.159758 463.39103 977.454545 636.121212 977.454545c188.509091 0 341.333333-152.824242 341.333333-341.333333 0-172.730182-128.294788-315.485091-294.787878-338.183757zM620.606061 46.545455H62.060606a15.515152 15.515152 0 0 0-15.406545 13.699878L46.545455 62.060606v558.545455a15.515152 15.515152 0 0 0 13.699878 15.406545L62.060606 636.121212h186.181818c0-214.217697 173.661091-387.878788 387.878788-387.878788V62.060606a15.515152 15.515152 0 0 0-13.699879-15.406545L620.606061 46.545455z m15.515151 248.242424c-188.509091 0-341.333333 152.824242-341.333333 341.333333h325.818182a15.515152 15.515152 0 0 0 15.406545-13.699879L636.121212 620.606061V294.787879z" p-id="17631"></path></svg>';return n[h]||d},u=(h,n)=>h.includes("text")?n.name||n.text:{group:"组合",image:"图片",rect:"矩形",circle:"圆形",triangle:"三角形",polygon:"多边形",path:"路径"}[h]||"默认元素",r=h=>{const n=t.canvas.getObjects().find(d=>d.id===h);t.canvas.discardActiveObject(),t.canvas.setActiveObject(n),t.canvas.requestRenderAll()},a=h=>({up:'<svg t="1650442206559" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1799" width="12" height="12"><path d="M876.2 434.3L536.7 94.9c-6.6-6.6-15.5-10.3-24.7-10.3-9.3 0-18.2 3.7-24.7 10.3L147.8 434.3c-13.7 13.7-13.7 35.8 0 49.5 13.7 13.7 35.8 13.7 49.5 0L477 204.1v700.2c0 19.3 15.7 35 35 35s35-15.7 35-35V204.1l279.7 279.7c6.8 6.8 15.8 10.3 24.7 10.3s17.9-3.4 24.7-10.3c13.7-13.7 13.7-35.8 0.1-49.5z" p-id="1800"></path></svg>',down:'<svg t="1650442229022" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1997" width="12" height="12"><path d="M876.2 589.7L536.7 929.1c-6.6 6.6-15.5 10.3-24.7 10.3-9.3 0-18.2-3.7-24.7-10.3L147.8 589.7c-13.7-13.7-13.7-35.8 0-49.5 13.7-13.7 35.8-13.7 49.5 0L477 819.9V119.6c0-19.3 15.7-35 35-35s35 15.7 35 35v700.2l279.7-279.7c6.8-6.8 15.8-10.3 24.7-10.3s17.9 3.4 24.7 10.3c13.7 13.8 13.7 35.9 0.1 49.6z" p-id="1998" ></path></svg>',upTop:'<svg t="1650442106652" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1839" width="11" height="11"><path d="M548.352 219.648a58.88 58.88 0 0 0-16.896-10.752 51.2 51.2 0 0 0-38.912 0 58.88 58.88 0 0 0-16.896 10.752l-256 256a51.2 51.2 0 0 0 72.704 72.704L460.8 379.392V972.8a51.2 51.2 0 0 0 102.4 0V379.392l168.448 168.96a51.2 51.2 0 0 0 72.704-72.704zM972.8 0H51.2a51.2 51.2 0 0 0 0 102.4h921.6a51.2 51.2 0 0 0 0-102.4z" p-id="1840" ></path></svg>',downTop:'<svg t="1650442146918" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2045" width="11" height="11"><path d="M548.352 804.352a58.88 58.88 0 0 1-16.896 10.752 51.2 51.2 0 0 1-38.912 0 58.88 58.88 0 0 1-16.896-10.752l-256-256a51.2 51.2 0 0 1 72.704-72.704L460.8 644.608V51.2a51.2 51.2 0 0 1 102.4 0v593.408l168.448-168.96a51.2 51.2 0 0 1 72.704 72.704zM972.8 1024H51.2a51.2 51.2 0 0 1 0-102.4h921.6a51.2 51.2 0 0 1 0 102.4z" p-id="2046"></path></svg>'})[h],l=()=>{t.up()},i=()=>{t.upTop()},s=()=>{t.down()},e=()=>{t.downTop()},o=()=>{m.value=[...t.canvas.getObjects().filter(h=>!(h instanceof f.GuideLine||h.id==="workspace"))].reverse().map(h=>{const{type:n,id:d,name:g,text:v}=h;return{type:n,id:d,name:g,text:v}}),m.value=Pl(D(m),"id")};return Jt(()=>{t.canvas.preserveObjectStacking=!0,t.canvas.on("after:render",o)}),(h,n)=>{const d=it("Divider"),g=it("Tooltip"),v=it("Button"),_=it("ButtonGroup");return Z(),at("div",id,[D(m).length?(Z(),at(kt,{key:0},[M(d,{plain:"",orientation:"left"},{default:$(()=>[dt(ct(h.$t("layers")),1)]),_:1}),I("div",nd,[(Z(!0),at(kt,null,It(D(m),b=>(Z(),at("div",{onClick:C=>r(b.id),key:b.id,class:qt(y(b)&&"active")},[M(g,{content:b.name||b.text||b.type,placement:"left"},{default:$(()=>[I("div",sd,[I("span",{class:qt(y(b)&&"active"),innerHTML:w(b.type)},null,10,od),dt(" | "+ct(u(b.type,b)),1)])]),_:2},1032,["content"])],10,rd))),128))]),I("div",ad,[Ut(M(_,{size:"small"},{default:$(()=>[M(v,{onClick:l},{default:$(()=>[I("span",{innerHTML:a("up")},null,8,ld)]),_:1}),M(v,{onClick:s},{default:$(()=>[I("span",{innerHTML:a("down")},null,8,cd)]),_:1}),M(v,{onClick:i},{default:$(()=>[I("span",{innerHTML:a("upTop")},null,8,hd)]),_:1}),M(v,{onClick:e},{default:$(()=>[I("span",{innerHTML:a("downTop")},null,8,ud)]),_:1})]),_:1},512),[[Qt,D(p).mSelectMode==="one"]])])],64)):(Z(),at("p",fd,"暂无图层"))])}}}),pd=Bt(gd,[["__scopeId","data-v-aec79765"]]),vd=[{name:"汉体",fontFamily:"汉体"},{name:"华康金刚黑",fontFamily:"华康金刚黑"}],md=[],_d=[...vd,...md];var yd=Object.defineProperty,bd=Object.defineProperties,wd=Object.getOwnPropertyDescriptors,Zn=Object.getOwnPropertySymbols,Cd=Object.prototype.hasOwnProperty,xd=Object.prototype.propertyIsEnumerable,Qn=(c,t,f)=>t in c?yd(c,t,{enumerable:!0,configurable:!0,writable:!0,value:f}):c[t]=f,Sd=(c,t)=>{for(var f in t||(t={}))Cd.call(t,f)&&Qn(c,f,t[f]);if(Zn)for(var f of Zn(t))xd.call(t,f)&&Qn(c,f,t[f]);return c},Td=(c,t)=>bd(c,wd(t)),Od=typeof global=="object"&&global&&global.Object===Object&&global;const ds=Od;var kd=typeof self=="object"&&self&&self.Object===Object&&self,Ad=ds||kd||Function("return this")();const te=Ad;var Ed=te.Symbol;const De=Ed;var gs=Object.prototype,Md=gs.hasOwnProperty,Pd=gs.toString,ze=De?De.toStringTag:void 0;function Dd(c){var t=Md.call(c,ze),f=c[ze];try{c[ze]=void 0;var p=!0}catch(y){}var m=Pd.call(c);return p&&(t?c[ze]=f:delete c[ze]),m}var jd=Object.prototype,Ld=jd.toString;function Fd(c){return Ld.call(c)}var Id="[object Null]",$d="[object Undefined]",tr=De?De.toStringTag:void 0;function Le(c){return c==null?c===void 0?$d:Id:tr&&tr in Object(c)?Dd(c):Fd(c)}function Fe(c){return c!=null&&typeof c=="object"}var Bd="[object Symbol]";function Rd(c){return typeof c=="symbol"||Fe(c)&&Le(c)==Bd}var zd=Array.isArray;const bn=zd;var Hd=/\s/;function Vd(c){for(var t=c.length;t--&&Hd.test(c.charAt(t)););return t}var Ud=/^\s+/;function Nd(c){return c&&c.slice(0,Vd(c)+1).replace(Ud,"")}function ge(c){var t=typeof c;return c!=null&&(t=="object"||t=="function")}var er=0/0,Wd=/^[-+]0x[0-9a-f]+$/i,Xd=/^0b[01]+$/i,Yd=/^0o[0-7]+$/i,Gd=parseInt;function ir(c){if(typeof c=="number")return c;if(Rd(c))return er;if(ge(c)){var t=typeof c.valueOf=="function"?c.valueOf():c;c=ge(t)?t+"":t}if(typeof c!="string")return c===0?c:+c;c=Nd(c);var f=Xd.test(c);return f||Yd.test(c)?Gd(c.slice(2),f?2:8):Wd.test(c)?er:+c}var qd="[object AsyncFunction]",Kd="[object Function]",Jd="[object GeneratorFunction]",Zd="[object Proxy]";function ps(c){if(!ge(c))return!1;var t=Le(c);return t==Kd||t==Jd||t==qd||t==Zd}var Qd=te["__core-js_shared__"];const Ii=Qd;var nr=function(){var c=/[^.]+$/.exec(Ii&&Ii.keys&&Ii.keys.IE_PROTO||"");return c?"Symbol(src)_1."+c:""}();function t1(c){return!!nr&&nr in c}var e1=Function.prototype,i1=e1.toString;function Ae(c){if(c!=null){try{return i1.call(c)}catch(t){}try{return c+""}catch(t){}}return""}var n1=/[\\^$.*+?()[\]{}|]/g,r1=/^\[object .+?Constructor\]$/,s1=Function.prototype,o1=Object.prototype,a1=s1.toString,l1=o1.hasOwnProperty,c1=RegExp("^"+a1.call(l1).replace(n1,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function h1(c){if(!ge(c)||t1(c))return!1;var t=ps(c)?c1:r1;return t.test(Ae(c))}function u1(c,t){return c==null?void 0:c[t]}function Ee(c,t){var f=u1(c,t);return h1(f)?f:void 0}var f1=Ee(te,"WeakMap");const Gi=f1;var rr=Object.create,d1=function(){function c(){}return function(t){if(!ge(t))return{};if(rr)return rr(t);c.prototype=t;var f=new c;return c.prototype=void 0,f}}();const g1=d1;function p1(c,t){var f=-1,p=c.length;for(t||(t=Array(p));++f<p;)t[f]=c[f];return t}var v1=function(){try{var c=Ee(Object,"defineProperty");return c({},"",{}),c}catch(t){}}();const sr=v1;function m1(c,t){for(var f=-1,p=c==null?0:c.length;++f<p&&t(c[f],f,c)!==!1;);return c}var _1=9007199254740991,y1=/^(?:0|[1-9]\d*)$/;function b1(c,t){var f=typeof c;return t=t==null?_1:t,!!t&&(f=="number"||f!="symbol"&&y1.test(c))&&c>-1&&c%1==0&&c<t}function vs(c,t,f){t=="__proto__"&&sr?sr(c,t,{configurable:!0,enumerable:!0,value:f,writable:!0}):c[t]=f}function ms(c,t){return c===t||c!==c&&t!==t}var w1=Object.prototype,C1=w1.hasOwnProperty;function _s(c,t,f){var p=c[t];(!(C1.call(c,t)&&ms(p,f))||f===void 0&&!(t in c))&&vs(c,t,f)}function Oi(c,t,f,p){var m=!f;f||(f={});for(var y=-1,w=t.length;++y<w;){var u=t[y],r=p?p(f[u],c[u],u,f,c):void 0;r===void 0&&(r=c[u]),m?vs(f,u,r):_s(f,u,r)}return f}var x1=9007199254740991;function ys(c){return typeof c=="number"&&c>-1&&c%1==0&&c<=x1}function bs(c){return c!=null&&ys(c.length)&&!ps(c)}var S1=Object.prototype;function wn(c){var t=c&&c.constructor,f=typeof t=="function"&&t.prototype||S1;return c===f}function T1(c,t){for(var f=-1,p=Array(c);++f<c;)p[f]=t(f);return p}var O1="[object Arguments]";function or(c){return Fe(c)&&Le(c)==O1}var ws=Object.prototype,k1=ws.hasOwnProperty,A1=ws.propertyIsEnumerable,E1=or(function(){return arguments}())?or:function(c){return Fe(c)&&k1.call(c,"callee")&&!A1.call(c,"callee")};const M1=E1;function P1(){return!1}var Cs=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ar=Cs&&typeof module=="object"&&module&&!module.nodeType&&module,D1=ar&&ar.exports===Cs,lr=D1?te.Buffer:void 0,j1=lr?lr.isBuffer:void 0,L1=j1||P1;const xs=L1;var F1="[object Arguments]",I1="[object Array]",$1="[object Boolean]",B1="[object Date]",R1="[object Error]",z1="[object Function]",H1="[object Map]",V1="[object Number]",U1="[object Object]",N1="[object RegExp]",W1="[object Set]",X1="[object String]",Y1="[object WeakMap]",G1="[object ArrayBuffer]",q1="[object DataView]",K1="[object Float32Array]",J1="[object Float64Array]",Z1="[object Int8Array]",Q1="[object Int16Array]",tg="[object Int32Array]",eg="[object Uint8Array]",ig="[object Uint8ClampedArray]",ng="[object Uint16Array]",rg="[object Uint32Array]",Dt={};Dt[K1]=Dt[J1]=Dt[Z1]=Dt[Q1]=Dt[tg]=Dt[eg]=Dt[ig]=Dt[ng]=Dt[rg]=!0;Dt[F1]=Dt[I1]=Dt[G1]=Dt[$1]=Dt[q1]=Dt[B1]=Dt[R1]=Dt[z1]=Dt[H1]=Dt[V1]=Dt[U1]=Dt[N1]=Dt[W1]=Dt[X1]=Dt[Y1]=!1;function sg(c){return Fe(c)&&ys(c.length)&&!!Dt[Le(c)]}function Cn(c){return function(t){return c(t)}}var Ss=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ne=Ss&&typeof module=="object"&&module&&!module.nodeType&&module,og=Ne&&Ne.exports===Ss,$i=og&&ds.process,ag=function(){try{var c=Ne&&Ne.require&&Ne.require("util").types;return c||$i&&$i.binding&&$i.binding("util")}catch(t){}}();const je=ag;var cr=je&&je.isTypedArray,lg=cr?Cn(cr):sg;const cg=lg;var hg=Object.prototype,ug=hg.hasOwnProperty;function Ts(c,t){var f=bn(c),p=!f&&M1(c),m=!f&&!p&&xs(c),y=!f&&!p&&!m&&cg(c),w=f||p||m||y,u=w?T1(c.length,String):[],r=u.length;for(var a in c)(t||ug.call(c,a))&&!(w&&(a=="length"||m&&(a=="offset"||a=="parent")||y&&(a=="buffer"||a=="byteLength"||a=="byteOffset")||b1(a,r)))&&u.push(a);return u}function Os(c,t){return function(f){return c(t(f))}}var fg=Os(Object.keys,Object);const dg=fg;var gg=Object.prototype,pg=gg.hasOwnProperty;function vg(c){if(!wn(c))return dg(c);var t=[];for(var f in Object(c))pg.call(c,f)&&f!="constructor"&&t.push(f);return t}function xn(c){return bs(c)?Ts(c):vg(c)}function mg(c){var t=[];if(c!=null)for(var f in Object(c))t.push(f);return t}var _g=Object.prototype,yg=_g.hasOwnProperty;function bg(c){if(!ge(c))return mg(c);var t=wn(c),f=[];for(var p in c)p=="constructor"&&(t||!yg.call(c,p))||f.push(p);return f}function Sn(c){return bs(c)?Ts(c,!0):bg(c)}var wg=Ee(Object,"create");const Ye=wg;function Cg(){this.__data__=Ye?Ye(null):{},this.size=0}function xg(c){var t=this.has(c)&&delete this.__data__[c];return this.size-=t?1:0,t}var Sg="__lodash_hash_undefined__",Tg=Object.prototype,Og=Tg.hasOwnProperty;function kg(c){var t=this.__data__;if(Ye){var f=t[c];return f===Sg?void 0:f}return Og.call(t,c)?t[c]:void 0}var Ag=Object.prototype,Eg=Ag.hasOwnProperty;function Mg(c){var t=this.__data__;return Ye?t[c]!==void 0:Eg.call(t,c)}var Pg="__lodash_hash_undefined__";function Dg(c,t){var f=this.__data__;return this.size+=this.has(c)?0:1,f[c]=Ye&&t===void 0?Pg:t,this}function Oe(c){var t=-1,f=c==null?0:c.length;for(this.clear();++t<f;){var p=c[t];this.set(p[0],p[1])}}Oe.prototype.clear=Cg;Oe.prototype.delete=xg;Oe.prototype.get=kg;Oe.prototype.has=Mg;Oe.prototype.set=Dg;function jg(){this.__data__=[],this.size=0}function ki(c,t){for(var f=c.length;f--;)if(ms(c[f][0],t))return f;return-1}var Lg=Array.prototype,Fg=Lg.splice;function Ig(c){var t=this.__data__,f=ki(t,c);if(f<0)return!1;var p=t.length-1;return f==p?t.pop():Fg.call(t,f,1),--this.size,!0}function $g(c){var t=this.__data__,f=ki(t,c);return f<0?void 0:t[f][1]}function Bg(c){return ki(this.__data__,c)>-1}function Rg(c,t){var f=this.__data__,p=ki(f,c);return p<0?(++this.size,f.push([c,t])):f[p][1]=t,this}function pe(c){var t=-1,f=c==null?0:c.length;for(this.clear();++t<f;){var p=c[t];this.set(p[0],p[1])}}pe.prototype.clear=jg;pe.prototype.delete=Ig;pe.prototype.get=$g;pe.prototype.has=Bg;pe.prototype.set=Rg;var zg=Ee(te,"Map");const Ge=zg;function Hg(){this.size=0,this.__data__={hash:new Oe,map:new(Ge||pe),string:new Oe}}function Vg(c){var t=typeof c;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?c!=="__proto__":c===null}function Ai(c,t){var f=c.__data__;return Vg(t)?f[typeof t=="string"?"string":"hash"]:f.map}function Ug(c){var t=Ai(this,c).delete(c);return this.size-=t?1:0,t}function Ng(c){return Ai(this,c).get(c)}function Wg(c){return Ai(this,c).has(c)}function Xg(c,t){var f=Ai(this,c),p=f.size;return f.set(c,t),this.size+=f.size==p?0:1,this}function Ie(c){var t=-1,f=c==null?0:c.length;for(this.clear();++t<f;){var p=c[t];this.set(p[0],p[1])}}Ie.prototype.clear=Hg;Ie.prototype.delete=Ug;Ie.prototype.get=Ng;Ie.prototype.has=Wg;Ie.prototype.set=Xg;function ks(c,t){for(var f=-1,p=t.length,m=c.length;++f<p;)c[m+f]=t[f];return c}var Yg=Os(Object.getPrototypeOf,Object);const As=Yg;function Gg(){this.__data__=new pe,this.size=0}function qg(c){var t=this.__data__,f=t.delete(c);return this.size=t.size,f}function Kg(c){return this.__data__.get(c)}function Jg(c){return this.__data__.has(c)}var Zg=200;function Qg(c,t){var f=this.__data__;if(f instanceof pe){var p=f.__data__;if(!Ge||p.length<Zg-1)return p.push([c,t]),this.size=++f.size,this;f=this.__data__=new Ie(p)}return f.set(c,t),this.size=f.size,this}function $e(c){var t=this.__data__=new pe(c);this.size=t.size}$e.prototype.clear=Gg;$e.prototype.delete=qg;$e.prototype.get=Kg;$e.prototype.has=Jg;$e.prototype.set=Qg;function tp(c,t){return c&&Oi(t,xn(t),c)}function ep(c,t){return c&&Oi(t,Sn(t),c)}var Es=typeof exports=="object"&&exports&&!exports.nodeType&&exports,hr=Es&&typeof module=="object"&&module&&!module.nodeType&&module,ip=hr&&hr.exports===Es,ur=ip?te.Buffer:void 0,fr=ur?ur.allocUnsafe:void 0;function np(c,t){if(t)return c.slice();var f=c.length,p=fr?fr(f):new c.constructor(f);return c.copy(p),p}function rp(c,t){for(var f=-1,p=c==null?0:c.length,m=0,y=[];++f<p;){var w=c[f];t(w,f,c)&&(y[m++]=w)}return y}function Ms(){return[]}var sp=Object.prototype,op=sp.propertyIsEnumerable,dr=Object.getOwnPropertySymbols,ap=dr?function(c){return c==null?[]:(c=Object(c),rp(dr(c),function(t){return op.call(c,t)}))}:Ms;const Tn=ap;function lp(c,t){return Oi(c,Tn(c),t)}var cp=Object.getOwnPropertySymbols,hp=cp?function(c){for(var t=[];c;)ks(t,Tn(c)),c=As(c);return t}:Ms;const Ps=hp;function up(c,t){return Oi(c,Ps(c),t)}function Ds(c,t,f){var p=t(c);return bn(c)?p:ks(p,f(c))}function fp(c){return Ds(c,xn,Tn)}function dp(c){return Ds(c,Sn,Ps)}var gp=Ee(te,"DataView");const qi=gp;var pp=Ee(te,"Promise");const Ki=pp;var vp=Ee(te,"Set");const Ji=vp;var gr="[object Map]",mp="[object Object]",pr="[object Promise]",vr="[object Set]",mr="[object WeakMap]",_r="[object DataView]",_p=Ae(qi),yp=Ae(Ge),bp=Ae(Ki),wp=Ae(Ji),Cp=Ae(Gi),Se=Le;(qi&&Se(new qi(new ArrayBuffer(1)))!=_r||Ge&&Se(new Ge)!=gr||Ki&&Se(Ki.resolve())!=pr||Ji&&Se(new Ji)!=vr||Gi&&Se(new Gi)!=mr)&&(Se=function(c){var t=Le(c),f=t==mp?c.constructor:void 0,p=f?Ae(f):"";if(p)switch(p){case _p:return _r;case yp:return gr;case bp:return pr;case wp:return vr;case Cp:return mr}return t});const On=Se;var xp=Object.prototype,Sp=xp.hasOwnProperty;function Tp(c){var t=c.length,f=new c.constructor(t);return t&&typeof c[0]=="string"&&Sp.call(c,"index")&&(f.index=c.index,f.input=c.input),f}var Op=te.Uint8Array;const yr=Op;function kn(c){var t=new c.constructor(c.byteLength);return new yr(t).set(new yr(c)),t}function kp(c,t){var f=t?kn(c.buffer):c.buffer;return new c.constructor(f,c.byteOffset,c.byteLength)}var Ap=/\w*$/;function Ep(c){var t=new c.constructor(c.source,Ap.exec(c));return t.lastIndex=c.lastIndex,t}var br=De?De.prototype:void 0,wr=br?br.valueOf:void 0;function Mp(c){return wr?Object(wr.call(c)):{}}function Pp(c,t){var f=t?kn(c.buffer):c.buffer;return new c.constructor(f,c.byteOffset,c.length)}var Dp="[object Boolean]",jp="[object Date]",Lp="[object Map]",Fp="[object Number]",Ip="[object RegExp]",$p="[object Set]",Bp="[object String]",Rp="[object Symbol]",zp="[object ArrayBuffer]",Hp="[object DataView]",Vp="[object Float32Array]",Up="[object Float64Array]",Np="[object Int8Array]",Wp="[object Int16Array]",Xp="[object Int32Array]",Yp="[object Uint8Array]",Gp="[object Uint8ClampedArray]",qp="[object Uint16Array]",Kp="[object Uint32Array]";function Jp(c,t,f){var p=c.constructor;switch(t){case zp:return kn(c);case Dp:case jp:return new p(+c);case Hp:return kp(c,f);case Vp:case Up:case Np:case Wp:case Xp:case Yp:case Gp:case qp:case Kp:return Pp(c,f);case Lp:return new p;case Fp:case Bp:return new p(c);case Ip:return Ep(c);case $p:return new p;case Rp:return Mp(c)}}function Zp(c){return typeof c.constructor=="function"&&!wn(c)?g1(As(c)):{}}var Qp="[object Map]";function t0(c){return Fe(c)&&On(c)==Qp}var Cr=je&&je.isMap,e0=Cr?Cn(Cr):t0;const i0=e0;var n0="[object Set]";function r0(c){return Fe(c)&&On(c)==n0}var xr=je&&je.isSet,s0=xr?Cn(xr):r0;const o0=s0;var a0=1,l0=2,c0=4,js="[object Arguments]",h0="[object Array]",u0="[object Boolean]",f0="[object Date]",d0="[object Error]",Ls="[object Function]",g0="[object GeneratorFunction]",p0="[object Map]",v0="[object Number]",Fs="[object Object]",m0="[object RegExp]",_0="[object Set]",y0="[object String]",b0="[object Symbol]",w0="[object WeakMap]",C0="[object ArrayBuffer]",x0="[object DataView]",S0="[object Float32Array]",T0="[object Float64Array]",O0="[object Int8Array]",k0="[object Int16Array]",A0="[object Int32Array]",E0="[object Uint8Array]",M0="[object Uint8ClampedArray]",P0="[object Uint16Array]",D0="[object Uint32Array]",Et={};Et[js]=Et[h0]=Et[C0]=Et[x0]=Et[u0]=Et[f0]=Et[S0]=Et[T0]=Et[O0]=Et[k0]=Et[A0]=Et[p0]=Et[v0]=Et[Fs]=Et[m0]=Et[_0]=Et[y0]=Et[b0]=Et[E0]=Et[M0]=Et[P0]=Et[D0]=!0;Et[d0]=Et[Ls]=Et[w0]=!1;function di(c,t,f,p,m,y){var w,u=t&a0,r=t&l0,a=t&c0;if(f&&(w=m?f(c,p,m,y):f(c)),w!==void 0)return w;if(!ge(c))return c;var l=bn(c);if(l){if(w=Tp(c),!u)return p1(c,w)}else{var i=On(c),s=i==Ls||i==g0;if(xs(c))return np(c,u);if(i==Fs||i==js||s&&!m){if(w=r||s?{}:Zp(c),!u)return r?up(c,ep(w,c)):lp(c,tp(w,c))}else{if(!Et[i])return m?c:{};w=Jp(c,i,u)}}y||(y=new $e);var e=y.get(c);if(e)return e;y.set(c,w),o0(c)?c.forEach(function(n){w.add(di(n,t,f,n,c,y))}):i0(c)&&c.forEach(function(n,d){w.set(d,di(n,t,f,d,c,y))});var o=a?r?dp:fp:r?Sn:xn,h=l?void 0:o(c);return m1(h||c,function(n,d){h&&(d=n,n=c[d]),_s(w,d,di(n,t,f,d,c,y))}),w}var j0=1,L0=4;function F0(c){return di(c,j0|L0)}var I0=function(){return te.Date.now()};const Bi=I0;var $0="Expected a function",B0=Math.max,R0=Math.min;function z0(c,t,f){var p,m,y,w,u,r,a=0,l=!1,i=!1,s=!0;if(typeof c!="function")throw new TypeError($0);t=ir(t)||0,ge(f)&&(l=!!f.leading,i="maxWait"in f,y=i?B0(ir(f.maxWait)||0,t):y,s="trailing"in f?!!f.trailing:s);function e(C){var S=p,E=m;return p=m=void 0,a=C,w=c.apply(E,S),w}function o(C){return a=C,u=setTimeout(d,t),l?e(C):w}function h(C){var S=C-r,E=C-a,z=t-S;return i?R0(z,y-E):z}function n(C){var S=C-r,E=C-a;return r===void 0||S>=t||S<0||i&&E>=y}function d(){var C=Bi();if(n(C))return g(C);u=setTimeout(d,h(C))}function g(C){return u=void 0,s&&p?e(C):(p=m=void 0,w)}function v(){u!==void 0&&clearTimeout(u),a=0,p=r=m=u=void 0}function _(){return u===void 0?w:g(Bi())}function b(){var C=Bi(),S=n(C);if(p=arguments,m=this,r=C,S){if(u===void 0)return o(r);if(i)return clearTimeout(u),u=setTimeout(d,t),e(r)}return u===void 0&&(u=setTimeout(d,t)),w}return b.cancel=v,b.flush=_,b}var H0="Expected a function";function V0(c,t,f){var p=!0,m=!0;if(typeof c!="function")throw new TypeError(H0);return ge(f)&&(p="leading"in f?!!f.leading:p,m="trailing"in f?!!f.trailing:m),z0(c,t,{leading:p,maxWait:t,trailing:m})}function d2(c,t,f){let p=c.toString(16),m=t.toString(16),y=f.toString(16);return c<16&&(p=`0${p}`),t<16&&(m=`0${m}`),f<16&&(y=`0${y}`),p+m+y}function U0(c,t,f,p){return`rgba(${c}, ${t}, ${f}, ${p})`}function N0(c,t,f){let p="";const m=c.slice();return m.sort((y,w)=>y.left-w.left),t==="linear"?p=`linear-gradient(${f}deg,`:p="radial-gradient(",m.forEach((y,w)=>{p+=`rgba(${y.red}, ${y.green}, ${y.blue}, ${y.alpha}) ${y.left}%`,w!==m.length-1&&(p+=",")}),p+=")",p}let ai;const W0=new Uint8Array(16);function X0(){if(!ai&&(ai=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ai))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ai(W0)}const Wt=[];for(let c=0;c<256;++c)Wt.push((c+256).toString(16).slice(1));function Y0(c,t=0){return Wt[c[t+0]]+Wt[c[t+1]]+Wt[c[t+2]]+Wt[c[t+3]]+"-"+Wt[c[t+4]]+Wt[c[t+5]]+"-"+Wt[c[t+6]]+Wt[c[t+7]]+"-"+Wt[c[t+8]]+Wt[c[t+9]]+"-"+Wt[c[t+10]]+Wt[c[t+11]]+Wt[c[t+12]]+Wt[c[t+13]]+Wt[c[t+14]]+Wt[c[t+15]]}const G0=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Sr={randomUUID:G0};function Tr(c,t,f){if(Sr.randomUUID&&!t&&!c)return Sr.randomUUID();c=c||{};const p=c.random||(c.rng||X0)();if(p[6]=p[6]&15|64,p[8]=p[8]&63|128,t){f=f||0;for(let m=0;m<16;++m)t[f+m]=p[m];return t}return Y0(p)}const q0={class:"picker-color-ui border-box m-8px bg-[#fff] flex flex-col slelect-none"},K0=I("p",null,"Loading...",-1),J0={key:0,class:"btns flex justify-end items-center select-none"},Z0=Ct({name:"ColorPicker"}),Q0=Ct(Td(Sd({},Z0),{props:{isGradient:{type:Boolean,default:!1},showBtn:{type:Boolean,default:!1},showCancel:{type:Boolean,default:!1},color:{type:Object,default:c=>c.isGradient?{type:"linear",degree:0,points:[{id:Tr(),left:0,red:0,green:0,blue:0,alpha:1},{id:Tr(),left:100,red:255,green:0,blue:0,alpha:1}]}:{red:255,green:0,blue:0,alpha:1}},cancelText:{type:String,default:"Cancel"},cancelColor:{type:String,default:"#333"},cancelBg:{type:String,default:"#fff"},confirmText:{type:String,default:"Confirm"},confirmColor:{type:String,defualt:"#333"},confirmBg:{type:String,defualt:"#fff"}},emits:["change"],setup(c,{expose:t,emit:f}){var p,m;const y=c,w=Hn(()=>Vn(()=>import("./index-3f84cf4d.504596c9.js"),["./index-3f84cf4d.504596c9.js","./index.vue_vue_type_script_name_Preview_setup_true_lang-22e0d43b.89eaec2f.js","./index.9ba2f0f9.js","../assets/index-d70502e3.css","./_plugin-vue_export-helper.c27b6911.js","./index.db9bc9a4.js","./___vite-browser-external_commonjs-proxy.6a231247.js"],import.meta.url)),u=Hn(()=>Vn(()=>import("./index-b1398dc9.00132bd9.js"),["./index-b1398dc9.00132bd9.js","./index.vue_vue_type_script_name_Preview_setup_true_lang-22e0d43b.89eaec2f.js","./index.9ba2f0f9.js","../assets/index-d70502e3.css","./_plugin-vue_export-helper.c27b6911.js","./index.db9bc9a4.js","./___vite-browser-external_commonjs-proxy.6a231247.js"],import.meta.url)),r=y.isGradient&&((m=(p=y.color)==null?void 0:p.points)==null?void 0:m.length)||0,a=r?r-1:0;console.log(a),console.log(y.color.points);const l=Rt({isGradient:y.isGradient,red:y.isGradient?y.color.points[a].red:y.color.red,green:y.isGradient?y.color.points[a].green:y.color.green,blue:y.isGradient?y.color.points[a].blue:y.color.blue,alpha:y.isGradient?y.color.points[a].alpha:y.color.alpha,hue:0,saturation:100,value:100,style:"",type:y.isGradient?y.color.type:"linear",degree:y.isGradient?y.color.degree:0,activePointIndex:a,points:y.isGradient?F0(y.color.points):[]}),i=V0(function({red:n,green:d,blue:g,alpha:v,hue:_,saturation:b,value:C,points:S,type:E,degree:z},V){const W={red:n,green:d,blue:g,alpha:v,hue:_,saturation:b,value:C,points:S,type:E,degree:z};y.isGradient?s(W,V):e(W,V)},y.showBtn?100:150);function s(n,d){const{red:g=0,green:v=0,blue:_=0,alpha:b=0,hue:C,saturation:S,value:E,points:z,type:V,degree:W}=n,L=l.points[l.activePointIndex];d?d==="points"||d==="type"||d==="degree"?l[d]=n[d]:L[d]=n[d]:(L.red=g,L.green=v,L.blue=_,l.alpha=b,z&&(l.points=z),V&&(l.type=V),W&&(l.degree=W),S&&(l.saturation=S),E&&(l.value=E),C&&(l.hue=C));const A=N0(l.points,l.type,l.degree);l.style=A,!y.showBtn&&f("change",{style:l.style,gradient:{type:l.type,degree:l.degree,points:l.points}})}function e(n,d){const{red:g=0,green:v=0,blue:_=0,alpha:b,hue:C,saturation:S,value:E}=n;d?l[d]=n[d]:(l.red=g,l.green=v,l.blue=_,b&&(l.alpha=b),S&&(l.saturation=S),E&&(l.value=E),C&&(l.hue=C));const z=U0(l.red,l.green,l.blue,l.alpha);l.style=z,!y.showBtn&&f("change",{style:z,color:{red:l.red,green:l.green,blue:l.blue,hue:l.hue,alpha:l.alpha}})}const o=n=>{n&&typeof n=="function"&&n()},h=n=>{const{isGradient:d,style:g,type:v,degree:_,points:b,red:C,green:S,blue:E,alpha:z,hue:V}=l;d?f("change",{style:g,gradient:{type:v,degree:_,points:b}}):f("change",{style:g,color:{red:C,green:S,blue:E,hue:V,alpha:z}}),n&&typeof n=="function"&&n()};return Ve("colorPickerState",l),Ve("updateColor",i),t({onClose:o,onConfirm:h}),(n,d)=>(Z(),at("div",q0,[(Z(),wt(Jo,null,{default:$(()=>[y.isGradient?(Z(),wt(D(w),{key:0})):(Z(),wt(D(u),{key:1}))]),fallback:$(()=>[K0]),_:1})),c.showBtn?(Z(),at("div",J0,[c.showCancel?(Z(),at("div",{key:0,class:"btn",style:Xe({color:y.cancelColor,backgroundColor:y.cancelBg}),onClick:o},ct(y.cancelText),5)):bt("",!0),I("div",{class:"btn",style:Xe({color:y.confirmColor,backgroundColor:y.confirmBg}),onClick:h},ct(y.confirmText),5)])):bt("",!0)]))}}));const Is=c=>(ae("data-v-f65ab089"),c=c(),le(),c),tv={class:"box"},ev=Is(()=>I("span",null,"渐变",-1)),iv=Is(()=>I("span",null,"纯色",-1)),nv={key:0},rv=Ct({name:"ColorSelector"}),sv=Object.assign(rv,{props:{angleKey:{type:String,default:"gradientAngle"},color:{type:[Object,String],default:""}},emits:["change"],setup(c,{emit:t}){const{canvasEditor:f}=Pt(),p=(d,g,v,_,b)=>{const C=W=>{const L=-parseInt(W,10)*(Math.PI/180);return{x1:Math.round(50+Math.sin(L)*50)/100,y1:Math.round(50+Math.cos(L)*50)/100,x2:Math.round(50+Math.sin(L+Math.PI)*50)/100,y2:Math.round(50+Math.cos(L+Math.PI)*50)/100}},S=W=>{const L=C(b);return new K.fabric.Gradient({type:"linear",coords:{x1:L.x1*g,y1:L.y1*v,x2:L.x2*g,y2:L.y2*v},colorStops:W})},E=W=>new K.fabric.Gradient({type:"radial",coords:{x1:g/2,y1:v/2,r1:0,x2:g/2,y2:v/2,r2:g/2},colorStops:W});let z={};const V=[...d];return _==="linear"?z=S(V):_==="radial"&&(z=E(V)),z},m=c,y=t,w=vt(!1),u=vt(""),r=vt("background: linear-gradient(124deg, rgb(28, 27, 27) 0%, rgb(255, 0, 0) 100%);"),a=Rt({type:"linear",degree:0,points:[{left:0,red:0,green:0,blue:0,alpha:1},{left:100,red:255,green:0,blue:0,alpha:1}]}),l=d=>{if(typeof d=="string")w.value=!1,u.value=d;else{w.value=!0;const g=f.canvas.getActiveObjects()[0];g&&(o(d,g),e(d))}},i=ti(function(d){const g=f.canvas.getActiveObjects()[0],{gradient:v}=d;if(g){const _=h(v,g);y("change",_),g.set(m.angleKey,v.degree),s(d)}},500),s=d=>{d.gradient.type==="linear"?r.value=`background: ${d.style};`:r.value=`background: ${d.style.replace("radial","linear")};`},e=d=>{d.colorStops.sort((v,_)=>v.offset-_.offset);const g=d.colorStops.map(v=>`${v.color} ${v.offset*100}%`);r.value=`background: linear-gradient(124deg, ${g});`},o=(d,g)=>{d&&(a.type=d.type,a.degree=g.get(m.angleKey,d.degree),a.points=d.colorStops.map(v=>{const[_,b,C,S]=v.color.replace(/^rgba?\(|\s+|\)$/g,"").split(",");return{left:v.offset*100,red:Number(_),green:Number(b),blue:Number(C),alpha:Number(S)}}))},h=(d,g)=>{const v=d.points.map(_=>({offset:_.left/100,color:`rgba(${_.red}, ${_.green}, ${_.blue}, ${_.alpha})`}));return p(v,g.width,g.height,d.type,d.degree)},n=d=>{y("change",d)};return de(()=>m.color,d=>{l(d)}),Jt(()=>{l(m.color)}),(d,g)=>{const v=it("iSwitch"),_=it("ColorPicker");return Z(),at("div",tv,[M(v,{modelValue:D(w),"onUpdate:modelValue":g[0]||(g[0]=b=>Pe(w)?w.value=b:null),size:"large",class:"switch"},{open:$(()=>[ev]),close:$(()=>[iv]),_:1},8,["modelValue"]),D(w)?(Z(),at("div",nv,[I("div",{class:"gradient-bar",style:Xe(D(r))},null,4),M(D(Q0),{"is-gradient":!0,gradient:D(a),onChange:D(i),"cancel-text":d.$t("cancel"),"confirm-text":d.$t("ok")},null,8,["gradient","onChange","cancel-text","confirm-text"])])):bt("",!0),Ut(M(_,{modelValue:D(u),"onUpdate:modelValue":g[1]||(g[1]=b=>Pe(u)?u.value=b:null),onOnChange:n,alpha:""},null,8,["modelValue"]),[[Qt,!D(w)]])])}}}),ov=Bt(sv,[["__scopeId","data-v-f65ab089"]]);function An(c,t){return t===void 0&&(t=15),+parseFloat(Number(c).toPrecision(t))}function se(c){var t=c.toString().split(/[eE]/),f=(t[0].split(".")[1]||"").length-+(t[1]||0);return f>0?f:0}function qe(c){if(c.toString().indexOf("e")===-1)return Number(c.toString().replace(".",""));var t=se(c);return t>0?An(Number(c)*Math.pow(10,t)):Number(c)}function Zi(c){Bs&&(c>Number.MAX_SAFE_INTEGER||c<Number.MIN_SAFE_INTEGER)&&console.warn(c+" is beyond boundary when transfer to integer, the results may not be accurate")}function Ei(c){return function(){for(var t=[],f=0;f<arguments.length;f++)t[f]=arguments[f];var p=t[0],m=t.slice(1);return m.reduce(function(y,w){return c(y,w)},p)}}var ye=Ei(function(c,t){var f=qe(c),p=qe(t),m=se(c)+se(t),y=f*p;return Zi(y),y/Math.pow(10,m)}),av=Ei(function(c,t){var f=Math.pow(10,Math.max(se(c),se(t)));return(ye(c,f)+ye(t,f))/f}),lv=Ei(function(c,t){var f=Math.pow(10,Math.max(se(c),se(t)));return(ye(c,f)-ye(t,f))/f}),$s=Ei(function(c,t){var f=qe(c),p=qe(t);return Zi(f),Zi(p),ye(f/p,An(Math.pow(10,se(t)-se(c))))});function cv(c,t){var f=Math.pow(10,t),p=$s(Math.round(Math.abs(ye(c,f))),f);return c<0&&p!==0&&(p=ye(p,-1)),p}var Bs=!0;function hv(c){c===void 0&&(c=!0),Bs=c}var li={strip:An,plus:av,minus:lv,times:ye,divide:$s,round:cv,digitLength:se,float2Fixed:qe,enableBoundaryChecking:hv};const Rs=c=>(ae("data-v-4c516747"),c=c(),le(),c),uv=Rs(()=>I("i",{class:"ivu-icon ivu-icon-ios-remove"},null,-1)),fv=[uv],dv=Rs(()=>I("i",{class:"ivu-icon ivu-icon-ios-add"},null,-1)),gv=[dv],pv=["aria-valuemax","aria-valuemin","aria-valuenow","value","disabled","autofocus","readonly","placeholder"],Gt="ivu-input-number",ci="ivu-icon",vv=150,mv=Ct({__name:"inputNumber",props:{autofocus:{type:Boolean},parser:{},formatter:{},min:{default:-1/0},max:{default:1/0},precision:{default:2},step:{default:1},modelValue:{},defaultValue:{},modelEvent:{default:"change"},controlsOutside:{type:Boolean},hideButton:{type:Boolean},downDisabled:{type:Boolean},upDisabled:{type:Boolean},size:{default:"default"},disabled:{type:Boolean},readonly:{type:Boolean},placeholder:{},append:{},prepend:{}},emits:["update:modelValue","on-change","on-focus","on-blur","on-input"],setup(c,{expose:t,emit:f}){var U;li.enableBoundaryChecking(!1);const p=c,m=f,y=vt(`${Gt}-input-wrap`),w=vt(`${Gt}-input`),u=vt(`${Gt}-handler-wrap`),r=vt(`${Gt}-handler-up-inner ${ci} ${ci}-ios-arrow-up`),a=vt(`${Gt}-handler-down-inner ${ci} ${ci}-ios-arrow-down`),l=vt([`${Gt}-handler`,`${Gt}-handler-up`,{[`${Gt}-handler-up-disabled`]:p.upDisabled}]),i=vt([`${Gt}-handler`,`${Gt}-handler-down`,{[`${Gt}-handler-down-disabled`]:p.downDisabled}]),s=vt(!1),e=Ht(()=>[`${Gt}`,{[`${Gt}-${p.size}`]:!!p.size,[`${Gt}-disabled`]:p.disabled,[`${Gt}-focused`]:s.value,[`${Gt}-controls-outside`]:p.controlsOutside}]),o=vt(),h=Ht(()=>{if(Yt(p.precision)){const T=`${p.step}`.split(".")[1],x=T&&T.length||0;return Math.max(x,p.precision)}}),n=T=>{var k,R;if(!Yt(T))return"";const x=h.value?T.toFixed(h.value).replace(/\.?0+$/,""):String(T);return(R=(k=p.formatter)==null?void 0:k.call(p,x))!=null?R:x},d=vt(n((U=p.modelValue)!=null?U:p.defaultValue)),g=T=>{s.value=!0,m("on-focus",T)},v=T=>{s.value=!1,m("on-blur",T)},_=T=>{W(T,"minus",!0)},b=T=>{W(T,"plus",!0)},C=T=>{T.key==="ArrowUp"?(T.preventDefault(),!p.readonly&&S("plus",T)):T.key==="ArrowDown"&&(T.preventDefault(),!p.readonly&&S("minus",T))},S=(T,x)=>{if(T==="plus"&&(X.value||p.upDisabled)||T==="minus"&&(A.value||p.downDisabled))return;let k;Yt(L.value)?k=ht(li[T](L.value,p.step)):k=p.min===-1/0?0:p.min,d.value=n(k),B(k),m("update:modelValue",k),m("on-change",k,x)};let E=0;const z=()=>{E&&(window.clearTimeout(E),E=0)},V={onMouseup:z,onMouseleave:z},W=(T,x,k=!1)=>{var R;T.preventDefault(),(R=o.value)==null||R.focus(),S(x,T),k&&(E=window.setTimeout(()=>T.target.dispatchEvent(T),vv))},L=Ht(()=>{var x,k;if(!d.value)return;const T=Number((k=(x=p.parser)==null?void 0:x.call(p,d.value))!=null?k:d.value);return Number.isNaN(T)?void 0:T}),A=vt(Yt(L.value)&&L.value<=p.min),X=vt(Yt(L.value)&&L.value>=p.max),B=T=>{let x=!1,k=!1;Yt(T)&&(T<=p.min&&(x=!0),T>=p.max&&(k=!0)),X.value!==k&&(X.value=k),A.value!==x&&(A.value=x)},st=T=>{var k,R,q,N;let{value:x}=T.target;x=x.trim().replace(/。/g,"."),x=(R=(k=p.parser)==null?void 0:k.call(p,x))!=null?R:x,(Yt(Number(x))||/^(\.|-)$/.test(x))&&(d.value=(N=(q=p.formatter)==null?void 0:q.call(p,x))!=null?N:x,B(L.value),p.modelEvent==="input"&&m("update:modelValue",L.value),m("on-input",L.value,d.value,T))},ht=T=>{if(!Tl(T))return Yt(p.min)&&T<p.min&&(T=p.min),Yt(p.max)&&T>p.max&&(T=p.max),Yt(h.value)?li.round(T,h.value):T},ft=T=>{const x=ht(L.value),k=n(x);(x!==L.value||d.value!==k)&&(d.value=k,B(x)),mn(()=>{Yt(p.modelValue)&&p.modelValue!==x&&(d.value=n(p.modelValue),B(p.modelValue))}),m("update:modelValue",x),m("on-change",x,T)},O=()=>{const T=ht(L.value),x=n(T);(T!==L.value||d.value!==x)&&(d.value=x),m("update:modelValue",T)},F=vt(),j=vt(),P=T=>{const x=vt(),{posStart:k,posEnd:R}=vc(T,{threshold:0,onSwipeStart:()=>{x.value=L.value},onSwipe:q=>{if(!Yt(x.value))return;const N=x.value+li.round(R.x-k.x,0)*p.step;d.value=n(N),p.modelEvent==="input"?st(q):ft(q)}})};return Jt(()=>{F.value&&P(F),j.value&&P(j)}),de(()=>p.modelValue,T=>{T!==L.value&&(d.value=n(T),B(T))}),de(()=>p.min,T=>{const x=Yt(L.value)&&L.value<=T;A.value!==x&&(A.value=x),Yt(L.value)&&L.value<T&&O()}),de(()=>p.max,T=>{const x=Yt(L.value)&&L.value>=T;X.value!==x&&(X.value=x),Yt(L.value)&&L.value>T&&O()}),t({minus:_,plus:b,input:o.value,focus:()=>{var T;(T=o.value)==null||T.focus()},blur:()=>{var T;(T=o.value)==null||T.blur()}}),(T,x)=>(Z(),at("div",{class:qt(D(e))},[T.controlsOutside?(Z(),at(kt,{key:0},[I("div",si({class:["ivu-input-number-controls-outside-btn ivu-input-number-controls-outside-down",{"ivu-input-number-controls-outside-btn-disabled":T.downDisabled}],onMousedown:_},V),fv,16),I("div",si({class:["ivu-input-number-controls-outside-btn ivu-input-number-controls-outside-up",{"ivu-input-number-controls-outside-btn-disabled":T.upDisabled}],onMousedown:b},V),gv,16)],64)):T.hideButton?bt("",!0):(Z(),at("div",{key:1,class:qt(D(u))},[I("a",si({class:D(l),onMousedown:b},V),[I("span",{class:qt(D(r))},null,2)],16),I("a",si({class:D(i),onMousedown:_},V),[I("span",{class:qt(D(a))},null,2)],16)],2)),I("div",{class:qt(D(y))},[T.$slots.prefix?Un(T.$slots,"prefix",{key:0},void 0,!0):T.append?(Z(),at("label",{key:1,ref_key:"appendLabelRef",ref:F,class:qt(`${D(y)}__label`)},ct(T.append),3)):bt("",!0),I("input",{ref_key:"inputRef",ref:o,type:"text",autocomplete:"off",spellcheck:"false",role:"spinbutton","aria-valuemax":T.max,"aria-valuemin":T.min,"aria-valuenow":D(d),value:D(d),class:qt(D(w)),disabled:T.disabled,autofocus:T.autofocus,readonly:T.readonly,placeholder:T.placeholder,onFocus:g,onBlur:v,onInput:st,onChange:ft,onKeydown:C},null,42,pv),T.$slots.suffix?Un(T.$slots,"suffix",{key:2},void 0,!0):T.prepend?(Z(),at("label",{key:3,ref_key:"prependLabelRef",ref:j,class:qt(`${D(y)}__label`)},ct(T.prepend),3)):bt("",!0)],2)],2))}});const ne=Bt(mv,[["__scopeId","data-v-4c516747"]]);const _v={key:0,class:"box"},yv={class:"flex-view"},bv={class:"flex-item"},wv={class:"left font-selector"},Cv={key:0,class:"font-item"},xv={style:{display:"none"}},Sv={class:"right"},Tv={class:"flex-view"},Ov={class:"flex-item"},kv=["innerHTML"],Av={class:"flex-view"},Ev={class:"flex-item"},Mv={viewBox:"0 0 1024 1024",width:"14",height:"14"},Pv=["fill"],Dv={viewBox:"0 0 1024 1024",width:"14",height:"14"},jv=["fill"],Lv={viewBox:"0 0 1024 1024",width:"14",height:"14"},Fv=["fill"],Iv={viewBox:"0 0 1024 1024",width:"14",height:"14"},$v=["fill"],Bv={class:"flex-view"},Rv={class:"flex-item"},zv={class:"label"},Hv={class:"content"},Vv={class:"flex-view"},Uv={class:"flex-item"},Nv={class:"label"},Wv={class:"content slider-box"},Xv={class:"flex-view"},Yv={class:"flex-item"},Gv={class:"label"},qv={class:"content slider-box"},Kv={class:"ivu-col__box"},Jv={class:"label"},Zv={class:"content"},Qv={class:"ivu-col__box"},tm={class:"label"},em={class:"content"},im={class:"ivu-col__box"},nm={class:"label"},rm={class:"content"},sm={class:"flex-view"},om={class:"flex-item"},am={class:"label"},lm={class:"content slider-box"},cm=Ct({name:"AttrBute"}),hm=Object.assign(cm,{setup(c){const t=_e("event"),f=Qe(),p="https://nihaojob.github.io/vue-fabric-editor-static/",{fabric:m,mixinState:y,canvasEditor:w}=Pt(),u=["text","i-text","textbox","rect","circle","triangle","polygon","image","group","line","arrow"],r=["i-text","textbox","text"],a=Rt({id:"",opacity:0,angle:0,fill:"#fff",left:0,top:0,strokeWidth:0,strokeDashArray:[],stroke:"#fff",shadow:{color:"#fff",blur:0,offsetX:0,offsetY:0},points:{}}),l=Rt({fontSize:0,fontFamily:"",lineHeight:0,charSpacing:0,fontWeight:"",textBackgroundColor:"#fff",textAlign:"",fontStyle:"",underline:!1,linethrough:!1,overline:!1}),i=vt([..._d]),s=[{value:{strokeUniform:!0,strokeDashArray:[],strokeLineCap:"butt"},label:"Stroke"},{value:{strokeUniform:!0,strokeDashArray:[1,10],strokeLineCap:"butt"},label:"Dash-1"},{value:{strokeUniform:!0,strokeDashArray:[1,10],strokeLineCap:"round"},label:"Dash-2"},{value:{strokeUniform:!0,strokeDashArray:[15,15],strokeLineCap:"square"},label:"Dash-3"},{value:{strokeUniform:!0,strokeDashArray:[15,15],strokeLineCap:"round"},label:"Dash-4"},{value:{strokeUniform:!0,strokeDashArray:[25,25],strokeLineCap:"square"},label:"Dash-5"},{value:{strokeUniform:!0,strokeDashArray:[25,25],strokeLineCap:"round"},label:"Dash-6"},{value:{strokeUniform:!0,strokeDashArray:[1,8,16,8,1,20],strokeLineCap:"square"},label:"Dash-7"},{value:{strokeUniform:!0,strokeDashArray:[1,8,16,8,1,20],strokeLineCap:"round"},label:"Dash-8"}],e=["left","center","right"],o=['<svg t="1650441458823" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3554" width="18" height="18"><path d="M198.4 198.4h341.333333c8.533333 0 14.933333 2.133333 19.2 8.533333 6.4 6.4 8.533333 12.8 8.533334 19.2v57.6c0 8.533333-2.133333 14.933333-8.533334 19.2-6.4 6.4-12.8 8.533333-19.2 8.533334h-341.333333c-8.533333 0-14.933333-2.133333-19.2-8.533334-6.4-6.4-8.533333-12.8-8.533333-19.2v-57.6c0-8.533333 2.133333-14.933333 8.533333-19.2 4.266667-4.266667 12.8-8.533333 19.2-8.533333z m0 170.666667h569.6c8.533333 0 14.933333 2.133333 19.2 8.533333 6.4 6.4 8.533333 12.8 8.533333 19.2v57.6c0 8.533333-2.133333 14.933333-8.533333 19.2-6.4 6.4-12.8 8.533333-19.2 8.533333h-569.6c-8.533333 0-14.933333-2.133333-19.2-8.533333-6.4-6.4-8.533333-12.8-8.533333-19.2v-57.6c0-8.533333 2.133333-14.933333 8.533333-19.2 4.266667-4.266667 12.8-8.533333 19.2-8.533333z m0 170.666666h454.4c8.533333 0 14.933333 2.133333 19.2 8.533334 6.4 6.4 8.533333 12.8 8.533333 19.2v57.6c0 8.533333-2.133333 14.933333-8.533333 19.2-6.4 6.4-12.8 8.533333-19.2 8.533333h-454.4c-8.533333 0-14.933333-2.133333-19.2-8.533333-6.4-6.4-8.533333-12.8-8.533333-19.2v-57.6c0-8.533333 2.133333-14.933333 8.533333-19.2 4.266667-4.266667 12.8-8.533333 19.2-8.533334z m0 170.666667h625.066667c8.533333 0 14.933333 2.133333 19.2 8.533333 6.4 6.4 8.533333 12.8 8.533333 19.2v57.6c0 8.533333-2.133333 14.933333-8.533333 19.2-6.4 6.4-12.8 8.533333-19.2 8.533334h-625.066667c-8.533333 0-14.933333-2.133333-19.2-8.533334-6.4-6.4-8.533333-12.8-8.533333-19.2v-57.6c0-8.533333 2.133333-14.933333 8.533333-19.2 4.266667-4.266667 12.8-8.533333 19.2-8.533333z" p-id="3555"></path></svg>','<svg t="1650441512015" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3704" width="18" height="18"><path d="M313.6 198.4h398.933333c8.533333 0 14.933333 2.133333 19.2 8.533333 6.4 6.4 8.533333 12.8 8.533334 19.2v57.6c0 8.533333-2.133333 14.933333-8.533334 19.2-6.4 6.4-12.8 8.533333-19.2 8.533334h-398.933333c-8.533333 0-14.933333-2.133333-19.2-8.533334-6.4-6.4-8.533333-12.8-8.533333-19.2v-57.6c0-8.533333 2.133333-14.933333 8.533333-19.2 4.266667-4.266667 10.666667-8.533333 19.2-8.533333z m-115.2 170.666667h625.066667c8.533333 0 14.933333 2.133333 19.2 8.533333 6.4 6.4 8.533333 12.8 8.533333 19.2v57.6c0 8.533333-2.133333 14.933333-8.533333 19.2-6.4 6.4-12.8 8.533333-19.2 8.533333h-625.066667c-8.533333 0-14.933333-2.133333-19.2-8.533333-6.4-6.4-8.533333-12.8-8.533333-19.2v-57.6c0-8.533333 2.133333-14.933333 8.533333-19.2 4.266667-4.266667 12.8-8.533333 19.2-8.533333z m115.2 170.666666h398.933333c8.533333 0 14.933333 2.133333 19.2 8.533334 6.4 6.4 8.533333 12.8 8.533334 19.2v57.6c0 8.533333-2.133333 14.933333-8.533334 19.2-6.4 6.4-12.8 8.533333-19.2 8.533333h-398.933333c-8.533333 0-14.933333-2.133333-19.2-8.533333-6.4-6.4-8.533333-12.8-8.533333-19.2v-57.6c0-8.533333 2.133333-14.933333 8.533333-19.2 4.266667-4.266667 10.666667-8.533333 19.2-8.533334z m-115.2 170.666667h625.066667c8.533333 0 14.933333 2.133333 19.2 8.533333 6.4 6.4 8.533333 12.8 8.533333 19.2v57.6c0 8.533333-2.133333 14.933333-8.533333 19.2-6.4 6.4-12.8 8.533333-19.2 8.533334h-625.066667c-8.533333 0-14.933333-2.133333-19.2-8.533334-6.4-6.4-8.533333-12.8-8.533333-19.2v-57.6c0-8.533333 2.133333-14.933333 8.533333-19.2 4.266667-4.266667 12.8-8.533333 19.2-8.533333z" p-id="3705"></path></svg>','<svg t="1650441519862" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="18" height="18"><path d="M454.4 283.733333v-57.6c0-8.533333 2.133333-14.933333 8.533333-19.2 6.4-6.4 12.8-8.533333 19.2-8.533333h341.333334c8.533333 0 14.933333 2.133333 19.2 8.533333 6.4 6.4 8.533333 12.8 8.533333 19.2v57.6c0 8.533333-2.133333 14.933333-8.533333 19.2-6.4 6.4-12.8 8.533333-19.2 8.533334h-341.333334c-8.533333 0-14.933333-2.133333-19.2-8.533334-4.266667-4.266667-8.533333-10.666667-8.533333-19.2z m-226.133333 170.666667v-57.6c0-8.533333 2.133333-14.933333 8.533333-19.2 6.4-6.4 12.8-8.533333 19.2-8.533333h569.6c8.533333 0 14.933333 2.133333 19.2 8.533333 6.4 6.4 8.533333 12.8 8.533333 19.2v57.6c0 8.533333-2.133333 14.933333-8.533333 19.2-6.4 6.4-12.8 8.533333-19.2 8.533333H256c-8.533333 0-14.933333-2.133333-19.2-8.533333-6.4-4.266667-8.533333-10.666667-8.533333-19.2z m113.066666 170.666667v-57.6c0-8.533333 2.133333-14.933333 8.533334-19.2 6.4-6.4 12.8-8.533333 19.2-8.533334h454.4c8.533333 0 14.933333 2.133333 19.2 8.533334 6.4 6.4 8.533333 12.8 8.533333 19.2v57.6c0 8.533333-2.133333 14.933333-8.533333 19.2-6.4 6.4-12.8 8.533333-19.2 8.533333h-454.4c-8.533333 0-14.933333-2.133333-19.2-8.533333-6.4-4.266667-8.533333-10.666667-8.533334-19.2z m-170.666666 170.666666v-57.6c0-8.533333 2.133333-14.933333 8.533333-19.2 6.4-6.4 12.8-8.533333 19.2-8.533333h625.066667c8.533333 0 14.933333 2.133333 19.2 8.533333 6.4 6.4 8.533333 12.8 8.533333 19.2v57.6c0 8.533333-2.133333 14.933333-8.533333 19.2-6.4 6.4-12.8 8.533333-19.2 8.533334h-625.066667c-8.533333 0-14.933333-2.133333-19.2-8.533334-6.4-4.266667-8.533333-10.666667-8.533333-19.2z" p-id="3855"></path></svg>'],h=()=>{Ti.get(`${p}/font/free-font.json`).then(L=>{i.value=[...i.value,...Object.entries(L.data).map(([,A])=>A)]})},n=L=>{const A=w.canvas.getActiveObject();L&&L.target&&L.target!==A||A&&(a.id=A.get("id"),a.opacity=A.get("opacity")*100,a.fill=A.get("fill"),a.left=A.get("left"),a.top=A.get("top"),a.stroke=A.get("stroke"),a.strokeWidth=A.get("strokeWidth"),a.shadow=A.get("shadow")||{},a.angle=A.get("angle")||0,a.points=A.get("points")||{},["i-text","text","textbox"].includes(A.type)&&(l.fontSize=A.get("fontSize"),l.fontFamily=A.get("fontFamily"),l.lineHeight=A.get("lineHeight"),l.textAlign=A.get("textAlign"),l.underline=A.get("underline"),l.linethrough=A.get("linethrough"),l.charSpacing=A.get("charSpacing"),l.overline=A.get("overline"),l.fontStyle=A.get("fontStyle"),l.textBackgroundColor=A.get("textBackgroundColor"),l.fontWeight=A.get("fontWeight")))},d=()=>{var L;a.fill="",(L=f==null?void 0:f.proxy)==null||L.$forceUpdate()},g=()=>{h(),t.on("selectCancel",d),t.on("selectOne",n),w.canvas.on("object:modified",n)},v=L=>{if(!L)return;if(["arial","Microsoft YaHei"].includes(L)){const B=w.canvas.getActiveObjects()[0];B&&B.set("fontFamily",L),w.canvas.renderAll();return}Ft.Spin.show(),new es(L).load(null,15e4).then(()=>{const B=w.canvas.getActiveObjects()[0];B&&B.set("fontFamily",L),w.canvas.renderAll(),Ft.Spin.hide()}).catch(()=>{Ft.Spin.hide()})},_=(L,A)=>{const X=w.canvas.getActiveObjects()[0];if(L==="opacity"){X&&X.set(L,A/100),w.canvas.renderAll();return}if(L==="angle"){X.rotate(A),w.canvas.renderAll();return}X&&X.set(L,A),w.canvas.renderAll(),n()},b=L=>{const A=w.canvas.getActiveObjects()[0];if(A){const X=s.find(B=>B.label===L);A.set(X.value),w.canvas.renderAll()}},C=()=>{const L=w.canvas.getActiveObjects()[0];L&&L.set("shadow",new m.Shadow(a.shadow)),w.canvas.renderAll()},S=(L,A)=>{const X=A==="normal"?"bold":"normal";l.fontWeight=X;const B=w.canvas.getActiveObjects()[0];B&&B.set(L,X),w.canvas.renderAll()},E=(L,A)=>{const X=A==="normal"?"italic":"normal";l.fontStyle=X;const B=w.canvas.getActiveObjects()[0];B&&B.set(L,X),w.canvas.renderAll()},z=(L,A)=>{const X=A===!1;l.linethrough=X;const B=w.canvas.getActiveObjects()[0];B&&B.set(L,X),w.canvas.renderAll()},V=(L,A)=>{const X=A===!1;l.underline=X;const B=w.canvas.getActiveObjects()[0];B&&B.set(L,X),w.canvas.renderAll()},W=L=>{const A=w.canvas.getActiveObjects();!A||!A.length||(A[0].set("points",us(L,Math.min(A[0].width,A[0].height)/2)),w.canvas.requestRenderAll())};return Jt(g),ei(()=>{t.off("selectCancel",d),t.off("selectOne",n),w.canvas.off("object:modified",n)}),(L,A)=>{const X=it("Divider"),B=it("Option"),st=it("Select"),ht=it("Radio"),ft=it("RadioGroup"),O=it("Button"),F=it("ButtonGroup"),j=it("Col"),P=it("Row"),U=it("ColorPicker"),T=it("Slider"),x=it("Input");return D(y).mSelectMode==="one"?(Z(),at("div",_v,[Ut(I("div",null,[M(X,{plain:"",orientation:"left"},{default:$(()=>[dt(ct(L.$t("attributes.font")),1)]),_:1}),I("div",yv,[I("div",bv,[I("div",wv,[M(st,{modelValue:D(l).fontFamily,"onUpdate:modelValue":A[0]||(A[0]=k=>D(l).fontFamily=k),onOnChange:v},{default:$(()=>[(Z(!0),at(kt,null,It(D(i),k=>(Z(),wt(B,{value:k.name,key:`font-${k.name}`},{default:$(()=>[k.preview?(Z(),at("div",{key:1,class:"font-item",style:Xe(`background-image:url('${k.preview}');`)},[dt(ct(k.preview?"":k)+" ",1),I("span",xv,ct(k.name),1)],4)):(Z(),at("div",Cv,ct(k.name),1))]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),I("div",Sv,[M(D(ne),{modelValue:D(l).fontSize,"onUpdate:modelValue":A[1]||(A[1]=k=>D(l).fontSize=k),onOnChange:A[2]||(A[2]=k=>_("fontSize",k)),append:"字号",min:1},null,8,["modelValue"])])])]),I("div",Tv,[I("div",Ov,[M(ft,{class:"button-group",modelValue:D(l).textAlign,"onUpdate:modelValue":A[3]||(A[3]=k=>D(l).textAlign=k),onOnChange:A[4]||(A[4]=k=>_("textAlign",k)),type:"button"},{default:$(()=>[(Z(),at(kt,null,It(e,(k,R)=>M(ht,{label:k,key:k},{default:$(()=>[I("span",{innerHTML:o[R]},null,8,kv)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])])]),I("div",Av,[I("div",Ev,[M(F,{class:"button-group"},{default:$(()=>[M(O,{onClick:A[5]||(A[5]=k=>S("fontWeight",D(l).fontWeight))},{default:$(()=>[(Z(),at("svg",Mv,[I("path",{d:"M793.99865 476a244 244 0 0 0 54-130.42C862.75865 192.98 743.01865 64 593.85865 64H195.01865a32 32 0 0 0-32 32v96a32 32 0 0 0 32 32h63.74v576H195.01865a32 32 0 0 0-32 32v96a32 32 0 0 0 32 32h418.64c141.6 0 268.28-103.5 282-244.8 9.48-96.9-32.78-184.12-101.66-239.2zM418.33865 224h175.52a96 96 0 0 1 0 192h-175.52z m175.52 576h-175.52V576h175.52a112 112 0 0 1 0 224z",fill:D(l).fontWeight==="bold"?"#305ef4":"#666"},null,8,Pv)]))]),_:1}),M(O,{onClick:A[6]||(A[6]=k=>E("fontStyle",D(l).fontStyle))},{default:$(()=>[(Z(),at("svg",Dv,[I("path",{d:"M832 96v64a32 32 0 0 1-32 32h-125.52l-160 640H608a32 32 0 0 1 32 32v64a32 32 0 0 1-32 32H224a32 32 0 0 1-32-32v-64a32 32 0 0 1 32-32h125.52l160-640H416a32 32 0 0 1-32-32V96a32 32 0 0 1 32-32h384a32 32 0 0 1 32 32z",fill:D(l).fontStyle==="italic"?"#305ef4":"#666"},null,8,jv)]))]),_:1}),M(O,{onClick:A[7]||(A[7]=k=>z("linethrough",D(l).linethrough))},{default:$(()=>[(Z(),at("svg",Lv,[I("path",{d:"M893.088 501.792H125.344a32 32 0 0 0 0 64h767.744a32 32 0 0 0 0-64zM448 448h112V208h288V96H160v112h288zM448 640h112v288H448z",fill:D(l).linethrough?"#305ef4":"#666"},null,8,Fv)]))]),_:1}),M(O,{onClick:A[8]||(A[8]=k=>V("underline",D(l).underline))},{default:$(()=>[(Z(),at("svg",Iv,[I("path",{d:"M703.232 67.008h127.488v413.248c0 158.016-142.656 286.016-318.72 286.016-176 0-318.72-128-318.72-286.016V67.008h127.488v413.248c0 39.872 18.176 78.144 51.136 107.776 36.8 32.96 86.528 51.072 140.096 51.072s103.36-18.112 140.032-51.136c33.024-29.632 51.2-67.968 51.2-107.776V67.008zM193.28 871.616h637.44v85.376H193.28v-85.376z",fill:D(l).underline?"#305ef4":"#666"},null,8,$v)]))]),_:1})]),_:1})])]),M(P,{gutter:12},{default:$(()=>[M(j,{flex:"1"},{default:$(()=>[M(D(ne),{modelValue:D(l).lineHeight,"onUpdate:modelValue":A[9]||(A[9]=k=>D(l).lineHeight=k),onOnChange:A[10]||(A[10]=k=>_("lineHeight",k)),step:.1,append:L.$t("attributes.line_height")},null,8,["modelValue","append"])]),_:1}),M(j,{flex:"1"},{default:$(()=>[M(D(ne),{modelValue:D(l).charSpacing,"onUpdate:modelValue":A[11]||(A[11]=k=>D(l).charSpacing=k),onOnChange:A[12]||(A[12]=k=>_("charSpacing",k)),append:L.$t("attributes.char_spacing")},null,8,["modelValue","append"])]),_:1})]),_:1}),I("div",Bv,[I("div",Rv,[I("span",zv,ct(L.$t("background")),1),I("div",Hv,[M(U,{modelValue:D(l).textBackgroundColor,"onUpdate:modelValue":A[13]||(A[13]=k=>D(l).textBackgroundColor=k),onOnChange:A[14]||(A[14]=k=>_("textBackgroundColor",k)),alpha:""},null,8,["modelValue"])])])])],512),[[Qt,r.includes(D(y).mSelectOneType)]]),Ut(I("div",null,[M(X,{plain:"",orientation:"left"},{default:$(()=>[dt(ct(L.$t("attributes.exterior")),1)]),_:1}),D(y).mSelectOneType==="polygon"?(Z(),wt(P,{key:0,gutter:12},{default:$(()=>[M(j,{flex:"0.5"},{default:$(()=>[M(D(ne),{modelValue:D(a).points.length,"onUpdate:modelValue":A[15]||(A[15]=k=>D(a).points.length=k),min:3,max:30,onOnChange:W,append:"边数"},null,8,["modelValue"])]),_:1})]),_:1})):bt("",!0),M(ov,{color:D(a).fill,onChange:A[16]||(A[16]=k=>_("fill",k))},null,8,["color"]),M(P,{gutter:12},{default:$(()=>[M(j,{flex:"1"},{default:$(()=>[M(D(ne),{modelValue:D(a).left,"onUpdate:modelValue":A[17]||(A[17]=k=>D(a).left=k),onOnChange:A[18]||(A[18]=k=>_("left",k)),append:L.$t("attributes.left")},null,8,["modelValue","append"])]),_:1}),M(j,{flex:"1"},{default:$(()=>[M(D(ne),{modelValue:D(a).top,"onUpdate:modelValue":A[19]||(A[19]=k=>D(a).top=k),onOnChange:A[20]||(A[20]=k=>_("top",k)),append:L.$t("attributes.top")},null,8,["modelValue","append"])]),_:1})]),_:1}),I("div",Vv,[I("div",Uv,[I("span",Nv,ct(L.$t("attributes.angle")),1),I("div",Wv,[M(T,{modelValue:D(a).angle,"onUpdate:modelValue":A[21]||(A[21]=k=>D(a).angle=k),max:360,onOnInput:A[22]||(A[22]=k=>_("angle",k))},null,8,["modelValue"])])])]),I("div",Xv,[I("div",Yv,[I("span",Gv,ct(L.$t("attributes.opacity")),1),I("div",qv,[M(T,{modelValue:D(a).opacity,"onUpdate:modelValue":A[23]||(A[23]=k=>D(a).opacity=k),onOnInput:A[24]||(A[24]=k=>_("opacity",k))},null,8,["modelValue"])])])]),M(X,{plain:"",orientation:"left"},{default:$(()=>[dt(ct(L.$t("attributes.stroke")),1)]),_:1}),M(P,{gutter:12},{default:$(()=>[M(j,{flex:"1"},{default:$(()=>[I("div",Kv,[I("span",Jv,ct(L.$t("color")),1),I("div",Zv,[M(U,{modelValue:D(a).stroke,"onUpdate:modelValue":A[25]||(A[25]=k=>D(a).stroke=k),onOnChange:A[26]||(A[26]=k=>_("stroke",k)),alpha:""},null,8,["modelValue"])])])]),_:1}),M(j,{flex:"1"},{default:$(()=>[M(D(ne),{modelValue:D(a).strokeWidth,"onUpdate:modelValue":A[27]||(A[27]=k=>D(a).strokeWidth=k),onOnChange:A[28]||(A[28]=k=>_("strokeWidth",k)),append:L.$t("width"),min:0},null,8,["modelValue","append"])]),_:1})]),_:1}),M(P,{gutter:12},{default:$(()=>[M(j,{flex:"1"},{default:$(()=>[I("div",Qv,[I("span",tm,ct(L.$t("attributes.stroke")),1),I("div",em,[M(st,{modelValue:D(a).strokeDashArray,"onUpdate:modelValue":A[29]||(A[29]=k=>D(a).strokeDashArray=k),onOnChange:b},{default:$(()=>[(Z(),at(kt,null,It(s,k=>M(B,{value:k.label,key:`stroke-${k.label}`},{default:$(()=>[dt(ct(k.label),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"])])])]),_:1})]),_:1}),M(X,{plain:"",orientation:"left"},{default:$(()=>[dt(ct(L.$t("attributes.shadow")),1)]),_:1}),M(P,{gutter:12},{default:$(()=>[M(j,{flex:"1"},{default:$(()=>[I("div",im,[I("span",nm,ct(L.$t("color")),1),I("div",rm,[M(U,{modelValue:D(a).shadow.color,"onUpdate:modelValue":A[30]||(A[30]=k=>D(a).shadow.color=k),onOnChange:A[31]||(A[31]=k=>_("color",k)),alpha:""},null,8,["modelValue"])])])]),_:1}),M(j,{flex:"1"},{default:$(()=>[M(D(ne),{modelValue:D(a).shadow.blur,"onUpdate:modelValue":A[32]||(A[32]=k=>D(a).shadow.blur=k),defaultValue:0,onOnChange:A[33]||(A[33]=k=>C("blur",k)),append:L.$t("attributes.blur"),min:0},null,8,["modelValue","append"])]),_:1})]),_:1}),M(P,{gutter:12},{default:$(()=>[M(j,{flex:"1"},{default:$(()=>[M(D(ne),{modelValue:D(a).shadow.offsetX,"onUpdate:modelValue":A[34]||(A[34]=k=>D(a).shadow.offsetX=k),defaultValue:0,onOnChange:A[35]||(A[35]=k=>C("offsetX",k)),append:L.$t("attributes.offset_x")},null,8,["modelValue","append"])]),_:1}),M(j,{flex:"1"},{default:$(()=>[M(D(ne),{modelValue:D(a).shadow.offsetY,"onUpdate:modelValue":A[36]||(A[36]=k=>D(a).shadow.offsetY=k),defaultValue:0,onOnChange:A[37]||(A[37]=k=>C("offsetY",k)),append:L.$t("attributes.offset_y")},null,8,["modelValue","append"])]),_:1})]),_:1})],512),[[Qt,u.includes(D(y).mSelectOneType)]]),I("div",null,[M(X,{plain:"",orientation:"left"},{default:$(()=>[dt(ct(L.$t("attributes.id")),1)]),_:1}),I("div",sm,[I("div",om,[I("span",am,ct(L.$t("attributes.id")),1),I("div",lm,[M(x,{modelValue:D(a).id,"onUpdate:modelValue":A[38]||(A[38]=k=>D(a).id=k),onOnChange:A[39]||(A[39]=k=>_("id",D(a).id))},null,8,["modelValue"])])])])])])):bt("",!0)}}}),um=Bt(hm,[["__scopeId","data-v-eee4417c"]]);var En={exports:{}},Me=typeof Reflect=="object"?Reflect:null,Or=Me&&typeof Me.apply=="function"?Me.apply:function(t,f,p){return Function.prototype.apply.call(t,f,p)},gi;Me&&typeof Me.ownKeys=="function"?gi=Me.ownKeys:Object.getOwnPropertySymbols?gi=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:gi=function(t){return Object.getOwnPropertyNames(t)};function fm(c){console&&console.warn&&console.warn(c)}var zs=Number.isNaN||function(t){return t!==t};function Tt(){Tt.init.call(this)}En.exports=Tt;En.exports.once=vm;Tt.EventEmitter=Tt;Tt.prototype._events=void 0;Tt.prototype._eventsCount=0;Tt.prototype._maxListeners=void 0;var kr=10;function Mi(c){if(typeof c!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof c)}Object.defineProperty(Tt,"defaultMaxListeners",{enumerable:!0,get:function(){return kr},set:function(c){if(typeof c!="number"||c<0||zs(c))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+c+".");kr=c}});Tt.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Tt.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||zs(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function Hs(c){return c._maxListeners===void 0?Tt.defaultMaxListeners:c._maxListeners}Tt.prototype.getMaxListeners=function(){return Hs(this)};Tt.prototype.emit=function(t){for(var f=[],p=1;p<arguments.length;p++)f.push(arguments[p]);var m=t==="error",y=this._events;if(y!==void 0)m=m&&y.error===void 0;else if(!m)return!1;if(m){var w;if(f.length>0&&(w=f[0]),w instanceof Error)throw w;var u=new Error("Unhandled error."+(w?" ("+w.message+")":""));throw u.context=w,u}var r=y[t];if(r===void 0)return!1;if(typeof r=="function")Or(r,this,f);else for(var a=r.length,l=Xs(r,a),p=0;p<a;++p)Or(l[p],this,f);return!0};function Vs(c,t,f,p){var m,y,w;if(Mi(f),y=c._events,y===void 0?(y=c._events=Object.create(null),c._eventsCount=0):(y.newListener!==void 0&&(c.emit("newListener",t,f.listener?f.listener:f),y=c._events),w=y[t]),w===void 0)w=y[t]=f,++c._eventsCount;else if(typeof w=="function"?w=y[t]=p?[f,w]:[w,f]:p?w.unshift(f):w.push(f),m=Hs(c),m>0&&w.length>m&&!w.warned){w.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+w.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=c,u.type=t,u.count=w.length,fm(u)}return c}Tt.prototype.addListener=function(t,f){return Vs(this,t,f,!1)};Tt.prototype.on=Tt.prototype.addListener;Tt.prototype.prependListener=function(t,f){return Vs(this,t,f,!0)};function dm(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Us(c,t,f){var p={fired:!1,wrapFn:void 0,target:c,type:t,listener:f},m=dm.bind(p);return m.listener=f,p.wrapFn=m,m}Tt.prototype.once=function(t,f){return Mi(f),this.on(t,Us(this,t,f)),this};Tt.prototype.prependOnceListener=function(t,f){return Mi(f),this.prependListener(t,Us(this,t,f)),this};Tt.prototype.removeListener=function(t,f){var p,m,y,w,u;if(Mi(f),m=this._events,m===void 0)return this;if(p=m[t],p===void 0)return this;if(p===f||p.listener===f)--this._eventsCount===0?this._events=Object.create(null):(delete m[t],m.removeListener&&this.emit("removeListener",t,p.listener||f));else if(typeof p!="function"){for(y=-1,w=p.length-1;w>=0;w--)if(p[w]===f||p[w].listener===f){u=p[w].listener,y=w;break}if(y<0)return this;y===0?p.shift():gm(p,y),p.length===1&&(m[t]=p[0]),m.removeListener!==void 0&&this.emit("removeListener",t,u||f)}return this};Tt.prototype.off=Tt.prototype.removeListener;Tt.prototype.removeAllListeners=function(t){var f,p,m;if(p=this._events,p===void 0)return this;if(p.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):p[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete p[t]),this;if(arguments.length===0){var y=Object.keys(p),w;for(m=0;m<y.length;++m)w=y[m],w!=="removeListener"&&this.removeAllListeners(w);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(f=p[t],typeof f=="function")this.removeListener(t,f);else if(f!==void 0)for(m=f.length-1;m>=0;m--)this.removeListener(t,f[m]);return this};function Ns(c,t,f){var p=c._events;if(p===void 0)return[];var m=p[t];return m===void 0?[]:typeof m=="function"?f?[m.listener||m]:[m]:f?pm(m):Xs(m,m.length)}Tt.prototype.listeners=function(t){return Ns(this,t,!0)};Tt.prototype.rawListeners=function(t){return Ns(this,t,!1)};Tt.listenerCount=function(c,t){return typeof c.listenerCount=="function"?c.listenerCount(t):Ws.call(c,t)};Tt.prototype.listenerCount=Ws;function Ws(c){var t=this._events;if(t!==void 0){var f=t[c];if(typeof f=="function")return 1;if(f!==void 0)return f.length}return 0}Tt.prototype.eventNames=function(){return this._eventsCount>0?gi(this._events):[]};function Xs(c,t){for(var f=new Array(t),p=0;p<t;++p)f[p]=c[p];return f}function gm(c,t){for(;t+1<c.length;t++)c[t]=c[t+1];c.pop()}function pm(c){for(var t=new Array(c.length),f=0;f<t.length;++f)t[f]=c[f].listener||c[f];return t}function vm(c,t){return new Promise(function(f,p){function m(w){c.removeListener(t,y),p(w)}function y(){typeof c.removeListener=="function"&&c.removeListener("error",m),f([].slice.call(arguments))}Ys(c,t,y,{once:!0}),t!=="error"&&mm(c,m,{once:!0})})}function mm(c,t,f){typeof c.on=="function"&&Ys(c,"error",t,f)}function Ys(c,t,f,p){if(typeof c.on=="function")p.once?c.once(t,f):c.on(t,f);else if(typeof c.addEventListener=="function")c.addEventListener(t,function m(y){p.once&&c.removeEventListener(t,m),f(y)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof c)}var _m=En.exports;const Gs=qr(_m);class qs extends Gs{constructor(){super(...arguments);J(this,"handler");J(this,"mSelectMode","")}init(f){this.handler=f,this.handler&&(this.handler.on("selection:created",()=>this.selected()),this.handler.on("selection:updated",()=>this.selected()),this.handler.on("selection:cleared",()=>this.selected()))}selected(){if(!this.handler)throw TypeError("还未初始化");const f=this.handler.getActiveObjects().filter(p=>!(p instanceof K.fabric.GuideLine));f&&f.length===1?this.emit(Zt.ONE,f):f&&f.length>1?(this.mSelectMode="multiple",this.emit(Zt.MULTI,f)):this.emit(Zt.CANCEL)}}const Ri=new qs,zi=typeof navigator!="undefined"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function Hi(c,t,f,p){c.addEventListener?c.addEventListener(t,f,p):c.attachEvent&&c.attachEvent("on".concat(t),f)}function He(c,t,f,p){c.removeEventListener?c.removeEventListener(t,f,p):c.detachEvent&&c.detachEvent("on".concat(t),f)}function Ks(c,t){const f=t.slice(0,t.length-1);for(let p=0;p<f.length;p++)f[p]=c[f[p].toLowerCase()];return f}function Js(c){typeof c!="string"&&(c=""),c=c.replace(/\s/g,"");const t=c.split(",");let f=t.lastIndexOf("");for(;f>=0;)t[f-1]+=",",t.splice(f,1),f=t.lastIndexOf("");return t}function ym(c,t){const f=c.length>=t.length?c:t,p=c.length>=t.length?t:c;let m=!0;for(let y=0;y<f.length;y++)p.indexOf(f[y])===-1&&(m=!1);return m}const Ke={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":zi?173:189,"=":zi?61:187,";":zi?59:186,"'":222,"[":219,"]":221,"\\":220},oe={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},Qi={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Xt={16:!1,18:!1,17:!1,91:!1},$t={};for(let c=1;c<20;c++)Ke["f".concat(c)]=111+c;let Mt=[],We=null,Zs="all";const ue=new Map,ni=c=>Ke[c.toLowerCase()]||oe[c.toLowerCase()]||c.toUpperCase().charCodeAt(0),bm=c=>Object.keys(Ke).find(t=>Ke[t]===c),wm=c=>Object.keys(oe).find(t=>oe[t]===c);function Qs(c){Zs=c||"all"}function Je(){return Zs||"all"}function Cm(){return Mt.slice(0)}function xm(){return Mt.map(c=>bm(c)||wm(c)||String.fromCharCode(c))}function Sm(){const c=[];return Object.keys($t).forEach(t=>{$t[t].forEach(f=>{let{key:p,scope:m,mods:y,shortcut:w}=f;c.push({scope:m,shortcut:w,mods:y,keys:p.split("+").map(u=>ni(u))})})}),c}function Tm(c){const t=c.target||c.srcElement,{tagName:f}=t;let p=!0;const m=f==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(t.type);return(t.isContentEditable||(m||f==="TEXTAREA"||f==="SELECT")&&!t.readOnly)&&(p=!1),p}function Om(c){return typeof c=="string"&&(c=ni(c)),Mt.indexOf(c)!==-1}function km(c,t){let f,p;c||(c=Je());for(const m in $t)if(Object.prototype.hasOwnProperty.call($t,m))for(f=$t[m],p=0;p<f.length;)f[p].scope===c?f.splice(p,1).forEach(w=>{let{element:u}=w;return Mn(u)}):p++;Je()===c&&Qs(t||"all")}function Am(c){let t=c.keyCode||c.which||c.charCode;const f=Mt.indexOf(t);if(f>=0&&Mt.splice(f,1),c.key&&c.key.toLowerCase()==="meta"&&Mt.splice(0,Mt.length),(t===93||t===224)&&(t=91),t in Xt){Xt[t]=!1;for(const p in oe)oe[p]===t&&(fe[p]=!1)}}function to(c){if(typeof c=="undefined")Object.keys($t).forEach(m=>{Array.isArray($t[m])&&$t[m].forEach(y=>hi(y)),delete $t[m]}),Mn(null);else if(Array.isArray(c))c.forEach(m=>{m.key&&hi(m)});else if(typeof c=="object")c.key&&hi(c);else if(typeof c=="string"){for(var t=arguments.length,f=new Array(t>1?t-1:0),p=1;p<t;p++)f[p-1]=arguments[p];let[m,y]=f;typeof m=="function"&&(y=m,m=""),hi({key:c,scope:m,method:y,splitKey:"+"})}}const hi=c=>{let{key:t,scope:f,method:p,splitKey:m="+"}=c;Js(t).forEach(w=>{const u=w.split(m),r=u.length,a=u[r-1],l=a==="*"?"*":ni(a);if(!$t[l])return;f||(f=Je());const i=r>1?Ks(oe,u):[],s=[];$t[l]=$t[l].filter(e=>{const h=(p?e.method===p:!0)&&e.scope===f&&ym(e.mods,i);return h&&s.push(e.element),!h}),s.forEach(e=>Mn(e))})};function Ar(c,t,f,p){if(t.element!==p)return;let m;if(t.scope===f||t.scope==="all"){m=t.mods.length>0;for(const y in Xt)Object.prototype.hasOwnProperty.call(Xt,y)&&(!Xt[y]&&t.mods.indexOf(+y)>-1||Xt[y]&&t.mods.indexOf(+y)===-1)&&(m=!1);(t.mods.length===0&&!Xt[16]&&!Xt[18]&&!Xt[17]&&!Xt[91]||m||t.shortcut==="*")&&(t.keys=[],t.keys=t.keys.concat(Mt),t.method(c,t)===!1&&(c.preventDefault?c.preventDefault():c.returnValue=!1,c.stopPropagation&&c.stopPropagation(),c.cancelBubble&&(c.cancelBubble=!0)))}}function Er(c,t){const f=$t["*"];let p=c.keyCode||c.which||c.charCode;if(!fe.filter.call(this,c))return;if((p===93||p===224)&&(p=91),Mt.indexOf(p)===-1&&p!==229&&Mt.push(p),["ctrlKey","altKey","shiftKey","metaKey"].forEach(u=>{const r=Qi[u];c[u]&&Mt.indexOf(r)===-1?Mt.push(r):!c[u]&&Mt.indexOf(r)>-1?Mt.splice(Mt.indexOf(r),1):u==="metaKey"&&c[u]&&Mt.length===3&&(c.ctrlKey||c.shiftKey||c.altKey||(Mt=Mt.slice(Mt.indexOf(r))))}),p in Xt){Xt[p]=!0;for(const u in oe)oe[u]===p&&(fe[u]=!0);if(!f)return}for(const u in Xt)Object.prototype.hasOwnProperty.call(Xt,u)&&(Xt[u]=c[Qi[u]]);c.getModifierState&&!(c.altKey&&!c.ctrlKey)&&c.getModifierState("AltGraph")&&(Mt.indexOf(17)===-1&&Mt.push(17),Mt.indexOf(18)===-1&&Mt.push(18),Xt[17]=!0,Xt[18]=!0);const m=Je();if(f)for(let u=0;u<f.length;u++)f[u].scope===m&&(c.type==="keydown"&&f[u].keydown||c.type==="keyup"&&f[u].keyup)&&Ar(c,f[u],m,t);if(!(p in $t))return;const y=$t[p],w=y.length;for(let u=0;u<w;u++)if((c.type==="keydown"&&y[u].keydown||c.type==="keyup"&&y[u].keyup)&&y[u].key){const r=y[u],{splitKey:a}=r,l=r.key.split(a),i=[];for(let s=0;s<l.length;s++)i.push(ni(l[s]));i.sort().join("")===Mt.sort().join("")&&Ar(c,r,m,t)}}function fe(c,t,f){Mt=[];const p=Js(c);let m=[],y="all",w=document,u=0,r=!1,a=!0,l="+",i=!1,s=!1;for(f===void 0&&typeof t=="function"&&(f=t),Object.prototype.toString.call(t)==="[object Object]"&&(t.scope&&(y=t.scope),t.element&&(w=t.element),t.keyup&&(r=t.keyup),t.keydown!==void 0&&(a=t.keydown),t.capture!==void 0&&(i=t.capture),typeof t.splitKey=="string"&&(l=t.splitKey),t.single===!0&&(s=!0)),typeof t=="string"&&(y=t),s&&to(c,y);u<p.length;u++)c=p[u].split(l),m=[],c.length>1&&(m=Ks(oe,c)),c=c[c.length-1],c=c==="*"?"*":ni(c),c in $t||($t[c]=[]),$t[c].push({keyup:r,keydown:a,scope:y,mods:m,shortcut:p[u],method:f,key:p[u],splitKey:l,element:w});if(typeof w!="undefined"&&window){if(!ue.has(w)){const e=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return Er(h,w)},o=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;Er(h,w),Am(h)};ue.set(w,{keydownListener:e,keyupListenr:o,capture:i}),Hi(w,"keydown",e,i),Hi(w,"keyup",o,i)}if(!We){const e=()=>{Mt=[]};We={listener:e,capture:i},Hi(window,"focus",e,i)}}}function Em(c){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys($t).forEach(f=>{$t[f].filter(m=>m.scope===t&&m.shortcut===c).forEach(m=>{m&&m.method&&m.method()})})}function Mn(c){const t=Object.values($t).flat();if(t.findIndex(p=>{let{element:m}=p;return m===c})<0){const{keydownListener:p,keyupListenr:m,capture:y}=ue.get(c)||{};p&&m&&(He(c,"keyup",m,y),He(c,"keydown",p,y),ue.delete(c))}if((t.length<=0||ue.size<=0)&&(Object.keys(ue).forEach(m=>{const{keydownListener:y,keyupListenr:w,capture:u}=ue.get(m)||{};y&&w&&(He(m,"keyup",w,u),He(m,"keydown",y,u),ue.delete(m))}),ue.clear(),Object.keys($t).forEach(m=>delete $t[m]),We)){const{listener:m,capture:y}=We;He(window,"focus",m,y),We=null}}const Vi={getPressedKeyString:xm,setScope:Qs,getScope:Je,deleteScope:km,getPressedKeyCodes:Cm,getAllKeyCodes:Sm,isPressed:Om,filter:Tm,trigger:Em,unbind:to,keyMap:Ke,modifier:oe,modifierMap:Qi};for(const c in Vi)Object.prototype.hasOwnProperty.call(Vi,c)&&(fe[c]=Vi[c]);if(typeof window!="undefined"){const c=window.hotkeys;fe.noConflict=t=>(t&&window.hotkeys===fe&&(window.hotkeys=c),fe),window.hotkeys=fe}class Ci{constructor(t,f){this.container=t,this.dom=null,this.shown=!1,this.root=!0,this.parent=null,this.submenus=[],this.items=f,this._onclick=p=>{this.dom&&p.target!=this.dom&&p.target.parentElement!=this.dom&&!p.target.classList.contains("item")&&!p.target.parentElement.classList.contains("item")&&this.hideAll()},this._oncontextmenu=p=>{p.preventDefault(),p.target!=this.dom&&p.target.parentElement!=this.dom&&!p.target.classList.contains("item")&&!p.target.parentElement.classList.contains("item")&&(this.hideAll(),this.show(p.clientX,p.clientY))},this._oncontextmenu_keydown=p=>{p.keyCode==93&&(p.preventDefault(),this.hideAll(),this.show(p.clientX,p.clientY))},this._onblur=()=>{this.hideAll()}}getMenuDom(){const t=document.createElement("div");t.classList.add("context");for(const f of this.items)t.appendChild(this.itemToDomEl(f));return t}itemToDomEl(t){const f=document.createElement("div");if(t===null)return f.classList="separator",f;t.hasOwnProperty("color")&&/^#([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t.color.toString())&&(f.style.cssText=`color: ${t.color}`),f.classList.add("item");const p=document.createElement("span");p.classList="label",p.innerText=t.hasOwnProperty("text")?t.text.toString():"",f.appendChild(p),t.hasOwnProperty("disabled")&&t.disabled?f.classList.add("disabled"):f.classList.add("enabled");const m=document.createElement("span");if(m.classList="hotkey",m.innerText=t.hasOwnProperty("hotkey")?t.hotkey.toString():"",f.appendChild(m),t.hasOwnProperty("subitems")&&Array.isArray(t.subitems)&&t.subitems.length>0){const y=new Ci(this.container,t.subitems);y.root=!1,y.parent=this;const w=()=>{if(t.hasOwnProperty("disabled")&&t.disabled==!0)return;this.hideSubMenus();const u=this.dom.offsetLeft+this.dom.clientWidth+f.offsetLeft,r=this.dom.offsetTop+f.offsetTop;y.shown?y.hide():y.show(u,r)};this.submenus.push(y),f.classList.add("has-subitems"),f.addEventListener("click",w),f.addEventListener("mousemove",w)}else if(t.hasOwnProperty("submenu")&&t.submenu instanceof Ci){const y=t.submenu;y.root=!1,y.parent=this;const w=()=>{if(t.hasOwnProperty("disabled")&&t.disabled==!0)return;this.hideSubMenus();const u=this.dom.offsetLeft+this.dom.clientWidth+f.offsetLeft,r=this.dom.offsetTop+f.offsetTop;y.shown?y.hide():y.show(u,r)};this.submenus.push(y),f.classList.add("has-subitems"),f.addEventListener("click",w),f.addEventListener("mousemove",w)}else f.addEventListener("click",()=>{if(this.hideSubMenus(),!f.classList.contains("disabled"))if(t.hasOwnProperty("onclick")&&typeof t.onclick=="function"){const y={handled:!1,item:f,label:p,hotkey:m,items:this.items,data:t};t.onclick(y),y.handled||this.hide()}else this.hide()}),f.addEventListener("mousemove",()=>{this.hideSubMenus()});return f}hideAll(){if(this.root&&!this.parent){this.shown&&(this.hideSubMenus(),this.shown=!1,this.container.removeChild(this.dom),this.parent&&this.parent.shown&&this.parent.hide());return}this.parent.hide()}hide(){this.dom&&this.shown&&(this.shown=!1,this.hideSubMenus(),this.container.removeChild(this.dom),this.parent&&this.parent.shown&&this.parent.hide())}hideSubMenus(){for(const t of this.submenus)t.shown&&(t.shown=!1,t.container.removeChild(t.dom)),t.hideSubMenus()}show(t,f){this.dom=this.getMenuDom(),this.dom.style.left=`${t}px`,this.dom.style.top=`${f}px`,this.shown=!0,this.container.appendChild(this.dom)}install(){this.container.addEventListener("contextmenu",this._oncontextmenu),this.container.addEventListener("keydown",this._oncontextmenu_keydown),this.container.addEventListener("click",this._onclick),window.addEventListener("blur",this._onblur)}setData(t){this.items=t}uninstall(){this.dom=null,this.container.removeEventListener("keydown",this._oncontextmenu_keydown),this.container.removeEventListener("click",this._onclick),window.removeEventListener("blur",this._onblur)}}function Ui(c,t){const f=document.createElement("a");f.href=c,f.download=`${Lt()}.${t}`,document.body.appendChild(f),f.click(),f.remove()}function tn(c){c&&c.forEach(t=>{t.objects?tn(t.objects):t.type==="text"&&(t.type="textbox")})}class en{constructor(t,f){J(this,"canvas");J(this,"editor");this.canvas=t,this.editor=f}insert(){wi({accept:".json"}).then(t=>{const[f]=t,p=new FileReader;p.readAsText(f,"UTF-8"),p.onload=()=>{this.insertSvgFile(p.result)}})}insertSvgFile(t){this.editor.hooksEntity.hookImportBefore.callAsync(t,()=>{this.canvas.loadFromJSON(t,()=>{this.canvas.renderAll(),this.editor.hooksEntity.hookImportAfter.callAsync(t,()=>{this.canvas.renderAll()})})})}getJson(){return this.canvas.toJSON(["id","gradientAngle","selectable","hasControls"])}dragAddItem(t,f){const{left:p,top:m}=this.canvas.getSelectionElement().getBoundingClientRect();if(t.x<p||t.y<m||f.width===void 0)return;const y={x:t.x-p,y:t.y-m},w=this.canvas.restorePointerVpt(y);f.left=w.x-f.width/2,f.top=w.y,this.canvas.add(f),this.canvas.requestRenderAll()}clipboard(){const t=this.getJson();yc(JSON.stringify(t,null,"	"))}saveJson(){return ie(this,null,function*(){const t=this.getJson();yield tn(t.objects);const f=`data:text/json;charset=utf-8,${encodeURIComponent(JSON.stringify(t,null,"	"))}`;Ui(f,"json")})}getCanvasData(){return ie(this,null,function*(){const t=this.getJson();return yield tn(t.objects),`data:text/json;charset=utf-8,${encodeURIComponent(JSON.stringify(t,null,"	"))}`})}saveSvg(){this.editor.hooksEntity.hookSaveBefore.callAsync("",()=>{const t=this._getSaveSvgOption(),f=this.canvas.toSVG(t),p=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(f)}`;this.editor.hooksEntity.hookSaveAfter.callAsync(p,()=>{Ui(p,"svg")})})}saveImg(){this.editor.hooksEntity.hookSaveBefore.callAsync("",()=>{const t=this._getSaveOption();this.canvas.setViewportTransform([1,0,0,1,0,0]);const f=this.canvas.toDataURL(t);this.editor.hooksEntity.hookSaveAfter.callAsync(f,()=>{Ui(f,"png")})})}preview(){return new Promise((t,f)=>{this.editor.hooksEntity.hookSaveBefore.callAsync("",()=>{const p=this._getSaveOption();this.canvas.setViewportTransform([1,0,0,1,0,0]),this.canvas.renderAll();const m=this.canvas.toDataURL(p);this.editor.hooksEntity.hookSaveAfter.callAsync(m,()=>{t(m)})})})}_getSaveSvgOption(){const t=this.canvas.getObjects().find(w=>w.id==="workspace"),{left:f,top:p,width:m,height:y}=t;return{width:m,height:y,viewBox:{x:f,y:p,width:m,height:y}}}_getSaveOption(){const t=this.canvas.getObjects().find(u=>u.id==="workspace"),{left:f,top:p,width:m,height:y}=t;return{name:"New Image",format:"png",quality:1,width:m,height:y,left:f,top:p}}clear(){this.canvas.getObjects().forEach(t=>{t.id!=="workspace"&&this.canvas.remove(t)}),this.canvas.discardActiveObject(),this.canvas.renderAll()}destroy(){console.log("pluginDestroy")}}J(en,"pluginName","ServersPlugin"),J(en,"apis",["insert","insertSvgFile","getJson","dragAddItem","clipboard","saveJson","getCanvasData","saveSvg","saveImg","clear","preview"]);var Pn={};Pn.deprecate=(c,t)=>{let f=!0;return function(){return f&&(console.warn("DeprecationWarning: "+t),f=!1),c.apply(this,arguments)}};const Mm=Pn,Pm=Mm.deprecate(()=>{},"Hook.context is deprecated and will be removed"),Mr=function(...c){return this.call=this._createCall("sync"),this.call(...c)},Pr=function(...c){return this.callAsync=this._createCall("async"),this.callAsync(...c)},Dr=function(...c){return this.promise=this._createCall("promise"),this.promise(...c)};let eo=class{constructor(t=[],f=void 0){this._args=t,this.name=f,this.taps=[],this.interceptors=[],this._call=Mr,this.call=Mr,this._callAsync=Pr,this.callAsync=Pr,this._promise=Dr,this.promise=Dr,this._x=void 0,this.compile=this.compile,this.tap=this.tap,this.tapAsync=this.tapAsync,this.tapPromise=this.tapPromise}compile(t){throw new Error("Abstract: should be overridden")}_createCall(t){return this.compile({taps:this.taps,interceptors:this.interceptors,args:this._args,type:t})}_tap(t,f,p){if(typeof f=="string")f={name:f.trim()};else if(typeof f!="object"||f===null)throw new Error("Invalid tap options");if(typeof f.name!="string"||f.name==="")throw new Error("Missing name for tap");typeof f.context!="undefined"&&Pm(),f=Object.assign({type:t,fn:p},f),f=this._runRegisterInterceptors(f),this._insert(f)}tap(t,f){this._tap("sync",t,f)}tapAsync(t,f){this._tap("async",t,f)}tapPromise(t,f){this._tap("promise",t,f)}_runRegisterInterceptors(t){for(const f of this.interceptors)if(f.register){const p=f.register(t);p!==void 0&&(t=p)}return t}withOptions(t){const f=p=>Object.assign({},t,typeof p=="string"?{name:p}:p);return{name:this.name,tap:(p,m)=>this.tap(f(p),m),tapAsync:(p,m)=>this.tapAsync(f(p),m),tapPromise:(p,m)=>this.tapPromise(f(p),m),intercept:p=>this.intercept(p),isUsed:()=>this.isUsed(),withOptions:p=>this.withOptions(f(p))}}isUsed(){return this.taps.length>0||this.interceptors.length>0}intercept(t){if(this._resetCompilation(),this.interceptors.push(Object.assign({},t)),t.register)for(let f=0;f<this.taps.length;f++)this.taps[f]=t.register(this.taps[f])}_resetCompilation(){this.call=this._call,this.callAsync=this._callAsync,this.promise=this._promise}_insert(t){this._resetCompilation();let f;typeof t.before=="string"?f=new Set([t.before]):Array.isArray(t.before)&&(f=new Set(t.before));let p=0;typeof t.stage=="number"&&(p=t.stage);let m=this.taps.length;for(;m>0;){m--;const y=this.taps[m];this.taps[m+1]=y;const w=y.stage||0;if(f){if(f.has(y.name)){f.delete(y.name);continue}if(f.size>0)continue}if(!(w>p)){m++;break}}this.taps[m]=t}};Object.setPrototypeOf(eo.prototype,null);var ce=eo;let Dm=class{constructor(t){this.config=t,this.options=void 0,this._args=void 0}create(t){this.init(t);let f;switch(this.options.type){case"sync":f=new Function(this.args(),`"use strict";
`+this.header()+this.contentWithInterceptors({onError:w=>`throw ${w};
`,onResult:w=>`return ${w};
`,resultReturns:!0,onDone:()=>"",rethrowIfPossible:!0}));break;case"async":f=new Function(this.args({after:"_callback"}),`"use strict";
`+this.header()+this.contentWithInterceptors({onError:w=>`_callback(${w});
`,onResult:w=>`_callback(null, ${w});
`,onDone:()=>`_callback();
`}));break;case"promise":let p=!1;const m=this.contentWithInterceptors({onError:w=>(p=!0,`_error(${w});
`),onResult:w=>`_resolve(${w});
`,onDone:()=>`_resolve();
`});let y="";y+=`"use strict";
`,y+=this.header(),y+=`return new Promise((function(_resolve, _reject) {
`,p&&(y+=`var _sync = true;
`,y+=`function _error(_err) {
`,y+=`if(_sync)
`,y+=`_resolve(Promise.resolve().then((function() { throw _err; })));
`,y+=`else
`,y+=`_reject(_err);
`,y+=`};
`),y+=m,p&&(y+=`_sync = false;
`),y+=`}));
`,f=new Function(this.args(),y);break}return this.deinit(),f}setup(t,f){t._x=f.taps.map(p=>p.fn)}init(t){this.options=t,this._args=t.args.slice()}deinit(){this.options=void 0,this._args=void 0}contentWithInterceptors(t){if(this.options.interceptors.length>0){const f=t.onError,p=t.onResult,m=t.onDone;let y="";for(let w=0;w<this.options.interceptors.length;w++){const u=this.options.interceptors[w];u.call&&(y+=`${this.getInterceptor(w)}.call(${this.args({before:u.context?"_context":void 0})});
`)}return y+=this.content(Object.assign(t,{onError:f&&(w=>{let u="";for(let r=0;r<this.options.interceptors.length;r++)this.options.interceptors[r].error&&(u+=`${this.getInterceptor(r)}.error(${w});
`);return u+=f(w),u}),onResult:p&&(w=>{let u="";for(let r=0;r<this.options.interceptors.length;r++)this.options.interceptors[r].result&&(u+=`${this.getInterceptor(r)}.result(${w});
`);return u+=p(w),u}),onDone:m&&(()=>{let w="";for(let u=0;u<this.options.interceptors.length;u++)this.options.interceptors[u].done&&(w+=`${this.getInterceptor(u)}.done();
`);return w+=m(),w})})),y}else return this.content(t)}header(){let t="";return this.needContext()?t+=`var _context = {};
`:t+=`var _context;
`,t+=`var _x = this._x;
`,this.options.interceptors.length>0&&(t+=`var _taps = this.taps;
`,t+=`var _interceptors = this.interceptors;
`),t}needContext(){for(const t of this.options.taps)if(t.context)return!0;return!1}callTap(t,{onError:f,onResult:p,onDone:m,rethrowIfPossible:y}){let w="",u=!1;for(let a=0;a<this.options.interceptors.length;a++){const l=this.options.interceptors[a];l.tap&&(u||(w+=`var _tap${t} = ${this.getTap(t)};
`,u=!0),w+=`${this.getInterceptor(a)}.tap(${l.context?"_context, ":""}_tap${t});
`)}w+=`var _fn${t} = ${this.getTapFn(t)};
`;const r=this.options.taps[t];switch(r.type){case"sync":y||(w+=`var _hasError${t} = false;
`,w+=`try {
`),p?w+=`var _result${t} = _fn${t}(${this.args({before:r.context?"_context":void 0})});
`:w+=`_fn${t}(${this.args({before:r.context?"_context":void 0})});
`,y||(w+=`} catch(_err) {
`,w+=`_hasError${t} = true;
`,w+=f("_err"),w+=`}
`,w+=`if(!_hasError${t}) {
`),p&&(w+=p(`_result${t}`)),m&&(w+=m()),y||(w+=`}
`);break;case"async":let a="";p?a+=`(function(_err${t}, _result${t}) {
`:a+=`(function(_err${t}) {
`,a+=`if(_err${t}) {
`,a+=f(`_err${t}`),a+=`} else {
`,p&&(a+=p(`_result${t}`)),m&&(a+=m()),a+=`}
`,a+="})",w+=`_fn${t}(${this.args({before:r.context?"_context":void 0,after:a})});
`;break;case"promise":w+=`var _hasResult${t} = false;
`,w+=`var _promise${t} = _fn${t}(${this.args({before:r.context?"_context":void 0})});
`,w+=`if (!_promise${t} || !_promise${t}.then)
`,w+=`  throw new Error('Tap function (tapPromise) did not return promise (returned ' + _promise${t} + ')');
`,w+=`_promise${t}.then((function(_result${t}) {
`,w+=`_hasResult${t} = true;
`,p&&(w+=p(`_result${t}`)),m&&(w+=m()),w+=`}), function(_err${t}) {
`,w+=`if(_hasResult${t}) throw _err${t};
`,w+=f(`_err${t}`),w+=`});
`;break}return w}callTapsSeries({onError:t,onResult:f,resultReturns:p,onDone:m,doneReturns:y,rethrowIfPossible:w}){if(this.options.taps.length===0)return m();const u=this.options.taps.findIndex(s=>s.type!=="sync"),r=p||y;let a="",l=m,i=0;for(let s=this.options.taps.length-1;s>=0;s--){const e=s;l!==m&&(this.options.taps[e].type!=="sync"||i++>20)&&(i=0,a+=`function _next${e}() {
`,a+=l(),a+=`}
`,l=()=>`${r?"return ":""}_next${e}();
`);const h=l,n=g=>g?"":m(),d=this.callTap(e,{onError:g=>t(e,g,h,n),onResult:f&&(g=>f(e,g,h,n)),onDone:!f&&h,rethrowIfPossible:w&&(u<0||e<u)});l=()=>d}return a+=l(),a}callTapsLooping({onError:t,onDone:f,rethrowIfPossible:p}){if(this.options.taps.length===0)return f();const m=this.options.taps.every(w=>w.type==="sync");let y="";m||(y+=`var _looper = (function() {
`,y+=`var _loopAsync = false;
`),y+=`var _loop;
`,y+=`do {
`,y+=`_loop = false;
`;for(let w=0;w<this.options.interceptors.length;w++){const u=this.options.interceptors[w];u.loop&&(y+=`${this.getInterceptor(w)}.loop(${this.args({before:u.context?"_context":void 0})});
`)}return y+=this.callTapsSeries({onError:t,onResult:(w,u,r,a)=>{let l="";return l+=`if(${u} !== undefined) {
`,l+=`_loop = true;
`,m||(l+=`if(_loopAsync) _looper();
`),l+=a(!0),l+=`} else {
`,l+=r(),l+=`}
`,l},onDone:f&&(()=>{let w="";return w+=`if(!_loop) {
`,w+=f(),w+=`}
`,w}),rethrowIfPossible:p&&m}),y+=`} while(_loop);
`,m||(y+=`_loopAsync = true;
`,y+=`});
`,y+=`_looper();
`),y}callTapsParallel({onError:t,onResult:f,onDone:p,rethrowIfPossible:m,onTap:y=(w,u)=>u()}){if(this.options.taps.length<=1)return this.callTapsSeries({onError:t,onResult:f,onDone:p,rethrowIfPossible:m});let w="";w+=`do {
`,w+=`var _counter = ${this.options.taps.length};
`,p&&(w+=`var _done = (function() {
`,w+=p(),w+=`});
`);for(let u=0;u<this.options.taps.length;u++){const r=()=>p?`if(--_counter === 0) _done();
`:"--_counter;",a=l=>l||!p?`_counter = 0;
`:`_counter = 0;
_done();
`;w+=`if(_counter <= 0) break;
`,w+=y(u,()=>this.callTap(u,{onError:l=>{let i="";return i+=`if(_counter > 0) {
`,i+=t(u,l,r,a),i+=`}
`,i},onResult:f&&(l=>{let i="";return i+=`if(_counter > 0) {
`,i+=f(u,l,r,a),i+=`}
`,i}),onDone:!f&&(()=>r()),rethrowIfPossible:m}),r,a)}return w+=`} while(false);
`,w}args({before:t,after:f}={}){let p=this._args;return t&&(p=[t].concat(p)),f&&(p=p.concat(f)),p.length===0?"":p.join(", ")}getTapFn(t){return`_x[${t}]`}getTap(t){return`_taps[${t}]`}getInterceptor(t){return`_interceptors[${t}]`}};var he=Dm;const jm=ce,Lm=he;class Fm extends Lm{content({onError:t,onDone:f,rethrowIfPossible:p}){return this.callTapsSeries({onError:(m,y)=>t(y),onDone:f,rethrowIfPossible:p})}}const jr=new Fm,Im=()=>{throw new Error("tapAsync is not supported on a SyncHook")},$m=()=>{throw new Error("tapPromise is not supported on a SyncHook")},Bm=function(c){return jr.setup(this,c),jr.create(c)};function io(c=[],t=void 0){const f=new jm(c,t);return f.constructor=io,f.tapAsync=Im,f.tapPromise=$m,f.compile=Bm,f}io.prototype=null;const Rm=ce,zm=he;class Hm extends zm{content({onError:t,onResult:f,resultReturns:p,onDone:m,rethrowIfPossible:y}){return this.callTapsSeries({onError:(w,u)=>t(u),onResult:(w,u,r)=>`if(${u} !== undefined) {
${f(u)};
} else {
${r()}}
`,resultReturns:p,onDone:m,rethrowIfPossible:y})}}const Lr=new Hm,Vm=()=>{throw new Error("tapAsync is not supported on a SyncBailHook")},Um=()=>{throw new Error("tapPromise is not supported on a SyncBailHook")},Nm=function(c){return Lr.setup(this,c),Lr.create(c)};function no(c=[],t=void 0){const f=new Rm(c,t);return f.constructor=no,f.tapAsync=Vm,f.tapPromise=Um,f.compile=Nm,f}no.prototype=null;const Wm=ce,Xm=he;class Ym extends Xm{content({onError:t,onResult:f,resultReturns:p,rethrowIfPossible:m}){return this.callTapsSeries({onError:(y,w)=>t(w),onResult:(y,w,u)=>{let r="";return r+=`if(${w} !== undefined) {
`,r+=`${this._args[0]} = ${w};
`,r+=`}
`,r+=u(),r},onDone:()=>f(this._args[0]),doneReturns:p,rethrowIfPossible:m})}}const Fr=new Ym,Gm=()=>{throw new Error("tapAsync is not supported on a SyncWaterfallHook")},qm=()=>{throw new Error("tapPromise is not supported on a SyncWaterfallHook")},Km=function(c){return Fr.setup(this,c),Fr.create(c)};function ro(c=[],t=void 0){if(c.length<1)throw new Error("Waterfall hooks must have at least one argument");const f=new Wm(c,t);return f.constructor=ro,f.tapAsync=Gm,f.tapPromise=qm,f.compile=Km,f}ro.prototype=null;const Jm=ce,Zm=he;class Qm extends Zm{content({onError:t,onDone:f,rethrowIfPossible:p}){return this.callTapsLooping({onError:(m,y)=>t(y),onDone:f,rethrowIfPossible:p})}}const Ir=new Qm,t3=()=>{throw new Error("tapAsync is not supported on a SyncLoopHook")},e3=()=>{throw new Error("tapPromise is not supported on a SyncLoopHook")},i3=function(c){return Ir.setup(this,c),Ir.create(c)};function so(c=[],t=void 0){const f=new Jm(c,t);return f.constructor=so,f.tapAsync=t3,f.tapPromise=e3,f.compile=i3,f}so.prototype=null;const n3=ce,r3=he;class s3 extends r3{content({onError:t,onDone:f}){return this.callTapsParallel({onError:(p,m,y,w)=>t(m)+w(!0),onDone:f})}}const $r=new s3,o3=function(c){return $r.setup(this,c),$r.create(c)};function oo(c=[],t=void 0){const f=new n3(c,t);return f.constructor=oo,f.compile=o3,f._call=void 0,f.call=void 0,f}oo.prototype=null;const a3=ce,l3=he;class c3 extends l3{content({onError:t,onResult:f,onDone:p}){let m="";return m+=`var _results = new Array(${this.options.taps.length});
`,m+=`var _checkDone = function() {
`,m+=`for(var i = 0; i < _results.length; i++) {
`,m+=`var item = _results[i];
`,m+=`if(item === undefined) return false;
`,m+=`if(item.result !== undefined) {
`,m+=f("item.result"),m+=`return true;
`,m+=`}
`,m+=`if(item.error) {
`,m+=t("item.error"),m+=`return true;
`,m+=`}
`,m+=`}
`,m+=`return false;
`,m+=`}
`,m+=this.callTapsParallel({onError:(y,w,u,r)=>{let a="";return a+=`if(${y} < _results.length && ((_results.length = ${y+1}), (_results[${y}] = { error: ${w} }), _checkDone())) {
`,a+=r(!0),a+=`} else {
`,a+=u(),a+=`}
`,a},onResult:(y,w,u,r)=>{let a="";return a+=`if(${y} < _results.length && (${w} !== undefined && (_results.length = ${y+1}), (_results[${y}] = { result: ${w} }), _checkDone())) {
`,a+=r(!0),a+=`} else {
`,a+=u(),a+=`}
`,a},onTap:(y,w,u,r)=>{let a="";return y>0&&(a+=`if(${y} >= _results.length) {
`,a+=u(),a+=`} else {
`),a+=w(),y>0&&(a+=`}
`),a},onDone:p}),m}}const Br=new c3,h3=function(c){return Br.setup(this,c),Br.create(c)};function ao(c=[],t=void 0){const f=new a3(c,t);return f.constructor=ao,f.compile=h3,f._call=void 0,f.call=void 0,f}ao.prototype=null;const u3=ce,f3=he;class d3 extends f3{content({onError:t,onDone:f}){return this.callTapsSeries({onError:(p,m,y,w)=>t(m)+w(!0),onDone:f})}}const Rr=new d3,g3=function(c){return Rr.setup(this,c),Rr.create(c)};function Dn(c=[],t=void 0){const f=new u3(c,t);return f.constructor=Dn,f.compile=g3,f._call=void 0,f.call=void 0,f}Dn.prototype=null;var p3=Dn;const v3=ce,m3=he;class _3 extends m3{content({onError:t,onResult:f,resultReturns:p,onDone:m}){return this.callTapsSeries({onError:(y,w,u,r)=>t(w)+r(!0),onResult:(y,w,u)=>`if(${w} !== undefined) {
${f(w)}
} else {
${u()}}
`,resultReturns:p,onDone:m})}}const zr=new _3,y3=function(c){return zr.setup(this,c),zr.create(c)};function lo(c=[],t=void 0){const f=new v3(c,t);return f.constructor=lo,f.compile=y3,f._call=void 0,f.call=void 0,f}lo.prototype=null;const b3=ce,w3=he;class C3 extends w3{content({onError:t,onDone:f}){return this.callTapsLooping({onError:(p,m,y,w)=>t(m)+w(!0),onDone:f})}}const Hr=new C3,x3=function(c){return Hr.setup(this,c),Hr.create(c)};function co(c=[],t=void 0){const f=new b3(c,t);return f.constructor=co,f.compile=x3,f._call=void 0,f.call=void 0,f}co.prototype=null;const S3=ce,T3=he;class O3 extends T3{content({onError:t,onResult:f,onDone:p}){return this.callTapsSeries({onError:(m,y,w,u)=>t(y)+u(!0),onResult:(m,y,w)=>{let u="";return u+=`if(${y} !== undefined) {
`,u+=`${this._args[0]} = ${y};
`,u+=`}
`,u+=w(),u},onDone:()=>f(this._args[0])})}}const Vr=new O3,k3=function(c){return Vr.setup(this,c),Vr.create(c)};function ho(c=[],t=void 0){if(c.length<1)throw new Error("Waterfall hooks must have at least one argument");const f=new S3(c,t);return f.constructor=ho,f.compile=k3,f._call=void 0,f.call=void 0,f}ho.prototype=null;const jn=Pn,A3=(c,t)=>t;class Ln{constructor(t,f=void 0){this._map=new Map,this.name=f,this._factory=t,this._interceptors=[]}get(t){return this._map.get(t)}for(t){const f=this.get(t);if(f!==void 0)return f;let p=this._factory(t);const m=this._interceptors;for(let y=0;y<m.length;y++)p=m[y].factory(t,p);return this._map.set(t,p),p}intercept(t){this._interceptors.push(Object.assign({factory:A3},t))}}Ln.prototype.tap=jn.deprecate(function(c,t,f){return this.for(c).tap(t,f)},"HookMap#tap(key,…) is deprecated. Use HookMap#for(key).tap(…) instead.");Ln.prototype.tapAsync=jn.deprecate(function(c,t,f){return this.for(c).tapAsync(t,f)},"HookMap#tapAsync(key,…) is deprecated. Use HookMap#for(key).tapAsync(…) instead.");Ln.prototype.tapPromise=jn.deprecate(function(c,t,f){return this.for(c).tapPromise(t,f)},"HookMap#tapPromise(key,…) is deprecated. Use HookMap#for(key).tapPromise(…) instead.");var E3=p3;class M3 extends Gs{constructor(){super(...arguments);J(this,"canvas");J(this,"contextMenu");J(this,"pluginMap",{});J(this,"customEvents",[]);J(this,"customApis",[]);J(this,"hooks",["hookImportBefore","hookImportAfter","hookSaveBefore","hookSaveAfter"]);J(this,"hooksEntity",{})}init(f){this.canvas=f,this._initContextMenu(),this._bindContextMenu(),this._initActionHooks(),this._initServersPlugin()}use(f,p){if(this._checkPlugin(f)){this._saveCustomAttr(f);const m=new f(this.canvas,this,p);this.pluginMap[f.pluginName]=m,this._bindingHooks(m),this._bindingHotkeys(m),this._bindingApis(m)}}getPlugin(f){if(this.pluginMap[f])return this.pluginMap[f]}_checkPlugin(f){const{pluginName:p,events:m=[],apis:y=[]}=f;if(this.pluginMap[p])throw new Error(p+"插件重复初始化");return m.forEach(w=>{if(this.customEvents.find(u=>u===w))throw new Error(p+"插件中"+w+"重复")}),y.forEach(w=>{if(this.customApis.find(u=>u===w))throw new Error(p+"插件中"+w+"重复")}),!0}_bindingHooks(f){this.hooks.forEach(p=>{const m=f[p];m&&this.hooksEntity[p].tapPromise(f.pluginName+p,function(){return m.apply(f,[...arguments])})})}_bindingHotkeys(f){var p;(p=f==null?void 0:f.hotkeys)==null||p.forEach(m=>{fe(m,{keyup:!0},y=>f.hotkeyEvent(m,y))})}_saveCustomAttr(f){const{events:p=[],apis:m=[]}=f;this.customApis=this.customApis.concat(m),this.customEvents=this.customEvents.concat(p)}_bindingApis(f){const{apis:p=[]}=f.constructor;p.forEach(m=>{this[m]=function(){return f[m].apply(f,[...arguments])}})}_bindContextMenu(){this.canvas.on("mouse:down",f=>{if(f.button===3){let p=[];Object.keys(this.pluginMap).forEach(m=>{const y=this.pluginMap[m],w=y.contextMenu&&y.contextMenu();w&&(p=p.concat(w))}),this._renderMenu(f,p)}})}_renderMenu(f,p){p.length!==0&&(this.contextMenu.hideAll(),this.contextMenu.setData(p),this.contextMenu.show(f.e.clientX,f.e.clientY))}_initActionHooks(){this.hooks.forEach(f=>{this.hooksEntity[f]=new E3(["data"])})}_initContextMenu(){this.contextMenu=new Ci(this.canvas.wrapperEl,[]),this.contextMenu.install()}_initServersPlugin(){this.use(en,{})}}class pi{constructor(t,f){J(this,"canvas");J(this,"editor");J(this,"defautOption",{});J(this,"hotkeys",["space"]);J(this,"dragMode",!1);this.canvas=t,this.editor=f,this.dragMode=!1,this.init()}init(){this._initDring()}startDring(){this.dragMode=!0,this.canvas.defaultCursor="grab",this.editor.emit("startDring"),this.canvas.renderAll()}endDring(){this.dragMode=!1,this.canvas.defaultCursor="default",this.canvas.isDragging=!1,this.editor.emit("endDring"),this.canvas.renderAll()}_initDring(){const t=this;this.canvas.on("mouse:down",function(f){const p=f.e;(p.altKey||t.dragMode)&&(t.canvas.defaultCursor="grabbing",t.canvas.discardActiveObject(),t._setDring(),this.selection=!1,this.isDragging=!0,this.lastPosX=p.clientX,this.lastPosY=p.clientY,this.requestRenderAll())}),this.canvas.on("mouse:move",function(f){if(this.isDragging){t.canvas.discardActiveObject(),t.canvas.defaultCursor="grabbing";const{e:p}=f;if(!this.viewportTransform)return;const m=this.viewportTransform;m[4]+=p.clientX-this.lastPosX,m[5]+=p.clientY-this.lastPosY,this.lastPosX=p.clientX,this.lastPosY=p.clientY,this.requestRenderAll()}}),this.canvas.on("mouse:up",function(){this.viewportTransform&&(this.setViewportTransform(this.viewportTransform),this.isDragging=!1,this.selection=!0,this.getObjects().forEach(f=>{f.id!=="workspace"&&f.hasControls&&(f.selectable=!0)}),t.canvas.defaultCursor="default",this.requestRenderAll())})}_setDring(){this.canvas.selection=!1,this.canvas.defaultCursor="grab",this.canvas.getObjects().forEach(t=>{t.selectable=!1}),this.canvas.requestRenderAll()}destroy(){console.log("pluginDestroy")}hotkeyEvent(t,f){f.code==="Space"&&f.type==="keydown"&&(this.dragMode||this.startDring()),f.code==="Space"&&f.type==="keyup"&&this.endDring()}}J(pi,"pluginName","DringPlugin"),J(pi,"events",["startDring","endDring"]),J(pi,"apis",["startDring","endDring"]);class vi{constructor(t,f){J(this,"canvas");J(this,"editor");J(this,"defautOption",{color:"rgba(255,95,95,1)",width:1});J(this,"hotkeys",[""]);J(this,"dragMode",!1);this.canvas=t,this.editor=f,this.dragMode=!1,this.init()}init(){const{canvas:t}=this,f=t.getSelectionContext(),p=5,m=4,y=this;let w,u=1;function r(o){l(o.x+.5,o.y1>o.y2?o.y2:o.y1,o.x+.5,o.y2>o.y1?o.y2:o.y1)}function a(o){l(o.x1>o.x2?o.x2:o.x1,o.y+.5,o.x2>o.x1?o.x2:o.x1,o.y+.5)}function l(o,h,n,d){w!=null&&(f.save(),f.lineWidth=y.defautOption.width,f.strokeStyle=y.defautOption.color,f.beginPath(),f.moveTo(o*u+w[4],h*u+w[5]),f.lineTo(n*u+w[4],d*u+w[5]),f.stroke(),f.restore())}function i(o,h){o=Math.round(o),h=Math.round(h);for(let n=o-m,d=o+m;n<=d;n++)if(n===h)return!0;return!1}const s=[],e=[];t.on("mouse:down",()=>{w=t.viewportTransform,u=t.getZoom()}),t.on("object:moving",o=>{if(w===void 0||o.target===void 0)return;const h=o.target,n=t.getObjects(),d=h.getCenterPoint(),g=d.x,v=d.y,_=h.getBoundingRect(),b=_.height/w[3],C=_.width/w[0];let S=!1,E=!1;if(t._currentTransform){for(let V=n.length;V--;){if(n[V]===h||h instanceof K.fabric.GuideLine&&n[V]instanceof K.fabric.GuideLine)continue;const W=n[V].getCenterPoint(),L=W.x,A=W.y,X=n[V].getBoundingRect(),B=X.height/w[3],st=X.width/w[0];i(L,g)&&(E=!0,s.push({x:L,y1:A<v?A-B/2-p:A+B/2+p,y2:v>A?v+b/2+p:v-b/2-p}),h.setPositionByOrigin(new K.fabric.Point(L,v),"center","center")),i(L-st/2,g-C/2)&&(E=!0,s.push({x:L-st/2,y1:A<v?A-B/2-p:A+B/2+p,y2:v>A?v+b/2+p:v-b/2-p}),h.setPositionByOrigin(new K.fabric.Point(L-st/2+C/2,v),"center","center")),i(L+st/2,g+C/2)&&(E=!0,s.push({x:L+st/2,y1:A<v?A-B/2-p:A+B/2+p,y2:v>A?v+b/2+p:v-b/2-p}),h.setPositionByOrigin(new K.fabric.Point(L+st/2-C/2,v),"center","center")),i(A,v)&&(S=!0,e.push({y:A,x1:L<g?L-st/2-p:L+st/2+p,x2:g>L?g+C/2+p:g-C/2-p}),h.setPositionByOrigin(new K.fabric.Point(g,A),"center","center")),i(A-B/2,v-b/2)&&(S=!0,e.push({y:A-B/2,x1:L<g?L-st/2-p:L+st/2+p,x2:g>L?g+C/2+p:g-C/2-p}),h.setPositionByOrigin(new K.fabric.Point(g,A-B/2+b/2),"center","center")),i(A+B/2,v+b/2)&&(S=!0,e.push({y:A+B/2,x1:L<g?L-st/2-p:L+st/2+p,x2:g>L?g+C/2+p:g-C/2-p}),h.setPositionByOrigin(new K.fabric.Point(g,A+B/2-b/2),"center","center"))}S||(e.length=0),E||(s.length=0)}}),t.on("before:render",()=>{try{t.clearContext(t.contextTop)}catch(o){console.log(o)}}),t.on("after:render",()=>{for(let o=s.length;o--;)r(s[o]);for(let o=e.length;o--;)a(e[o]);s.length=0,e.length=0}),t.on("mouse:up",()=>{s.length=0,e.length=0,t.renderAll()})}destroy(){console.log("pluginDestroy")}}J(vi,"pluginName","AlignGuidLinePlugin"),J(vi,"events",["",""]),J(vi,"apis",[]);const P3=""+new URL("../assets/middlecontrol-a163c615.svg",import.meta.url).href,D3=""+new URL("../assets/middlecontrolhoz-9b7cc4b3.svg",import.meta.url).href,j3=""+new URL("../assets/edgecontrol-dbe38ac6.svg",import.meta.url).href,L3=""+new URL("../assets/rotateicon-ec6729f2.svg",import.meta.url).href;K.fabric.Object.NUM_FRACTION_DIGITS=4;function Ze(c,t,f,p,m,y,w){w!==void 0&&(c.save(),c.translate(t,f),c.rotate(K.fabric.util.degreesToRadians(w)),c.drawImage(p,-m/2,-y/2,m,y),c.restore())}function F3(){const c=document.createElement("img");c.src=P3;const t=document.createElement("img");t.src=D3;function f(m,y,w,u,r){Ze(m,y,w,c,20,25,r.angle)}function p(m,y,w,u,r){Ze(m,y,w,t,25,20,r.angle)}K.fabric.Object.prototype.controls.ml=new K.fabric.Control({x:-.5,y:0,offsetX:-1,cursorStyleHandler:K.fabric.controlsUtils.scaleSkewCursorStyleHandler,actionHandler:K.fabric.controlsUtils.scalingXOrSkewingY,getActionName:K.fabric.controlsUtils.scaleOrSkewActionName,render:f}),K.fabric.Object.prototype.controls.mr=new K.fabric.Control({x:.5,y:0,offsetX:1,cursorStyleHandler:K.fabric.controlsUtils.scaleSkewCursorStyleHandler,actionHandler:K.fabric.controlsUtils.scalingXOrSkewingY,getActionName:K.fabric.controlsUtils.scaleOrSkewActionName,render:f}),K.fabric.Object.prototype.controls.mb=new K.fabric.Control({x:0,y:.5,offsetY:1,cursorStyleHandler:K.fabric.controlsUtils.scaleSkewCursorStyleHandler,actionHandler:K.fabric.controlsUtils.scalingYOrSkewingX,getActionName:K.fabric.controlsUtils.scaleOrSkewActionName,render:p}),K.fabric.Object.prototype.controls.mt=new K.fabric.Control({x:0,y:-.5,offsetY:-1,cursorStyleHandler:K.fabric.controlsUtils.scaleSkewCursorStyleHandler,actionHandler:K.fabric.controlsUtils.scalingYOrSkewingX,getActionName:K.fabric.controlsUtils.scaleOrSkewActionName,render:p})}function I3(){const c=document.createElement("img");c.src=j3;function t(f,p,m,y,w){Ze(f,p,m,c,25,25,w.angle)}K.fabric.Object.prototype.controls.tl=new K.fabric.Control({x:-.5,y:-.5,cursorStyleHandler:K.fabric.controlsUtils.scaleCursorStyleHandler,actionHandler:K.fabric.controlsUtils.scalingEqually,render:t}),K.fabric.Object.prototype.controls.bl=new K.fabric.Control({x:-.5,y:.5,cursorStyleHandler:K.fabric.controlsUtils.scaleCursorStyleHandler,actionHandler:K.fabric.controlsUtils.scalingEqually,render:t}),K.fabric.Object.prototype.controls.tr=new K.fabric.Control({x:.5,y:-.5,cursorStyleHandler:K.fabric.controlsUtils.scaleCursorStyleHandler,actionHandler:K.fabric.controlsUtils.scalingEqually,render:t}),K.fabric.Object.prototype.controls.br=new K.fabric.Control({x:.5,y:.5,cursorStyleHandler:K.fabric.controlsUtils.scaleCursorStyleHandler,actionHandler:K.fabric.controlsUtils.scalingEqually,render:t})}function $3(c){const t="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3E%3Csvg version='1.1' id='Ebene_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='595.275px' height='595.275px' viewBox='200 215 230 470' xml:space='preserve'%3E%3Ccircle style='fill:%23F44336;' cx='299.76' cy='439.067' r='218.516'/%3E%3Cg%3E%3Crect x='267.162' y='307.978' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -222.6202 340.6915)' style='fill:white;' width='65.545' height='262.18'/%3E%3Crect x='266.988' y='308.153' transform='matrix(0.7071 0.7071 -0.7071 0.7071 398.3889 -83.3116)' style='fill:white;' width='65.544' height='262.179'/%3E%3C/g%3E%3C/svg%3E",f=document.createElement("img");f.src=t;function p(y,w,u,r,a){Ze(y,w,u,f,24,24,a.angle)}function m(y,w){if(w.action==="rotate")return!0;const u=c.getActiveObjects();return u&&(u.map(r=>c.remove(r)),c.requestRenderAll(),c.discardActiveObject()),!0}K.fabric.Object.prototype.controls.deleteControl=new K.fabric.Control({x:.5,y:-.5,offsetY:-16,offsetX:16,cursorStyle:"pointer",mouseUpHandler:m,render:p})}function B3(){const c=document.createElement("img");c.src=L3;function t(f,p,m,y,w){Ze(f,p,m,c,40,40,w.angle)}K.fabric.Object.prototype.controls.mtr=new K.fabric.Control({x:0,y:.5,cursorStyleHandler:K.fabric.controlsUtils.rotationStyleHandler,actionHandler:K.fabric.controlsUtils.rotationWithSnapping,offsetY:30,actionName:"rotate",render:t})}class uo{constructor(t,f){J(this,"canvas");J(this,"editor");this.canvas=t,this.editor=f,this.init()}init(){$3(this.canvas),I3(),F3(),B3(),K.fabric.Object.prototype.set({transparentCorners:!1,borderColor:"#51B9F9",cornerColor:"#FFF",borderScaleFactor:2.5,cornerStyle:"circle",cornerStrokeColor:"#0E98FC",borderOpacityWhenMoving:1})}destroy(){console.log("pluginDestroy")}}J(uo,"pluginName","ControlsPlugin");function ve(c){return`url("data:image/svg+xml,%3Csvg height='18' width='18' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: black;'%3E%3Cg fill='none' transform='rotate(${c} 16 16)'%3E%3Cpath d='M22.4484 0L32 9.57891L22.4484 19.1478V13.1032C17.6121 13.8563 13.7935 17.6618 13.0479 22.4914H19.2141L9.60201 32.01L0 22.4813H6.54912C7.36524 14.1073 14.0453 7.44023 22.4484 6.61688V0Z' fill='white'/%3E%3Cpath d='M24.0605 3.89587L29.7229 9.57896L24.0605 15.252V11.3562C17.0479 11.4365 11.3753 17.0895 11.3048 24.0879H15.3048L9.60201 29.7308L3.90932 24.0879H8.0806C8.14106 15.3223 15.2645 8.22345 24.0605 8.14313V3.89587Z' fill='black'/%3E%3C/g%3E%3C/svg%3E ") 12 12,crosshair`}class fo{constructor(t,f){J(this,"canvas");J(this,"editor");this.canvas=t,this.editor=f,this.init()}init(){const{canvas:t}=this;K.fabric.Object.prototype.controls.mtr=new K.fabric.Control({x:-.5,y:-.5,offsetY:-10,offsetX:-10,rotate:20,actionName:"rotate",actionHandler:K.fabric.controlsUtils.rotationWithSnapping,render:()=>""}),K.fabric.Object.prototype.controls.mtr2=new K.fabric.Control({x:.5,y:-.5,offsetY:-10,offsetX:10,rotate:20,actionName:"rotate",actionHandler:K.fabric.controlsUtils.rotationWithSnapping,render:()=>""}),K.fabric.Object.prototype.controls.mtr3=new K.fabric.Control({x:.5,y:.5,offsetY:10,offsetX:10,rotate:20,actionName:"rotate",actionHandler:K.fabric.controlsUtils.rotationWithSnapping,render:()=>""}),K.fabric.Object.prototype.controls.mtr4=new K.fabric.Control({x:-.5,y:.5,offsetY:10,offsetX:-10,rotate:20,actionName:"rotate",actionHandler:K.fabric.controlsUtils.rotationWithSnapping,render:()=>""}),t.on("after:render",()=>{var m;const f=t.getActiveObject(),p=(m=f==null?void 0:f.angle)==null?void 0:m.toFixed(2);p!==void 0&&(K.fabric.Object.prototype.controls.mtr.cursorStyle=ve(Number(p)),K.fabric.Object.prototype.controls.mtr2.cursorStyle=ve(Number(p)+90),K.fabric.Object.prototype.controls.mtr3.cursorStyle=ve(Number(p)+180),K.fabric.Object.prototype.controls.mtr4.cursorStyle=ve(Number(p)+270))}),t.on("object:rotating",f=>{var y,w,u;const p=t.lowerCanvasEl.nextSibling,m=(w=(y=t.getActiveObject())==null?void 0:y.angle)==null?void 0:w.toFixed(2);if(m!==void 0)switch((u=f.transform)==null?void 0:u.corner){case"mtr":p.style.cursor=ve(Number(m));break;case"mtr2":p.style.cursor=ve(Number(m)+90);break;case"mtr3":p.style.cursor=ve(Number(m)+180);break;case"mtr4":p.style.cursor=ve(Number(m)+270);break}})}destroy(){console.log("pluginDestroy")}}J(fo,"pluginName","ControlsRotatePlugin");class nn{constructor(t,f){J(this,"canvas");J(this,"editor");this.canvas=t,this.editor=f}center(t,f){const p=t.getCenterPoint();return this.canvas._centerObject(f,p)}centerV(t,f){return this.canvas._centerObject(f,new K.fabric.Point(f.getCenterPoint().x,t.getCenterPoint().y))}centerH(t,f){return this.canvas._centerObject(f,new K.fabric.Point(t.getCenterPoint().x,f.getCenterPoint().y))}position(t){const f=["centerH","center","centerV"],p=this.canvas.getActiveObject();if(f.includes(t)&&p){const m=this.canvas.getObjects().find(y=>y.id==="workspace");m&&(console.log(this[t]),this[t](m,p)),this.canvas.renderAll()}}contextMenu(){if(this.canvas.getActiveObject())return[{text:"水平垂直居中",hotkey:"Ctrl+V",disabled:!1,onclick:()=>this.position("center")}]}destroy(){console.log("pluginDestroy")}}J(nn,"pluginName","CenterAlignPlugin"),J(nn,"apis",["centerH","center","position","centerV"]);class rn{constructor(t,f){J(this,"canvas");J(this,"editor");this.canvas=t,this.editor=f}_getWorkspace(){return this.canvas.getObjects().find(t=>t.id==="workspace")}_workspaceSendToBack(){const t=this._getWorkspace();t&&t.sendToBack()}up(){const t=this.canvas.getActiveObjects();if(t&&t.length===1){const f=this.canvas.getActiveObjects()[0];f&&f.bringForward(),this.canvas.renderAll(),this._workspaceSendToBack()}}upTop(){const t=this.canvas.getActiveObjects();if(t&&t.length===1){const f=this.canvas.getActiveObjects()[0];f&&f.bringToFront(),this.canvas.renderAll(),console.log(this),this._workspaceSendToBack()}}down(){const t=this.canvas.getActiveObjects();if(t&&t.length===1){const f=this.canvas.getActiveObjects()[0];f&&f.sendBackwards(),this.canvas.renderAll(),this._workspaceSendToBack()}}downTop(){const t=this.canvas.getActiveObjects();if(t&&t.length===1){const f=this.canvas.getActiveObjects()[0];f&&f.sendToBack(),this.canvas.renderAll(),this._workspaceSendToBack()}}contextMenu(){if(this.canvas.getActiveObject())return[{text:"图层管理",hotkey:"❯",subitems:[{text:"上一个",hotkey:"key",onclick:()=>this.up()},{text:"下一个",hotkey:"key",onclick:()=>this.down()},{text:"置顶",hotkey:"key",onclick:()=>this.upTop()},{text:"置底",hotkey:"key",onclick:()=>this.downTop()}]}]}destroy(){console.log("pluginDestroy")}}J(rn,"pluginName","LayerPlugin"),J(rn,"apis",["up","upTop","down","downTop"]);class sn{constructor(t,f){J(this,"canvas");J(this,"editor");J(this,"hotkeys",["ctrl+v","ctrl+c"]);J(this,"cache");this.canvas=t,this.editor=f,this.cache=null}_copyActiveSelection(t){const p=this.canvas;t==null||t.clone(m=>{m.clone(y=>{p.discardActiveObject(),!(y.left===void 0||y.top===void 0)&&(y.canvas=p,y.set({left:y.left+10,top:y.top+10,evented:!0,id:Lt()}),y.forEachObject(w=>{w.id=Lt(),p.add(w)}),y.setCoords(),p.setActiveObject(y),p.requestRenderAll())})})}_copyObject(t){const p=this.canvas;t==null||t.clone(m=>{m.left===void 0||m.top===void 0||(p.discardActiveObject(),m.set({left:m.left+10,top:m.top+10,evented:!0,id:Lt()}),p.add(m),p.setActiveObject(m),p.requestRenderAll())})}clone(t){const f=t||this.canvas.getActiveObject();f&&((f==null?void 0:f.type)==="activeSelection"?this._copyActiveSelection(f):this._copyObject(f))}hotkeyEvent(t,f){if(t==="ctrl+c"&&f.type==="keydown"){const p=this.canvas.getActiveObject();this.cache=p}t==="ctrl+v"&&f.type==="keydown"&&this.cache&&this.clone(this.cache)}contextMenu(){if(this.canvas.getActiveObject())return[{text:"复制",hotkey:"Ctrl+V",disabled:!1,onclick:()=>this.clone()}]}destroy(){console.log("pluginDestroy")}}J(sn,"pluginName","CopyPlugin"),J(sn,"apis",["clone"]);class go{constructor(t,f){J(this,"canvas");J(this,"editor");J(this,"hotkeys",["left","right","down","up"]);this.canvas=t,this.editor=f}hotkeyEvent(t,f){if(f.type==="keydown"){const{canvas:p}=this,m=p.getActiveObject();if(!m)return;switch(t){case"left":if(m.left===void 0)return;m.set("left",m.left-1);break;case"right":if(m.left===void 0)return;m.set("left",m.left+1);break;case"down":if(m.top===void 0)return;m.set("top",m.top+1);break;case"up":if(m.top===void 0)return;m.set("top",m.top-1);break}p.renderAll()}}destroy(){console.log("pluginDestroy")}}J(go,"pluginName","MoveHotKeyPlugin");class on{constructor(t,f){J(this,"canvas");J(this,"editor");J(this,"hotkeys",["backspace"]);this.canvas=t,this.editor=f}hotkeyEvent(t,f){f.type==="keydown"&&t==="backspace"&&this.del()}del(){const{canvas:t}=this,f=t.getActiveObjects();f&&(f.map(p=>t.remove(p)),t.requestRenderAll(),t.discardActiveObject())}contextMenu(){if(this.canvas.getActiveObject())return[null,{text:"删除",hotkey:"Ctrl+V",disabled:!1,onclick:()=>this.del()}]}destroy(){console.log("pluginDestroy")}}J(on,"pluginName","DeleteHotKeyPlugin"),J(on,"apis",["del"]);class an{constructor(t,f){J(this,"canvas");J(this,"editor");this.canvas=t,this.editor=f}unGroup(){const t=this.canvas.getActiveObject();t&&(t.toActiveSelection(),t.getObjects().forEach(f=>{f.set("id",Lt())}),this.canvas.discardActiveObject().renderAll())}group(){const t=this.canvas.getActiveObject();if(!t)return;const f=t.toGroup(),p=f.getObjects();f.clone(m=>{m.set("id",Lt()),this.canvas.remove(f),p.forEach(y=>{this.canvas.remove(y)}),this.canvas.add(m),this.canvas.setActiveObject(m)})}contextMenu(){const t=this.canvas.getActiveObject();if(t&&t.type==="group")return[{text:"拆分组合",hotkey:"Ctrl+V",disabled:!1,onclick:()=>this.unGroup()}];if(this.canvas.getActiveObjects().length>1)return[{text:"组合",hotkey:"Ctrl+V",disabled:!1,onclick:()=>this.group()}]}destroy(){console.log("pluginDestroy")}}J(an,"pluginName","GroupPlugin"),J(an,"apis",["unGroup","group"]);K.fabric.Arrow=K.fabric.util.createClass(K.fabric.Line,{type:"arrow",superType:"drawing",initialize(c,t){if(!c){const{x1:f,x2:p,y1:m,y2:y}=t;c=[f,m,p,y]}t=t||{},this.callSuper("initialize",c,t)},_render(c){this.callSuper("_render",c),c.save();const t=this.x2-this.x1,f=this.y2-this.y1,p=Math.atan2(f,t);c.translate((this.x2-this.x1)/2,(this.y2-this.y1)/2),c.rotate(p),c.beginPath(),c.moveTo(5,0),c.lineTo(-5,5),c.lineTo(-5,-5),c.closePath(),c.fillStyle=this.stroke,c.fill(),c.restore()}});K.fabric.Arrow.fromObject=(c,t)=>{const{x1:f,x2:p,y1:m,y2:y}=c;return t(new K.fabric.Arrow([f,m,p,y],c))};const R3=K.fabric.Arrow;class ln{constructor(t,f){J(this,"canvas");J(this,"editor");J(this,"isDrawingLineMode");J(this,"isArrow");J(this,"lineToDraw");J(this,"pointer");J(this,"pointerPoints");J(this,"isDrawingLine");this.canvas=t,this.editor=f,this.isDrawingLine=!1,this.isDrawingLineMode=!1,this.isArrow=!1,this.lineToDraw=null,this.pointer=null,this.pointerPoints=null,this.init()}init(){const{canvas:t}=this;t.on("mouse:down",f=>{if(!this.isDrawingLineMode)return;t.discardActiveObject(),t.getObjects().forEach(m=>{m.selectable=!1,m.hasControls=!1}),t.requestRenderAll(),this.isDrawingLine=!0,this.pointer=t.getPointer(f.e),this.pointerPoints=[this.pointer.x,this.pointer.y,this.pointer.x,this.pointer.y];const p=this.isArrow?R3:K.fabric.Line;this.lineToDraw=new p(this.pointerPoints,{strokeWidth:2,stroke:"#000000",id:Lt()}),this.lineToDraw.selectable=!1,this.lineToDraw.evented=!1,this.lineToDraw.strokeUniform=!0,t.add(this.lineToDraw)}),t.on("mouse:move",f=>{if(!(!this.isDrawingLine||(t.discardActiveObject(),t.getActiveObject()))){if(this.pointer=t.getPointer(f.e),f.e.shiftKey){const m=this.pointerPoints[0],y=this.pointerPoints[1],w=this.pointer.x-m,u=this.pointer.y-y,r=Math.sqrt(w*w+u*u);let a=Math.atan2(u,w)/Math.PI*180;a=parseInt((a+7.5)%360/15)*15;const l=r*Math.cos(a*Math.PI/180),i=r*Math.sin(a*Math.PI/180);this.lineToDraw.set({x2:l+m,y2:i+y})}else this.lineToDraw.set({x2:this.pointer.x,y2:this.pointer.y});t.renderAll()}}),t.on("mouse:up",()=>{this.isDrawingLine&&(this.lineToDraw.setCoords(),this.isDrawingLine=!1,t.discardActiveObject())})}setArrow(t){this.isArrow=t}setMode(t){this.isDrawingLineMode=t,this.isDrawingLineMode||this.endRest()}endRest(){this.canvas.getObjects().forEach(t=>{t.id!=="workspace"&&(t.selectable=!0,t.hasControls=!0)})}destroy(){console.log("pluginDestroy")}}J(ln,"pluginName","DrawLinePlugin"),J(ln,"apis",["setArrow","setMode"]);class po{constructor(t,f){J(this,"canvas");J(this,"editor");J(this,"isDown",!1);this.canvas=t,this.editor=f,this._init()}_init(){this.canvas.on("mouse:down",t=>{this.isDown=!0,t.target&&!t.target.lockMovementX&&!t.target.lockMovementY&&!t.target.lockRotation&&!t.target.lockScalingX&&!t.target.lockScalingY&&(t.target.hasControls=!0)}),this.canvas.on("mouse:up",()=>{this.isDown=!1}),this.canvas.on("mouse:dblclick",t=>{if(t.target&&t.target.type==="group"){const f=this._getGroupObj(t);if(!f)return;if(f.selectable=!0,f.hasControls&&(f.hasControls=!1),this.isText(f)){this._bedingTextEditingEvent(f,t);return}this.canvas.setActiveObject(f),this.canvas.renderAll()}})}_getGroupTextObj(t){var m;const f=this.canvas.getPointer(t.e,!0),p=this.canvas._searchPossibleTargets((m=t.target)==null?void 0:m._objects,f);return p&&this.isText(p)?p:!1}_getGroupObj(t){var m;const f=this.canvas.getPointer(t.e,!0);return this.canvas._searchPossibleTargets((m=t.target)==null?void 0:m._objects,f)}_bedingTextEditingEvent(t,f){if(!f.target)return;const p=t.toObject(),m=f.target,w={"i-text":"IText",text:"Text",textbox:"Textbox"}[p.type],u=m.calcTransformMatrix(),r=u[0],a=u[1],l=u[2],i=u[3],s=u[4],e=u[5],o=r*t.left+l*t.top+s,h=a*t.left+i*t.top+e,n=new K.fabric[w](t.text,Ot(yt({},p),{textAlign:t.textAlign,left:o,top:h,styles:t.styles,groupCopyed:t.group}));n.id=Lt(),t.visible=!1,f.target.addWithUpdate(),n.visible=!0,n.selectable=!0,n.hasConstrols=!1,n.editable=!0,this.canvas.add(n),this.canvas.setActiveObject(n),n.enterEditing(),n.selectAll(),n.on("editing:exited",()=>{t.set({text:n.text,visible:!0}),f.target.addWithUpdate(),n.visible=!1,this.canvas.remove(n),this.canvas.setActiveObject(f.target)})}_bedingEditingEvent(t,f){if(!f.target)return;const p=f.target.left,m=f.target.top,y=this._unGroup()||[],w=()=>{const u=this.canvas.getObjects().filter(a=>a.id&&y.includes(a.id));u.forEach(a=>this.canvas.remove(a));const r=new K.fabric.Group([...u]);r.set("left",p),r.set("top",m),r.set("id",Lt()),t.off("editing:exited",w),this.canvas.add(r),this.canvas.discardActiveObject().renderAll()};t.on("editing:exited",w)}_unGroup(){const t=[],f=this.canvas.getActiveObject();if(f)return f.getObjects().forEach(p=>{const m=Lt();t.push(m),p.set("id",m)}),f.toActiveSelection(),t}isText(t){return t.type&&["i-text","text","textbox"].includes(t.type)}destroy(){console.log("pluginDestroy")}}J(po,"pluginName","GroupTextEditorPlugin");class cn{constructor(t,f){J(this,"canvas");J(this,"editor");this.canvas=t,this.editor=f}left(){const{canvas:t}=this,f=t.getActiveObject(),p=t.getActiveObjects();if(f){const{left:m=0}=f;t.discardActiveObject(),p.forEach(w=>{const u=w.getBoundingRect(!0);w.set({left:m-u.left+Number(w.left)}),w.setCoords()});const y=new K.fabric.ActiveSelection(p,{canvas:t});t.setActiveObject(y),t.requestRenderAll()}}right(){const{canvas:t}=this,f=t.getActiveObject(),p=t.getActiveObjects();if(f){const{left:m=0,width:y=0}=f;t.discardActiveObject(),p.forEach(u=>{const r=u.getBoundingRect(!0);u.set({left:m+y-(r.left+r.width)+Number(u.left)})});const w=new K.fabric.ActiveSelection(p,{canvas:t});t.setActiveObject(w),t.requestRenderAll()}}xcenter(){const{canvas:t}=this,f=t.getActiveObject(),p=t.getActiveObjects();if(f){const{left:m=0,width:y=0}=f;t.discardActiveObject(),p.forEach(u=>{const r=u.getBoundingRect(!0);u.set({left:m+y/2-(r.left+r.width/2)+Number(u.left)})});const w=new K.fabric.ActiveSelection(p,{canvas:t});t.setActiveObject(w),t.requestRenderAll()}}ycenter(){const{canvas:t}=this,f=t.getActiveObject(),p=t.getActiveObjects();if(f){const{top:m=0,height:y=0}=f;t.discardActiveObject(),p.forEach(u=>{const r=u.getBoundingRect(!0);u.set({top:m+y/2-(r.top+r.height/2)+Number(u.top)})});const w=new K.fabric.ActiveSelection(p,{canvas:t});t.setActiveObject(w),t.requestRenderAll()}}top(){const{canvas:t}=this,f=t.getActiveObject(),p=t.getActiveObjects();if(f){const{top:m=0}=f;t.discardActiveObject(),p.forEach(w=>{const u=w.getBoundingRect(!0);w.set({top:m-u.top+Number(w.top)})});const y=new K.fabric.ActiveSelection(p,{canvas:t});t.setActiveObject(y),t.requestRenderAll()}}bottom(){const{canvas:t}=this,f=t.getActiveObject(),p=t.getActiveObjects();if(f){const{top:m=0,height:y=0}=f;t.discardActiveObject(),p.forEach(u=>{const r=u.getBoundingRect(!0);u.set({top:m+y-(r.top+r.height)+Number(u.top)})});const w=new K.fabric.ActiveSelection(p,{canvas:t});t.setActiveObject(w),t.requestRenderAll()}}xequation(){const{canvas:t}=this,f=t.getActiveObject();function p(u){return u.aCoords.tr.x-u.aCoords.tl.x}function m(){let u=0;return f&&f.forEachObject(r=>{u+=p(r)}),u}function y(){const u=m();if(f)return(Number(f.width)-u)/(f._objects.length-1)}function w(u){if(u===0)return 0;let r=0;if(f)for(let a=0;a<u;a++)r+=p(f._objects[a]);return r}if(f&&f.type==="activeSelection"){f._objects.sort((l,i)=>l.left-i.left);const r=y(),a=Number(f.width)/2;f.forEachObject((l,i)=>{const s=w(i),e=r*i+s-a;l.set("left",e)}),t.renderAll()}}yequation(){const{canvas:t}=this,f=t.getActiveObject()||{top:0,height:0};function p(u){return u.aCoords.bl.y-u.aCoords.tl.y}function m(){let u=0;return f.forEachObject(r=>{u+=p(r)}),u}function y(){const u=m();return(f.height-u)/(f._objects.length-1)}function w(u){if(u===0)return 0;let r=0;for(let a=0;a<u;a++)r+=p(f._objects[a]);return r}if(f&&f.type==="activeSelection"){f._objects.sort((l,i)=>l.top-i.top);const r=y(),a=Number(f.height)/2;f.forEachObject((l,i)=>{const s=w(i),e=r*i+s-a;l.set("top",e)}),t.renderAll()}}destroy(){console.log("pluginDestroy")}}J(cn,"pluginName","GroupAlignPlugin"),J(cn,"apis",["left","right","xcenter","ycenter","top","bottom","xequation","yequation"]);class mi{constructor(t,f){J(this,"canvas");J(this,"editor");J(this,"workspaceEl");J(this,"workspace");J(this,"option");this.canvas=t,this.editor=f,this.workspace=null,this.init({width:900,height:2e3})}init(t){const f=document.querySelector("#workspace");if(!f)throw new Error("element #workspace is missing, plz check!");this.workspaceEl=f,this.workspace=null,this.option=t,this._initBackground(),this._initWorkspace(),this._initResizeObserve(),this._bindWheel()}hookImportAfter(){return new Promise(t=>{const f=this.canvas.getObjects().find(p=>p.id==="workspace");f&&(f.set("selectable",!1),f.set("hasControls",!1),this.setSize(f.width,f.height),this.editor.emit("sizeChange",f.width,f.height)),t("")})}hookSaveAfter(){return new Promise(t=>{this.auto(),t(!0)})}_initBackground(){this.canvas.backgroundImage="",this.canvas.setWidth(this.workspaceEl.offsetWidth),this.canvas.setHeight(this.workspaceEl.offsetHeight)}_initWorkspace(){const{width:t,height:f}=this.option,p=new K.fabric.Rect({fill:"rgba(255,255,255,1)",width:t,height:f,id:"workspace",strokeWidth:0});p.set("selectable",!1),p.set("hasControls",!1),p.hoverCursor="default",this.canvas.add(p),this.canvas.renderAll(),this.workspace=p,this.auto()}setCenterFromObject(t){const{canvas:f}=this,p=t.getCenterPoint(),m=f.viewportTransform;f.width===void 0||f.height===void 0||!m||(m[4]=f.width/2-p.x*m[0],m[5]=f.height/2-p.y*m[3],f.setViewportTransform(m),f.renderAll())}_initResizeObserve(){new ResizeObserver(Xi(()=>{this.auto()},50)).observe(this.workspaceEl)}setSize(t,f){this._initBackground(),this.option.width=t,this.option.height=f,this.workspace=this.canvas.getObjects().find(p=>p.id==="workspace"),this.workspace.set("width",t),this.workspace.set("height",f),this.editor.emit("sizeChange",this.workspace.width,this.workspace.height),this.auto()}setZoomAuto(t,f){const{workspaceEl:p}=this,m=p.offsetWidth,y=p.offsetHeight;this.canvas.setWidth(m),this.canvas.setHeight(y);const w=this.canvas.getCenter();this.canvas.setViewportTransform(K.fabric.iMatrix.concat()),this.canvas.zoomToPoint(new K.fabric.Point(w.left,w.top),t),this.workspace&&(this.setCenterFromObject(this.workspace),this.workspace.clone(u=>{this.canvas.clipPath=u,this.canvas.requestRenderAll()}),f&&f(this.workspace.left,this.workspace.top))}_getScale(){const t=this.workspaceEl.offsetWidth,f=this.workspaceEl.offsetHeight;return t/f<this.option.width/this.option.height?t/this.option.width:f/this.option.height}big(){let t=this.canvas.getZoom();t+=.05;const f=this.canvas.getCenter();this.canvas.zoomToPoint(new K.fabric.Point(f.left,f.top),t)}small(){let t=this.canvas.getZoom();t-=.05;const f=this.canvas.getCenter();this.canvas.zoomToPoint(new K.fabric.Point(f.left,f.top),t<0?.01:t)}auto(){const t=this._getScale();this.setZoomAuto(t-.08)}one(){this.setZoomAuto(.8-.08),this.canvas.requestRenderAll()}_bindWheel(){this.canvas.on("mouse:wheel",function(t){const f=t.e.deltaY;let p=this.getZoom();p*=Bn(.999,f),p>20&&(p=20),p<.01&&(p=.01);const m=this.getCenter();this.zoomToPoint(new K.fabric.Point(m.left,m.top),p),t.e.preventDefault(),t.e.stopPropagation()})}destroy(){console.log("pluginDestroy")}}J(mi,"pluginName","WorkspacePlugin"),J(mi,"events",["sizeChange"]),J(mi,"apis",["big","small","auto","one","setSize"]);class vo{constructor(t,f){J(this,"canvas");J(this,"editor");this.canvas=t,this.editor=f}hookImportBefore(t){return mc(t)}destroy(){console.log("pluginDestroy")}}J(vo,"pluginName","DownFontPlugin");class _i{constructor(t,f){J(this,"canvas");J(this,"editor");J(this,"hotkeys",["ctrl+z","ctrl+shift+z","⌘+z","⌘+shift+z"]);J(this,"history");J(this,"renderCanvas",()=>{this.history.pause(),this.canvas.clear(),this.canvas.loadFromJSON(this.history.source.value,()=>{this.canvas.renderAll(),this.history.resume()})});this.canvas=t,this.editor=f,this._init()}_init(){this.history=dc(vt(),{capacity:50}),this.canvas.on({"object:added":t=>this._save(t),"object:modified":t=>this._save(t),"selection:updated":t=>this._save(t)})}hookImportAfter(){this.history.clear()}getHistory(){return this.history}_save(t){t.action===void 0&&t.e||!this.canvas||!this.canvas.getObjects().find(m=>m.id==="workspace")||this.history.isTracking.value&&(this.history.source.value=this.editor.getJson())}undo(){this.history.canUndo.value&&(this.history.undo(),this.renderCanvas())}redo(){this.history.redo(),this.renderCanvas()}hotkeyEvent(t,f){if(f.type==="keydown")switch(t){case"ctrl+z":case"⌘+z":this.undo();break;case"ctrl+shift+z":case"⌘+shift+z":this.redo();break}}}J(_i,"pluginName","HistoryPlugin"),J(_i,"apis",["undo","redo","getHistory"]),J(_i,"events",["historyInitSuccess"]);class hn{constructor(t,f){J(this,"canvas");J(this,"editor");J(this,"selectedMode");this.canvas=t,this.editor=f,this.selectedMode=vt(re.EMPTY),this.init()}init(){Ri.on(Zt.ONE,()=>this.selectedMode.value=re.ONE),Ri.on(Zt.MULTI,()=>this.selectedMode.value=re.MULTI),Ri.on(Zt.CANCEL,()=>this.selectedMode.value=re.EMPTY)}flip(t){const f=this.canvas.getActiveObject();f&&(f.set(`flip${t}`,!f[`flip${t}`]).setCoords(),this.canvas.requestRenderAll())}contextMenu(){if(this.selectedMode.value===re.ONE)return[{text:"翻转",hotkey:"❯",subitems:[{text:Nn("flip.x"),hotkey:"|",onclick:()=>this.flip("X")},{text:Nn("flip.y"),hotkey:"-",onclick:()=>this.flip("Y")}]}]}destroy(){console.log("pluginDestroy")}}J(hn,"pluginName","FlipPlugin"),J(hn,"apis",["flip"]);const z3=c=>{const t=[.02,.03,.05,.1,.2,.5,1,2,5,10,18],f=[5e3,2500,1e3,500,250,100,50,25,10,5,2];let p=0;for(;p<t.length&&t[p]<c;)p++;return f[p-1]||5e3},Ur=(c,t)=>{const f=t?"left":"top",p=t?"width":"height";c.sort((w,u)=>w[f]-u[f]);const m=[];let y=Object.assign({},c[0]);for(const w of c){const u=Object.assign({},w);y[f]+y[p]>=u[f]?y[p]=Math.max(y[f]+y[p],u[f]+u[p])-y[f]:(m.push(y),y=Object.assign({},u))}return m.push(y),m},Ni=(c,t)=>{c.save();const{left:f,top:p,width:m,height:y,stroke:w,lineWidth:u}=t;c.beginPath(),w&&(c.strokeStyle=w),c.lineWidth=u!=null?u:1,c.moveTo(f,p),c.lineTo(f+m,p+y),c.stroke(),c.restore()},Wi=(c,t)=>{c.save();const{left:f,top:p,text:m,fill:y,align:w,angle:u,fontSize:r}=t;y&&(c.fillStyle=y),c.textAlign=w!=null?w:"left",c.textBaseline="top",c.font=`${r!=null?r:10}px sans-serif`,u&&(c.translate(f,p),c.rotate(Math.PI/180*u),c.translate(-f,-p)),c.fillText(m,f,p),c.restore()},un=(c,t)=>{c.save();const{left:f,top:p,width:m,height:y,fill:w,stroke:u,strokeWidth:r}=t;c.beginPath(),w&&(c.fillStyle=w),c.rect(f,p,m,y),c.fill(),u&&(c.strokeStyle=u,c.lineWidth=r!=null?r:1,c.stroke()),c.restore()},ui=(c,t)=>{c.save();const{isHorizontal:f,left:p,top:m,width:y,height:w,backgroundColor:u}=t,r=f?c.createLinearGradient(p,w/2,p+y,w/2):c.createLinearGradient(y/2,m,y/2,w+m),a=new K.fabric.Color(u);a.setAlpha(0),r.addColorStop(0,a.toRgba()),r.addColorStop(.33,u),r.addColorStop(.67,u),r.addColorStop(1,a.toRgba()),un(c,{left:p,top:m,width:y,height:w,fill:r}),c.restore()};function H3(){K.fabric.GuideLine||(K.fabric.GuideLine=K.fabric.util.createClass(K.fabric.Line,{type:"GuideLine",selectable:!1,hasControls:!1,hasBorders:!1,stroke:"#4bec13",originX:"center",originY:"center",padding:4,globalCompositeOperation:"difference",axis:"horizontal",initialize(c,t){const f=t.axis==="horizontal";this.hoverCursor=f?"ns-resize":"ew-resize";const p=f?[-999999,c,999999,c]:[c,-999999,c,999999];t[f?"lockMovementX":"lockMovementY"]=!0,this.callSuper("initialize",p,t),this.on("mousedown:before",m=>{this.activeOn==="down"&&this.canvas.setActiveObject(this,m.e)}),this.on("moving",m=>{this.canvas.ruler.options.enabled&&this.isPointOnRuler(m.e)?this.moveCursor="not-allowed":this.moveCursor=this.isHorizontal()?"ns-resize":"ew-resize",this.canvas.fire("guideline:moving",{target:this,e:m.e})}),this.on("mouseup",m=>{if(this.canvas.ruler.options.enabled&&this.isPointOnRuler(m.e)){this.canvas.remove(this);return}this.moveCursor=this.isHorizontal()?"ns-resize":"ew-resize",this.canvas.fire("guideline:mouseup",{target:this,e:m.e})}),this.on("removed",()=>{this.off("removed"),this.off("mousedown:before"),this.off("moving"),this.off("mouseup")})},getBoundingRect(c,t){this.bringToFront();const f=this.isHorizontal(),p=this.callSuper("getBoundingRect",c,t);return p[f?"top":"left"]+=p[f?"height":"width"]/2,p[f?"height":"width"]=0,p},isPointOnRuler(c){const t=this.isHorizontal(),f=this.canvas.ruler.isPointOnRuler(new K.fabric.Point(c.offsetX,c.offsetY));return t&&f==="horizontal"||!t&&f==="vertical"?f:!1},isHorizontal(){return this.height===0}}),K.fabric.GuideLine.fromObject=function(c,t){const f=K.fabric.util.object.clone;function p(w){delete w.xy,t&&t(w)}const m=f(c,!0),y=m.height===0;m.xy=y?m.y1:m.x1,m.axis=y?"horizontal":"vertical",K.fabric.Object._fromObject(m.type,m,p,"xy")})}K.fabric.GuideLine;class V3{constructor(t){J(this,"ctx");J(this,"options");J(this,"startCalibration");J(this,"activeOn","up");J(this,"objectRect");J(this,"eventHandler",{calcObjectRect:Xi(this.calcObjectRect.bind(this),15),clearStatus:this.clearStatus.bind(this),canvasMouseDown:this.canvasMouseDown.bind(this),canvasMouseMove:Xi(this.canvasMouseMove.bind(this),15),canvasMouseUp:this.canvasMouseUp.bind(this),render:t=>{t.ctx&&this.render()}});J(this,"lastAttr",{status:"out",cursor:void 0,selection:void 0});J(this,"tempGuidelLine");J(this,"getCommonEventInfo",t=>{if(!(!this.tempGuidelLine||!t.absolutePointer))return{e:t.e,transform:this.tempGuidelLine.get("transform"),pointer:{x:t.absolutePointer.x,y:t.absolutePointer.y},target:this.tempGuidelLine}});this.options=Object.assign({ruleSize:20,fontSize:10,enabled:!1,backgroundColor:"#fff",borderColor:"#ddd",highlightColor:"#007fff",textColor:"#888"},t),this.ctx=this.options.canvas.getContext(),K.fabric.util.object.extend(this.options.canvas,{ruler:this}),H3(),this.options.enabled&&this.enable()}destroy(){this.disable()}clearGuideline(){this.options.canvas.remove(...this.options.canvas.getObjects(K.fabric.GuideLine.prototype.type))}showGuideline(){this.options.canvas.getObjects(K.fabric.GuideLine.prototype.type).forEach(t=>{t.set("visible",!0)}),this.options.canvas.renderAll()}hideGuideline(){this.options.canvas.getObjects(K.fabric.GuideLine.prototype.type).forEach(t=>{t.set("visible",!1)}),this.options.canvas.renderAll()}enable(){this.options.enabled=!0,this.options.canvas.on("after:render",this.eventHandler.calcObjectRect),this.options.canvas.on("after:render",this.eventHandler.render),this.options.canvas.on("mouse:down",this.eventHandler.canvasMouseDown),this.options.canvas.on("mouse:move",this.eventHandler.canvasMouseMove),this.options.canvas.on("mouse:up",this.eventHandler.canvasMouseUp),this.options.canvas.on("selection:cleared",this.eventHandler.clearStatus),this.showGuideline(),this.render()}disable(){this.options.canvas.off("after:render",this.eventHandler.calcObjectRect),this.options.canvas.off("after:render",this.eventHandler.render),this.options.canvas.off("mouse:down",this.eventHandler.canvasMouseDown),this.options.canvas.off("mouse:move",this.eventHandler.canvasMouseMove),this.options.canvas.off("mouse:up",this.eventHandler.canvasMouseUp),this.options.canvas.off("selection:cleared",this.eventHandler.clearStatus),this.hideGuideline(),this.options.enabled=!1}render(){var f,p;const t=this.options.canvas.viewportTransform;t&&(this.draw({isHorizontal:!0,rulerLength:this.getSize().width,startCalibration:(f=this.startCalibration)!=null&&f.x?this.startCalibration.x:-(t[4]/t[0])}),this.draw({isHorizontal:!1,rulerLength:this.getSize().height,startCalibration:(p=this.startCalibration)!=null&&p.y?this.startCalibration.y:-(t[5]/t[3])}),ui(this.ctx,{isHorizontal:!0,left:-10,top:-10,width:this.options.ruleSize*2+10,height:this.options.ruleSize+10,backgroundColor:this.options.backgroundColor}),ui(this.ctx,{isHorizontal:!1,left:-10,top:-10,width:this.options.ruleSize+10,height:this.options.ruleSize*2+10,backgroundColor:this.options.backgroundColor}))}getSize(){var t,f;return{width:(t=this.options.canvas.width)!=null?t:0,height:(f=this.options.canvas.height)!=null?f:0}}getZoom(){return this.options.canvas.getZoom()}draw(t){const{isHorizontal:f,rulerLength:p,startCalibration:m}=t,y=this.getZoom(),w=z3(y),u=p/y,r=Math[m>0?"floor":"ceil"](m/w)*w,a=r-m,l=this.getSize();un(this.ctx,{left:0,top:0,width:f?l.width:this.options.ruleSize,height:f?this.options.ruleSize:l.height,fill:this.options.backgroundColor,stroke:this.options.borderColor});const i=new K.fabric.Color(this.options.textColor);for(let s=0;s+a<=Math.ceil(u);s+=w){const e=(a+s)*y,o=r+s+"",h=10*o.length/4,n=f?e-h-1:this.options.ruleSize/2-this.options.fontSize/2-4,d=f?this.options.ruleSize/2-this.options.fontSize/2-4:e+h;Wi(this.ctx,{text:o,left:n,top:d,fill:i.toRgb(),angle:f?0:-90})}for(let s=0;s+a<=Math.ceil(u);s+=w){const e=Math.round((a+s)*y),o=f?e:this.options.ruleSize-8,h=f?this.options.ruleSize-8:e,n=f?0:8,d=f?8:0;Ni(this.ctx,{left:o,top:h,width:n,height:d,stroke:i.toRgb()})}if(this.objectRect){const s=f?"x":"y";this.objectRect[s].forEach(e=>{if(e.skip===s)return;const o=E=>Math.round(E/y+m)+"",h=o(f?e.left:e.top),n=o(f?e.left+e.width:e.top+e.height),d=h===n,g={isHorizontal:f,width:f?160:this.options.ruleSize-8,height:f?this.options.ruleSize-8:160,backgroundColor:this.options.backgroundColor};ui(this.ctx,Ot(yt({},g),{left:f?e.left-80:0,top:f?0:e.top-80})),d||ui(this.ctx,Ot(yt({},g),{left:f?e.width+e.left-80:0,top:f?0:e.height+e.top-80}));const v=new K.fabric.Color(this.options.highlightColor);v.setAlpha(.5),un(this.ctx,{left:f?e.left:this.options.ruleSize-8,top:f?this.options.ruleSize-8:e.top,width:f?e.width:8,height:f?8:e.height,fill:v.toRgba()});const _=this.options.ruleSize/2-this.options.fontSize/2-4,b={fill:v.toRgba(),angle:f?0:-90};Wi(this.ctx,Ot(yt({},b),{text:h,left:f?e.left-2:_,top:f?_:e.top-2,align:d?"center":f?"right":"left"})),d||Wi(this.ctx,Ot(yt({},b),{text:n,left:f?e.left+e.width+2:_,top:f?_:e.top+e.height+2,align:f?"left":"right"}));const C=d?8:14;v.setAlpha(1);const S={width:f?0:C,height:f?C:0,stroke:v.toRgba()};Ni(this.ctx,Ot(yt({},S),{left:f?e.left:this.options.ruleSize-C,top:f?this.options.ruleSize-C:e.top})),d||Ni(this.ctx,Ot(yt({},S),{left:f?e.left+e.width:this.options.ruleSize-C,top:f?this.options.ruleSize-C:e.top+e.height}))})}}calcObjectRect(){const t=this.options.canvas.getActiveObjects();if(t.length===0)return;const f=t.reduce((p,m)=>{var w,u;const y=m.getBoundingRect(!1,!0);if(m.group){const r=yt({top:0,left:0,width:0,height:0,scaleX:1,scaleY:1},m.group);y.width*=r.scaleX,y.height*=r.scaleY;const a=r.width/2+r.left,l=(r.width/2+((w=m.left)!=null?w:0))*(1-r.scaleX);y.left+=(a-l)*this.getZoom();const i=r.height/2+r.top,s=(r.height/2+((u=m.top)!=null?u:0))*(1-r.scaleY);y.top+=(i-s)*this.getZoom()}return m instanceof K.fabric.GuideLine&&(y.skip=m.isHorizontal()?"x":"y"),p.push(y),p},[]);f.length!==0&&(this.objectRect={x:Ur(f,!0),y:Ur(f,!1)})}clearStatus(){this.objectRect=void 0}isPointOnRuler(t){return new K.fabric.Rect({left:0,top:0,width:this.options.ruleSize,height:this.options.canvas.height}).containsPoint(t)?"vertical":new K.fabric.Rect({left:0,top:0,width:this.options.canvas.width,height:this.options.ruleSize}).containsPoint(t)?"horizontal":!1}canvasMouseDown(t){if(!t.pointer||!t.absolutePointer)return;const f=this.isPointOnRuler(t.pointer);f&&this.activeOn==="up"&&(this.lastAttr.selection=this.options.canvas.selection,this.options.canvas.selection=!1,this.activeOn="down",this.tempGuidelLine=new K.fabric.GuideLine(f==="horizontal"?t.absolutePointer.y:t.absolutePointer.x,{axis:f,visible:!1}),this.options.canvas.add(this.tempGuidelLine),this.options.canvas.setActiveObject(this.tempGuidelLine),this.options.canvas._setupCurrentTransform(t.e,this.tempGuidelLine,!0),this.tempGuidelLine.fire("down",this.getCommonEventInfo(t)))}canvasMouseMove(t){if(!t.pointer)return;if(this.tempGuidelLine&&t.absolutePointer){const p={};this.tempGuidelLine.axis==="horizontal"?p.top=t.absolutePointer.y:p.left=t.absolutePointer.x,this.tempGuidelLine.set(Ot(yt({},p),{visible:!0})),this.options.canvas.requestRenderAll();const m=this.getCommonEventInfo(t);this.options.canvas.fire("object:moving",m),this.tempGuidelLine.fire("moving",m)}const f=this.isPointOnRuler(t.pointer);if(!f){this.lastAttr.status!=="out"&&(this.options.canvas.defaultCursor=this.lastAttr.cursor,this.lastAttr.status="out");return}(this.lastAttr.status==="out"||f!==this.lastAttr.status)&&(this.lastAttr.cursor=this.options.canvas.defaultCursor,this.options.canvas.defaultCursor=f==="horizontal"?"ns-resize":"ew-resize",this.lastAttr.status=f)}canvasMouseUp(t){var f;this.activeOn==="down"&&(this.options.canvas.selection=this.lastAttr.selection,this.activeOn="up",(f=this.tempGuidelLine)==null||f.fire("up",this.getCommonEventInfo(t)),this.tempGuidelLine=void 0)}}function U3(c,t){const f=new V3(yt({canvas:c},t));let p;const m=()=>{p=c.getObjects().find(w=>w.id==="workspace")},y=(w,u)=>{const{top:r,height:a,left:l,width:i}=w;if(r===void 0||a===void 0||l===void 0||i===void 0)return!1;const s=u.getBoundingRect(!0,!0),{top:e,height:o,left:h,width:n}=s;return u.isHorizontal()&&(r>e+1||r+a<e+o-1)?!0:!u.isHorizontal()&&(l>h+1||l+i<h+n-1)};return c.on("guideline:moving",w=>{if(!p){m();return}const{target:u}=w;y(p,u)&&(u.moveCursor="not-allowed")}),c.on("guideline:mouseup",w=>{var r;if(!p){m();return}const{target:u}=w;y(p,u)&&(c.remove(u),c.setCursor((r=c.defaultCursor)!=null?r:""))}),f}class fn{constructor(t,f){J(this,"canvas");J(this,"editor");J(this,"ruler");this.canvas=t,this.editor=f,this.init()}hookSaveBefore(){return new Promise(t=>{this.hideGuideline(),t(!0)})}hookSaveAfter(){return new Promise(t=>{this.showGuideline(),t(!0)})}init(){this.ruler=U3(this.canvas)}hideGuideline(){this.ruler.hideGuideline()}showGuideline(){this.ruler.showGuideline()}rulerEnable(){this.ruler.enable()}rulerDisable(){this.ruler.disable()}destroy(){console.log("pluginDestroy")}}J(fn,"pluginName","RulerPlugin"),J(fn,"apis",["hideGuideline","showGuideline","rulerEnable","rulerDisable"]);class dn{constructor(t,f){J(this,"canvas");J(this,"editor");J(this,"apiMapUrl");this.canvas=t,this.editor=f,this.apiMapUrl={template:"https://nihaojob.github.io/vue-fabric-editor-static/template/type.json",svg:"https://nihaojob.github.io/vue-fabric-editor-static/svg/type.json",ai:"https://zzq-typora-picgo.oss-cn-beijing.aliyuncs.com/2024-fengru/templateAI.json"}}getMaterialType(t){return ie(this,null,function*(){const f=this.apiMapUrl[t];return(yield Ti.get(f,{params:{typeId:t}})).data.data})}getMaterialTypeHTTP(t){return ie(this,null,function*(){const f=this.apiMapUrl[t];return(yield Qo(f,{params:{typeId:t}})).data.data})}}J(dn,"pluginName","MaterialPlugin"),J(dn,"apis",["getMaterialType","getMaterialList"]);const N3=c=>(ae("data-v-0988a6ac"),c=c(),le(),c),W3={class:"home"},X3={style:{float:"right"}},Y3={class:"content"},G3={class:"left-panel"},q3={class:"left-panel"},K3={class:"left-panel"},J3={class:"left-panel"},Z3={class:"left-panel"},Q3={id:"workspace"},t2={class:"canvas-box"},e2=N3(()=>I("div",{class:"inside-shadow"},null,-1)),i2={class:"right-bar"},n2={key:0,style:{"padding-top":"10px"}},r2={class:"attr-item"},s2=Ct({name:"Home"}),o2=Object.assign(s2,{setup(c){const t=fs(),f=new M3,p=new qs,m=Rt({menuActive:1,show:!1,toolsBarShow:!0,attrBarShow:!0,select:null,ruler:!1}),y=Zo();Jt(()=>{const l=new K.fabric.Canvas("canvas",{fireRightClick:!0,stopContextMenu:!0,controlsAboveOverlay:!0,imageSmoothingEnabled:!1});f.init(l),f.use(pi),f.use(vi),f.use(uo),f.use(fo),f.use(nn),f.use(rn),f.use(sn),f.use(go),f.use(on),f.use(an),f.use(ln),f.use(po),f.use(cn),f.use(mi),f.use(vo),f.use(_i),f.use(hn),f.use(fn),f.use(dn),p.init(l),m.show=!0,console.log(y.params.command);const i=JSON.parse(y.params.command);i.height?(console.log("router params hight: "+i.height),f.setSize(i.width,i.height),t.setSize(i.width,i.height)):i.json&&f.insertSvgFile(i.json)});const w=l=>{l?f.rulerEnable():f.rulerDisable()},u=()=>{m.toolsBarShow=!m.toolsBarShow},r=l=>{m.menuActive=l,m.toolsBarShow=!0},a=()=>{m.attrBarShow=!m.attrBarShow};return Ve("fabric",K.fabric),Ve("event",p),Ve("canvasEditor",f),(l,i)=>{const s=it("Divider"),e=it("iSwitch"),o=it("Tooltip"),h=it("Header"),n=it("Icon"),d=it("MenuItem"),g=it("Menu"),v=it("Content"),_=it("Layout");return Z(),at("div",W3,[M(_,null,{default:$(()=>[D(m).show?(Z(),wt(h,{key:0},{default:$(()=>[M(Ll),M(s,{type:"vertical"}),M(Ec),M(s,{type:"vertical"}),M(o,{content:l.$t("grid")},{default:$(()=>[M(e,{modelValue:D(m).ruler,"onUpdate:modelValue":i[0]||(i[0]=b=>D(m).ruler=b),onOnChange:w,size:"small",class:"switch"},null,8,["modelValue"])]),_:1},8,["content"]),M(s,{type:"vertical"}),M(ed),I("div",X3,[M(D(sh)),M(D(Gh)),M(hh),M(fh),M(oh)])]),_:1})):bt("",!0),M(v,{style:{display:"flex",height:"calc(100vh - 64px)"}},{default:$(()=>[D(m).show?(Z(),at("div",{key:0,class:qt(`left-bar ${D(m).toolsBarShow&&"show-tools-bar"}`)},[M(g,{"active-name":D(m).menuActive,accordion:"",onOnSelect:r,width:"65px"},{default:$(()=>[M(d,{name:1,class:"menu-item"},{default:$(()=>[M(n,{type:"md-book",size:"24"}),I("div",null,ct(l.$t("templates")),1)]),_:1}),M(d,{name:2,class:"menu-item"},{default:$(()=>[M(n,{type:"md-images",size:"24"}),I("div",null,ct(l.$t("elements")),1)]),_:1}),M(d,{name:3,class:"menu-item"},{default:$(()=>[M(n,{type:"ios-leaf-outline",size:"24"}),I("div",null,ct(l.$t("material.cartoon")),1)]),_:1}),M(d,{name:4,class:"menu-item"},{default:$(()=>[M(n,{type:"md-reorder",size:"24"}),I("div",null,ct(l.$t("layers")),1)]),_:1}),M(d,{name:5,class:"menu-item"},{default:$(()=>[M(n,{type:"md-infinite",size:"24"}),I("div",null,ct(l.$t("AI")),1)]),_:1})]),_:1},8,["active-name"]),Ut(I("div",Y3,[Ut(I("div",G3,[M(Qh)],512),[[Qt,D(m).menuActive===1]]),Ut(I("div",q3,[M(gf),M(jc)],512),[[Qt,D(m).menuActive===2]]),Ut(I("div",K3,[M(yf)],512),[[Qt,D(m).menuActive===3]]),Ut(I("div",J3,[M(pd)],512),[[Qt,D(m).menuActive===4]]),Ut(I("div",Z3,[M(Xu)],512),[[Qt,D(m).menuActive===5]])],512),[[Qt,D(m).toolsBarShow]]),I("div",{class:qt(`close-btn left-btn ${D(m).toolsBarShow&&"left-btn-open"}`),onClick:u},null,2)],2)):bt("",!0),I("div",Q3,[I("div",t2,[e2,I("canvas",{id:"canvas",class:qt(D(m).ruler?"design-stage-grid":"")},null,2),D(m).show?(Z(),wt(Dh,{key:0})):bt("",!0),M(Oh)])]),Ut(I("div",i2,[D(m).show?(Z(),at("div",n2,[M(Ef),M(Tf),M(bh),M(Df),M(Kf),I("div",r2,[M(Fh),M($h),M(gh)]),M(Wc),M(Zc),M(rh)])):bt("",!0),D(m).show?(Z(),wt(um,{key:1})):bt("",!0)],512),[[Qt,D(m).attrBarShow]]),I("div",{class:qt(`close-btn right-btn ${D(m).attrBarShow&&"right-btn-open"}`),onClick:a},null,2)]),_:1})]),_:1})])}}}),a2=Bt(o2,[["__scopeId","data-v-0988a6ac"]]),v2=Object.freeze(Object.defineProperty({__proto__:null,default:a2},Symbol.toStringTag,{value:"Module"}));export{U0 as a,F0 as c,N0 as g,v2 as i,d2 as r,Tr as v};
